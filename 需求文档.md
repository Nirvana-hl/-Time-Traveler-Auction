# 时空旅人拍卖会 - 需求文档

## 1. 项目概述

### 1.1 项目背景

"时空旅人拍卖会"是一款结合实体卡牌与数字技术的创新线下桌游。玩家扮演来自不同时空的旅人，通过竞拍散落在时空中的"奇物"来构建自己的收藏集，争夺"时空影响力"的最高荣誉。

### 1.2 项目目标

- 创造沉浸式的跨时空游戏体验
- 实现实体卡牌与数字技术的无缝结合
- 提供丰富的策略深度和玩家互动
- 支持2-6名玩家同时游戏

### 1.3 技术栈

- **前端**: UniApp框架 (Vue.js)
- **平台**: 微信小程序、支付宝小程序、H5
- **后端**: 云开发或纯前端实现
- **部署**: 小程序平台发布，支持多端适配

## 2. 核心功能需求

### 2.1 游戏基础系统

#### 2.1.1 卡牌信息管理

**功能描述**: 通过点击卡牌展示奇物详细信息

- **输入**: 点击卡牌
- **处理**: 根据卡牌ID获取详细信息
- **输出**: 显示卡牌详细信息页面

**显示内容**:
- 奇物名称和插画
- 时空来源(年代+地点)
- 背景故事描述
- 所属收藏集标签
- 基础价值评分

**技术规格**:

```javascript
// 卡牌数据结构
{
  id: "artifact_001",
  name: "唐代秘色瓷",
  era: "唐代(618-907)",
  location: "中国",
  story: "一段生动的背景故事...",
  collectionTags: ["艺术瑰宝", "东方文明"],
  baseValue: 8,
  image: "/static/images/artifacts/artifact_001.jpg"
}
```

#### 2.1.2 实时拍卖系统

**功能描述**: 管理卡牌竞拍流程

- 拍卖状态管理(准备→预倒计时→竞拍→结束)
- 实时出价显示和更新
- 倒计时器管理(预倒计时5秒，竞拍倒计时30秒)
- 获胜者判定和记录（无人出价则流拍）
- 断线重连一致性：倒计时按服务端剩余时间恢复（上限30秒）

**界面需求**:
- 当前拍卖品展示区域
- 出价输入框和提交按钮
- 当前最高出价显示
- 倒计时进度条
- 玩家出价历史记录

##### 详细时序与规则（补充规范）

- 预倒计时（5秒）
  - 触发：房主点击开始游戏后，广播 `game_started`，客户端进入 `countdown` 阶段
  - UI：显示“游戏即将开始 5s”数字倒计时
  - 行为：此阶段不允许出价，不展示能量HUD

- 拍卖轮（30秒）
  - 触发：广播 `auction_started`，携带本轮上架的拍品列表 `artifacts[]` 与 `duration=30`
  - UI：显示统一倒计时30秒；能量HUD在拍卖阶段显示
  - 出价限制：
    - 出价需严格大于当前最高价
    - 出价金额不得超过玩家当前能量
  - 结算：
    - 倒计时归零时结束所有本轮拍品的拍卖
    - 每件拍品选取最高出价者作为获胜者，将拍品加入其手牌并写入 `room_artifacts`
    - 无人出价则流拍

- 并发拍卖
  - 支持一轮上架多件拍品（当前实现为2件），共享同一30秒倒计时
  - 统一倒计时结束即结算全部当前拍品

- 断线/重连
  - 客户端加入房间时，若服务端存在活跃拍卖，需同步到本地
  - 统一倒计时取“所有活跃拍卖剩余时间的最小值”，上限30秒，至少1秒

- 广播事件
  - `game_started`：`{ gamePhase: 'countdown' }`
  - `auction_started`：`{ artifacts: Artifact[], duration: 30 }`

- 数据持久化（表结构行为）
  - `auctions`：`id, artifact_id, artifact(json), highest_bid, highest_bidder, time_remaining, status`
  - `auction_history`：写入每件拍卖结束时的胜者与价格
  - `room_artifacts`：为获胜者添加拍品归属

#### 2.1.3 收藏集进度追踪

**功能描述**: 追踪玩家收藏集完成情况

**定义多个收藏集类别**:
- 艺术瑰宝(需要3件艺术品)
- 科技奇点(需要2件科技品)
- 生命奥秘(需要3件生物相关)
- 权力象征(需要2件权力物品)

- 实时更新各收藏集完成进度
- 计算收藏集奖励分数

### 2.2 道具商店系统

#### 2.2.1 商店界面

**功能描述**: 提供道具购买界面

- 道具分类展示
- 价格和效果说明
- 玩家货币余额显示
- 购买确认流程

**界面组件**:

```html
<!-- 商店界面结构 -->
<div class="shop-panel">
  <div class="player-balance">当前能量: 50</div>
  <div class="道具-list">
    <div class="道具-item" v-for="item in 道具s" :key="item.id">
      <h4>{{ item.name }} - {{ item.price }}能量</h4>
      <p>{{ item.description }}</p>
      <button @click="buy道具(item)">购买</button>
    </div>
  </div>
</div>
```

#### 2.2.2 道具管理系统

**功能描述**: 管理道具的购买、持有和使用

- 道具库存管理
- 使用条件验证
- 效果执行和状态更新

**道具数据模型**:

```javascript
// 道具数据结构
const 道具s = [
  {
    id: "道具_001",
    name: "时空乱流",
    price: 15,
    description: "强制一名对手将一张奇物放回牌堆",
    type: "破坏",
    targetType: "player_artifact", // 需要选择玩家和具体卡牌
    useTiming: "anytime", // 使用时机
    effect: "return_artifact"
  },
  {
    id: "道具_002", 
    name: "赝品鉴定",
    price: 10,
    description: "当前拍卖的奇物流拍",
    type: "控制",
    targetType: "current_auction",
    useTiming: "auction_countdown",
    effect: "cancel_auction"
  },
  // ... 其他道具
];
```

#### 2.2.3 道具效果系统

**功能描述**: 执行各种道具效果

- 破坏效果(时空乱流)
- 控制效果(时间冻结、赝品鉴定)
- 经济效果(能量窃取)
- 增益效果(双倍拍品)

**效果实现示例**:

```javascript
// 时空乱流效果实现
function executeTimeVortex(targetPlayerId, targetArtifactId) {
  // 验证使用条件
  if (!validate道具Use('时空乱流', currentPlayerId)) return false;
  
  // 执行效果
  const artifact = removeArtifactFromPlayer(targetPlayerId, targetArtifactId);
  returnArtifactToDeck(artifact);
  
  // 更新游戏状态
  updateCollectionProgress();
  addGameLog(`${currentPlayer.name} 对 ${targetPlayer.name} 使用了时空乱流！`);
  
  return true;
}
```

## 3. 用户界面需求

### 3.1 主要界面

#### 3.1.1 主游戏界面

**布局要求**:
- 顶部: 当前拍卖品展示区(30%)
- 中部: 拍卖控制区(20%)
- 底部: 玩家状态和道具栏(30%)
- 侧边: 收藏集进度(20%)

**响应式设计**:
- 平板: 横屏优化，确保多人可见
- 手机: 竖屏适配，简化操作

#### 3.1.2 道具商店界面

**功能区域**:
- 道具分类标签
- 道具详情卡片
- 购买确认弹窗
- 使用说明提示

#### 3.1.3 卡牌信息界面

**展示内容**:
- 全屏卡牌插画
- 详细信息文本
- 返回拍卖按钮

### 3.2 交互设计

#### 3.2.1 拍卖流程交互

- 直观的出价界面
- 实时状态反馈
- 清晰的倒计时显示

#### 3.2.2 道具使用交互

- 简单的选择机制
- 明确的使用确认
- 即时的效果反馈

## 4. 数据模型

### 4.1 核心数据表

#### 4.1.1 玩家数据

```javascript
{
  id: "player_001",
  name: "玩家名称",
  energy: 50, // 时空能量
  artifacts: ["artifact_001", "artifact_005"], // 拥有的奇物ID
  道具s: ["道具_001", "道具_003"], // 拥有的道具ID
  collections: {
    "艺术瑰宝": 2,
    "科技奇点": 1
  }
}
```

#### 4.1.2 游戏状态数据

```javascript
{
  gameId: "game_001",
  phase: "auction", // bidding, 道具, settlement
  currentAuction: {
    artifactId: "artifact_003",
    highestBid: 15,
    highestBidder: "player_002",
    timeRemaining: 45
  },
  players: ["player_001", "player_002"],
  deck: ["artifact_004", "artifact_007"], // 剩余牌堆
  used道具s: ["道具_001_used"] // 已使用道具记录
}
```

## 5. 技术实现需求

### 5.1 前端架构

#### 5.1.1 项目结构

```
src/
├── pages/
│   ├── index/                 # 主游戏页面
│   ├── card-detail/           # 卡牌详情页面
│   ├── shop/                  # 道具商店页面
│   └── collection/             # 收藏集页面
├── components/
│   ├── auction-panel/         # 拍卖面板组件
│   ├── item-shop/             # 道具商店组件
│   ├── player-panel/          # 玩家信息组件
│   ├── collection-tracker/      # 收藏集追踪组件
│   └── card-item/             # 卡牌项组件
├── services/
│   ├── auction-service.js     # 拍卖逻辑
│   ├── item-service.js        # 道具逻辑
│   └── game-state-service.js  # 游戏状态管理
├── static/
│   ├── images/
│   │   └── artifacts/         # 卡牌图片资源
│   └── data/
│       ├── artifacts.json     # 卡牌数据
│       ├── items.json         # 道具数据
│       └── collections.json   # 收藏集配置
└── utils/
    ├── game-utils.js          # 游戏工具函数
    └── storage-utils.js       # 存储工具函数
```

#### 5.1.2 状态管理

使用Vuex管理全局状态:
- 游戏阶段状态
- 玩家数据
- 拍卖状态
- 道具库存

```javascript
// store/index.js
import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

const store = new Vuex.Store({
  state: {
    gamePhase: 'preparation',
    players: [],
    currentAuction: null,
    playerItems: {}
  },
  mutations: {
    SET_GAME_PHASE(state, phase) {
      state.gamePhase = phase
    },
    UPDATE_PLAYER_DATA(state, playerData) {
      state.players = playerData
    }
  },
  actions: {
    updateGameState({ commit }, newState) {
      commit('SET_GAME_PHASE', newState.phase)
    }
  }
})
```

### 5.2 卡牌交互系统

#### 5.2.1 卡牌点击事件

```javascript
// 卡牌点击处理
function onCardClick(artifactId) {
  // 获取卡牌详细信息
  const artifact = getArtifactById(artifactId);
  if (artifact) {
    // 显示卡牌详情弹窗
    showCardDetailModal(artifact);
  }
}
```

#### 5.2.2 卡牌详情展示

使用小程序弹窗或页面跳转展示卡牌信息:

```javascript
// 显示卡牌详情
function showCardDetailModal(artifact) {
  uni.showModal({
    title: artifact.name,
    content: `${artifact.era} - ${artifact.location}\n${artifact.story}`,
    showCancel: true,
    cancelText: '返回',
    confirmText: '查看详情',
    success: function(res) {
      if (res.confirm) {
        // 跳转到详情页面
        uni.navigateTo({
          url: `/pages/card-detail/card-detail?id=${artifact.id}`
        });
      }
    }
  });
}
```

## 6. 游戏规则需求

### 6.1 基础规则

#### 6.1.1 游戏流程

1. **准备阶段**: 分配初始能量，洗牌
2. **回合循环**:
   - 道具阶段: 玩家可购买/使用道具
   - 拍卖阶段: 竞拍当前奇物
   - 状态更新: 更新收藏集进度
3. **结束阶段**: 所有卡牌拍卖完毕后结算

#### 6.1.2 胜利条件

- 完成收藏集获得基础分数
- 零散奇物获得一半价值分数
- 总分最高者获胜

### 6.2 道具规则

#### 6.2.1 购买限制

- 每回合限购2个道具
- 道具栏上限: 5个道具
- 同类道具持有上限: 2个

#### 6.2.2 使用限制

```javascript
// 使用时机定义
const USE_TIMING = {
  ANYTIME: 'anytime',           // 任何时候
  AUCTION_START: 'auction_start', // 拍卖开始前
  AUCTION_COUNTDOWN: 'auction_countdown', // 拍卖倒计时中
  AFTER_AUCTION: 'after_auction' // 拍卖结束后
};
```

## 7. 非功能性需求

### 7.1 性能需求

- 页面加载时间: < 3秒
- 卡牌点击响应时间: < 500ms
- 状态同步延迟: < 500ms

### 7.2 可用性需求

- 支持微信小程序、支付宝小程序、H5多端运行
- 触摸操作友好，按钮尺寸≥44px
- 支持离线游戏模式

### 7.3 兼容性需求

- 微信小程序: 基础库2.0+
- 支付宝小程序: 基础库1.0+
- H5: iOS Safari 12+, Android Chrome 70+
- 支持横屏和竖屏模式

## 8. 测试需求

### 8.1 功能测试

- 拍卖流程完整性测试
- 道具效果准确性测试
- 收藏集计算正确性测试
- 卡牌点击交互稳定性测试

### 8.2 集成测试

- 多玩家同时操作测试
- 网络异常处理测试
- 数据持久化测试

## 9. 部署和维护

### 9.1 部署方案

- 微信小程序: 通过微信开发者工具发布
- 支付宝小程序: 通过支付宝开发者工具发布
- H5: 静态网站部署(Netlify/Vercel)
- 云开发: 使用微信云开发或阿里云

### 9.2 维护计划

- 定期检查小程序平台兼容性
- 每月更新卡牌和道具库
- 根据玩家反馈平衡性调整
- 监控小程序性能指标

---

**文档版本**: v1.1  
**最后更新**: 2024年1月  
**下一步行动**: UniApp开发环境搭建、小程序项目初始化、UI/UX设计
