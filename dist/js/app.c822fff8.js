(function(t){function e(e){for(var a,o,n=e[0],c=e[1],l=e[2],u=0,m=[];u<n.length;u++)o=n[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&m.push(i[o][0]),i[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);d&&d(e);while(m.length)m.shift()();return r.push.apply(r,l||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],a=!0,n=1;n<s.length;n++){var c=s[n];0!==i[c]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=s[0]))}return t}var a={},i={app:0},r=[];function o(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=a,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(s,a,function(e){return t[e]}.bind(null,a));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],c=n.push.bind(n);n.push=e,n=n.slice();for(var l=0;l<n.length;l++)e(n[l]);var d=c;r.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"02c2":function(t,e,s){},"0716":function(t,e,s){"use strict";s("02c2")},"10d3":function(t,e,s){},1254:function(t,e,s){},"12e3":function(t,e,s){},1532:function(t,e,s){"use strict";s("8183")},"1b5f":function(t,e,s){"use strict";s("81cf")},"218e":function(t,e,s){},"245c":function(t,e,s){},"26fe":function(t){!function(){var t=new Error("Cannot find module '../../static/data/artifacts.json'");throw t.code="MODULE_NOT_FOUND",t}()},2838:function(t,e,s){},"2da4":function(t,e,s){"use strict";s("4bfa")},3842:function(t,e,s){"use strict";s("aa73")},"40bc":function(t,e,s){"use strict";s.r(e),s.d(e,"getSupabase",(function(){return r}));var a=s("940b");let i=null;function r(){if(!i){const t="https://tgkzpywukorcwdsbfubw.supabase.co",e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRna3pweXd1a29yY3dkc2JmdWJ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5MzU5OTksImV4cCI6MjA3NjUxMTk5OX0.NupWWx5WjH75cMQkIC20qjt9530PND0f-alArgYBvMM";t&&e||console.warn("Supabase env not set: VUE_APP_SUPABASE_URL / VUE_APP_SUPABASE_ANON_KEY"),i=Object(a["a"])(t,e,{realtime:{params:{eventsPerSecond:20}}})}return i}},4436:function(t,e,s){"use strict";s("218e")},4452:function(t,e,s){"use strict";s("12e3")},"4bfa":function(t,e,s){},"53d7":function(t,e,s){"use strict";s("10d3")},"56d7":function(t,e,s){"use strict";s.r(e);var a=s("2b0e"),i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},r=[],o={name:"App"},n=o,c=(s("1532"),s("2877")),l=Object(c["a"])(n,i,r,!1,null,null,null),d=l.exports,u=s("2f62");class m{constructor(){this.currentAuctions=[],this.auctionHistory=[],this.defaultTimeLimit=60}startAuction(t,e=this.defaultTimeLimit){const s={id:`${Date.now()}_${Math.random().toString(16).slice(2)}`,artifact:t,highestBid:0,highestBidder:null,timeRemaining:e,timeLimit:e,bids:[],startTime:Date.now(),status:"active",_timer:null};return this.currentAuctions.push(s),this.startCountdown(s),s}placeBid(t,e,s,a){const i=this.getAuctionById(t);if(!i||"active"!==i.status)throw new Error("å½“å‰æ²¡æœ‰æ´»è·ƒçš„æ‹å–");if(a<=i.highestBid)throw new Error("å‡ºä»·å¿…é¡»é«˜äºå½“å‰æœ€é«˜ä»·");const r={playerId:e,playerName:s,amount:a,timestamp:Date.now()};return i.bids.push(r),i.highestBid=a,i.highestBidder=e,r}endAuction(t){const e=this.getAuctionById(t);if(!e)return null;e.status="ended",e.endTime=Date.now(),e._timer&&(clearInterval(e._timer),e._timer=null),this.auctionHistory.push({...e});const s={id:e.id,winner:e.highestBidder,winningBid:e.highestBid,artifact:e.artifact};return this.currentAuctions=this.currentAuctions.filter(e=>e.id!==t),s}startCountdown(t){t&&(t._timer=setInterval(()=>{if(!t||"active"!==t.status)return clearInterval(t._timer),void(t._timer=null);t.timeRemaining--,t.timeRemaining<=0&&(clearInterval(t._timer),t._timer=null,this.endAuction(t.id))},1e3))}getCurrentAuctions(){return this.currentAuctions}getAuctionById(t){return this.currentAuctions.find(e=>e.id===t)}getAuctionHistory(){return this.auctionHistory}}var h=new m,p=s("40bc");class _{async upsertAuction(t,e){const s=Object(p["getSupabase"])(),{error:a}=await s.from("auctions").upsert({id:e.id,artifact_id:e.artifact.id,artifact:e.artifact,highest_bid:e.highestBid,highest_bidder:e.highestBidder,time_remaining:e.timeRemaining,status:e.status});if(a)throw a;return e}async updateBid(t,e,s,a){const i=Object(p["getSupabase"])(),{error:r}=await i.from("auctions").update({highest_bid:s,highest_bidder:a}).eq("id",e);if(r)throw r}async endAuction(t,e){const s=Object(p["getSupabase"])(),{error:a}=await s.from("auctions").update({status:"ended",time_remaining:0}).eq("id",e.id);if(a)throw a;const{error:i}=await s.from("auction_history").insert({auction_id:e.id,artifact_id:e.artifact.id,artifact:e.artifact,winner:e.highestBidder,winning_bid:e.highestBid});if(i)throw i;if(e.highestBidder){const{error:a}=await s.from("room_artifacts").insert({room_id:t,owner_user_id:e.highestBidder,artifact_id:e.artifact.id});if(a)throw a}const{error:r}=await s.from("auctions").delete().eq("id",e.id);if(r)throw r}}var f=new _;class v{constructor(){this.items=[],this.playerItems=new Map,this.loadItems()}async loadItems(){try{const{getSupabase:t}=await Promise.resolve().then(s.bind(null,"40bc")),e=t(),{data:a,error:i}=await e.from("items").select("*");if(i)throw i;this.items=Array.isArray(a)?a:[]}catch(t){console.error("åŠ è½½é“å…·æ•°æ®å¤±è´¥:",t),this.items=[]}}getItems(){return this.items}getItemById(t){return this.items.find(e=>e.id===t)}buyItem(t,e,s){const a=this.getItemById(e);if(!a)throw new Error("é“å…·ä¸å­˜åœ¨");if(s<a.price)throw new Error("èƒ½é‡ä¸è¶³");const i=this.getPlayerItemCount(t);if(i>=5)throw new Error("é“å…·æ å·²æ»¡");const r=this.getPlayerItemCountByType(t,a.type);if(r>=2)throw new Error("åŒç±»é“å…·æŒæœ‰å·²è¾¾ä¸Šé™");return this.playerItems.has(t)||this.playerItems.set(t,[]),this.playerItems.get(t).push({...a,purchaseTime:Date.now()}),{success:!0,item:a,remainingEnergy:s-a.price}}useItem(t,e,s=null){const a=this.playerItems.get(t)||[],i=a.find(t=>t.id===e);if(!i)throw new Error("é“å…·ä¸å­˜åœ¨");if(!this.validateUseTiming(i,s))throw new Error("å½“å‰æ—¶æœºä¸èƒ½ä½¿ç”¨æ­¤é“å…·");const r=this.executeItemEffect(i,s),o=a.findIndex(t=>t.id===e);return a.splice(o,1),r}validateUseTiming(t,e){return!0}executeItemEffect(t,e){switch(t.effect){case"return_artifact":return this.executeReturnArtifact(t,e);case"cancel_auction":return this.executeCancelAuction(t,e);case"extend_time":return this.executeExtendTime(t,e);case"steal_energy":return this.executeStealEnergy(t,e);case"double_auction":return this.executeDoubleAuction(t,e);default:throw new Error("æœªçŸ¥çš„é“å…·æ•ˆæœ")}}executeReturnArtifact(t,e){return{effect:"return_artifact",message:"æ—¶ç©ºä¹±æµå‘åŠ¨ï¼ç›®æ ‡å¥‡ç‰©è¢«é€å›ç‰Œå †",target:e}}executeCancelAuction(t,e){return{effect:"cancel_auction",message:"èµå“é‰´å®šï¼å½“å‰æ‹å–è¢«å–æ¶ˆ",target:e}}executeExtendTime(t,e){return{effect:"extend_time",message:"æ—¶é—´å†»ç»“ï¼æ‹å–æ—¶é—´å»¶é•¿30ç§’",target:e,extendTime:30}}executeStealEnergy(t,e){return{effect:"steal_energy",message:"èƒ½é‡çªƒå–ï¼ä»ç›®æ ‡ç©å®¶å¤„çªƒå–5ç‚¹èƒ½é‡",target:e,stealAmount:5}}executeDoubleAuction(t,e){return{effect:"double_auction",message:"åŒå€æ‹å“ï¼ä¸‹æ¬¡æ‹å–å°†å‡ºç°ä¸¤å¼ å¥‡ç‰©",target:e}}getPlayerItemCount(t){const e=this.playerItems.get(t)||[];return e.length}getPlayerItemCountByType(t,e){const s=this.playerItems.get(t)||[];return s.filter(t=>t.type===e).length}getPlayerItems(t){return this.playerItems.get(t)||[]}}var g=new v;class C{constructor(){this.gameState={gameId:null,phase:"preparation",players:[],currentAuction:null,deck:[],usedItems:[],gameLog:[]}}initializeGame(t){return this.gameState.gameId=this.generateGameId(),this.gameState.phase="preparation",this.gameState.players=t.map((t,e)=>({id:"player_"+(e+1),name:t,energy:50,artifacts:[],items:[],collections:{"è‰ºæœ¯ç‘°å®":0,"ç§‘æŠ€å¥‡ç‚¹":0,"ç”Ÿå‘½å¥¥ç§˜":0,"æƒåŠ›è±¡å¾":0}})),this.gameState.deck=this.initializeDeck(),this.gameState.gameLog=[],this.addGameLog("æ¸¸æˆå¼€å§‹ï¼æ‰€æœ‰ç©å®¶è·å¾—50ç‚¹åˆå§‹èƒ½é‡"),this.gameState}generateGameId(){return`game_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async initializeDeck(){try{const t=s("26fe"),e=Array.isArray(t)?t:t.default||[];return this.shuffleArray([...e])}catch(t){return console.error("åŠ è½½å¡ç‰Œæ•°æ®å¤±è´¥:",t),[]}}shuffleArray(t){const e=[...t];for(let s=e.length-1;s>0;s--){const t=Math.floor(Math.random()*(s+1));[e[s],e[t]]=[e[t],e[s]]}return e}startAuctionPhase(){return this.gameState.phase="auction",this.addGameLog("æ‹å–é˜¶æ®µå¼€å§‹ï¼"),this.gameState}startItemPhase(){return this.gameState.phase="item",this.addGameLog("é“å…·é˜¶æ®µå¼€å§‹ï¼ç©å®¶å¯ä»¥è´­ä¹°å’Œä½¿ç”¨é“å…·"),this.gameState}endGame(){return this.gameState.phase="settlement",this.calculateFinalScores(),this.addGameLog("æ¸¸æˆç»“æŸï¼å¼€å§‹ç»“ç®—åˆ†æ•°"),this.gameState}calculateFinalScores(){this.gameState.players.forEach(t=>{let e=0;Object.keys(t.collections).forEach(s=>{const a=this.getCollectionByName(s);a&&t.collections[s]>=a.requiredCount&&(e+=a.rewardPoints)}),t.artifacts.forEach(t=>{const s=this.getArtifactById(t);s&&(e+=Math.floor(s.baseValue/2))}),t.finalScore=e}),this.gameState.players.sort((t,e)=>e.finalScore-t.finalScore)}async getCollectionByName(t){try{const e=s("7316"),a=Array.isArray(e)?e:e.default||[];return a.find(e=>e.name===t)}catch(e){return console.error("åŠ è½½æ”¶è—é›†æ•°æ®å¤±è´¥:",e),null}}async getArtifactById(t){try{const e=s("26fe"),a=Array.isArray(e)?e:e.default||[];return a.find(e=>e.id===t)}catch(e){return console.error("åŠ è½½å¥‡ç‰©æ•°æ®å¤±è´¥:",e),null}}updateCollectionProgress(t,e){const s=this.gameState.players.find(e=>e.id===t);s&&e.collectionTags.forEach(t=>{s.collections.hasOwnProperty(t)&&s.collections[t]++})}addGameLog(t){this.gameState.gameLog.push({timestamp:Date.now(),message:t})}getGameState(){return this.gameState}getPlayer(t){return this.gameState.players.find(e=>e.id===t)}updatePlayerEnergy(t,e){const s=this.getPlayer(t);s&&(s.energy=Math.max(0,s.energy+e),this.addGameLog(`${s.name} çš„èƒ½é‡å˜åŒ–: ${e>0?"+":""}${e}`))}addArtifactToPlayer(t,e){const s=this.getPlayer(t);s&&(s.artifacts.push(e.id),this.updateCollectionProgress(t,e),this.addGameLog(`${s.name} è·å¾—äº†å¥‡ç‰©: ${e.name}`))}removeArtifactFromPlayer(t,e){const s=this.getPlayer(t);if(s){const t=s.artifacts.indexOf(e);t>-1&&(s.artifacts.splice(t,1),this.addGameLog(s.name+" å¤±å»äº†å¥‡ç‰©"))}}}var y=new C;a["a"].use(u["a"]);const w=new u["a"].Store({state:{gamePhase:"preparation",players:[],currentAuctions:[],gameLog:[],showCardDetail:!1,selectedCard:null,showShop:!1,currentPlayer:null,playerEnergy:50,playerArtifacts:[],playerItems:[],user:null,roomId:null},mutations:{SET_GAME_PHASE(t,e){t.gamePhase=e},SET_PLAYERS(t,e){t.players=e},SET_CURRENT_AUCTIONS(t,e){t.currentAuctions=e},ADD_OR_UPDATE_AUCTION(t,e){const s=t.currentAuctions.findIndex(t=>t.id===e.id);s>=0?a["a"].set(t.currentAuctions,s,e):t.currentAuctions.push(e)},REMOVE_AUCTION(t,e){t.currentAuctions=t.currentAuctions.filter(t=>t.id!==e)},ADD_GAME_LOG(t,e){t.gameLog.push(e)},SET_SHOW_CARD_DETAIL(t,e){t.showCardDetail=e},SET_SELECTED_CARD(t,e){t.selectedCard=e},SET_SHOW_SHOP(t,e){t.showShop=e},SET_CURRENT_PLAYER(t,e){t.currentPlayer=e},SET_PLAYER_ENERGY(t,e){t.playerEnergy=e},SET_PLAYER_ARTIFACTS(t,e){t.playerArtifacts=e},SET_PLAYER_ITEMS(t,e){t.playerItems=e},SET_USER(t,e){if(!e)return void(t.user=null);const s=t.user||{},a={...s,...e};void 0!==e.username&&null!==e.username||(a.username=s.username),void 0!==e.avatar&&null!==e.avatar||(a.avatar=s.avatar),t.user=a},SET_ROOM_ID(t,e){t.roomId=e}},actions:{async initializeGame({commit:t},e){const s=y.initializeGame(e);return t("SET_GAME_PHASE",s.phase),t("SET_PLAYERS",s.players),t("SET_CURRENT_PLAYER",s.players[0]),t("SET_PLAYER_ENERGY",50),s},async startAuction({commit:t,state:e},s){const a=h.startAuction(s);return t("ADD_OR_UPDATE_AUCTION",a),t("SET_GAME_PHASE","auction"),e.roomId&&await f.upsertAuction(e.roomId,a),a},async placeBid({commit:t,state:e},{auctionId:s,playerId:a,playerName:i,bidAmount:r}){try{const o=h.placeBid(s,a,i,r),n=h.getAuctionById(s);return t("ADD_OR_UPDATE_AUCTION",n),e.roomId&&await f.updateBid(e.roomId,s,n.highestBid,n.highestBidder),o}catch(o){throw o}},async endAuction({commit:t,state:e},s){const a=h.endAuction(s);if(a){const s={id:a.id,artifact:a.artifact,highestBid:a.winningBid,highestBidder:a.winner,status:"ended",timeRemaining:0};e.roomId&&await f.endAuction(e.roomId,s);const i=e.players.find(t=>t.id===a.winner);if(i&&(i.artifacts.push(a.artifact.id),y.updateCollectionProgress(a.winner,a.artifact)),e.currentPlayer&&e.currentPlayer.id===a.winner){const s=Array.isArray(e.currentPlayer.artifacts)?[...e.currentPlayer.artifacts,a.artifact.id]:[a.artifact.id];e.currentPlayer={...e.currentPlayer,artifacts:s},t("SET_PLAYER_ARTIFACTS",s),y.updateCollectionProgress(a.winner,a.artifact)}t("ADD_GAME_LOG",{timestamp:Date.now(),message:`${i?i.name:"æœªçŸ¥ç©å®¶"} ä»¥ ${a.winningBid} èƒ½é‡èµ¢å¾—äº† ${a.artifact.name}`}),t("REMOVE_AUCTION",a.id),t("SET_GAME_PHASE","item")}return a},async buyItem({commit:t,state:e},{playerId:s,itemId:a}){try{const i=g.buyItem(s,a,e.playerEnergy);return t("SET_PLAYER_ENERGY",i.remainingEnergy),i}catch(i){throw i}},async useItem({commit:t,state:e},{playerId:s,itemId:a,target:i}){try{const t=g.useItem(s,a,i);return t}catch(r){throw r}},showCardDetail({commit:t},e){t("SET_SELECTED_CARD",e),t("SET_SHOW_CARD_DETAIL",!0)},hideCardDetail({commit:t}){t("SET_SHOW_CARD_DETAIL",!1),t("SET_SELECTED_CARD",null)},showShop({commit:t}){t("SET_SHOW_SHOP",!0)},hideShop({commit:t}){t("SET_SHOW_SHOP",!1)},updateGameState({commit:t},e){e.phase&&t("SET_GAME_PHASE",e.phase),e.players&&t("SET_PLAYERS",e.players),e.currentAuctions&&t("SET_CURRENT_AUCTIONS",e.currentAuctions)}},getters:{isGameActive:t=>"settlement"!==t.gamePhase,isAuctionPhase:t=>"auction"===t.gamePhase,isItemPhase:t=>"item"===t.gamePhase,currentAuctionsInfo:t=>(t.currentAuctions||[]).map(t=>({id:t.id,artifact:t.artifact,highestBid:t.highestBid,timeRemaining:t.timeRemaining,bidCount:t.bids.length})),currentPlayerInfo:t=>t.currentPlayer?{id:t.currentPlayer.id,name:t.currentPlayer.name,energy:t.playerEnergy,artifacts:t.playerArtifacts,items:t.playerItems}:null,recentGameLog:t=>t.gameLog.slice(-10)}});var b=w,I=s("8c4f"),S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"game-container",class:{"post-start":"preparation"!==t.gamePhase}},[e("div",{staticClass:"top-auth-bar"},[t._m(0),t.user?e("div",{staticClass:"right"},[e("span",{staticClass:"user-email"},[t._v(t._s(t.user.email))]),e("button",{staticClass:"nav-button",on:{click:function(e){return t.$router.push("/profile")}}},[t._v("ä¸ªäººä¸­å¿ƒ")])]):e("div",{staticClass:"right"},[e("button",{staticClass:"nav-button primary",on:{click:function(e){return t.$router.push("/login")}}},[t._v("ç™»å½• / æ³¨å†Œ")])])]),e("div",{staticClass:"game-status"},[e("div",{staticClass:"room-info"},[e("span",{staticClass:"room-name"},[t._v(t._s(t.room?t.room.name||"æœªå‘½åæˆ¿é—´":"æœªåŠ å…¥æˆ¿é—´"))]),e("span",{staticClass:"room-id"},[t._v("ID: "+t._s(t.room?t.room.short_id||t.room.id:"-"))]),t.room?e("span",{staticClass:"room-meta"},[t._v("ç©å®¶ "+t._s(t.playerCount)+"/"+t._s(t.seatCount)+" Â· æˆ¿ä¸»ï¼š"+t._s(t.ownerName))]):t._e()]),e("span",{staticClass:"game-phase"},[t._v(t._s(t.gamePhaseText))]),t.currentPlayer?e("div",{staticClass:"player-energy-hud"},[e("span",{staticClass:"icon"},[t._v("âš¡")]),e("span",{staticClass:"label"},[t._v("èƒ½é‡")]),e("span",{staticClass:"value"},[t._v(t._s(t.$store.state.playerEnergy))])]):t._e(),e("div",{staticClass:"game-controls"},["preparation"===t.gamePhase?e("button",{staticClass:"control-button",on:{click:t.toggleReady}},[t._v(t._s(t.currentUserReady?"å–æ¶ˆå‡†å¤‡":"å‡†å¤‡"))]):t._e(),"preparation"===t.gamePhase&&t.isOwner&&t.allReady?e("button",{staticClass:"control-button",on:{click:t.startGame}},[t._v("å¼€å§‹æ¸¸æˆ")]):t._e(),t._e(),"item"===t.gamePhase?e("button",{staticClass:"control-button",on:{click:t.openShop}},[t._v("é“å…·å•†åº—")]):t._e(),e("button",{staticClass:"control-button danger",on:{click:t.leaveRoom}},[t._v("é€€å‡ºæˆ¿é—´")])])]),t.playerCount>0&&"preparation"!==t.gamePhase?e("div",{staticClass:"players-avatars"},t._l(t.room?t.room.room_players:[],(function(s){return e("div",{key:s.user_id,staticClass:"avatar-item",on:{click:function(e){return t.showPlayerHand(s)}}},[e("div",{staticClass:"avatar-wrap"},[e("img",{staticClass:"player-avatar",attrs:{src:t.getAvatarFor(s.user_id)}}),e("span",{staticClass:"ready-indicator",class:{on:!!s.is_ready}})]),e("div",{staticClass:"player-name"},[t._v(t._s(t.getNameFor(s.user_id)))])])})),0):t._e(),e("div",{staticClass:"auction-stage"},["auction"===t.gamePhase&&t.$store.state.currentAuctions&&t.$store.state.currentAuctions.length?e("auction-panel",{attrs:{auctions:t.$store.state.currentAuctions,countdown:t.auctionCountdown},on:{"artifact-click":t.showArtifactDetailFromAuction}}):t.prepCountdown>0?e("div",{staticClass:"countdown-stage"},[e("div",{staticClass:"countdown-content"},[e("div",{staticClass:"countdown-icon"},[t._v("â°")]),e("h3",{staticClass:"countdown-title"},[t._v("æ‹å–å³å°†å¼€å§‹")]),e("div",{staticClass:"countdown-timer"},[t._v(t._s(t.prepCountdown))]),e("p",{staticClass:"countdown-subtitle"},[t._v("å‡†å¤‡å‚ä¸ç«æ‹ï¼")])])]):e("div",{staticClass:"stage-placeholder"},[t._v("æ‹å–ä¼šå°ç©ºé—²ï¼Œç­‰å¾…æ–°ä¸€è½®æ‹å–")])],1),t.seatCount>0&&"preparation"===t.gamePhase?e("div",{staticClass:"seats",style:{gridTemplateColumns:"repeat("+t.seatCount+", 1fr)"}},t._l(t.seats,(function(s,a){return e("div",{key:a,staticClass:"seat",class:{occupied:!!s.player},on:{click:function(e){return t.moveToSeat(a)}}},[e("div",{staticClass:"seat-index"},[t._v(t._s(a+1)+"/"+t._s(t.seatCount))]),e("div",{staticClass:"seat-body"},[s.player?e("div",{staticClass:"seat-player"},[e("div",{staticClass:"avatar-wrap"},[e("img",{staticClass:"seat-avatar",attrs:{src:t.getAvatarFor(s.player.user_id)}}),s.player.is_ready?e("span",{staticClass:"ready-badge"},[t._v("âœ“")]):t._e()]),e("div",{staticClass:"seat-name"},[t._v(t._s(t.getNameFor(s.player.user_id)))])]):e("div",{staticClass:"seat-empty"},[t._v("ç©ºä½")])])])})),0):t._e(),"preparation"!==t.gamePhase?e("div",{staticClass:"my-hand"},[e("h3",{staticClass:"hand-title"},[t._v("æˆ‘çš„æ‰‹ç‰Œ")]),e("div",{staticClass:"hand-grid"},t._l(t.currentPlayer?t.currentPlayer.artifacts:[],(function(s){return e("div",{key:s,staticClass:"hand-card",on:{click:function(e){return t.showArtifactDetail(s)}}},[e("img",{staticClass:"hand-image",attrs:{src:t.artifactMap[s]?t.artifactMap[s].image:"https://via.placeholder.com/160x100?text=æœªçŸ¥å¡ç‰Œ"}}),e("div",{staticClass:"hand-name"},[t._v(t._s(t.artifactMap[s]?t.artifactMap[s].name:s))])])})),0)]):t._e(),"preparation"!==t.gamePhase?e("div",{staticClass:"collections-panel"},[e("div",{staticClass:"collections-section"},[e("h4",{staticClass:"collections-title"},[t._v("æ”¶è—é›†è¿›åº¦")]),e("div",{staticClass:"collections-list"},t._l(t.collections,(function(s){return e("div",{key:s.id,staticClass:"collection-progress-item",class:{completed:t.isCollectionCompleted(s)}},[e("div",{staticClass:"collection-header"},[e("div",{staticClass:"collection-icon"},[t._v("ğŸ†")]),e("div",{staticClass:"collection-info"},[e("div",{staticClass:"collection-name"},[t._v(t._s(s.name))]),e("div",{staticClass:"collection-description"},[t._v(t._s(s.description))])]),t.isCollectionCompleted(s)?e("div",{staticClass:"collection-reward"},[e("span",{staticClass:"reward-badge"},[t._v("âœ“")])]):t._e()]),e("div",{staticClass:"progress-container"},[e("div",{staticClass:"progress-bar"},[e("div",{staticClass:"progress-fill",style:{width:t.getCollectionProgress(s)+"%"}})]),e("div",{staticClass:"progress-text"},[t._v(" "+t._s(t.getCurrentCollectionCount(s))+"/"+t._s(s.requiredCount)+" ")])])])})),0)])]):t._e(),"preparation"!==t.gamePhase?e("div",{staticClass:"chat-panel"},[t._m(1),e("div",{ref:"chatContainer",staticClass:"chat-messages"},t._l(t.chatMessages,(function(s){return e("div",{key:s.id,staticClass:"chat-message",class:{"own-message":s.userId===(t.user&&t.user.id)}},[e("div",{staticClass:"message-header"},[e("span",{staticClass:"message-username"},[t._v(t._s(s.username))]),e("span",{staticClass:"message-time"},[t._v(t._s(t.formatMessageTime(s.timestamp)))])]),e("div",{staticClass:"message-content"},[t._v(t._s(s.content))])])})),0),e("div",{staticClass:"chat-input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.newMessage,expression:"newMessage"}],staticClass:"message-input",attrs:{placeholder:"è¾“å…¥æ¶ˆæ¯..."},domProps:{value:t.newMessage},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage.apply(null,arguments)},input:function(e){e.target.composing||(t.newMessage=e.target.value)}}}),e("button",{staticClass:"send-button",attrs:{disabled:!t.newMessage.trim()},on:{click:t.sendMessage}},[e("span",{staticClass:"send-icon"},[t._v("ğŸ“¤")])])])]):t._e(),t.showCardDetail?e("div",{staticClass:"card-detail-popup"},[e("div",{staticClass:"popup-overlay",on:{click:t.hideCardDetail}}),t.selectedCard?e("div",{staticClass:"popup-content"},[e("img",{staticClass:"detail-image",attrs:{src:t.selectedCard.image,alt:"å¥‡ç‰©å›¾ç‰‡"}}),e("div",{staticClass:"detail-content"},[e("h3",{staticClass:"detail-name"},[t._v(t._s(t.selectedCard.name))]),e("p",{staticClass:"detail-era"},[t._v(t._s(t.selectedCard.era)+" - "+t._s(t.selectedCard.location))]),e("p",{staticClass:"detail-story"},[t._v(t._s(t.selectedCard.story))]),e("div",{staticClass:"detail-tags"},t._l(t.selectedCard.collectionTags,(function(s){return e("span",{key:s,staticClass:"detail-tag"},[t._v(" "+t._s(s)+" ")])})),0),e("p",{staticClass:"detail-value"},[t._v("åŸºç¡€ä»·å€¼: "+t._s(t.selectedCard.baseValue))])]),e("button",{staticClass:"close-button",on:{click:t.hideCardDetail}},[t._v("å…³é—­")])]):t._e()]):t._e(),t.showShop?e("div",{staticClass:"shop-popup"},[e("div",{staticClass:"popup-overlay",on:{click:t.closeShop}}),e("div",{staticClass:"popup-content"},[e("item-shop"),e("button",{staticClass:"close-button",on:{click:t.closeShop}},[t._v("å…³é—­å•†åº—")])],1)]):t._e(),t.showHandPopup?e("div",{staticClass:"hand-popup"},[e("div",{staticClass:"popup-overlay",on:{click:t.hideHand}}),e("div",{staticClass:"popup-content"},[e("h3",{staticClass:"hand-title"},[t._v(t._s(t.handPlayer?t.handPlayer.name+" çš„æ‰‹ç‰Œ":"æ‰‹ç‰Œ"))]),e("div",{staticClass:"hand-grid"},t._l(t.handPlayer?t.handPlayer.artifacts:[],(function(s){return e("div",{key:s,staticClass:"hand-card"},[e("img",{staticClass:"hand-image",attrs:{src:t.artifactMap[s]?t.artifactMap[s].image:"https://via.placeholder.com/160x100?text=æœªçŸ¥å¡ç‰Œ"}}),e("div",{staticClass:"hand-name"},[t._v(t._s(t.artifactMap[s]?t.artifactMap[s].name:s))])])})),0),e("button",{staticClass:"close-button",on:{click:t.hideHand}},[t._v("å…³é—­")])])]):t._e(),t.showGameEndDialog?e("div",{staticClass:"game-end-popup"},[e("div",{staticClass:"popup-overlay",on:{click:t.closeGameEndDialog}}),e("div",{staticClass:"popup-content game-end-content"},[t._m(2),e("div",{staticClass:"game-end-actions"},[e("button",{staticClass:"action-button primary",on:{click:t.stayInRoom}},[e("span",{staticClass:"btn-icon"},[t._v("ğŸ ")]),t._v(" ç•™åœ¨æˆ¿é—´ ")]),e("button",{staticClass:"action-button secondary",on:{click:t.goToRooms}},[e("span",{staticClass:"btn-icon"},[t._v("ğŸ“‹")]),t._v(" è¿”å›æˆ¿é—´åˆ—è¡¨ ")])])])]):t._e()])},P=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"left"},[e("span",{staticClass:"brand"},[t._v("æ—¶ç©ºæ—…äººæ‹å–ä¼š")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"chat-header"},[e("h4",{staticClass:"chat-title"},[t._v("æˆ¿é—´èŠå¤©")]),e("div",{staticClass:"chat-status"},[e("span",{staticClass:"status-dot"}),e("span",{staticClass:"status-text"},[t._v("åœ¨çº¿")])])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"game-end-header"},[e("div",{staticClass:"game-end-icon"},[t._v("ğŸ†")]),e("h2",{staticClass:"game-end-title"},[t._v("æ¸¸æˆç»“æŸ")]),e("p",{staticClass:"game-end-subtitle"},[t._v("æ„Ÿè°¢å‚ä¸æ—¶ç©ºæ—…äººæ‹å–ä¼šï¼")])])}],A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"auction-panel"},[e("div",{staticClass:"auction-header"},[t._m(0),t.auctionsList.length>0?e("div",{staticClass:"countdown"},[e("div",{staticClass:"countdown-icon"},[t._v("â°")]),e("span",{staticClass:"countdown-text"},[t._v(t._s(t.countdown)+"s")])]):t._e()]),t.auctionsList.length>0?e("div",{staticClass:"auction-content"},[t._e(),t.auctionsList.length>0?e("div",{staticClass:"auction-list"},t._l(t.auctionsList,(function(s,a){return e("div",{key:s.id,staticClass:"auction-card"},[e("div",{staticClass:"artifact-card"},[e("div",{staticClass:"artifact-image-container"},[e("img",{staticClass:"auction-image",attrs:{src:s.artifact.image,alt:"æ‹å–å“"},on:{click:function(e){return t.$emit("artifact-click",s.artifact)}}})]),e("div",{staticClass:"artifact-info"},[e("h4",{staticClass:"artifact-name",attrs:{title:s.artifact.name}},[t._v(t._s(s.artifact.name))]),e("p",{staticClass:"artifact-era",attrs:{title:s.artifact.era}},[t._v(t._s(s.artifact.era))]),e("div",{staticClass:"artifact-tags"},[t._l((s.artifact.collectionTags||[]).slice(0,3),(function(s){return e("span",{key:s,staticClass:"artifact-tag",attrs:{title:s}},[t._v(t._s(s))])})),(s.artifact.collectionTags||[]).length>3?e("span",{staticClass:"artifact-tag more-tag"},[t._v("+"+t._s((s.artifact.collectionTags||[]).length-3))]):t._e()],2)])]),e("div",{staticClass:"bid-display"},[e("span",{staticClass:"bid-amount"},[t._v(t._s(s.highestBid))]),e("span",{staticClass:"bid-unit"},[t._v("èƒ½é‡")]),s.highestBidder?e("div",{staticClass:"bidder-info"},[e("img",{staticClass:"bidder-avatar",attrs:{src:t.getBidderAvatar(s.highestBidder),alt:t.getBidderName(s.highestBidder)}}),e("span",{staticClass:"bidder-name"},[t._v(t._s(t.getBidderName(s.highestBidder)))])]):t._e()]),t.auctionsList.length>0?e("div",{staticClass:"countdown-progress"},[e("div",{staticClass:"progress-fill",style:{width:t.getCountdownPercentShared()+"%"}})]):t._e(),e("div",{staticClass:"bid-input"},[e("div",{staticClass:"bid-input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bidAmounts[s.id],expression:"bidAmounts[a.id]"}],staticClass:"bid-field",attrs:{type:"text",inputmode:"numeric",pattern:"\\\\d*"},domProps:{value:t.bidAmounts[s.id]},on:{input:[function(e){e.target.composing||t.$set(t.bidAmounts,s.id,e.target.value)},function(e){return t.onBidInput(s.id)}],keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.placeBid(s)}}}),e("span",{staticClass:"bid-unit-label"},[t._v("èƒ½é‡")])]),e("button",{staticClass:"bid-button",attrs:{disabled:!(parseInt(t.bidAmounts[s.id]||0)>s.highestBid&&parseInt(t.bidAmounts[s.id]||0)<=(t.currentPlayerInfo?t.currentPlayerInfo.energy:0)&&"active"===s.status)},on:{click:function(e){return t.placeBid(s)}}},[e("span",{staticClass:"bid-icon"},[t._v("ğŸ¯")]),t._v(" å‡ºä»· ")])])])})),0):t._e()]):e("div",{staticClass:"no-auction"},[t._m(2)])])},E=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"auction-title-section"},[e("h3",{staticClass:"auction-title"},[t._v("ğŸº æ—¶ç©ºæ‹å–ä¼š")]),e("p",{staticClass:"auction-subtitle"},[t._v("ç«æ‹æ¥è‡ªä¸åŒæ—¶ç©ºçš„çè´µå¥‡ç‰©")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"artifact-card"},[e("div",{staticClass:"artifact-image-container"},[e("img",{staticClass:"auction-image",attrs:{src:"https://via.placeholder.com/120x120?text=æ‹å“",alt:"æ‹å–å“"}}),e("div",{staticClass:"artifact-glow"})]),e("div",{staticClass:"artifact-info"},[e("h4",{staticClass:"artifact-name"},[t._v("æ‹å“")]),e("p",{staticClass:"artifact-era"},[t._v("--")]),e("div",{staticClass:"artifact-tags"},[e("span",{staticClass:"artifact-tag"},[t._v("--")])])])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"no-auction-content"},[e("div",{staticClass:"no-auction-icon"},[t._v("ğŸº")]),e("p",{staticClass:"no-auction-text"},[t._v("å½“å‰æ²¡æœ‰æ´»è·ƒçš„æ‹å–")]),e("p",{staticClass:"no-auction-subtitle"},[t._v("ç­‰å¾…ä¸‹ä¸€ä»¶å¥‡ç‰©å‡ºç°...")])])}],x={name:"AuctionPanel",props:{currentAuction:{type:Object,default:null},auctions:{type:Array,default:()=>[]},countdown:{type:Number,default:0}},data(){return{bidAmounts:{}}},computed:{...Object(u["c"])(["players"]),...Object(u["b"])(["currentPlayerInfo"]),auctionsList(){return this.auctions&&this.auctions.length?this.auctions:this.currentAuction?[this.currentAuction]:[]},__dummy(){return null}},watch:{countdown(t){}},methods:{canBid(t){const e=parseInt(this.bidAmounts[t.id]||0);return t&&"active"===t.status&&this.currentPlayerInfo&&this.currentPlayerInfo.energy>=e},getCountdownPercentShared(){const t=30,e=Number(this.countdown)||0;if(t<=0)return 0;const s=(t-e)/t*100;return Math.max(0,Math.min(100,Math.round(s)))},onBidInput(t){const e=String(this.bidAmounts[t]||""),s=e.replace(/[^\d]/g,"");this.$set(this.bidAmounts,t,s)},async placeBid(t){const e=parseInt(this.bidAmounts[t.id]||0);if(!Number.isFinite(e)||e<=0)alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—");else if(e>(this.currentPlayerInfo?this.currentPlayerInfo.energy:0))alert("èƒ½é‡ä¸è¶³");else if(e<=t.highestBid)alert("å‡ºä»·å¿…é¡»é«˜äºå½“å‰æœ€é«˜ä»·");else if(t&&"active"===t.status)try{await this.$store.dispatch("placeBid",{auctionId:t.id,playerId:this.currentPlayerInfo.id,playerName:this.currentPlayerInfo.name,bidAmount:e}),this.$store.commit("SET_PLAYER_ENERGY",this.currentPlayerInfo.energy-e),this.$set(this.bidAmounts,t.id,""),alert("å‡ºä»·æˆåŠŸ")}catch(s){alert(s.message||"å‡ºä»·å¤±è´¥")}else alert("å½“å‰æ‹å–ä¸å¯å‡ºä»·")},getBidderName(t){const e=this.players.find(e=>e.id===t);return e?e.name:"æœªçŸ¥ç©å®¶"},getBidderAvatar(t){if(this.$parent&&this.$parent.getAvatarFor)return this.$parent.getAvatarFor(t);const e=(t||"U").slice(0,2).toUpperCase(),s="334155",a="e2e8f0",i=encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24'><rect width='100%' height='100%' fill='#${s}'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-size='10' fill='#${a}' font-family='Arial, sans-serif'>${e}</text></svg>`);return"data:image/svg+xml;charset=utf-8,"+i}}},R=x,T=(s("53d7"),Object(c["a"])(R,A,E,!1,null,"1a6c1eed",null)),$=T.exports,k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"player-avatar",on:{click:function(e){return t.$router.push("/player/"+t.player.id)}}},[e("div",{staticClass:"avatar-wrap"},[e("img",{staticClass:"avatar",attrs:{src:"https://via.placeholder.com/60x60?text=P",alt:"avatar"}}),e("span",{staticClass:"energy"},[t._v("âš¡ "+t._s(t.player.energy))])]),e("div",{staticClass:"name"},[t._v(t._s(t.player.name))])])},M=[],D={name:"PlayerAvatar",props:{player:{type:Object,required:!0}}},O=D,j=(s("c1f4"),Object(c["a"])(O,k,M,!1,null,"fc4eb968",null)),U=j.exports,B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"item-shop"},[e("div",{staticClass:"shop-header"},[e("h3",{staticClass:"shop-title"},[t._v("é“å…·å•†åº—")]),e("div",{staticClass:"player-energy"},[e("span",{staticClass:"energy-label"},[t._v("å½“å‰èƒ½é‡:")]),e("span",{staticClass:"energy-value"},[t._v(t._s(t.playerEnergy))])])]),e("div",{staticClass:"shop-content"},t._l(t.items,(function(s){return e("div",{key:s.id,staticClass:"item-card"},[e("div",{staticClass:"item-icon"},[t._v("ğŸ¯")]),e("div",{staticClass:"item-info"},[e("h4",{staticClass:"item-name"},[t._v(t._s(s.name))]),e("p",{staticClass:"item-description"},[t._v(t._s(s.description))]),e("div",{staticClass:"item-meta"},[e("span",{staticClass:"item-price"},[t._v(t._s(s.price)+" èƒ½é‡")]),e("span",{staticClass:"item-type"},[t._v(t._s(s.type))])])]),e("button",{staticClass:"buy-button",attrs:{disabled:!t.canBuyItem(s)},on:{click:function(e){return t.buyItem(s)}}},[t._v(" è´­ä¹° ")])])})),0)])},q=[],N={name:"ItemShop",data(){return{items:[{id:"item_001",name:"æ—¶ç©ºä¹±æµ",price:15,description:"å¼ºåˆ¶ä¸€åå¯¹æ‰‹å°†ä¸€å¼ å¥‡ç‰©æ”¾å›ç‰Œå †",type:"ç ´å"},{id:"item_002",name:"èµå“é‰´å®š",price:10,description:"å½“å‰æ‹å–çš„å¥‡ç‰©æµæ‹",type:"æ§åˆ¶"},{id:"item_003",name:"æ—¶é—´å†»ç»“",price:20,description:"å»¶é•¿å½“å‰æ‹å–æ—¶é—´30ç§’",type:"æ§åˆ¶"}]}},computed:{...Object(u["c"])(["playerEnergy","currentPlayer"])},methods:{canBuyItem(t){return this.playerEnergy>=t.price},async buyItem(t){if(this.canBuyItem(t))try{const e=await this.$store.dispatch("buyItem",{playerId:this.currentPlayer.id,itemId:t.id});this.$store.commit("SET_PLAYER_ENERGY",e.remainingEnergy),alert("è´­ä¹°æˆåŠŸ")}catch(e){alert(e.message||"è´­ä¹°å¤±è´¥")}else alert("èƒ½é‡ä¸è¶³")}}},G=N,L=(s("4436"),Object(c["a"])(G,B,q,!1,null,"66b979ee",null)),H=L.exports,F={name:"GameIndex",components:{AuctionPanel:$,PlayerAvatar:U,ItemShop:H},data(){return{selectedCard:null,showHandPopup:!1,handPlayer:null,artifactMap:{},room:null,profileMap:{},refreshTimer:null,collections:[],showGameEndDialog:!1,prepCountdown:0,auctionCountdown:0,auctionTimer:null,currentAuction:null,chatMessages:[],newMessage:"",chatChannel:null}},computed:{...Object(u["c"])(["gamePhase","gameLog","showCardDetail","showShop","user","roomId"]),currentPlayer(){return this.$store.state.currentPlayer},isOwner(){return this.room&&this.user&&this.room.owner_id===this.user.id},allReady(){const t=this.room&&this.room.room_players?this.room.room_players:[];return t.length>0&&t.every(t=>!!t.is_ready)},currentUserReady(){const t=this.user,e=this.room&&this.room.room_players?this.room.room_players:[];if(!t)return!1;const s=e.find(e=>e.user_id===t.id);return!(!s||!s.is_ready)},playerCount(){return this.room&&this.room.room_players?this.room.room_players.length:0},ownerName(){return this.room?this.getNameFor(this.room.owner_id):"-"},seatCount(){return this.room&&Number(this.room.max_players)?Number(this.room.max_players):0},seats(){const t=this.room&&this.room.room_players?this.room.room_players:[],e=this.seatCount,s=Array.from({length:e},()=>({player:null}));return t.forEach(t=>{const a="number"===typeof t.seat_index?t.seat_index:-1;a>=0&&a<e&&!s[a].player&&(s[a].player=t)}),t.filter(t=>"number"!==typeof t.seat_index||t.seat_index<0).forEach(t=>{const e=s.findIndex(t=>!t.player);e>=0&&(s[e].player=t)}),s},gamePhaseText(){const t={preparation:"å‡†å¤‡é˜¶æ®µ",auction:"æ‹å–é˜¶æ®µ",item:"é“å…·é˜¶æ®µ",settlement:"ç»“ç®—é˜¶æ®µ"};return t[this.gamePhase]||"æœªçŸ¥é˜¶æ®µ"}},async mounted(){const t=this.$route.query.roomId;t&&this.$store.commit("SET_ROOM_ID",t),await this.initializeGame(),await this.loadRoomState(),await this.subscribeRoomRealtime()},beforeDestroy(){this.unsubscribeRoomRealtime(),this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)},methods:{async initializeGame(){const t=await this.loadArtifacts();this.artifactMap=t.reduce((t,e)=>(t[e.id]=e,t),{}),await this.loadCollections()},async subscribeRoomRealtime(){try{const t=this.$store.state.roomId;if(!t)return;const{getSupabase:e}=await Promise.resolve().then(s.bind(null,"40bc")),a=e();this.roomChannel=a.channel("room_db_"+t).on("postgres_changes",{event:"*",schema:"public",table:"room_players",filter:"room_id=eq."+t},async()=>{await this.loadRoomState()}).on("postgres_changes",{event:"update",schema:"public",table:"rooms",filter:"id=eq."+t},async()=>{await this.loadRoomState()}).subscribe(),this.broadcastChannel=a.channel("room_cast_"+t).on("broadcast",{event:"seat_change"},async()=>{await this.loadRoomState()}).on("broadcast",{event:"ready_change"},async()=>{await this.loadRoomState()}).on("broadcast",{event:"game_started"},async t=>{console.log("[game] received game_started broadcast",t),this.$store.commit("SET_GAME_PHASE",t.payload.gamePhase);const e=(this.room&&this.room.room_players?this.room.room_players:[]).find(t=>t.user_id===this.$store.state.user.id);e&&this.$store.commit("SET_CURRENT_PLAYER",{id:e.user_id,name:this.getNameFor(e.user_id),energy:50,artifacts:[],items:[]}),this.startAuctionCountdown()}).on("broadcast",{event:"auction_started"},async t=>{console.log("[game] received auction_started broadcast",t);const e=t.payload.artifacts||(t.payload.artifact?[t.payload.artifact]:[]);for(const a of e)await this.$store.dispatch("startAuction",a);const s=Number(t.payload.duration)||30;this.startUnifiedAuctionTimer(s)}).on("broadcast",{event:"chat_message"},async t=>{console.log("[game] received chat_message broadcast",t),this.chatMessages.push(t.payload),this.$nextTick(()=>{const t=this.$refs.chatContainer;t&&(t.scrollTop=t.scrollHeight)})}).subscribe(),this.refreshTimer||(this.refreshTimer=setInterval(this.loadRoomState,1e3))}catch(t){console.warn("[game] subscribe realtime failed",t),this.refreshTimer||(this.refreshTimer=setInterval(this.loadRoomState,1e3))}},unsubscribeRoomRealtime(){if(this.roomChannel){try{this.roomChannel.unsubscribe()}catch(t){}this.roomChannel=null}if(this.broadcastChannel){try{this.broadcastChannel.unsubscribe()}catch(t){}this.broadcastChannel=null}},async loadRoomState(){try{const e=this.$store.state.roomId;if(!e)return void(this.room=null);const a=await Promise.resolve().then(s.bind(null,"afab")),i=a.default,r=await i.getRoom(e),o=r&&r.room_players?[...r.room_players]:[];if(o.sort((t,e)=>{const s="number"===typeof t.seat_index?t.seat_index:9999,a="number"===typeof e.seat_index?e.seat_index:9999;return s-a}),r.room_players=o,this.room=r,r&&"waiting"===r.status&&this.$store.commit("SET_GAME_PHASE","preparation"),r&&"playing"===r.status)try{const{getSupabase:t}=await Promise.resolve().then(s.bind(null,"40bc")),e=t(),{data:a}=await e.from("auctions").select("*").eq("status","active").eq("status","active"),i=new Set((this.$store.state.currentAuctions||[]).map(t=>t.id));for(const s of a||[]){if(i.has(s.id))continue;const t=s.artifact||this.artifactMap[s.artifact_id]||{id:s.artifact_id,name:s.artifact_id},e={id:s.id,artifact:t,highestBid:s.highest_bid||0,highestBidder:s.highest_bidder||null,timeRemaining:"number"===typeof s.time_remaining?s.time_remaining:30,bids:[],startTime:Date.now(),status:"active",_timer:null};this.$store.commit("ADD_OR_UPDATE_AUCTION",e)}(a||[]).length>0&&this.$store.commit("SET_GAME_PHASE","auction")}catch(t){console.warn("[game] sync active auctions failed",t)}"ended"===r.status&&(this.$store.commit("SET_GAME_PHASE","settlement"),this.showGameEndDialog=!0,setTimeout(()=>{this.handleGameEnd()},3e3));const n=Array.from(new Set(o.map(t=>t.user_id).filter(Boolean)));if(n.length>0){const{getSupabase:t}=await Promise.resolve().then(s.bind(null,"40bc")),e=t(),{data:a}=await e.from("profiles").select("id, username, avatar").in("id",n),i={};(a||[]).forEach(t=>{i[t.id]={username:t.username,avatar:t.avatar}}),this.profileMap=i}else this.profileMap={};try{const t=this.$store.state.user&&this.$store.state.user.id;if(e&&t){const{getSupabase:a}=await Promise.resolve().then(s.bind(null,"40bc")),i=a(),{data:r}=await i.from("room_artifacts").select("artifact_id").eq("room_id",e).eq("owner_user_id",t),o=(r||[]).map(t=>t.artifact_id),n=(this.room&&this.room.room_players?this.room.room_players:[]).find(e=>e.user_id===t);if(n){const t={id:n.user_id,name:this.getNameFor(n.user_id),energy:50,artifacts:o,items:[]};this.$store.commit("SET_CURRENT_PLAYER",t),this.$store.commit("SET_PLAYER_ARTIFACTS",o)}}}catch(t){console.warn("[game] sync player hand from DB failed",t)}}catch(t){console.warn("[game] loadRoomState failed",t)}},async toggleReady(){try{const t=this.$store.state.roomId,e=this.$store.state.user&&this.$store.state.user.id;if(!t||!e)return;const a=(this.room&&this.room.room_players?this.room.room_players:[]).find(t=>t.user_id===e),i=!(a&&a.is_ready),r=await Promise.resolve().then(s.bind(null,"afab")),o=r.default;await o.setReady(t,e,i),await this.loadRoomState()}catch(t){console.warn("[game] toggleReady failed",t)}},async moveToSeat(t){try{const e=this.$store.state.roomId,a=this.$store.state.user&&this.$store.state.user.id;if(!e||!a)return;const i=this.seats,r=(this.room&&this.room.room_players?this.room.room_players:[]).find(t=>t.user_id===a),o=r&&"number"===typeof r.seat_index?r.seat_index:-1,n=i[t]&&i[t].player,c=await Promise.resolve().then(s.bind(null,"afab")),l=c.default;n&&n.user_id!==a?(await l.setSeat(e,n.user_id,null),await l.setSeat(e,a,t),o>=0&&await l.setSeat(e,n.user_id,o)):await l.setSeat(e,a,t),r&&(r.seat_index=t),await this.loadRoomState()}catch(e){console.warn("[game] moveToSeat failed",e)}},async leaveRoom(){try{const t=this.$store.state.roomId,e=this.$store.state.user&&this.$store.state.user.id;if(!t||!e)return;const a=await Promise.resolve().then(s.bind(null,"afab")),i=a.default;await i.leaveRoom(t,e),this.unsubscribeRoomRealtime(),this.$store.commit("SET_ROOM_ID",null),this.room=null,this.$router.push("/rooms")}catch(t){console.warn("[game] leaveRoom failed",t)}},async handleGameEnd(){try{const t=this.$store.state.roomId;if(t){const{getSupabase:e}=await Promise.resolve().then(s.bind(null,"40bc")),a=e();await a.from("rooms").update({status:"waiting"}).eq("id",t),this.$router.push({path:"/game",query:{roomId:t,gameEnded:"true"}})}else this.$router.push("/rooms")}catch(t){console.warn("[game] handleGameEnd failed",t),this.$router.push("/rooms")}},async startGame(){try{const e=this.$store.state.roomId,a=this.$store.state.user&&this.$store.state.user.id;if(!e||!a||!this.isOwner||!this.allReady)return;const i=await Promise.resolve().then(s.bind(null,"afab")),r=i.default;await r.startGame(e,a),this.$store.commit("SET_GAME_PHASE","preparation"),this.$store.commit("ADD_GAME_LOG",{timestamp:Date.now(),message:"æ¸¸æˆå¼€å§‹ï¼æ‰€æœ‰ç©å®¶è·å¾—50ç‚¹åˆå§‹èƒ½é‡"});const o=(this.room&&this.room.room_players?this.room.room_players:[]).find(t=>t.user_id===a);o&&this.$store.commit("SET_CURRENT_PLAYER",{id:o.user_id,name:this.getNameFor(o.user_id),energy:50,artifacts:[],items:[]});try{const{getSupabase:t}=await Promise.resolve().then(s.bind(null,"40bc")),a=t();await a.channel("room_cast_"+e).send({type:"broadcast",event:"game_started",payload:{gamePhase:"preparation"}})}catch(t){console.warn("[game] broadcast game_started failed",t)}this.startAuctionCountdown()}catch(t){console.warn("[game] startGame failed",t)}},async startAuction(){const t=await this.loadArtifacts();if(t.length>0){const e=[];while(e.length<Math.min(2,t.length)){const s=t[Math.floor(Math.random()*t.length)];e.find(t=>t.id===s.id)||e.push(s)}for(const t of e)await this.$store.dispatch("startAuction",t)}},async loadArtifacts(){try{const{getSupabase:t}=await Promise.resolve().then(s.bind(null,"40bc")),e=t(),{data:a,error:i}=await e.from("artifacts").select("*");if(i)throw i;return(a||[]).map(t=>({id:t.id,name:t.name,era:t.era,location:t.location,story:t.story,collectionTags:t.collection_tags||[],baseValue:t.base_value||0,image:t.image}))}catch(t){return console.error("åŠ è½½å¡ç‰Œæ•°æ®å¤±è´¥:",t),[]}},openShop(){this.$store.commit("SET_SHOW_SHOP",!0)},closeShop(){this.$store.commit("SET_SHOW_SHOP",!1)},showArtifactDetail(t){const e=this.artifactMap[t];this.selectedCard=e||{id:t,name:"ç¤ºä¾‹å¥‡ç‰©",era:"å¤ä»£",location:"æœªçŸ¥",story:"è¿™æ˜¯ä¸€ä¸ªç¥ç§˜çš„å¥‡ç‰©...",collectionTags:["è‰ºæœ¯ç‘°å®"],baseValue:8,image:"https://via.placeholder.com/300x200?text=ç¤ºä¾‹å¥‡ç‰©"},this.$store.commit("SET_SHOW_CARD_DETAIL",!0)},hideCardDetail(){this.$store.commit("SET_SHOW_CARD_DETAIL",!1),this.selectedCard=null},showArtifactDetailFromAuction(t){this.selectedCard=t,this.$store.commit("SET_SHOW_CARD_DETAIL",!0)},showPlayerHand(t){const e={id:t.user_id,name:this.getNameFor(t.user_id),artifacts:this.currentPlayer&&this.currentPlayer.id===t.user_id&&this.currentPlayer.artifacts||[]};this.handPlayer=e,this.showHandPopup=!0},hideHand(){this.handPlayer=null,this.showHandPopup=!1},formatTime(t){const e=new Date(t);return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},getAvatarFor(t){const e=this.profileMap[t];if(e&&e.avatar)return e.avatar;const s=(e&&e.username?e.username:t||"U").toString().slice(0,2).toUpperCase(),a="334155",i="e2e8f0",r=encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><rect width='100%' height='100%' fill='#${a}'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-size='16' fill='#${i}' font-family='Arial, sans-serif'>${s}</text></svg>`);return"data:image/svg+xml;charset=utf-8,"+r},getNameFor(t){const e=this.profileMap[t];return e&&e.username?e.username:this.room&&this.room.owner_id===t?"æˆ¿ä¸»":(t||"").slice(0,6)},async loadCollections(){try{const t=await fetch("/static/data/collections.json");this.collections=await t.json()}catch(t){console.error("åŠ è½½æ”¶è—é›†æ•°æ®å¤±è´¥:",t),this.collections=[]}},isCollectionCompleted(t){const e=this.getCurrentCollectionCount(t);return e>=t.requiredCount},getCurrentCollectionCount(t){if(!this.currentPlayer||!this.currentPlayer.artifacts)return 0;let e=0;return this.currentPlayer.artifacts.forEach(s=>{const a=this.artifactMap[s];a&&a.collectionTags&&a.collectionTags.includes(t.name)&&e++}),e},getCollectionProgress(t){const e=this.getCurrentCollectionCount(t),s=t.requiredCount;return Math.min(e/s*100,100)},closeGameEndDialog(){this.showGameEndDialog=!1},stayInRoom(){this.showGameEndDialog=!1},goToRooms(){this.showGameEndDialog=!1,this.unsubscribeRoomRealtime(),this.$store.commit("SET_ROOM_ID",null),this.room=null,this.$router.push("/rooms")},async onAuctionTimeUp(){try{const t=this.$store.state.currentAuctions||[];for(const e of t)await this.$store.dispatch("endAuction",e.id)}catch(t){console.warn("[game] onAuctionTimeUp failed",t)}},startAuctionCountdown(){this.auctionTimer&&(clearInterval(this.auctionTimer),this.auctionTimer=null),this.$store.commit("SET_GAME_PHASE","preparation"),this.prepCountdown=0,this.$nextTick(()=>{this.prepCountdown=5,this.$nextTick(()=>{console.log("å€’è®¡æ—¶åˆå§‹åŒ–å®Œæˆï¼Œå¼€å§‹å€’è®¡æ—¶"),this.auctionTimer=setInterval(()=>{this.$set(this,"prepCountdown",this.prepCountdown-1),console.log("å‡†å¤‡å€’è®¡æ—¶:",this.prepCountdown),this.prepCountdown<=0&&(clearInterval(this.auctionTimer),this.auctionTimer=null,setTimeout(()=>{this.autoStartAuction()},500))},1e3)})})},startUnifiedAuctionTimer(t){this.auctionCountdown=Number(t)||30,this.auctionTimer&&(clearInterval(this.auctionTimer),this.auctionTimer=null),this.$store.commit("SET_GAME_PHASE","auction"),console.log("å¼€å§‹æ‹å–å€’è®¡æ—¶:",this.auctionCountdown),this.auctionTimer=setInterval(async()=>{this.auctionCountdown--,console.log("æ‹å–å€’è®¡æ—¶:",this.auctionCountdown),this.auctionCountdown<=0&&(clearInterval(this.auctionTimer),this.auctionTimer=null,await this.onAuctionTimeUp())},1e3)},async autoStartAuction(){try{this.$store.commit("SET_GAME_PHASE","auction"),await new Promise(t=>setTimeout(t,300));const t=await this.loadArtifacts();if(t.length>0){const e=[];while(e.length<Math.min(2,t.length)){const s=t[Math.floor(Math.random()*t.length)];e.find(t=>t.id===s.id)||e.push(s)}for(const t of e)await this.$store.dispatch("startAuction",t);this.startUnifiedAuctionTimer(30);const a=this.$store.state.roomId;if(a){const{getSupabase:t}=await Promise.resolve().then(s.bind(null,"40bc")),i=t();await i.channel("room_cast_"+a).send({type:"broadcast",event:"auction_started",payload:{artifacts:e,duration:30}})}}}catch(t){console.warn("[game] autoStartAuction failed",t)}},async sendMessage(){if(!this.newMessage.trim()||!this.user)return;const t={id:Date.now(),userId:this.user.id,username:this.user.email||"åŒ¿å",content:this.newMessage.trim(),timestamp:Date.now()};this.chatMessages.push(t),this.newMessage="";const e=this.$store.state.roomId;if(e)try{const{getSupabase:a}=await Promise.resolve().then(s.bind(null,"40bc")),i=a();await i.channel("room_cast_"+e).send({type:"broadcast",event:"chat_message",payload:t})}catch(a){console.warn("[game] sendMessage failed",a)}},formatMessageTime(t){const e=new Date(t),s=new Date,a=s-e;return a<6e4?"åˆšåˆš":a<36e5?Math.floor(a/6e4)+"åˆ†é’Ÿå‰":e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}}},Y=F,z=(s("60d5"),Object(c["a"])(Y,S,P,!1,null,"6b61fc81",null)),W=z.exports,V=function(){var t=this,e=t._self._c;return e("view",{staticClass:"card-detail-page"},[e("view",{staticClass:"detail-header"},[e("button",{staticClass:"back-button",on:{click:t.goBack}},[t._v("â† è¿”å›")]),e("text",{staticClass:"page-title"},[t._v("å¥‡ç‰©è¯¦æƒ…")])]),t.artifact?e("view",{staticClass:"card-content"},[e("view",{staticClass:"artifact-image-section"},[e("image",{staticClass:"artifact-image",attrs:{src:t.artifact.image,mode:"aspectFit"},on:{error:t.onImageError}})]),e("view",{staticClass:"artifact-info"},[e("text",{staticClass:"artifact-name"},[t._v(t._s(t.artifact.name))]),e("text",{staticClass:"artifact-era"},[t._v(t._s(t.artifact.era))]),e("text",{staticClass:"artifact-location"},[t._v(t._s(t.artifact.location))]),e("view",{staticClass:"artifact-tags"},t._l(t.artifact.collectionTags,(function(s){return e("text",{key:s,staticClass:"artifact-tag"},[t._v(" "+t._s(s)+" ")])})),0),e("view",{staticClass:"artifact-value"},[e("text",{staticClass:"value-label"},[t._v("åŸºç¡€ä»·å€¼:")]),e("text",{staticClass:"value-number"},[t._v(t._s(t.artifact.baseValue))])])]),e("view",{staticClass:"artifact-story"},[e("text",{staticClass:"story-title"},[t._v("èƒŒæ™¯æ•…äº‹")]),e("text",{staticClass:"story-content"},[t._v(t._s(t.artifact.story))])]),e("view",{staticClass:"related-collections"},[e("text",{staticClass:"collections-title"},[t._v("ç›¸å…³æ”¶è—é›†")]),e("view",{staticClass:"collections-list"},t._l(t.artifact.collectionTags,(function(s){return e("view",{key:s,staticClass:"collection-item"},[e("text",{staticClass:"collection-name"},[t._v(t._s(s))]),e("text",{staticClass:"collection-progress"},[t._v(" "+t._s(t.getCollectionProgress(s))+" ")])])})),0)])]):e("view",{staticClass:"loading"},[e("text",[t._v("åŠ è½½ä¸­...")])])])},J=[],X={name:"CardDetailPage",data(){return{artifact:null}},computed:{...Object(u["c"])(["currentPlayer"])},async mounted(){await this.loadArtifact()},methods:{async loadArtifact(){const t=this.$route.query.id;if(!t)return uni.showToast({title:"å¥‡ç‰©IDä¸å­˜åœ¨",icon:"none"}),void this.goBack();try{const e=await uni.request({url:"/static/data/artifacts.json"}),s=e.data;this.artifact=s.find(e=>e.id===t),this.artifact||(uni.showToast({title:"å¥‡ç‰©ä¸å­˜åœ¨",icon:"none"}),this.goBack())}catch(e){console.error("åŠ è½½å¥‡ç‰©è¯¦æƒ…å¤±è´¥:",e),uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"}),this.goBack()}},onImageError(){console.error("å¥‡ç‰©å›¾ç‰‡åŠ è½½å¤±è´¥:",this.artifact.image),this.artifact.image="/static/images/placeholder.jpg"},getCollectionProgress(t){if(!this.currentPlayer||!this.currentPlayer.collections)return"0/æœªçŸ¥";const e=this.currentPlayer.collections[t]||0,s=this.getRequiredCount(t);return`${e}/${s}`},getRequiredCount(t){const e={"è‰ºæœ¯ç‘°å®":3,"ç§‘æŠ€å¥‡ç‚¹":2,"ç”Ÿå‘½å¥¥ç§˜":3,"æƒåŠ›è±¡å¾":2};return e[t]||0},goBack(){uni.navigateBack()}}},Z=X,Q=(s("94be"),Object(c["a"])(Z,V,J,!1,null,"4e4f11fb",null)),K=Q.exports,tt=function(){var t=this,e=t._self._c;return e("view",{staticClass:"shop-page"},[e("view",{staticClass:"shop-header"},[e("text",{staticClass:"page-title"},[t._v("é“å…·å•†åº—")]),e("view",{staticClass:"player-info"},[e("text",{staticClass:"player-name"},[t._v(t._s(t.currentPlayer.name))]),e("view",{staticClass:"energy-display"},[e("text",{staticClass:"energy-icon"},[t._v("âš¡")]),e("text",{staticClass:"energy-value"},[t._v(t._s(t.currentPlayer.energy))])])])]),e("view",{staticClass:"shop-content"},[e("view",{staticClass:"category-tabs"},t._l(t.categories,(function(s){return e("view",{key:s,staticClass:"category-tab",class:{active:t.selectedCategory===s},on:{click:function(e){return t.selectCategory(s)}}},[t._v(" "+t._s(s)+" ")])})),0),e("view",{staticClass:"items-list"},t._l(t.filteredItems,(function(s){return e("view",{key:s.id,staticClass:"item-card"},[e("image",{staticClass:"item-icon",attrs:{src:s.icon,mode:"aspectFit"}}),e("view",{staticClass:"item-details"},[e("text",{staticClass:"item-name"},[t._v(t._s(s.name))]),e("text",{staticClass:"item-description"},[t._v(t._s(s.description))]),e("view",{staticClass:"item-meta"},[e("text",{staticClass:"item-price"},[t._v(t._s(s.price)+" èƒ½é‡")]),e("text",{staticClass:"item-type"},[t._v(t._s(s.type))])])]),e("button",{staticClass:"buy-button",attrs:{disabled:!t.canBuyItem(s)},on:{click:function(e){return t.buyItem(s)}}},[t._v(" "+t._s(t.getBuyButtonText(s))+" ")])])})),0)]),e("view",{staticClass:"my-items"},[e("text",{staticClass:"section-title"},[t._v("æˆ‘çš„é“å…· ("+t._s(t.playerItems.length)+"/5)")]),e("view",{staticClass:"items-grid"},t._l(t.playerItems,(function(s){return e("view",{key:s.id,staticClass:"player-item",on:{click:function(e){return t.useItem(s)}}},[e("image",{staticClass:"item-icon-small",attrs:{src:s.icon,mode:"aspectFit"}}),e("text",{staticClass:"item-name-small"},[t._v(t._s(s.name))]),e("text",{staticClass:"item-type-small"},[t._v(t._s(s.type))])])})),0)]),e("uni-popup",{ref:"buyConfirmPopup",attrs:{type:"center"}},[e("view",{staticClass:"buy-confirm-popup"},[e("text",{staticClass:"confirm-title"},[t._v("ç¡®è®¤è´­ä¹°")]),e("view",{staticClass:"confirm-content"},[e("image",{staticClass:"confirm-icon",attrs:{src:t.selectedItem.icon,mode:"aspectFit"}}),e("view",{staticClass:"confirm-details"},[e("text",{staticClass:"confirm-name"},[t._v(t._s(t.selectedItem.name))]),e("text",{staticClass:"confirm-price"},[t._v("ä»·æ ¼: "+t._s(t.selectedItem.price)+" èƒ½é‡")]),e("text",{staticClass:"confirm-description"},[t._v(t._s(t.selectedItem.description))])])]),e("view",{staticClass:"confirm-buttons"},[e("button",{staticClass:"cancel-button",on:{click:t.cancelBuy}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"confirm-button",on:{click:t.confirmBuy}},[t._v("ç¡®è®¤è´­ä¹°")])])])])],1)},et=[],st={name:"ShopPage",data(){return{items:[],playerItems:[],categories:["å…¨éƒ¨","ç ´å","æ§åˆ¶","ç»æµ","å¢ç›Š"],selectedCategory:"å…¨éƒ¨",selectedItem:null}},computed:{...Object(u["c"])(["currentPlayer"]),filteredItems(){return"å…¨éƒ¨"===this.selectedCategory?this.items:this.items.filter(t=>t.type===this.selectedCategory)}},async mounted(){await this.loadData()},methods:{async loadData(){await this.loadItems(),await this.loadPlayerItems()},async loadItems(){this.items=g.getItems()},async loadPlayerItems(){this.currentPlayer&&(this.playerItems=g.getPlayerItems(this.currentPlayer.id))},selectCategory(t){this.selectedCategory=t},canBuyItem(t){return this.currentPlayer.energy>=t.price&&this.playerItems.length<5},getBuyButtonText(t){return this.currentPlayer.energy<t.price?"èƒ½é‡ä¸è¶³":this.playerItems.length>=5?"é“å…·æ å·²æ»¡":"è´­ä¹°"},buyItem(t){this.selectedItem=t,this.$refs.buyConfirmPopup.open()},async confirmBuy(){if(this.selectedItem)try{const t=await this.$store.dispatch("buyItem",{playerId:this.currentPlayer.id,itemId:this.selectedItem.id});this.$store.commit("SET_PLAYER_ENERGY",t.remainingEnergy),await this.loadPlayerItems(),this.$refs.buyConfirmPopup.close(),this.selectedItem=null,uni.showToast({title:"è´­ä¹°æˆåŠŸ",icon:"success"})}catch(t){uni.showToast({title:t.message||"è´­ä¹°å¤±è´¥",icon:"none"})}},cancelBuy(){this.$refs.buyConfirmPopup.close(),this.selectedItem=null},async useItem(t){uni.showModal({title:"ä½¿ç”¨é“å…·",content:`ç¡®å®šè¦ä½¿ç”¨ ${t.name} å—ï¼Ÿ`,success:async e=>{if(e.confirm)try{const e=await this.$store.dispatch("useItem",{playerId:this.currentPlayer.id,itemId:t.id});await this.loadPlayerItems(),uni.showToast({title:e.message||"é“å…·ä½¿ç”¨æˆåŠŸ",icon:"success"})}catch(s){uni.showToast({title:s.message||"é“å…·ä½¿ç”¨å¤±è´¥",icon:"none"})}}})}}},at=st,it=(s("2da4"),Object(c["a"])(at,tt,et,!1,null,"7dadcc5e",null)),rt=it.exports,ot=function(){var t=this,e=t._self._c;return e("view",{staticClass:"collection-page"},[e("view",{staticClass:"page-header"},[e("text",{staticClass:"page-title"},[t._v("æ”¶è—é›†")]),e("view",{staticClass:"player-info"},[e("text",{staticClass:"player-name"},[t._v(t._s(t.currentPlayer.name))]),e("text",{staticClass:"completion-rate"},[t._v("å®Œæˆåº¦: "+t._s(t.completionRate)+"%")])])]),e("view",{staticClass:"collections-list"},t._l(t.collections,(function(s){return e("view",{key:s.id,staticClass:"collection-card",class:{completed:t.isCollectionCompleted(s)}},[e("image",{staticClass:"collection-icon",attrs:{src:s.icon,mode:"aspectFit"}}),e("view",{staticClass:"collection-info"},[e("text",{staticClass:"collection-name"},[t._v(t._s(s.name))]),e("text",{staticClass:"collection-description"},[t._v(t._s(s.description))]),e("view",{staticClass:"collection-progress"},[e("view",{staticClass:"progress-bar"},[e("view",{staticClass:"progress-fill",style:{width:t.getProgressWidth(s)}})]),e("text",{staticClass:"progress-text"},[t._v(" "+t._s(t.getCurrentCount(s))+"/"+t._s(s.requiredCount)+" ")])]),e("view",{staticClass:"collection-reward"},[e("text",{staticClass:"reward-label"},[t._v("å¥–åŠ±:")]),e("text",{staticClass:"reward-points"},[t._v(t._s(s.rewardPoints)+" åˆ†")]),t.isCollectionCompleted(s)?e("text",{staticClass:"reward-status"},[t._v(" å·²å®Œæˆ âœ“ ")]):t._e()])])])})),0),e("view",{staticClass:"my-artifacts"},[e("text",{staticClass:"section-title"},[t._v("æˆ‘çš„å¥‡ç‰© ("+t._s(t.playerArtifacts.length)+")")]),e("view",{staticClass:"artifacts-grid"},t._l(t.playerArtifacts,(function(s){return e("view",{key:s.id,staticClass:"artifact-card",on:{click:function(e){return t.showArtifactDetail(s)}}},[e("image",{staticClass:"artifact-image",attrs:{src:s.image,mode:"aspectFit"}}),e("view",{staticClass:"artifact-info"},[e("text",{staticClass:"artifact-name"},[t._v(t._s(s.name))]),e("text",{staticClass:"artifact-era"},[t._v(t._s(s.era))]),e("view",{staticClass:"artifact-tags"},t._l(s.collectionTags,(function(s){return e("text",{key:s,staticClass:"artifact-tag"},[t._v(" "+t._s(s)+" ")])})),0),e("text",{staticClass:"artifact-value"},[t._v("ä»·å€¼: "+t._s(s.baseValue))])])])})),0)]),e("uni-popup",{ref:"artifactDetailPopup",attrs:{type:"center"}},[t.selectedArtifact?e("view",{staticClass:"artifact-detail-popup"},[e("image",{staticClass:"detail-image",attrs:{src:t.selectedArtifact.image,mode:"aspectFit"}}),e("view",{staticClass:"detail-content"},[e("text",{staticClass:"detail-name"},[t._v(t._s(t.selectedArtifact.name))]),e("text",{staticClass:"detail-era"},[t._v(t._s(t.selectedArtifact.era)+" - "+t._s(t.selectedArtifact.location))]),e("text",{staticClass:"detail-story"},[t._v(t._s(t.selectedArtifact.story))]),e("view",{staticClass:"detail-tags"},t._l(t.selectedArtifact.collectionTags,(function(s){return e("text",{key:s,staticClass:"detail-tag"},[t._v(" "+t._s(s)+" ")])})),0),e("text",{staticClass:"detail-value"},[t._v("åŸºç¡€ä»·å€¼: "+t._s(t.selectedArtifact.baseValue))])]),e("button",{staticClass:"close-button",on:{click:t.hideArtifactDetail}},[t._v("å…³é—­")])]):t._e()])],1)},nt=[],ct={name:"CollectionPage",data(){return{collections:[],playerArtifacts:[],selectedArtifact:null}},computed:{...Object(u["c"])(["currentPlayer"]),completionRate(){if(0===this.collections.length)return 0;const t=this.collections.filter(t=>this.isCollectionCompleted(t)).length;return Math.round(t/this.collections.length*100)}},async mounted(){await this.loadData()},methods:{async loadData(){await this.loadCollections(),await this.loadPlayerArtifacts()},async loadCollections(){try{const t=await uni.request({url:"/static/data/collections.json"});this.collections=t.data}catch(t){console.error("åŠ è½½æ”¶è—é›†æ•°æ®å¤±è´¥:",t)}},async loadPlayerArtifacts(){if(this.currentPlayer&&this.currentPlayer.artifacts)try{const t=await uni.request({url:"/static/data/artifacts.json"}),e=t.data;this.playerArtifacts=e.filter(t=>this.currentPlayer.artifacts.includes(t.id))}catch(t){console.error("åŠ è½½å¥‡ç‰©æ•°æ®å¤±è´¥:",t)}},isCollectionCompleted(t){const e=this.getCurrentCount(t);return e>=t.requiredCount},getCurrentCount(t){return this.currentPlayer&&this.currentPlayer.collections&&this.currentPlayer.collections[t.name]||0},getProgressWidth(t){const e=this.getCurrentCount(t),s=Math.min(e/t.requiredCount*100,100);return s+"%"},showArtifactDetail(t){this.selectedArtifact=t,this.$refs.artifactDetailPopup.open()},hideArtifactDetail(){this.$refs.artifactDetailPopup.close(),this.selectedArtifact=null}}},lt=ct,dt=(s("9150"),Object(c["a"])(lt,ot,nt,!1,null,"953fb5ce",null)),ut=dt.exports,mt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"auth-container"},[e("div",{staticClass:"topbar"},[e("button",{staticClass:"btn link",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.$router.replace("/menu")}}},[t._v("è¿”å›èœå•")])]),e("div",{staticClass:"auth-card"},[e("div",{staticClass:"form-field"},[e("label",[t._v("è´¦å·ï¼ˆé‚®ç®±æˆ–ç”¨æˆ·åï¼‰")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.account,expression:"account"}],attrs:{type:"text",placeholder:"è¾“å…¥é‚®ç®±æˆ–ç”¨æˆ·å"},domProps:{value:t.account},on:{input:function(e){e.target.composing||(t.account=e.target.value)}}})]),e("div",{staticClass:"form-field"},[e("label",[t._v("å¯†ç ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"è‡³å°‘6ä½"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})]),"register"===t.mode?e("div",{staticClass:"form-field"},[e("label",[t._v("æ˜µç§°ï¼ˆæ³¨å†Œæ—¶å¯é€‰ï¼‰")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{type:"text",placeholder:"ä½ çš„æ˜µç§°"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})]):t._e(),e("p",{staticClass:"hint"},[t._v(t._s("login"===t.mode?"ä½¿ç”¨è´¦å·ï¼ˆé‚®ç®±æˆ–ç”¨æˆ·åï¼‰ç™»å½•åè¿›å…¥èœå•åˆ›å»ºæˆ–åŠ å…¥æˆ¿é—´":"ä»…ç”¨è´¦å·+å¯†ç æ³¨å†Œï¼›å¦‚ä½¿ç”¨ç”¨æˆ·åæ³¨å†Œå°†ç”Ÿæˆç³»ç»Ÿé‚®ç®±"))]),e("div",{staticClass:"actions"},["login"===t.mode?e("button",{staticClass:"btn primary",attrs:{disabled:t.isSubmitting},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.handleSignIn.apply(null,arguments)}}},[t._v(t._s(t.isSubmitting?"å¤„ç†ä¸­...":"ç™»å½•"))]):e("button",{staticClass:"btn primary",attrs:{disabled:t.isSubmitting},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.handleSignUp.apply(null,arguments)}}},[t._v(t._s(t.isSubmitting?"å¤„ç†ä¸­...":"æ³¨å†Œ"))]),e("button",{staticClass:"btn link",attrs:{disabled:t.isSubmitting},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.toggleRegister.apply(null,arguments)}}},[t._v(t._s("login"===t.mode?"æ²¡æœ‰è´¦å·ï¼Ÿæ³¨å†Œ":"å·²æœ‰è´¦å·ï¼Ÿå»ç™»å½•"))])])]),t.errorMessage?e("p",{staticClass:"error"},[t._v(t._s(t.errorMessage))]):t._e()])},ht=[];class pt{async signUpAccount(t,e,s){const a=Object(p["getSupabase"])(),i=/@/.test(t),r=i?t:t+"@local.invalid",{data:o,error:n}=await a.auth.signUp({email:r,password:e});if(n)throw n;return o&&o.user&&await a.from("profiles").upsert({id:o.user.id,username:s||t,account:t}),o}async signInAccount(t,e){const s=Object(p["getSupabase"])();let a=t;if(!/@/.test(t)){const{data:e}=await s.from("profiles").select("id, username, account").eq("username",t).maybeSingle();a=e&&e.account?e.account+"@local.invalid":t+"@local.invalid"}const{data:i,error:r}=await s.auth.signInWithPassword({email:a,password:e});if(r)throw r;return i}async signOut(){const t=Object(p["getSupabase"])();await t.auth.signOut()}async getUser(){const t=Object(p["getSupabase"])(),{data:e}=await t.auth.getUser();if(!e||!e.user)return null;try{const{data:s}=await t.from("profiles").select("username, avatar").eq("id",e.user.id).single();return{...e.user,username:s&&s.username,avatar:s&&s.avatar}}catch(s){return console.warn("Failed to load user profile:",s),e.user}}onAuthStateChange(t){const e=Object(p["getSupabase"])();return e.auth.onAuthStateChange(async(s,a)=>{const i=a&&a.user||null;if(i)try{const{data:s}=await e.from("profiles").select("username, avatar").eq("id",i.id).single(),a={...i,username:s&&s.username,avatar:s&&s.avatar};t(a)}catch(r){t(i)}else t(null)})}}var _t=new pt,ft={name:"LoginPage",data(){return{account:"",password:"",username:"",errorMessage:"",mode:"login",isSubmitting:!1}},methods:{async handleSignUp(){this.errorMessage="";try{const t=await _t.signUpAccount(this.account,this.password,this.username),e=t&&t.user;e&&(this.$store.commit("SET_USER",e),this.$router.push("/menu"))}catch(t){this.errorMessage=t.message||"æ³¨å†Œå¤±è´¥"}},async handleSignIn(){this.errorMessage="";try{const t=await _t.signInAccount(this.account,this.password),e=t&&t.user;e&&(this.$store.commit("SET_USER",e),this.$router.push("/menu"))}catch(t){this.errorMessage=t.message||"ç™»å½•å¤±è´¥"}},toggleRegister(){this.mode="login"===this.mode?"register":"login"}}},vt=ft,gt=(s("1b5f"),Object(c["a"])(vt,mt,ht,!1,null,"f8057020",null)),Ct=gt.exports,yt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rooms-container"},[e("nav",{staticClass:"navbar"},[e("div",{staticClass:"nav-content"},[t._m(0),e("div",{staticClass:"nav-actions"},[e("button",{staticClass:"nav-btn",on:{click:function(e){return t.$router.push("/create-room")}}},[e("span",{staticClass:"btn-icon"},[t._v("â•")]),t._v(" åˆ›å»ºæˆ¿é—´ ")]),e("button",{staticClass:"nav-btn",on:{click:function(e){return t.$router.push("/menu")}}},[e("span",{staticClass:"btn-icon"},[t._v("â†")]),t._v(" è¿”å›èœå• ")])])])]),e("main",{staticClass:"main-content"},[t._m(1),e("section",{staticClass:"quick-join-section"},[e("div",{staticClass:"quick-join-card"},[t._m(2),e("div",{staticClass:"card-content"},[e("div",{staticClass:"input-group"},[e("div",{staticClass:"input-icon"},[t._v("ğŸ ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.roomIdInput,expression:"roomIdInput"}],staticClass:"room-input",attrs:{type:"text",placeholder:"è¾“å…¥æˆ¿é—´IDï¼ˆæ”¯æŒ6ä½æ•°å­—æˆ–å®Œæ•´UUIDï¼‰"},domProps:{value:t.roomIdInput},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.joinById.apply(null,arguments)},input:function(e){e.target.composing||(t.roomIdInput=e.target.value)}}}),e("button",{staticClass:"input-btn",attrs:{disabled:!t.roomIdInput},on:{click:t.joinById}},[t._v(" åŠ å…¥ ")])]),t.errorMessage?e("p",{staticClass:"error-message"},[t._v(t._s(t.errorMessage))]):t._e()])])]),e("section",{staticClass:"rooms-section"},[e("div",{staticClass:"section-header"},[e("h2",{staticClass:"section-title"},[t._v("å¯ç”¨æˆ¿é—´")]),e("p",{staticClass:"section-subtitle"},[t._v(t._s(t.rooms.length)+" ä¸ªæˆ¿é—´å¯ç”¨")])]),t.rooms&&t.rooms.length?e("div",{staticClass:"rooms-grid"},t._l(t.rooms,(function(s){return e("div",{key:s.id,staticClass:"room-card",class:{selected:t.selectedRoomId===s.id},on:{click:function(e){return t.selectRoom(s.id)}}},[e("div",{staticClass:"room-header"},[e("div",{staticClass:"room-icon"},[t._v("ğŸ ")]),e("div",{staticClass:"room-info"},[e("h3",{staticClass:"room-name"},[t._v(t._s(s.name||"æˆ¿é—´"+(s.short_id||s.id.slice(0,8))))]),e("div",{staticClass:"room-id"},[t._v("ID: "+t._s(s.short_id||s.id.slice(0,8)))])]),e("div",{staticClass:"room-status",class:s.status},[e("span",{staticClass:"status-dot"}),t._v(" "+t._s(t.getStatusText(s.status))+" ")])]),e("div",{staticClass:"room-details"},[e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-icon"},[t._v("ğŸ‘¥")]),e("span",{staticClass:"detail-label"},[t._v("äººæ•°")]),e("span",{staticClass:"detail-value"},[t._v(t._s(null!=s.current_players?s.current_players:0)+"/"+t._s(s.max_players))])]),e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-icon"},[t._v("ğŸ•’")]),e("span",{staticClass:"detail-label"},[t._v("åˆ›å»ºæ—¶é—´")]),e("span",{staticClass:"detail-value"},[t._v(t._s(t.formatTime(s.created_at)))])])]),e("div",{staticClass:"room-actions"},[e("button",{staticClass:"join-btn",attrs:{disabled:"waiting"!==s.status},on:{click:function(e){e.stopPropagation(),t.selectedRoomId===s.id?t.joinSelectedRoom():t.selectRoom(s.id)}}},[e("span",{staticClass:"btn-icon"},[t._v("ğŸšª")]),t._v(" "+t._s(t.selectedRoomId===s.id?"åŠ å…¥æˆ¿é—´":"é€‰æ‹©æˆ¿é—´")+" ")])])])})),0):e("div",{staticClass:"empty-state"},[e("div",{staticClass:"empty-icon"},[t._v("ğŸ ")]),e("h3",{staticClass:"empty-title"},[t._v("æš‚æ— å¯ç”¨æˆ¿é—´")]),e("p",{staticClass:"empty-subtitle"},[t._v("å½“å‰æ²¡æœ‰ç­‰å¾…ä¸­çš„æˆ¿é—´ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°æˆ¿é—´")]),e("button",{staticClass:"empty-action",on:{click:function(e){return t.$router.push("/create-room")}}},[e("span",{staticClass:"btn-icon"},[t._v("â•")]),t._v(" åˆ›å»ºæˆ¿é—´ ")])])])])])},wt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"brand"},[e("div",{staticClass:"brand-icon"},[t._v("ğŸ ")]),e("span",{staticClass:"brand-text"},[t._v("æˆ¿é—´åˆ—è¡¨")])])},function(){var t=this,e=t._self._c;return e("section",{staticClass:"header-section"},[e("div",{staticClass:"section-header"},[e("h1",{staticClass:"section-title"},[t._v("é€‰æ‹©æˆ¿é—´åŠ å…¥")]),e("p",{staticClass:"section-subtitle"},[t._v("æµè§ˆå¯ç”¨æˆ¿é—´æˆ–é€šè¿‡IDç›´æ¥åŠ å…¥")])])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"card-header"},[e("div",{staticClass:"card-icon"},[t._v("ğŸ”¢")]),e("h2",{staticClass:"card-title"},[t._v("å¿«é€ŸåŠ å…¥")]),e("p",{staticClass:"card-subtitle"},[t._v("è¾“å…¥æˆ¿é—´IDç›´æ¥åŠ å…¥æŒ‡å®šæˆ¿é—´")])])}],bt=s("afab"),It={name:"RoomsPage",data(){return{rooms:[],selectedRoomId:"",roomIdInput:"",errorMessage:"",refreshTimer:null}},async mounted(){const t=await _t.getUser();t&&this.$store.commit("SET_USER",t),this.refreshTimer=setInterval(this.loadRooms,5e3),await this.loadRooms()},beforeDestroy(){this.refreshTimer&&clearInterval(this.refreshTimer)},methods:{async loadRooms(){try{this.rooms=await bt["default"].listRooms()}catch(t){}},selectRoom(t){this.selectedRoomId=t},async joinSelectedRoom(){try{const t=this.$store.state.user;if(console.log("[rooms.vue] joinSelectedRoom clicked",{selectedRoomId:this.selectedRoomId,userId:t&&t.id}),!t)return this.$router.push("/login");if(!this.selectedRoomId)throw new Error("è¯·é€‰æ‹©æˆ¿é—´");const e=await bt["default"].joinRoom(this.selectedRoomId,t.id);console.log("[rooms.vue] joinSelectedRoom success",{roomId:e&&e.id}),this.$store.commit("SET_ROOM_ID",e.id),this.$router.push({path:"/game",query:{roomId:e.id}})}catch(t){console.error("[rooms] joinSelectedRoom error",t),this.errorMessage=t.message||"åŠ å…¥æˆ¿é—´å¤±è´¥"}},async joinById(){try{const t=this.$store.state.user;if(console.log("[rooms.vue] joinById clicked",{input:this.roomIdInput,userId:t&&t.id}),!t)return this.$router.push("/login");if(!this.roomIdInput)throw new Error("è¯·å¡«å†™æˆ¿é—´ID");const e=await bt["default"].joinRoom(this.roomIdInput,t.id);console.log("[rooms.vue] joinById success",{roomId:e&&e.id}),this.$store.commit("SET_ROOM_ID",e.id),this.$router.push({path:"/game",query:{roomId:e.id}})}catch(t){console.error("[rooms] joinById error",t),this.errorMessage=t.message||"åŠ å…¥æˆ¿é—´å¤±è´¥"}},getStatusText(t){const e={waiting:"ç­‰å¾…ä¸­",playing:"æ¸¸æˆä¸­",ended:"å·²ç»“æŸ"};return e[t]||t},formatTime(t){const e=new Date(t),s=new Date,a=s-e;return a<6e4?"åˆšåˆš":a<36e5?Math.floor(a/6e4)+"åˆ†é’Ÿå‰":a<864e5?Math.floor(a/36e5)+"å°æ—¶å‰":e.toLocaleDateString("zh-CN")}}},St=It,Pt=(s("d637"),Object(c["a"])(St,yt,wt,!1,null,"502c8979",null)),At=Pt.exports,Et=function(){var t=this,e=t._self._c;return e("div",{staticClass:"create-room-container"},[e("nav",{staticClass:"navbar"},[e("div",{staticClass:"nav-content"},[t._m(0),e("div",{staticClass:"nav-actions"},[t.currentRoom?e("button",{staticClass:"nav-btn",on:{click:function(e){return t.$router.push("/rooms")}}},[e("span",{staticClass:"btn-icon"},[t._v("ğŸ ")]),t._v(" è¿”å›æˆ¿é—´åˆ—è¡¨ ")]):t._e(),e("button",{staticClass:"nav-btn",on:{click:function(e){return t.$router.push("/menu")}}},[e("span",{staticClass:"btn-icon"},[t._v("â†")]),t._v(" è¿”å›èœå• ")])])])]),e("main",{staticClass:"main-content"},[e("section",{staticClass:"create-section"},[t._m(1),e("div",{staticClass:"form-container"},[e("div",{staticClass:"form-card"},[t._m(2),e("div",{staticClass:"form-content"},[e("div",{staticClass:"form-field"},[t._m(3),e("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"form-input",attrs:{type:"text",placeholder:"ä¾‹å¦‚ï¼šæ—¶ç©ºæ‹å–-1å·æˆ¿"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}}),e("p",{staticClass:"field-hint"},[t._v("ç»™ä½ çš„æˆ¿é—´èµ·ä¸ªæœ‰è¶£çš„åå­—")])]),e("div",{staticClass:"form-field"},[t._m(4),e("div",{staticClass:"number-input-group"},[e("button",{staticClass:"number-btn",attrs:{disabled:t.maxPlayers<=2},on:{click:t.decreasePlayers}},[t._v("-")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.maxPlayers,expression:"maxPlayers",modifiers:{number:!0}}],staticClass:"number-input",attrs:{type:"number",min:"2",max:"8",readonly:""},domProps:{value:t.maxPlayers},on:{input:function(e){e.target.composing||(t.maxPlayers=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{staticClass:"number-btn",attrs:{disabled:t.maxPlayers>=8},on:{click:t.increasePlayers}},[t._v("+")])]),e("p",{staticClass:"field-hint"},[t._v("2-8äººï¼Œæ¨è4-6äºº")])]),e("div",{staticClass:"form-field"},[t._m(5),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"form-textarea",attrs:{placeholder:"å†™ç‚¹æˆ¿é—´ç‰¹è‰²æˆ–è§„åˆ™...",rows:"3"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}}),e("p",{staticClass:"field-hint"},[t._v("å¯é€‰ï¼Œæè¿°æˆ¿é—´çš„ç‰¹è‰²æˆ–ç‰¹æ®Šè§„åˆ™")])])]),e("div",{staticClass:"form-actions"},[e("button",{staticClass:"create-btn",attrs:{disabled:t.isCreating},on:{click:t.handleCreate}},[t.isCreating?e("span",{staticClass:"btn-spinner"}):t._e(),e("span",{staticClass:"btn-icon"},[t._v("ğŸš€")]),t._v(" "+t._s(t.isCreating?"åˆ›å»ºä¸­...":"åˆ›å»ºæˆ¿é—´")+" ")])]),t.errorMessage?e("p",{staticClass:"error-message"},[t._v(t._s(t.errorMessage))]):t._e()])])]),t.room?e("section",{staticClass:"success-section"},[e("div",{staticClass:"success-card"},[t._m(6),e("div",{staticClass:"room-info"},[e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[t._v("æˆ¿é—´åç§°")]),e("div",{staticClass:"info-value"},[t._v(t._s(t.room.name||"æœªå‘½åæˆ¿é—´"))])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[t._v("æˆ¿é—´ID")]),e("div",{staticClass:"info-value room-id"},[t._v(t._s(t.room.short_id))])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[t._v("æœ€å¤§äººæ•°")]),e("div",{staticClass:"info-value"},[t._v(t._s(t.room.max_players)+"äºº")])]),t.room.description?e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[t._v("æˆ¿é—´æè¿°")]),e("div",{staticClass:"info-value"},[t._v(t._s(t.room.description))])]):t._e()]),e("div",{staticClass:"invite-section"},[e("h3",{staticClass:"invite-title"},[t._v("é‚€è¯·æœ‹å‹")]),e("div",{staticClass:"invite-methods"},[e("div",{staticClass:"invite-method"},[e("div",{staticClass:"method-icon"},[t._v("ğŸ”¢")]),e("div",{staticClass:"method-content"},[e("div",{staticClass:"method-label"},[t._v("æˆ¿é—´ID")]),e("div",{staticClass:"method-value"},[t._v(t._s(t.room.short_id))]),e("button",{staticClass:"copy-btn",on:{click:t.copyRoomId}},[t._v("å¤åˆ¶")])])]),e("div",{staticClass:"invite-method"},[e("div",{staticClass:"method-icon"},[t._v("ğŸ”—")]),e("div",{staticClass:"method-content"},[e("div",{staticClass:"method-label"},[t._v("é‚€è¯·é“¾æ¥")]),e("div",{staticClass:"method-value link"},[t._v(t._s(t.inviteLink))]),e("button",{staticClass:"copy-btn",on:{click:t.copyInviteLink}},[t._v("å¤åˆ¶")])])])])]),e("div",{staticClass:"success-actions"},[e("button",{staticClass:"action-btn primary",on:{click:function(e){return t.$router.push({path:"/game",query:{roomId:t.room.id}})}}},[e("span",{staticClass:"btn-icon"},[t._v("ğŸšª")]),t._v(" è¿›å…¥æˆ¿é—´ ")]),e("button",{staticClass:"action-btn secondary",on:{click:t.copyAllInfo}},[e("span",{staticClass:"btn-icon"},[t._v("ğŸ“‹")]),t._v(" å¤åˆ¶å…¨éƒ¨ä¿¡æ¯ ")])])])]):t._e()])])},xt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"brand"},[e("div",{staticClass:"brand-icon"},[t._v("ğŸ ")]),e("span",{staticClass:"brand-text"},[t._v("åˆ›å»ºæˆ¿é—´")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"section-header"},[e("h1",{staticClass:"section-title"},[t._v("åˆ›å»ºæ–°æˆ¿é—´")]),e("p",{staticClass:"section-subtitle"},[t._v("è®¾ç½®æˆ¿é—´ä¿¡æ¯ï¼Œé‚€è¯·æœ‹å‹ä¸€èµ·æ¸¸æˆ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"form-header"},[e("div",{staticClass:"form-icon"},[t._v("âš™ï¸")]),e("h2",{staticClass:"form-title"},[t._v("æˆ¿é—´è®¾ç½®")])])},function(){var t=this,e=t._self._c;return e("label",{staticClass:"field-label"},[e("span",{staticClass:"label-icon"},[t._v("ğŸ·ï¸")]),t._v(" æˆ¿é—´åç§° ")])},function(){var t=this,e=t._self._c;return e("label",{staticClass:"field-label"},[e("span",{staticClass:"label-icon"},[t._v("ğŸ‘¥")]),t._v(" æœ€å¤§äººæ•° ")])},function(){var t=this,e=t._self._c;return e("label",{staticClass:"field-label"},[e("span",{staticClass:"label-icon"},[t._v("ğŸ“")]),t._v(" æˆ¿é—´æè¿° ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"success-header"},[e("div",{staticClass:"success-icon"},[t._v("ğŸ‰")]),e("h2",{staticClass:"success-title"},[t._v("æˆ¿é—´åˆ›å»ºæˆåŠŸï¼")]),e("p",{staticClass:"success-subtitle"},[t._v("ä½ çš„æˆ¿é—´å·²ç»å‡†å¤‡å°±ç»ª")])])}],Rt={name:"CreateRoomPage",data(){return{name:"",maxPlayers:6,description:"",errorMessage:"",room:null,inviteLink:"",isCreating:!1,currentRoom:null}},async mounted(){const t=await _t.getUser();t?(this.$store.commit("SET_USER",t),await this.loadCurrentRoom()):this.$router.push("/login")},methods:{async loadCurrentRoom(){try{const t=this.$store.state.roomId;t&&(this.currentRoom=await bt["default"].getRoom(t))}catch(t){console.warn("[create-room] loadCurrentRoom failed",t),this.currentRoom=null}},decreasePlayers(){this.maxPlayers>2&&this.maxPlayers--},increasePlayers(){this.maxPlayers<8&&this.maxPlayers++},async handleCreate(){this.errorMessage="",this.isCreating=!0;try{const t=this.$store.state.user;if(!t)return this.$router.push("/login");const e=await bt["default"].createRoom(t.id,{name:this.name,maxPlayers:this.maxPlayers,description:this.description});this.room=e,this.$store.commit("SET_ROOM_ID",e.id),this.inviteLink=`${window.location.origin}/game?roomId=${e.id}`,this.$nextTick(()=>{const t=document.querySelector(".success-section");t&&t.scrollIntoView({behavior:"smooth"})})}catch(t){this.errorMessage=t.message||"åˆ›å»ºæˆ¿é—´å¤±è´¥"}finally{this.isCreating=!1}},async copyRoomId(){try{await navigator.clipboard.writeText(this.room.short_id),this.showCopySuccess("æˆ¿é—´IDå·²å¤åˆ¶")}catch(t){console.error("å¤åˆ¶å¤±è´¥:",t)}},async copyInviteLink(){try{await navigator.clipboard.writeText(this.inviteLink),this.showCopySuccess("é‚€è¯·é“¾æ¥å·²å¤åˆ¶")}catch(t){console.error("å¤åˆ¶å¤±è´¥:",t)}},async copyAllInfo(){const t=`æˆ¿é—´åç§°ï¼š${this.room.name||"æœªå‘½åæˆ¿é—´"}\næˆ¿é—´IDï¼š${this.room.short_id}\næœ€å¤§äººæ•°ï¼š${this.room.max_players}äºº\n${this.room.description?"æˆ¿é—´æè¿°ï¼š"+this.room.description:""}\né‚€è¯·é“¾æ¥ï¼š${this.inviteLink}`;try{await navigator.clipboard.writeText(t),this.showCopySuccess("å…¨éƒ¨ä¿¡æ¯å·²å¤åˆ¶")}catch(e){console.error("å¤åˆ¶å¤±è´¥:",e)}},showCopySuccess(t){const e=document.createElement("div");e.textContent=t,e.style.cssText="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: #10b981;\n        color: white;\n        padding: 12px 20px;\n        border-radius: 8px;\n        z-index: 1000;\n        font-size: 14px;\n        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);\n      ",document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},3e3)}}},Tt=Rt,$t=(s("4452"),Object(c["a"])(Tt,Et,xt,!1,null,"63de556e",null)),kt=$t.exports,Mt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"player-page"},[e("div",{staticClass:"header"},[e("button",{staticClass:"back",on:{click:function(e){return t.$router.back()}}},[t._v("â† è¿”å›")]),e("h2",{staticClass:"title"},[t._v("ç©å®¶ï¼š"+t._s(t.player?t.player.name:"æœªçŸ¥"))])]),t.player?e("div",{staticClass:"stats"},[e("div",{staticClass:"stat"},[t._v("èƒ½é‡ï¼š"+t._s(t.player.energy))]),e("div",{staticClass:"stat"},[t._v("å¥‡ç‰©ï¼š"+t._s(t.player.artifacts.length))]),e("div",{staticClass:"stat"},[t._v("é“å…·ï¼š"+t._s(t.player.items.length))])]):t._e(),t.player?e("div",{staticClass:"hand-section"},[e("h3",{staticClass:"section-title"},[t._v("æ‰‹ç‰Œ")]),e("div",{staticClass:"hand-grid"},t._l(t.player.artifacts,(function(s){return e("div",{key:s,staticClass:"hand-card"},[e("img",{staticClass:"hand-image",attrs:{src:t.artifactMap[s]?t.artifactMap[s].image:"https://via.placeholder.com/200x120?text=æœªçŸ¥å¡ç‰Œ"}}),e("div",{staticClass:"hand-name"},[t._v(t._s(t.artifactMap[s]?t.artifactMap[s].name:s))])])})),0)]):t._e()])},Dt=[],Ot={name:"PlayerPage",data(){return{player:null,artifactMap:{}}},async mounted(){const t=this.$route.params.id,e=this.$store.state.players.find(e=>e.id===t)||null;this.player=e;const s=await this.loadArtifacts();this.artifactMap=s.reduce((t,e)=>(t[e.id]=e,t),{})},methods:{async loadArtifacts(){try{return[{id:"artifact_001",name:"å”ä»£ç§˜è‰²ç“·",image:"https://via.placeholder.com/300x200?text=å”ä»£ç§˜è‰²ç“·"},{id:"artifact_002",name:"è¾¾èŠ¬å¥‡è®¾è®¡å›¾",image:"https://via.placeholder.com/300x200?text=è¾¾èŠ¬å¥‡è®¾è®¡å›¾"}]}catch(t){return[]}}}},jt=Ot,Ut=(s("66db"),Object(c["a"])(jt,Mt,Dt,!1,null,"1e1863fb",null)),Bt=Ut.exports,qt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"menu-container"},[e("nav",{staticClass:"navbar"},[e("div",{staticClass:"nav-content"},[t._m(0),t.$store.state.user?e("div",{staticClass:"nav-actions"},[e("div",{staticClass:"user-info"},[e("img",{staticClass:"user-avatar",attrs:{src:t.getUserAvatar(),alt:"ç”¨æˆ·å¤´åƒ"}}),e("span",{staticClass:"user-name"},[t._v(t._s(t.getUserName()))])]),e("button",{staticClass:"nav-btn",on:{click:function(e){return t.$router.push("/profile")}}},[e("span",{staticClass:"btn-icon"},[t._v("ğŸ‘¤")]),t._v(" ä¸ªäººä¸­å¿ƒ ")]),e("button",{staticClass:"nav-btn logout",on:{click:t.logout}},[e("span",{staticClass:"btn-icon"},[t._v("ğŸšª")]),t._v(" ç™»å‡º ")])]):e("div",{staticClass:"nav-actions"},[e("button",{staticClass:"nav-btn primary",on:{click:function(e){return t.$router.push("/login")}}},[e("span",{staticClass:"btn-icon"},[t._v("ğŸ”‘")]),t._v(" ç™»å½• / æ³¨å†Œ ")])])])]),e("main",{staticClass:"main-content"},[e("section",{staticClass:"hero-section"},[e("div",{staticClass:"hero-content"},[e("div",{staticClass:"hero-badge"},[t._v("ğŸ® åˆ›æ–°æ¡Œæ¸¸ä½“éªŒ")]),t._m(1),t._m(2),e("div",{staticClass:"hero-actions"},[e("button",{staticClass:"hero-btn primary",on:{click:t.quickStart}},[e("span",{staticClass:"btn-icon"},[t._v("âš¡")]),t._v(" å¿«é€Ÿå¼€å§‹ ")]),e("button",{staticClass:"hero-btn secondary",on:{click:t.scrollToGame}},[e("span",{staticClass:"btn-icon"},[t._v("ğŸ¯")]),t._v(" äº†è§£æ›´å¤š ")])])]),t._m(3)]),e("section",{ref:"gameSection",staticClass:"game-section"},[t._m(4),e("div",{staticClass:"game-actions"},[e("div",{staticClass:"action-card primary"},[e("div",{staticClass:"card-icon"},[t._v("ğŸ ")]),e("h3",{staticClass:"card-title"},[t._v("åˆ›å»ºæˆ¿é—´")]),e("p",{staticClass:"card-desc"},[t._v("åˆ›å»ºä¸“å±æ¸¸æˆæˆ¿é—´ï¼Œé‚€è¯·æœ‹å‹ä¸€èµ·æ¸¸æˆ")]),e("button",{staticClass:"card-btn",on:{click:t.createRoom}},[t._v("åˆ›å»ºæˆ¿é—´")])]),e("div",{staticClass:"action-card secondary"},[e("div",{staticClass:"card-icon"},[t._v("ğŸ”")]),e("h3",{staticClass:"card-title"},[t._v("é€‰æ‹©æˆ¿é—´")]),e("p",{staticClass:"card-desc"},[t._v("æµè§ˆæˆ¿é—´åˆ—è¡¨ï¼Œé€‰æ‹©å–œæ¬¢çš„æˆ¿é—´åŠ å…¥")]),e("button",{staticClass:"card-btn",on:{click:t.goRooms}},[t._v("é€‰æ‹©æˆ¿é—´")])])]),e("div",{staticClass:"join-room-section"},[t._m(5),e("div",{staticClass:"form-content"},[e("div",{staticClass:"input-group"},[e("div",{staticClass:"input-icon"},[t._v("ğŸ”¢")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.roomIdInput,expression:"roomIdInput"}],staticClass:"room-input",attrs:{type:"text",placeholder:"è¾“å…¥æˆ¿é—´IDï¼ˆæ”¯æŒ6ä½æ•°å­—æˆ–å®Œæ•´UUIDï¼‰"},domProps:{value:t.roomIdInput},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.joinRoom.apply(null,arguments)},input:function(e){e.target.composing||(t.roomIdInput=e.target.value)}}}),e("button",{staticClass:"input-btn",attrs:{disabled:!t.roomIdInput},on:{click:t.joinRoom}},[t._v(" åŠ å…¥ ")])]),t.errorMessage?e("p",{staticClass:"error-message"},[t._v(t._s(t.errorMessage))]):t._e()])])]),t._m(6)])])},Nt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"brand"},[e("div",{staticClass:"brand-icon"},[t._v("âš¡")]),e("span",{staticClass:"brand-text"},[t._v("æ—¶ç©ºæ—…äººæ‹å–ä¼š")])])},function(){var t=this,e=t._self._c;return e("h1",{staticClass:"hero-title"},[e("span",{staticClass:"title-highlight"},[t._v("æ—¶ç©ºæ—…äºº")]),e("br"),t._v("æ‹å–ä¼š ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"hero-subtitle"},[t._v(" ç»“åˆå®ä½“å¡ç‰Œä¸æ•°å­—ç§‘æŠ€çš„åˆ›æ–°çº¿ä¸‹æ¡Œæ¸¸"),e("br"),t._v(" æ‰®æ¼”æ—¶ç©ºæ—…äººï¼Œç«æ‹å¥‡ç‰©ï¼Œäº‰å¤ºæ—¶ç©ºå½±å“åŠ› ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"hero-visual"},[e("div",{staticClass:"floating-card card-1"},[t._v("ğŸº")]),e("div",{staticClass:"floating-card card-2"},[t._v("âš”ï¸")]),e("div",{staticClass:"floating-card card-3"},[t._v("ğŸ“œ")]),e("div",{staticClass:"floating-card card-4"},[t._v("ğŸ’")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"section-header"},[e("h2",{staticClass:"section-title"},[t._v("å¼€å§‹æ¸¸æˆ")]),e("p",{staticClass:"section-subtitle"},[t._v("é€‰æ‹©ä½ çš„æ¸¸æˆæ–¹å¼")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"form-header"},[e("h3",{staticClass:"form-title"},[t._v("é€šè¿‡æˆ¿é—´IDåŠ å…¥")]),e("p",{staticClass:"form-subtitle"},[t._v("è¾“å…¥æˆ¿é—´IDç›´æ¥åŠ å…¥æŒ‡å®šæˆ¿é—´")])])},function(){var t=this,e=t._self._c;return e("section",{staticClass:"features-section"},[e("div",{staticClass:"section-header"},[e("h2",{staticClass:"section-title"},[t._v("æ¸¸æˆç‰¹è‰²")]),e("p",{staticClass:"section-subtitle"},[t._v("ä½“éªŒç‹¬ç‰¹çš„æ—¶ç©ºæ‹å–ç©æ³•")])]),e("div",{staticClass:"features-grid"},[e("div",{staticClass:"feature-card"},[e("div",{staticClass:"feature-icon"},[t._v("ğŸº")]),e("h3",{staticClass:"feature-title"},[t._v("å¥‡ç‰©æ‹å–")]),e("p",{staticClass:"feature-desc"},[t._v("ç«æ‹æ¥è‡ªä¸åŒæ—¶ç©ºçš„çè´µå¥‡ç‰©ï¼Œæ¯ä»¶éƒ½æœ‰ç‹¬ç‰¹çš„å†å²èƒŒæ™¯å’Œä»·å€¼")])]),e("div",{staticClass:"feature-card"},[e("div",{staticClass:"feature-icon"},[t._v("âš¡")]),e("h3",{staticClass:"feature-title"},[t._v("é“å…·äº¤äº’")]),e("p",{staticClass:"feature-desc"},[t._v("ä½¿ç”¨æ—¶ç©ºä¹±æµã€èµå“é‰´å®šç­‰é“å…·æ”¹å˜æ‹å–å±€åŠ¿ï¼Œå¢åŠ ç­–ç•¥æ·±åº¦")])]),e("div",{staticClass:"feature-card"},[e("div",{staticClass:"feature-icon"},[t._v("ğŸ“š")]),e("h3",{staticClass:"feature-title"},[t._v("æ”¶è—é›†ç³»ç»Ÿ")]),e("p",{staticClass:"feature-desc"},[t._v("æ„å»ºç‹¬ç‰¹çš„æ”¶è—é›†ç»„åˆï¼Œè·å¾—æ—¶ç©ºå½±å“åŠ›ï¼Œäº‰å¤ºæœ€é«˜è£èª‰")])])])])}],Gt={name:"MenuPage",data(){return{roomIdInput:"",errorMessage:"",room:null,refreshTimer:null}},computed:{hasRoom(){return!!this.room},allReady(){if(!this.room||!this.room.room_players)return!1;const t=this.room.room_players;return t.length>0&&t.every(t=>!!t.is_ready)},isOwner(){return this.room&&this.$store.state.user&&this.room.owner_id===this.$store.state.user.id},canStart(){return this.hasRoom&&this.allReady&&this.isOwner}},async mounted(){const t=await _t.getUser();t&&(console.log("Loaded user:",t),this.$store.commit("SET_USER",t)),this.refreshTimer=setInterval(this.loadRoom,5e3),await this.loadRoom()},beforeDestroy(){this.refreshTimer&&clearInterval(this.refreshTimer)},methods:{async loadRoom(){try{const t=this.$store.state.roomId;if(!t)return void(this.room=null);this.room=await bt["default"].getRoom(t)}catch(t){console.warn("[menu] loadRoom failed",t)}},goRoom(){this.$router.push("/room")},goRooms(){this.$router.push("/rooms")},async createRoom(){const t=this.$store.state.user;if(!t)return this.$router.push("/login");this.$router.push("/create-room")},async joinRoom(){this.errorMessage="";try{const t=this.$store.state.user;if(console.log("[menu.vue] joinRoom clicked",{input:this.roomIdInput,userId:t&&t.id}),!t)return this.$router.push("/login");if(!this.roomIdInput)throw new Error("è¯·å¡«å†™æˆ¿é—´ID");const e=await bt["default"].joinRoom(this.roomIdInput,t.id);console.log("[menu.vue] joinRoom success",{roomId:e&&e.id}),this.$store.commit("SET_ROOM_ID",e.id),await this.loadRoom(),this.$router.push({path:"/game",query:{roomId:e.id}})}catch(t){this.errorMessage=t.message||"åŠ å…¥æˆ¿é—´å¤±è´¥"}},async quickStart(){this.errorMessage="";try{const t=this.$store.state.user;if(!t)return this.$router.push("/login");const e=await bt["default"].quickJoinRandomRoom(t.id);this.$store.commit("SET_ROOM_ID",e.id),await this.$nextTick(),this.$router.push({path:"/game",query:{roomId:e.id}})}catch(t){this.errorMessage=t.message||"æš‚æ—¶æ— æ³•å¿«é€ŸåŠ å…¥æˆ¿é—´"}},async logout(){await _t.signOut(),this.$store.commit("SET_USER",null),this.$store.commit("SET_ROOM_ID",null),this.$router.push("/menu")},scrollToGame(){this.$refs.gameSection.scrollIntoView({behavior:"smooth"})},getUserAvatar(){const t=this.$store.state.user;if(!t)return"https://via.placeholder.com/36x36?text=U";if(t.avatar)return t.avatar;const e=(t.username||(t.email?t.email.split("@")[0]:"U")).toString().slice(0,2).toUpperCase(),s="334155",a="e2e8f0",i=encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='100%' height='100%' fill='#${s}'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-size='16' fill='#${a}' font-family='Arial, sans-serif'>${e}</text></svg>`);return"data:image/svg+xml;charset=utf-8,"+i},getUserName(){const t=this.$store.state.user;return t?t.username?t.username:t.email?t.email.split("@")[0]:"ç”¨æˆ·":"æ¸¸å®¢"}}},Lt=Gt,Ht=(s("3842"),Object(c["a"])(Lt,qt,Nt,!1,null,"28d3071c",null)),Ft=Ht.exports,Yt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"profile-container"},[e("div",{staticClass:"profile-card"},[e("h2",{staticClass:"title"},[t._v("ä¸ªäººä¸­å¿ƒ")]),t.user?e("div",{staticClass:"user-info"},[e("div",{staticClass:"avatar-section"},[e("div",{staticClass:"avatar-container"},[e("div",{staticClass:"avatar-wrapper",on:{click:t.changeAvatar}},[e("img",{staticClass:"avatar",attrs:{src:t.userProfile.avatar||t.defaultAvatar,alt:"ç”¨æˆ·å¤´åƒ"},on:{error:t.handleAvatarError}}),t.isUploading?e("div",{staticClass:"upload-overlay"},[e("div",{staticClass:"upload-spinner"}),e("span",[t._v("ä¸Šä¼ ä¸­...")])]):t._e()]),e("button",{staticClass:"avatar-edit-btn",attrs:{disabled:t.isUploading},on:{click:t.changeAvatar}},[t._v(" "+t._s(t.isUploading?"ä¸Šä¼ ä¸­...":"æ›´æ¢å¤´åƒ")+" ")])])]),e("div",{staticClass:"info-section"},[e("div",{staticClass:"form-field"},[e("label",[t._v("ç”¨æˆ·å")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.userProfile.username,expression:"userProfile.username"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",disabled:!t.isEditing},domProps:{value:t.userProfile.username},on:{input:function(e){e.target.composing||t.$set(t.userProfile,"username",e.target.value)}}})]),e("div",{staticClass:"form-field"},[e("label",[t._v("é‚®ç®±")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.user.email,expression:"user.email"}],staticClass:"disabled-input",attrs:{type:"email",disabled:""},domProps:{value:t.user.email},on:{input:function(e){e.target.composing||t.$set(t.user,"email",e.target.value)}}})]),e("div",{staticClass:"form-field"},[e("label",[t._v("æ³¨å†Œæ—¶é—´")]),e("input",{staticClass:"disabled-input",attrs:{type:"text",disabled:""},domProps:{value:t.formatDate(t.user.created_at)}})])]),e("div",{staticClass:"actions"},[t.isEditing?[e("button",{staticClass:"btn primary",on:{click:t.saveProfile}},[t._v("ä¿å­˜")]),e("button",{staticClass:"btn",on:{click:t.cancelEdit}},[t._v("å–æ¶ˆ")])]:e("button",{staticClass:"btn",on:{click:t.toggleEdit}},[t._v(" ç¼–è¾‘èµ„æ–™ ")])],2)]):t._e(),e("div",{staticClass:"divider"}),e("div",{staticClass:"stats-section"},[e("h3",[t._v("æ¸¸æˆç»Ÿè®¡")]),e("div",{staticClass:"stats-grid"},[e("div",{staticClass:"stat-item"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.gameStats.totalGames||0))]),e("div",{staticClass:"stat-label"},[t._v("æ€»æ¸¸æˆæ•°")])]),e("div",{staticClass:"stat-item"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.gameStats.wins||0))]),e("div",{staticClass:"stat-label"},[t._v("èƒœåˆ©æ¬¡æ•°")])]),e("div",{staticClass:"stat-item"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.gameStats.totalArtifacts||0))]),e("div",{staticClass:"stat-label"},[t._v("è·å¾—å¥‡ç‰©")])]),e("div",{staticClass:"stat-item"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.gameStats.totalEnergy||0))]),e("div",{staticClass:"stat-label"},[t._v("æ€»èƒ½é‡")])])])]),e("div",{staticClass:"divider"}),e("div",{staticClass:"profile-actions"},[e("button",{staticClass:"btn",on:{click:function(e){return t.$router.push("/menu")}}},[t._v("è¿”å›èœå•")]),e("button",{staticClass:"btn danger",on:{click:t.logout}},[t._v("é€€å‡ºç™»å½•")])]),t.errorMessage?e("p",{staticClass:"error"},[t._v(t._s(t.errorMessage))]):t._e(),t.successMessage?e("p",{staticClass:"success"},[t._v(t._s(t.successMessage))]):t._e()])])},zt=[],Wt={name:"ProfilePage",data(){return{user:null,userProfile:{username:"",avatar:""},gameStats:{totalGames:0,wins:0,totalArtifacts:0,totalEnergy:0},isEditing:!1,isUploading:!1,originalProfile:{},errorMessage:"",successMessage:""}},computed:{defaultAvatar(){if(!this.user)return"";const t=(this.user.id||"U").slice(0,2).toUpperCase(),e="334155",s="e2e8f0",a=encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120'><rect width='100%' height='100%' fill='#${e}'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-size='48' fill='#${s}' font-family='Arial, sans-serif'>${t}</text></svg>`);return"data:image/svg+xml;charset=utf-8,"+a}},async mounted(){await this.loadUserData(),await this.loadUserProfile(),await this.loadGameStats()},methods:{async loadUserData(){const t=await _t.getUser();t?(this.user=t,this.$store.commit("SET_USER",t)):this.$router.push("/login")},async loadUserProfile(){if(this.user)try{const t=Object(p["getSupabase"])(),{data:e,error:s}=await t.from("profiles").select("*").eq("id",this.user.id).single();if(s&&"PGRST116"!==s.code)throw s;e&&(this.userProfile={username:e.username||"",avatar:e.avatar||""})}catch(t){console.error("åŠ è½½ç”¨æˆ·èµ„æ–™å¤±è´¥:",t),this.errorMessage="åŠ è½½ç”¨æˆ·èµ„æ–™å¤±è´¥"}},async loadGameStats(){if(this.user)try{Object(p["getSupabase"])();this.gameStats={totalGames:0,wins:0,totalArtifacts:0,totalEnergy:0}}catch(t){console.error("åŠ è½½æ¸¸æˆç»Ÿè®¡å¤±è´¥:",t)}},toggleEdit(){this.isEditing=!0,this.originalProfile={...this.userProfile}},cancelEdit(){this.isEditing=!1,this.userProfile={...this.originalProfile},this.errorMessage="",this.successMessage=""},async saveProfile(){if(this.user)try{const t=Object(p["getSupabase"])(),e={id:this.user.id,username:this.userProfile.username||null};this.userProfile.avatar&&(e.avatar=this.userProfile.avatar);const{error:s}=await t.from("profiles").upsert(e);if(s)throw s;const a={...this.$store.state.user,username:this.userProfile.username||this.$store.state.user&&this.$store.state.user.username,avatar:this.userProfile.avatar||this.$store.state.user&&this.$store.state.user.avatar};this.$store.commit("SET_USER",a),this.isEditing=!1,this.successMessage="èµ„æ–™ä¿å­˜æˆåŠŸ",setTimeout(()=>{this.successMessage=""},3e3)}catch(t){console.error("ä¿å­˜ç”¨æˆ·èµ„æ–™å¤±è´¥:",t),this.errorMessage="ä¿å­˜ç”¨æˆ·èµ„æ–™å¤±è´¥: "+(t.message||"æœªçŸ¥é”™è¯¯")}},changeAvatar(){const t=document.createElement("input");t.type="file",t.accept="image/*",t.style.display="none",t.onchange=async t=>{const e=t.target.files[0];if(e)if(e.size>2097152)this.errorMessage="å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MB";else if(e.type.startsWith("image/"))try{await this.uploadAvatar(e)}catch(s){console.error("å¤´åƒä¸Šä¼ å¤±è´¥:",s),this.errorMessage="å¤´åƒä¸Šä¼ å¤±è´¥"}else this.errorMessage="è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶"},document.body.appendChild(t),t.click(),document.body.removeChild(t)},async uploadAvatar(t){this.isUploading=!0,this.errorMessage="";try{const e=Object(p["getSupabase"])(),s=t.name.split(".").pop(),a=`${this.user.id}_${Date.now()}.${s}`,i=`${this.user.id}/${a}`,{error:r}=await e.storage.from("avatars").upload(i,t,{cacheControl:"3600",upsert:!1});if(r)throw r;const{data:o}=e.storage.from("avatars").getPublicUrl(i);this.userProfile.avatar=o.publicUrl,await this.saveProfile(),this.successMessage="å¤´åƒä¸Šä¼ æˆåŠŸ",setTimeout(()=>{this.successMessage=""},3e3)}catch(e){console.error("å¤´åƒä¸Šä¼ å¤±è´¥:",e),this.errorMessage="å¤´åƒä¸Šä¼ å¤±è´¥: "+(e.message||"æœªçŸ¥é”™è¯¯")}finally{this.isUploading=!1}},handleAvatarError(t){t.target.src=this.defaultAvatar},formatDate(t){if(!t)return"-";const e=new Date(t);return e.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},async logout(){try{await _t.signOut(),this.$store.commit("SET_USER",null),this.$store.commit("SET_ROOM_ID",null),this.$router.push("/login")}catch(t){console.error("é€€å‡ºç™»å½•å¤±è´¥:",t),this.errorMessage="é€€å‡ºç™»å½•å¤±è´¥"}}}},Vt=Wt,Jt=(s("0716"),Object(c["a"])(Vt,Yt,zt,!1,null,"924f9130",null)),Xt=Jt.exports;a["a"].use(I["a"]);const Zt=[{path:"/",alias:["/menu"],name:"Menu",component:Ft},{path:"/card-detail",name:"CardDetail",component:K},{path:"/shop",name:"Shop",component:rt},{path:"/collection",name:"Collection",component:ut},{path:"/login",name:"Login",component:Ct},{path:"/rooms",name:"Rooms",component:At},{path:"/create-room",name:"CreateRoom",component:kt},{path:"/player/:id",name:"PlayerPage",component:Bt},{path:"/game",name:"GameIndex",component:W},{path:"/profile",name:"Profile",component:Xt},{path:"*",redirect:"/"}],Qt=new I["a"]({mode:"history",base:"/",routes:Zt}),Kt=["/menu","/login","/rooms"];Qt.beforeEach(async(t,e,s)=>{if(Kt.includes(t.path))return s();try{const t=await _t.getUser();if(t&&!b.state.user&&b.commit("SET_USER",t),!t)return s("/login");s()}catch(a){return console.error("[router guard] error",a),s("/login")}});var te=Qt;class ee{constructor(){this.cleanupInterval=null,this.isRunning=!1}startCleanup(t=5){this.isRunning?console.warn("æ¸…ç†æœåŠ¡å·²åœ¨è¿è¡Œä¸­"):(this.isRunning=!0,this.cleanupInterval=setInterval(async()=>{try{await this.performCleanup()}catch(t){console.error("æ¸…ç†ç©ºæˆ¿é—´æ—¶å‡ºé”™:",t)}},60*t*1e3),console.log(`æˆ¿é—´æ¸…ç†æœåŠ¡å·²å¯åŠ¨ï¼Œæ¯${t}åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡`))}stopCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null,this.isRunning=!1,console.log("æˆ¿é—´æ¸…ç†æœåŠ¡å·²åœæ­¢"))}async performCleanup(){try{await bt["default"].cleanupEmptyRooms(),console.log("ç©ºæˆ¿é—´æ¸…ç†å®Œæˆ")}catch(t){console.error("æ¸…ç†ç©ºæˆ¿é—´å¤±è´¥:",t)}}async manualCleanup(){await this.performCleanup()}}var se=new ee;a["a"].config.productionTip=!1,se.startCleanup(5),new a["a"]({store:b,router:te,render:t=>t(d)}).$mount("#app")},"60d5":function(t,e,s){"use strict";s("cb48")},"66db":function(t,e,s){"use strict";s("a19d")},7316:function(t){t.exports=JSON.parse('[{"id":"collection_001","name":"è‰ºæœ¯ç‘°å®","description":"æ”¶é›†3ä»¶è‰ºæœ¯å“","requiredCount":3,"tags":["è‰ºæœ¯ç‘°å®"],"rewardPoints":50,"icon":"/static/images/collections/art_collection.png"},{"id":"collection_002","name":"ç§‘æŠ€å¥‡ç‚¹","description":"æ”¶é›†2ä»¶ç§‘æŠ€å“","requiredCount":2,"tags":["ç§‘æŠ€å¥‡ç‚¹"],"rewardPoints":40,"icon":"/static/images/collections/tech_collection.png"},{"id":"collection_003","name":"ç”Ÿå‘½å¥¥ç§˜","description":"æ”¶é›†3ä»¶ç”Ÿç‰©ç›¸å…³ç‰©å“","requiredCount":3,"tags":["ç”Ÿå‘½å¥¥ç§˜"],"rewardPoints":60,"icon":"/static/images/collections/life_collection.png"},{"id":"collection_004","name":"æƒåŠ›è±¡å¾","description":"æ”¶é›†2ä»¶æƒåŠ›ç‰©å“","requiredCount":2,"tags":["æƒåŠ›è±¡å¾"],"rewardPoints":45,"icon":"/static/images/collections/power_collection.png"}]')},8183:function(t,e,s){},"81cf":function(t,e,s){},9150:function(t,e,s){"use strict";s("245c")},"94be":function(t,e,s){"use strict";s("1254")},a19d:function(t,e,s){},a6d5:function(t,e,s){},aa73:function(t,e,s){},afab:function(t,e,s){"use strict";s.r(e);var a=s("40bc");function i(){return Math.floor(1e5+9e5*Math.random()).toString()}async function r(t){const e=Object(a["getSupabase"])(),{data:s,error:i}=await e.from("rooms").select("id").eq("short_id",t).maybeSingle();return!i&&!!s}async function o(){let t,e=0;do{if(t=i(),e++,e>10)throw new Error("æ— æ³•ç”Ÿæˆå”¯ä¸€çš„æˆ¿é—´IDï¼Œè¯·é‡è¯•")}while(await r(t));return t}class n{async createRoom(t,{name:e,maxPlayers:s=6,description:i}={}){const r=Object(a["getSupabase"])(),n=await o(),{data:c,error:l}=await r.from("rooms").insert({owner_id:t,status:"waiting",name:e,max_players:s,description:i,short_id:n}).select().single();if(l)throw l;return await r.from("room_players").insert({room_id:c.id,user_id:t,role:"owner",energy:50,is_ready:!1,seat_index:0}),c}async joinRoom(t,e){const s=Object(a["getSupabase"])();console.log("[room-service] joinRoom begin",{roomId:t,userId:e});const{data:i,error:r}=await s.from("room_players").select("room_id, rooms!inner(id, status)").eq("user_id",e);if(r)throw r;if(i&&i.length>0)for(const a of i)"waiting"===a.rooms.status&&await this.leaveRoom(a.room_id,e);let o;if(6===t.length&&/^\d{6}$/.test(t)){const{data:e,error:a}=await s.from("rooms").select().eq("short_id",t).single();if(a)throw a;o=e}else{const{data:e,error:a}=await s.from("rooms").select().eq("id",t).single();if(a)throw a;o=e}if("playing"===o.status)throw new Error("æˆ¿é—´å·²å¼€å§‹æ¸¸æˆï¼Œæ— æ³•åŠ å…¥");if("ended"===o.status){const{error:t}=await s.from("rooms").update({status:"waiting"}).eq("id",o.id);if(t)throw t;o.status="waiting"}const{data:n}=await s.from("room_players").select("id").eq("room_id",o.id);if(n&&n.length>=(o.max_players||6))throw new Error("æˆ¿é—´å·²æ»¡ï¼Œæ— æ³•åŠ å…¥");const{data:c}=await s.from("room_players").select("seat_index").eq("room_id",o.id),l=new Set((c||[]).filter(t=>"number"===typeof t.seat_index).map(t=>t.seat_index));let d=null;for(let a=0;a<(o.max_players||6);a++)if(!l.has(a)){d=a;break}const{error:u}=await s.from("room_players").upsert({room_id:o.id,user_id:e,role:"player",energy:50,is_ready:!1,seat_index:d},{onConflict:"room_id,user_id",ignoreDuplicates:!0});if(u&&"23505"!==u.code)throw u;return console.log("[room-service] joinRoom success",{roomId:o.id,userId:e}),o}async getRoom(t){const e=Object(a["getSupabase"])();let s=e.from("rooms").select("id, short_id, name, status, owner_id, max_players, invite_code, room_players(id, user_id, role, energy, is_ready, seat_index)");s=6===t.length&&/^\d{6}$/.test(t)?s.eq("short_id",t):s.eq("id",t);const{data:i,error:r}=await s.single();if(r)throw r;return i}async listRooms(){const t=Object(a["getSupabase"])(),{data:e,error:s}=await t.from("rooms").select("\n        id, \n        short_id, \n        name, \n        status, \n        created_at, \n        max_players, \n        invite_code,\n        room_players(count)\n      ").order("created_at",{ascending:!1});if(s)throw s;const i=(e||[]).map(t=>({...t,current_players:t.room_players?t.room_players.length:0}));return i}async quickJoinRandomRoom(t){const e=await this.listRooms(),s=e.filter(t=>"waiting"===t.status);if(s.length>0){const e=s[Math.floor(Math.random()*s.length)];return await this.joinRoom(e.id,t),await this.getRoom(e.id)}{console.log("[room-service] æ²¡æœ‰å¯åŠ å…¥çš„æˆ¿é—´ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°æˆ¿é—´");const e=await this.createRoom(t,{name:"æœªå‘½åæˆ¿é—´",maxPlayers:6,description:""});return await this.getRoom(e.id)}}async setReady(t,e,s){const i=Object(a["getSupabase"])(),{error:r}=await i.from("room_players").update({is_ready:!!s}).eq("room_id",t).eq("user_id",e);if(r)throw r}async setSeat(t,e,s){const i=Object(a["getSupabase"])(),{error:r}=await i.from("room_players").update({seat_index:s}).eq("room_id",t).eq("user_id",e);if(r)throw r}async startGame(t,e){const s=Object(a["getSupabase"])(),{data:i,error:r}=await s.from("rooms").select().eq("id",t).single();if(r)throw r;if(i.owner_id!==e)throw new Error("åªæœ‰æˆ¿ä¸»å¯ä»¥å¼€å§‹æ¸¸æˆ");const{data:o,error:n}=await s.from("room_players").select("*").eq("room_id",t);if(n)throw n;const c=o.length>0&&o.every(t=>!!t.is_ready);if(!c)throw new Error("è¿˜æœ‰ç©å®¶æœªå‡†å¤‡");const{error:l}=await s.from("rooms").update({status:"playing"}).eq("id",t);if(l)throw l;const{error:d}=await s.from("room_players").update({energy:50}).eq("room_id",t);if(d)throw d;const{error:u}=await s.from("room_artifacts").delete().eq("room_id",t);if(u)throw u;return{success:!0}}async leaveRoom(t,e){const s=Object(a["getSupabase"])(),{data:i,error:r}=await s.from("rooms").select("*").eq("id",t).single();if(r)throw r;const{data:o,error:n}=await s.from("room_players").select("*").eq("room_id",t);if(n)throw n;const{error:c}=await s.from("room_players").delete().eq("room_id",t).eq("user_id",e);if(c)throw c;const{data:l}=await s.from("room_players").select("id, user_id").eq("room_id",t),d=Array.isArray(l)?l.length:0;if(0===d)return await s.from("rooms").update({status:"waiting",owner_id:null}).eq("id",t),void await this.deleteEmptyRoom(t,e).catch(()=>{});if(i.owner_id===e){const e=l[0];await s.from("rooms").update({owner_id:e.user_id}).eq("id",t),await s.from("room_players").update({role:"owner"}).eq("room_id",t).eq("user_id",e.user_id)}return{success:!0}}async deleteEmptyRoom(t,e){const s=Object(a["getSupabase"])(),{data:i}=await s.from("room_players").select("id").eq("room_id",t);if(i&&i.length>0)return;const{data:r}=await s.from("rooms").select("owner_id").eq("id",t).single();if(!r||r.owner_id!==e)return;const{error:o}=await s.from("rooms").delete().eq("id",t);o&&console.error("åˆ é™¤ç©ºæˆ¿é—´å¤±è´¥:",o)}async cleanupEmptyRooms(){const t=Object(a["getSupabase"])(),{data:e,error:s}=await t.from("rooms").select("id, status").in("status",["waiting","ended"]);if(s)throw s;for(const a of e){const{data:e}=await t.from("room_players").select("id").eq("room_id",a.id);e&&0!==e.length||await this.deleteEmptyRoom(a.id).catch(()=>{})}}}e["default"]=new n},c1f4:function(t,e,s){"use strict";s("a6d5")},cb48:function(t,e,s){},d637:function(t,e,s){"use strict";s("2838")}});
//# sourceMappingURL=app.c822fff8.js.map