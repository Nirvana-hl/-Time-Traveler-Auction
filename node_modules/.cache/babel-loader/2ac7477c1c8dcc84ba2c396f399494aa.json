{"remainingRequest":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js!D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\services\\room-service.js","dependencies":[{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\services\\room-service.js","mtime":1762087622759},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762215254891},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js","mtime":1762215256120}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgZ2V0U3VwYWJhc2UgfSBmcm9tICcuL3N1cGFiYXNlLWNsaWVudCc7CgovLyDnlJ/miJA25L2N5pWw5a2XSUQKZnVuY3Rpb24gZ2VuZXJhdGVTaG9ydElkKCkgewogIHJldHVybiBNYXRoLmZsb29yKDEwMDAwMCArIE1hdGgucmFuZG9tKCkgKiA5MDAwMDApLnRvU3RyaW5nKCk7Cn0KCi8vIOajgOafpXNob3J0X2lk5piv5ZCm5bey5a2Y5ZyoCmFzeW5jIGZ1bmN0aW9uIGlzU2hvcnRJZEV4aXN0cyhzaG9ydElkKSB7CiAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogIGNvbnN0IHsKICAgIGRhdGEsCiAgICBlcnJvcgogIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tcycpLnNlbGVjdCgnaWQnKS5lcSgnc2hvcnRfaWQnLCBzaG9ydElkKS5tYXliZVNpbmdsZSgpOwogIHJldHVybiAhZXJyb3IgJiYgISFkYXRhOwp9CgovLyDnlJ/miJDllK/kuIDnmoRzaG9ydF9pZAphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVVuaXF1ZVNob3J0SWQoKSB7CiAgbGV0IHNob3J0SWQ7CiAgbGV0IGF0dGVtcHRzID0gMDsKICBkbyB7CiAgICBzaG9ydElkID0gZ2VuZXJhdGVTaG9ydElkKCk7CiAgICBhdHRlbXB0cysrOwogICAgaWYgKGF0dGVtcHRzID4gMTApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCfml6Dms5XnlJ/miJDllK/kuIDnmoTmiL/pl7RJRO+8jOivt+mHjeivlScpOwogICAgfQogIH0gd2hpbGUgKGF3YWl0IGlzU2hvcnRJZEV4aXN0cyhzaG9ydElkKSk7CiAgcmV0dXJuIHNob3J0SWQ7Cn0KY2xhc3MgUm9vbVNlcnZpY2UgewogIGFzeW5jIGNyZWF0ZVJvb20ob3duZXJJZCwgewogICAgbmFtZSwKICAgIG1heFBsYXllcnMgPSA2LAogICAgZGVzY3JpcHRpb24KICB9ID0ge30pIHsKICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTsKICAgIGNvbnN0IHNob3J0SWQgPSBhd2FpdCBnZW5lcmF0ZVVuaXF1ZVNob3J0SWQoKTsKICAgIGNvbnN0IHsKICAgICAgZGF0YSwKICAgICAgZXJyb3IKICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tcycpLmluc2VydCh7CiAgICAgIG93bmVyX2lkOiBvd25lcklkLAogICAgICBzdGF0dXM6ICd3YWl0aW5nJywKICAgICAgbmFtZSwKICAgICAgbWF4X3BsYXllcnM6IG1heFBsYXllcnMsCiAgICAgIGRlc2NyaXB0aW9uLAogICAgICBzaG9ydF9pZDogc2hvcnRJZAogICAgfSkuc2VsZWN0KCkuc2luZ2xlKCk7CiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yOwogICAgLy8gYWRkIG93bmVyIHRvIHJvb21fcGxheWVycwogICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgncm9vbV9wbGF5ZXJzJykuaW5zZXJ0KHsKICAgICAgcm9vbV9pZDogZGF0YS5pZCwKICAgICAgdXNlcl9pZDogb3duZXJJZCwKICAgICAgcm9sZTogJ293bmVyJywKICAgICAgZW5lcmd5OiA1MCwKICAgICAgaXNfcmVhZHk6IGZhbHNlLAogICAgICBzZWF0X2luZGV4OiAwCiAgICB9KTsKICAgIHJldHVybiBkYXRhOwogIH0KICBhc3luYyBqb2luUm9vbShyb29tSWQsIHVzZXJJZCkgewogICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogICAgY29uc29sZS5sb2coJ1tyb29tLXNlcnZpY2VdIGpvaW5Sb29tIGJlZ2luJywgewogICAgICByb29tSWQsCiAgICAgIHVzZXJJZAogICAgfSk7CgogICAgLy8g5qOA5p+l55So5oi35piv5ZCm5bey57uP5Zyo5YW25LuW5oi/6Ze05LitCiAgICBjb25zdCB7CiAgICAgIGRhdGE6IGV4aXN0aW5nUm9vbXMsCiAgICAgIGVycm9yOiBjaGVja0Vycm9yCiAgICB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgncm9vbV9wbGF5ZXJzJykuc2VsZWN0KCdyb29tX2lkLCByb29tcyFpbm5lcihpZCwgc3RhdHVzKScpLmVxKCd1c2VyX2lkJywgdXNlcklkKTsKICAgIGlmIChjaGVja0Vycm9yKSB0aHJvdyBjaGVja0Vycm9yOwoKICAgIC8vIOWmguaenOeUqOaIt+W3sue7j+WcqOWFtuS7luaIv+mXtOS4re+8jOWFiOmAgOWHugogICAgaWYgKGV4aXN0aW5nUm9vbXMgJiYgZXhpc3RpbmdSb29tcy5sZW5ndGggPiAwKSB7CiAgICAgIGZvciAoY29uc3QgZXhpc3RpbmdSb29tIG9mIGV4aXN0aW5nUm9vbXMpIHsKICAgICAgICBpZiAoZXhpc3RpbmdSb29tLnJvb21zLnN0YXR1cyA9PT0gJ3dhaXRpbmcnKSB7CiAgICAgICAgICBhd2FpdCB0aGlzLmxlYXZlUm9vbShleGlzdGluZ1Jvb20ucm9vbV9pZCwgdXNlcklkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyDmlK/mjIHpgJrov4dVVUlE5oiWc2hvcnRfaWTmn6Xmib7miL/pl7QKICAgIGxldCByb29tOwogICAgaWYgKHJvb21JZC5sZW5ndGggPT09IDYgJiYgL15cZHs2fSQvLnRlc3Qocm9vbUlkKSkgewogICAgICAvLyA25L2N5pWw5a2XSUQKICAgICAgY29uc3QgewogICAgICAgIGRhdGEsCiAgICAgICAgZXJyb3IKICAgICAgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21zJykuc2VsZWN0KCkuZXEoJ3Nob3J0X2lkJywgcm9vbUlkKS5zaW5nbGUoKTsKICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjsKICAgICAgcm9vbSA9IGRhdGE7CiAgICB9IGVsc2UgewogICAgICAvLyBVVUlECiAgICAgIGNvbnN0IHsKICAgICAgICBkYXRhLAogICAgICAgIGVycm9yCiAgICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tcycpLnNlbGVjdCgpLmVxKCdpZCcsIHJvb21JZCkuc2luZ2xlKCk7CiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7CiAgICAgIHJvb20gPSBkYXRhOwogICAgfQoKICAgIC8vIOajgOafpeaIv+mXtOeKtuaAge+8muWFgeiuuOWKoOWFpeetieW+heS4reeahOaIv+mXtO+8m+iLpeaIv+mXtOS4uiBlbmRlZO+8jOWImemHjee9ruS4uiB3YWl0aW5nIOS7peaUr+aMgemHjeaWsOWKoOWFpQogICAgaWYgKHJvb20uc3RhdHVzID09PSAncGxheWluZycpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCfmiL/pl7Tlt7LlvIDlp4vmuLjmiI/vvIzml6Dms5XliqDlhaUnKTsKICAgIH0KICAgIGlmIChyb29tLnN0YXR1cyA9PT0gJ2VuZGVkJykgewogICAgICBjb25zdCB7CiAgICAgICAgZXJyb3I6IHJlc2V0RXJyCiAgICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tcycpLnVwZGF0ZSh7CiAgICAgICAgc3RhdHVzOiAnd2FpdGluZycKICAgICAgfSkuZXEoJ2lkJywgcm9vbS5pZCk7CiAgICAgIGlmIChyZXNldEVycikgdGhyb3cgcmVzZXRFcnI7CiAgICAgIHJvb20uc3RhdHVzID0gJ3dhaXRpbmcnOwogICAgfQoKICAgIC8vIOajgOafpeaIv+mXtOaYr+WQpuW3sua7oQogICAgY29uc3QgewogICAgICBkYXRhOiBjdXJyZW50UGxheWVycwogICAgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21fcGxheWVycycpLnNlbGVjdCgnaWQnKS5lcSgncm9vbV9pZCcsIHJvb20uaWQpOwogICAgaWYgKGN1cnJlbnRQbGF5ZXJzICYmIGN1cnJlbnRQbGF5ZXJzLmxlbmd0aCA+PSAocm9vbS5tYXhfcGxheWVycyB8fCA2KSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ+aIv+mXtOW3sua7oe+8jOaXoOazleWKoOWFpScpOwogICAgfQoKICAgIC8vIGF2b2lkIGR1cGxpY2F0ZSBqb2luIHVuZGVyIHJhY2UgY29uZGl0aW9uczogdXBzZXJ0IG9uIChyb29tX2lkLCB1c2VyX2lkKQogICAgY29uc3QgewogICAgICBkYXRhOiBwbGF5ZXJzCiAgICB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgncm9vbV9wbGF5ZXJzJykuc2VsZWN0KCdzZWF0X2luZGV4JykuZXEoJ3Jvb21faWQnLCByb29tLmlkKTsKICAgIGNvbnN0IHRha2VuID0gbmV3IFNldCgocGxheWVycyB8fCBbXSkuZmlsdGVyKHAgPT4gdHlwZW9mIHAuc2VhdF9pbmRleCA9PT0gJ251bWJlcicpLm1hcChwID0+IHAuc2VhdF9pbmRleCkpOwogICAgbGV0IHNlYXRJbmRleCA9IG51bGw7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IChyb29tLm1heF9wbGF5ZXJzIHx8IDYpOyBpKyspIHsKICAgICAgaWYgKCF0YWtlbi5oYXMoaSkpIHsKICAgICAgICBzZWF0SW5kZXggPSBpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGVycm9yOiB1cHNlcnRFcnIKICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tX3BsYXllcnMnKS51cHNlcnQoewogICAgICByb29tX2lkOiByb29tLmlkLAogICAgICB1c2VyX2lkOiB1c2VySWQsCiAgICAgIHJvbGU6ICdwbGF5ZXInLAogICAgICBlbmVyZ3k6IDUwLAogICAgICBpc19yZWFkeTogZmFsc2UsCiAgICAgIHNlYXRfaW5kZXg6IHNlYXRJbmRleAogICAgfSwgewogICAgICBvbkNvbmZsaWN0OiAncm9vbV9pZCx1c2VyX2lkJywKICAgICAgaWdub3JlRHVwbGljYXRlczogdHJ1ZQogICAgfSk7CiAgICBpZiAodXBzZXJ0RXJyICYmIHVwc2VydEVyci5jb2RlICE9PSAnMjM1MDUnKSB0aHJvdyB1cHNlcnRFcnI7CiAgICBjb25zb2xlLmxvZygnW3Jvb20tc2VydmljZV0gam9pblJvb20gc3VjY2VzcycsIHsKICAgICAgcm9vbUlkOiByb29tLmlkLAogICAgICB1c2VySWQKICAgIH0pOwogICAgcmV0dXJuIHJvb207CiAgfQogIGFzeW5jIGdldFJvb20ocm9vbUlkKSB7CiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7CiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZS5mcm9tKCdyb29tcycpLnNlbGVjdCgnaWQsIHNob3J0X2lkLCBuYW1lLCBzdGF0dXMsIG93bmVyX2lkLCBtYXhfcGxheWVycywgaW52aXRlX2NvZGUsIHJvb21fcGxheWVycyhpZCwgdXNlcl9pZCwgcm9sZSwgZW5lcmd5LCBpc19yZWFkeSwgc2VhdF9pbmRleCknKTsKCiAgICAvLyDmlK/mjIHpgJrov4dVVUlE5oiWc2hvcnRfaWTmn6Xmib7miL/pl7QKICAgIGlmIChyb29tSWQubGVuZ3RoID09PSA2ICYmIC9eXGR7Nn0kLy50ZXN0KHJvb21JZCkpIHsKICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc2hvcnRfaWQnLCByb29tSWQpOwogICAgfSBlbHNlIHsKICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnaWQnLCByb29tSWQpOwogICAgfQogICAgY29uc3QgewogICAgICBkYXRhLAogICAgICBlcnJvcgogICAgfSA9IGF3YWl0IHF1ZXJ5LnNpbmdsZSgpOwogICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjsKICAgIHJldHVybiBkYXRhOwogIH0KICBhc3luYyBsaXN0Um9vbXMoKSB7CiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7CiAgICBjb25zdCB7CiAgICAgIGRhdGEsCiAgICAgIGVycm9yCiAgICB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgncm9vbXMnKS5zZWxlY3QoYAogICAgICAgIGlkLCAKICAgICAgICBzaG9ydF9pZCwgCiAgICAgICAgbmFtZSwgCiAgICAgICAgc3RhdHVzLCAKICAgICAgICBjcmVhdGVkX2F0LCAKICAgICAgICBtYXhfcGxheWVycywgCiAgICAgICAgaW52aXRlX2NvZGUsCiAgICAgICAgcm9vbV9wbGF5ZXJzKGNvdW50KQogICAgICBgKS5vcmRlcignY3JlYXRlZF9hdCcsIHsKICAgICAgYXNjZW5kaW5nOiBmYWxzZQogICAgfSk7CiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yOwoKICAgIC8vIOWkhOeQhuaVsOaNru+8jOa3u+WKoOW9k+WJjeeOqeWutuaVsOmHjwogICAgY29uc3Qgcm9vbXMgPSAoZGF0YSB8fCBbXSkubWFwKHJvb20gPT4gKHsKICAgICAgLi4ucm9vbSwKICAgICAgY3VycmVudF9wbGF5ZXJzOiByb29tLnJvb21fcGxheWVycyA/IHJvb20ucm9vbV9wbGF5ZXJzLmxlbmd0aCA6IDAKICAgIH0pKTsKICAgIHJldHVybiByb29tczsKICB9CiAgYXN5bmMgcXVpY2tKb2luUmFuZG9tUm9vbSh1c2VySWQpIHsKICAgIGNvbnN0IHJvb21zID0gYXdhaXQgdGhpcy5saXN0Um9vbXMoKTsKICAgIGNvbnN0IHdhaXRpbmcgPSByb29tcy5maWx0ZXIociA9PiByLnN0YXR1cyA9PT0gJ3dhaXRpbmcnKTsKCiAgICAvLyDlpoLmnpzmnInnrYnlvoXkuK3nmoTmiL/pl7TvvIzpmo/mnLrpgInmi6nkuIDkuKrliqDlhaUKICAgIGlmICh3YWl0aW5nLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgcGljayA9IHdhaXRpbmdbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogd2FpdGluZy5sZW5ndGgpXTsKICAgICAgYXdhaXQgdGhpcy5qb2luUm9vbShwaWNrLmlkLCB1c2VySWQpOwogICAgICAvLyDov5Tlm57ljIXlkKvlrozmlbTnjqnlrrbkv6Hmga/nmoTmiL/pl7Tlr7nosaEKICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0Um9vbShwaWNrLmlkKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIOWmguaenOayoeacieetieW+heS4reeahOaIv+mXtO+8jOiHquWKqOWIm+W7uuS4gOS4quaWsOaIv+mXtAogICAgICBjb25zb2xlLmxvZygnW3Jvb20tc2VydmljZV0g5rKh5pyJ5Y+v5Yqg5YWl55qE5oi/6Ze077yM6Ieq5Yqo5Yib5bu65paw5oi/6Ze0Jyk7CiAgICAgIGNvbnN0IG5ld1Jvb20gPSBhd2FpdCB0aGlzLmNyZWF0ZVJvb20odXNlcklkLCB7CiAgICAgICAgbmFtZTogYOacquWRveWQjeaIv+mXtGAsCiAgICAgICAgbWF4UGxheWVyczogNiwKICAgICAgICBkZXNjcmlwdGlvbjogJycKICAgICAgfSk7CiAgICAgIC8vIOi/lOWbnuWMheWQq+WujOaVtOeOqeWutuS/oeaBr+eahOaIv+mXtOWvueixoQogICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRSb29tKG5ld1Jvb20uaWQpOwogICAgfQogIH0KICBhc3luYyBzZXRSZWFkeShyb29tSWQsIHVzZXJJZCwgaXNSZWFkeSkgewogICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogICAgY29uc3QgewogICAgICBlcnJvcgogICAgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21fcGxheWVycycpLnVwZGF0ZSh7CiAgICAgIGlzX3JlYWR5OiAhIWlzUmVhZHkKICAgIH0pLmVxKCdyb29tX2lkJywgcm9vbUlkKS5lcSgndXNlcl9pZCcsIHVzZXJJZCk7CiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yOwogIH0KICBhc3luYyBzZXRTZWF0KHJvb21JZCwgdXNlcklkLCBzZWF0SW5kZXgpIHsKICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTsKICAgIGNvbnN0IHsKICAgICAgZXJyb3IKICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tX3BsYXllcnMnKS51cGRhdGUoewogICAgICBzZWF0X2luZGV4OiBzZWF0SW5kZXgKICAgIH0pLmVxKCdyb29tX2lkJywgcm9vbUlkKS5lcSgndXNlcl9pZCcsIHVzZXJJZCk7CiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yOwogIH0KICBhc3luYyBzdGFydEdhbWUocm9vbUlkLCBvd25lcklkKSB7CiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7CiAgICAvLyBjaGVjayBvd25lcgogICAgY29uc3QgewogICAgICBkYXRhOiByb29tLAogICAgICBlcnJvcjogcmVycgogICAgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21zJykuc2VsZWN0KCkuZXEoJ2lkJywgcm9vbUlkKS5zaW5nbGUoKTsKICAgIGlmIChyZXJyKSB0aHJvdyByZXJyOwogICAgaWYgKHJvb20ub3duZXJfaWQgIT09IG93bmVySWQpIHRocm93IG5ldyBFcnJvcign5Y+q5pyJ5oi/5Li75Y+v5Lul5byA5aeL5ri45oiPJyk7CiAgICAvLyBjaGVjayBhbGwgcmVhZHkKICAgIGNvbnN0IHsKICAgICAgZGF0YTogcGxheWVycywKICAgICAgZXJyb3I6IHBlcnIKICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tX3BsYXllcnMnKS5zZWxlY3QoJyonKS5lcSgncm9vbV9pZCcsIHJvb21JZCk7CiAgICBpZiAocGVycikgdGhyb3cgcGVycjsKICAgIGNvbnN0IGFsbFJlYWR5ID0gcGxheWVycy5sZW5ndGggPiAwICYmIHBsYXllcnMuZXZlcnkocCA9PiAhIXAuaXNfcmVhZHkpOwogICAgaWYgKCFhbGxSZWFkeSkgdGhyb3cgbmV3IEVycm9yKCfov5jmnInnjqnlrrbmnKrlh4blpIcnKTsKICAgIC8vIHNldCByb29tIHN0YXR1cwogICAgY29uc3QgewogICAgICBlcnJvcjogdWVycgogICAgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21zJykudXBkYXRlKHsKICAgICAgc3RhdHVzOiAncGxheWluZycKICAgIH0pLmVxKCdpZCcsIHJvb21JZCk7CiAgICBpZiAodWVycikgdGhyb3cgdWVycjsKCiAgICAvLyDph43nva7mnKzlsYDnjqnlrrbotYTkuqfvvJoKICAgIC8vIDEpIOWwhuaIv+mXtOWGheaJgOacieeOqeWutuiDvemHj+mHjee9ruS4ujUwCiAgICBjb25zdCB7CiAgICAgIGVycm9yOiBwZXJyMgogICAgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21fcGxheWVycycpLnVwZGF0ZSh7CiAgICAgIGVuZXJneTogNTAKICAgIH0pLmVxKCdyb29tX2lkJywgcm9vbUlkKTsKICAgIGlmIChwZXJyMikgdGhyb3cgcGVycjI7CgogICAgLy8gMikg5riF56m65pys5oi/6Ze05bey5oyB5pyJ55qE5aWH54mp77yI56Gu5L+d5q+P5bGA5LuO56m65omL5byA5aeL77yJCiAgICBjb25zdCB7CiAgICAgIGVycm9yOiBhZXJyCiAgICB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgncm9vbV9hcnRpZmFjdHMnKS5kZWxldGUoKS5lcSgncm9vbV9pZCcsIHJvb21JZCk7CiAgICBpZiAoYWVycikgdGhyb3cgYWVycjsKICAgIHJldHVybiB7CiAgICAgIHN1Y2Nlc3M6IHRydWUKICAgIH07CiAgfQoKICAvLyDnjqnlrrbpgIDlh7rmiL/pl7QKICBhc3luYyBsZWF2ZVJvb20ocm9vbUlkLCB1c2VySWQpIHsKICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTsKCiAgICAvLyDojrflj5bmiL/pl7Tkv6Hmga8KICAgIGNvbnN0IHsKICAgICAgZGF0YTogcm9vbSwKICAgICAgZXJyb3I6IHJvb21FcnIKICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tcycpLnNlbGVjdCgnKicpLmVxKCdpZCcsIHJvb21JZCkuc2luZ2xlKCk7CiAgICBpZiAocm9vbUVycikgdGhyb3cgcm9vbUVycjsKCiAgICAvLyDojrflj5bmiL/pl7TlhoXmiYDmnInnjqnlrrYKICAgIGNvbnN0IHsKICAgICAgZGF0YTogcGxheWVycywKICAgICAgZXJyb3I6IHBsYXllcnNFcnIKICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tX3BsYXllcnMnKS5zZWxlY3QoJyonKS5lcSgncm9vbV9pZCcsIHJvb21JZCk7CiAgICBpZiAocGxheWVyc0VycikgdGhyb3cgcGxheWVyc0VycjsKCiAgICAvLyDliKDpmaTor6XnjqnlrrYKICAgIGNvbnN0IHsKICAgICAgZXJyb3I6IGRlbGV0ZUVycgogICAgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21fcGxheWVycycpLmRlbGV0ZSgpLmVxKCdyb29tX2lkJywgcm9vbUlkKS5lcSgndXNlcl9pZCcsIHVzZXJJZCk7CiAgICBpZiAoZGVsZXRlRXJyKSB0aHJvdyBkZWxldGVFcnI7CgogICAgLy8g6I635Y+W5Ymp5L2Z546p5a625pWw6YePCiAgICBjb25zdCB7CiAgICAgIGRhdGE6IHJlbWFpbmluZ1BsYXllcnMKICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tX3BsYXllcnMnKS5zZWxlY3QoJ2lkLCB1c2VyX2lkJykuZXEoJ3Jvb21faWQnLCByb29tSWQpOwogICAgY29uc3QgcmVtYWluaW5nQ291bnQgPSBBcnJheS5pc0FycmF5KHJlbWFpbmluZ1BsYXllcnMpID8gcmVtYWluaW5nUGxheWVycy5sZW5ndGggOiAwOwoKICAgIC8vIOWmguaenOa4uOaIj+ato+WcqOi/m+ihjOS4lOWJqeS9meeOqeWutuWwkeS6jjLkurrvvIzkuI3lho3oh6rliqjnu5PmnZ/muLjmiI/vvIjlhYHorrjljZXkurrnu6fnu63vvIkKCiAgICAvLyDlpoLmnpzmiL/pl7TkuLrnqbrvvIzph43nva7kuLogd2FpdGluZ++8jOWFgeiuuOWQjue7reWKoOWFpe+8m+W5tuWwneivleWIoOmZpOepuuaIv++8iOWmguaenOadg+mZkOWFgeiuuO+8iQogICAgaWYgKHJlbWFpbmluZ0NvdW50ID09PSAwKSB7CiAgICAgIC8vIOaIv+mXtOS4uuepuu+8muWwhueKtuaAgemHjee9ruS4uiB3YWl0aW5n77yM5bm25riF55CG6K+l5oi/6Ze055qE5rS75Yqo5ouN5Y2W77yM6Ziy5q2i6Leo5oi/6Ze05YCS6K6h5pe25bmy5omwCiAgICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21zJykudXBkYXRlKHsKICAgICAgICBzdGF0dXM6ICd3YWl0aW5nJywKICAgICAgICBvd25lcl9pZDogbnVsbAogICAgICB9KS5lcSgnaWQnLCByb29tSWQpOwogICAgICAvLyDnu5PmnZ/or6XmiL/pl7TnmoTmiYDmnInov5vooYzkuK3nmoTmi43ljZbvvIjmlbDmja7lupPlsYLvvIkKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBkYXRhOiBhY3RpdmVBdWN0aW9ucwogICAgICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdhdWN0aW9ucycpLnNlbGVjdCgnaWQnKS5lcSgncm9vbV9pZCcsIHJvb21JZCkuZXEoJ3N0YXR1cycsICdhY3RpdmUnKTsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgYWN0aXZlQXVjdGlvbnMgfHwgW10pIHsKICAgICAgICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ2F1Y3Rpb25zJykudXBkYXRlKHsKICAgICAgICAgICAgc3RhdHVzOiAnZW5kZWQnLAogICAgICAgICAgICB0aW1lX3JlbWFpbmluZzogMAogICAgICAgICAgfSkuZXEoJ2lkJywgYS5pZCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChfKSB7fQogICAgICBhd2FpdCB0aGlzLmRlbGV0ZUVtcHR5Um9vbShyb29tSWQsIHVzZXJJZCkuY2F0Y2goKCkgPT4ge30pOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8g5aaC5p6c6YCA5Ye655qE5piv5oi/5Li777yM6ZyA6KaB56e75Lqk5oi/5Li75p2D6ZmQCiAgICBpZiAocm9vbS5vd25lcl9pZCA9PT0gdXNlcklkKSB7CiAgICAgIC8vIOWwhuaIv+S4u+adg+mZkOenu+S6pOe7meesrOS4gOS4queOqeWutgogICAgICBjb25zdCBuZXdPd25lciA9IHJlbWFpbmluZ1BsYXllcnNbMF07CiAgICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21zJykudXBkYXRlKHsKICAgICAgICBvd25lcl9pZDogbmV3T3duZXIudXNlcl9pZAogICAgICB9KS5lcSgnaWQnLCByb29tSWQpOwoKICAgICAgLy8g5pu05paw5paw5oi/5Li755qE6KeS6ImyCiAgICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21fcGxheWVycycpLnVwZGF0ZSh7CiAgICAgICAgcm9sZTogJ293bmVyJwogICAgICB9KS5lcSgncm9vbV9pZCcsIHJvb21JZCkuZXEoJ3VzZXJfaWQnLCBuZXdPd25lci51c2VyX2lkKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIHN1Y2Nlc3M6IHRydWUKICAgIH07CiAgfQoKICAvLyDliKDpmaTnqbrmiL/pl7QKICBhc3luYyBkZWxldGVFbXB0eVJvb20ocm9vbUlkLCBhY3RpbmdVc2VySWQpIHsKICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTsKCiAgICAvLyDmo4Dmn6XmiL/pl7TmmK/lkKbnnJ/nmoTkuLrnqboKICAgIGNvbnN0IHsKICAgICAgZGF0YTogcGxheWVycwogICAgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21fcGxheWVycycpLnNlbGVjdCgnaWQnKS5lcSgncm9vbV9pZCcsIHJvb21JZCk7CiAgICBpZiAocGxheWVycyAmJiBwbGF5ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJuOyAvLyDmiL/pl7TkuI3kuLrnqbrvvIzkuI3liKDpmaQKICAgIH0KCiAgICAvLyDlj6rmnInmiL/kuLvlj6/ku6XliKDpmaTmiL/pl7TvvIzpgb/lhY3op6blj5FSTFPplJnor68KICAgIGNvbnN0IHsKICAgICAgZGF0YTogcm9vbQogICAgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21zJykuc2VsZWN0KCdvd25lcl9pZCcpLmVxKCdpZCcsIHJvb21JZCkuc2luZ2xlKCk7CiAgICBpZiAoIXJvb20gfHwgcm9vbS5vd25lcl9pZCAhPT0gYWN0aW5nVXNlcklkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIC8vIOWIoOmZpOaIv+mXtO+8iOeUseS6juWklumUrue6puadn++8jOebuOWFs+eahHJvb21fcGxheWVyc+WSjHJvb21fYXJ0aWZhY3Rz5Lya6Ieq5Yqo5Yig6Zmk77yJCiAgICBjb25zdCB7CiAgICAgIGVycm9yCiAgICB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgncm9vbXMnKS5kZWxldGUoKS5lcSgnaWQnLCByb29tSWQpOwogICAgaWYgKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIoOmZpOepuuaIv+mXtOWksei0pTonLCBlcnJvcik7CiAgICB9CiAgfQoKICAvLyDlrprmnJ/muIXnkIbnqbrmiL/pl7TvvIjlj6/ku6Xorr7nva7lrprml7bku7vliqHosIPnlKjvvIkKICBhc3luYyBjbGVhbnVwRW1wdHlSb29tcygpIHsKICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTsKCiAgICAvLyDmn6Xmib7miYDmnInmiL/pl7TvvIh3YWl0aW5nL2VuZGVk77yJCiAgICBjb25zdCB7CiAgICAgIGRhdGE6IHJvb21zLAogICAgICBlcnJvcjogcm9vbXNFcnIKICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tcycpLnNlbGVjdCgnaWQsIHN0YXR1cycpLmluKCdzdGF0dXMnLCBbJ3dhaXRpbmcnLCAnZW5kZWQnXSk7CiAgICBpZiAocm9vbXNFcnIpIHRocm93IHJvb21zRXJyOwoKICAgIC8vIOajgOafpeavj+S4quaIv+mXtOaYr+WQpuacieeOqeWutgogICAgZm9yIChjb25zdCByb29tIG9mIHJvb21zKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkYXRhOiBwbGF5ZXJzCiAgICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tX3BsYXllcnMnKS5zZWxlY3QoJ2lkJykuZXEoJ3Jvb21faWQnLCByb29tLmlkKTsKICAgICAgaWYgKCFwbGF5ZXJzIHx8IHBsYXllcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgYXdhaXQgdGhpcy5kZWxldGVFbXB0eVJvb20ocm9vbS5pZCkuY2F0Y2goKCkgPT4ge30pOwogICAgICB9CiAgICB9CiAgfQp9CmV4cG9ydCBkZWZhdWx0IG5ldyBSb29tU2VydmljZSgpOw=="},{"version":3,"names":["getSupabase","generateShortId","Math","floor","random","toString","isShortIdExists","shortId","supabase","data","error","from","select","eq","maybeSingle","generateUniqueShortId","attempts","Error","RoomService","createRoom","ownerId","name","maxPlayers","description","insert","owner_id","status","max_players","short_id","single","room_id","id","user_id","role","energy","is_ready","seat_index","joinRoom","roomId","userId","console","log","existingRooms","checkError","length","existingRoom","rooms","leaveRoom","room","test","resetErr","update","currentPlayers","players","taken","Set","filter","p","map","seatIndex","i","has","upsertErr","upsert","onConflict","ignoreDuplicates","code","getRoom","query","listRooms","order","ascending","current_players","room_players","quickJoinRandomRoom","waiting","r","pick","newRoom","setReady","isReady","setSeat","startGame","rerr","perr","allReady","every","uerr","perr2","aerr","delete","success","roomErr","playersErr","deleteErr","remainingPlayers","remainingCount","Array","isArray","activeAuctions","a","time_remaining","_","deleteEmptyRoom","catch","newOwner","actingUserId","cleanupEmptyRooms","roomsErr","in"],"sources":["D:/大学生活/大三/全栈ai/项目/-Time-Traveler-Auction/src/services/room-service.js"],"sourcesContent":["import { getSupabase } from './supabase-client'\r\n\r\n// 生成6位数字ID\r\nfunction generateShortId() {\r\n  return Math.floor(100000 + Math.random() * 900000).toString()\r\n}\r\n\r\n// 检查short_id是否已存在\r\nasync function isShortIdExists(shortId) {\r\n  const supabase = getSupabase()\r\n  const { data, error } = await supabase\r\n    .from('rooms')\r\n    .select('id')\r\n    .eq('short_id', shortId)\r\n    .maybeSingle()\r\n  return !error && !!data\r\n}\r\n\r\n// 生成唯一的short_id\r\nasync function generateUniqueShortId() {\r\n  let shortId\r\n  let attempts = 0\r\n  do {\r\n    shortId = generateShortId()\r\n    attempts++\r\n    if (attempts > 10) {\r\n      throw new Error('无法生成唯一的房间ID，请重试')\r\n    }\r\n  } while (await isShortIdExists(shortId))\r\n  return shortId\r\n}\r\n\r\nclass RoomService {\r\n  async createRoom(ownerId, { name, maxPlayers = 6, description } = {}) {\r\n    const supabase = getSupabase()\r\n    const shortId = await generateUniqueShortId()\r\n    const { data, error } = await supabase\r\n      .from('rooms')\r\n      .insert({ \r\n        owner_id: ownerId, \r\n        status: 'waiting', \r\n        name, \r\n        max_players: maxPlayers, \r\n        description,\r\n        short_id: shortId\r\n      })\r\n      .select()\r\n      .single()\r\n    if (error) throw error\r\n    // add owner to room_players\r\n    await supabase.from('room_players').insert({ room_id: data.id, user_id: ownerId, role: 'owner', energy: 50, is_ready: false, seat_index: 0 })\r\n    return data\r\n  }\r\n\r\n  async joinRoom(roomId, userId) {\r\n    const supabase = getSupabase()\r\n    console.log('[room-service] joinRoom begin', { roomId, userId })\r\n    \r\n    // 检查用户是否已经在其他房间中\r\n    const { data: existingRooms, error: checkError } = await supabase\r\n      .from('room_players')\r\n      .select('room_id, rooms!inner(id, status)')\r\n      .eq('user_id', userId)\r\n    \r\n    if (checkError) throw checkError\r\n    \r\n    // 如果用户已经在其他房间中，先退出\r\n    if (existingRooms && existingRooms.length > 0) {\r\n      for (const existingRoom of existingRooms) {\r\n        if (existingRoom.rooms.status === 'waiting') {\r\n          await this.leaveRoom(existingRoom.room_id, userId)\r\n        }\r\n      }\r\n    }\r\n    \r\n    // 支持通过UUID或short_id查找房间\r\n    let room\r\n    if (roomId.length === 6 && /^\\d{6}$/.test(roomId)) {\r\n      // 6位数字ID\r\n      const { data, error } = await supabase.from('rooms').select().eq('short_id', roomId).single()\r\n      if (error) throw error\r\n      room = data\r\n    } else {\r\n      // UUID\r\n      const { data, error } = await supabase.from('rooms').select().eq('id', roomId).single()\r\n      if (error) throw error\r\n      room = data\r\n    }\r\n    \r\n    // 检查房间状态：允许加入等待中的房间；若房间为 ended，则重置为 waiting 以支持重新加入\r\n    if (room.status === 'playing') {\r\n      throw new Error('房间已开始游戏，无法加入')\r\n    }\r\n    if (room.status === 'ended') {\r\n      const { error: resetErr } = await supabase.from('rooms').update({ status: 'waiting' }).eq('id', room.id)\r\n      if (resetErr) throw resetErr\r\n      room.status = 'waiting'\r\n    }\r\n    \r\n    // 检查房间是否已满\r\n    const { data: currentPlayers } = await supabase.from('room_players').select('id').eq('room_id', room.id)\r\n    if (currentPlayers && currentPlayers.length >= (room.max_players || 6)) {\r\n      throw new Error('房间已满，无法加入')\r\n    }\r\n    \r\n    // avoid duplicate join under race conditions: upsert on (room_id, user_id)\r\n    const { data: players } = await supabase.from('room_players').select('seat_index').eq('room_id', room.id)\r\n    const taken = new Set((players || []).filter(p => typeof p.seat_index === 'number').map(p => p.seat_index))\r\n    let seatIndex = null\r\n    for (let i = 0; i < (room.max_players || 6); i++) { if (!taken.has(i)) { seatIndex = i; break } }\r\n    const { error: upsertErr } = await supabase\r\n      .from('room_players')\r\n      .upsert(\r\n        { room_id: room.id, user_id: userId, role: 'player', energy: 50, is_ready: false, seat_index: seatIndex },\r\n        { onConflict: 'room_id,user_id', ignoreDuplicates: true }\r\n      )\r\n    if (upsertErr && upsertErr.code !== '23505') throw upsertErr\r\n    console.log('[room-service] joinRoom success', { roomId: room.id, userId })\r\n    return room\r\n  }\r\n\r\n  async getRoom(roomId) {\r\n    const supabase = getSupabase()\r\n    let query = supabase\r\n      .from('rooms')\r\n      .select('id, short_id, name, status, owner_id, max_players, invite_code, room_players(id, user_id, role, energy, is_ready, seat_index)')\r\n    \r\n    // 支持通过UUID或short_id查找房间\r\n    if (roomId.length === 6 && /^\\d{6}$/.test(roomId)) {\r\n      query = query.eq('short_id', roomId)\r\n    } else {\r\n      query = query.eq('id', roomId)\r\n    }\r\n    \r\n    const { data, error } = await query.single()\r\n    if (error) throw error\r\n    return data\r\n  }\r\n\r\n  async listRooms() {\r\n    const supabase = getSupabase()\r\n    const { data, error } = await supabase\r\n      .from('rooms')\r\n      .select(`\r\n        id, \r\n        short_id, \r\n        name, \r\n        status, \r\n        created_at, \r\n        max_players, \r\n        invite_code,\r\n        room_players(count)\r\n      `)\r\n      .order('created_at', { ascending: false })\r\n    if (error) throw error\r\n    \r\n    // 处理数据，添加当前玩家数量\r\n    const rooms = (data || []).map(room => ({\r\n      ...room,\r\n      current_players: room.room_players ? room.room_players.length : 0\r\n    }))\r\n    \r\n    return rooms\r\n  }\r\n\r\n  async quickJoinRandomRoom(userId) {\r\n    const rooms = await this.listRooms()\r\n    const waiting = rooms.filter(r => r.status === 'waiting')\r\n    \r\n    // 如果有等待中的房间，随机选择一个加入\r\n    if (waiting.length > 0) {\r\n      const pick = waiting[Math.floor(Math.random() * waiting.length)]\r\n      await this.joinRoom(pick.id, userId)\r\n      // 返回包含完整玩家信息的房间对象\r\n      return await this.getRoom(pick.id)\r\n    } else {\r\n      // 如果没有等待中的房间，自动创建一个新房间\r\n      console.log('[room-service] 没有可加入的房间，自动创建新房间')\r\n      const newRoom = await this.createRoom(userId, { \r\n        name: `未命名房间`,\r\n        maxPlayers: 6,\r\n        description: ''\r\n      })\r\n      // 返回包含完整玩家信息的房间对象\r\n      return await this.getRoom(newRoom.id)\r\n    }\r\n  }\r\n\r\n  async setReady(roomId, userId, isReady) {\r\n    const supabase = getSupabase()\r\n    const { error } = await supabase\r\n      .from('room_players')\r\n      .update({ is_ready: !!isReady })\r\n      .eq('room_id', roomId)\r\n      .eq('user_id', userId)\r\n    if (error) throw error\r\n  }\r\n\r\n  async setSeat(roomId, userId, seatIndex) {\r\n    const supabase = getSupabase()\r\n    const { error } = await supabase\r\n      .from('room_players')\r\n      .update({ seat_index: seatIndex })\r\n      .eq('room_id', roomId)\r\n      .eq('user_id', userId)\r\n    if (error) throw error\r\n  }\r\n\r\n  async startGame(roomId, ownerId) {\r\n    const supabase = getSupabase()\r\n    // check owner\r\n    const { data: room, error: rerr } = await supabase.from('rooms').select().eq('id', roomId).single()\r\n    if (rerr) throw rerr\r\n    if (room.owner_id !== ownerId) throw new Error('只有房主可以开始游戏')\r\n    // check all ready\r\n    const { data: players, error: perr } = await supabase.from('room_players').select('*').eq('room_id', roomId)\r\n    if (perr) throw perr\r\n    const allReady = players.length > 0 && players.every(p => !!p.is_ready)\r\n    if (!allReady) throw new Error('还有玩家未准备')\r\n    // set room status\r\n    const { error: uerr } = await supabase.from('rooms').update({ status: 'playing' }).eq('id', roomId)\r\n    if (uerr) throw uerr\r\n\r\n    // 重置本局玩家资产：\r\n    // 1) 将房间内所有玩家能量重置为50\r\n    const { error: perr2 } = await supabase\r\n      .from('room_players')\r\n      .update({ energy: 50 })\r\n      .eq('room_id', roomId)\r\n    if (perr2) throw perr2\r\n\r\n    // 2) 清空本房间已持有的奇物（确保每局从空手开始）\r\n    const { error: aerr } = await supabase\r\n      .from('room_artifacts')\r\n      .delete()\r\n      .eq('room_id', roomId)\r\n    if (aerr) throw aerr\r\n\r\n    return { success: true }\r\n  }\r\n\r\n  // 玩家退出房间\r\n  async leaveRoom(roomId, userId) {\r\n    const supabase = getSupabase()\r\n    \r\n    // 获取房间信息\r\n    const { data: room, error: roomErr } = await supabase.from('rooms').select('*').eq('id', roomId).single()\r\n    if (roomErr) throw roomErr\r\n    \r\n    // 获取房间内所有玩家\r\n    const { data: players, error: playersErr } = await supabase.from('room_players').select('*').eq('room_id', roomId)\r\n    if (playersErr) throw playersErr\r\n    \r\n    // 删除该玩家\r\n    const { error: deleteErr } = await supabase\r\n      .from('room_players')\r\n      .delete()\r\n      .eq('room_id', roomId)\r\n      .eq('user_id', userId)\r\n    if (deleteErr) throw deleteErr\r\n    \r\n    // 获取剩余玩家数量\r\n    const { data: remainingPlayers } = await supabase.from('room_players').select('id, user_id').eq('room_id', roomId)\r\n    const remainingCount = Array.isArray(remainingPlayers) ? remainingPlayers.length : 0\r\n    \r\n    // 如果游戏正在进行且剩余玩家少于2人，不再自动结束游戏（允许单人继续）\r\n    \r\n    // 如果房间为空，重置为 waiting，允许后续加入；并尝试删除空房（如果权限允许）\r\n    if (remainingCount === 0) {\r\n      // 房间为空：将状态重置为 waiting，并清理该房间的活动拍卖，防止跨房间倒计时干扰\r\n      await supabase.from('rooms').update({ status: 'waiting', owner_id: null }).eq('id', roomId)\r\n      // 结束该房间的所有进行中的拍卖（数据库层）\r\n      try {\r\n        const { data: activeAuctions } = await supabase\r\n          .from('auctions')\r\n          .select('id')\r\n          .eq('room_id', roomId)\r\n          .eq('status', 'active')\r\n        for (const a of (activeAuctions || [])) {\r\n          await supabase.from('auctions').update({ status: 'ended', time_remaining: 0 }).eq('id', a.id)\r\n        }\r\n      } catch (_) {}\r\n      await this.deleteEmptyRoom(roomId, userId).catch(() => {})\r\n      return\r\n    }\r\n    \r\n    // 如果退出的是房主，需要移交房主权限\r\n    if (room.owner_id === userId) {\r\n      // 将房主权限移交给第一个玩家\r\n      const newOwner = remainingPlayers[0]\r\n      await supabase\r\n        .from('rooms')\r\n        .update({ owner_id: newOwner.user_id })\r\n        .eq('id', roomId)\r\n      \r\n      // 更新新房主的角色\r\n      await supabase\r\n        .from('room_players')\r\n        .update({ role: 'owner' })\r\n        .eq('room_id', roomId)\r\n        .eq('user_id', newOwner.user_id)\r\n    }\r\n    \r\n    return { success: true }\r\n  }\r\n\r\n  // 删除空房间\r\n  async deleteEmptyRoom(roomId, actingUserId) {\r\n    const supabase = getSupabase()\r\n    \r\n    // 检查房间是否真的为空\r\n    const { data: players } = await supabase.from('room_players').select('id').eq('room_id', roomId)\r\n    if (players && players.length > 0) {\r\n      return // 房间不为空，不删除\r\n    }\r\n    \r\n    // 只有房主可以删除房间，避免触发RLS错误\r\n    const { data: room } = await supabase.from('rooms').select('owner_id').eq('id', roomId).single()\r\n    if (!room || room.owner_id !== actingUserId) {\r\n      return\r\n    }\r\n    // 删除房间（由于外键约束，相关的room_players和room_artifacts会自动删除）\r\n    const { error } = await supabase.from('rooms').delete().eq('id', roomId)\r\n    if (error) {\r\n      console.error('删除空房间失败:', error)\r\n    }\r\n  }\r\n\r\n  // 定期清理空房间（可以设置定时任务调用）\r\n  async cleanupEmptyRooms() {\r\n    const supabase = getSupabase()\r\n    \r\n    // 查找所有房间（waiting/ended）\r\n    const { data: rooms, error: roomsErr } = await supabase\r\n      .from('rooms')\r\n      .select('id, status')\r\n      .in('status', ['waiting', 'ended'])\r\n    if (roomsErr) throw roomsErr\r\n    \r\n    // 检查每个房间是否有玩家\r\n    for (const room of rooms) {\r\n      const { data: players } = await supabase.from('room_players').select('id').eq('room_id', room.id)\r\n      if (!players || players.length === 0) {\r\n        await this.deleteEmptyRoom(room.id).catch(() => {})\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default new RoomService()\r\n"],"mappings":"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","ignoreList":[]}]}