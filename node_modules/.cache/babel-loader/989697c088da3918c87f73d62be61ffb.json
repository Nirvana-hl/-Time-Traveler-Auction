{"remainingRequest":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js!D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\services\\auction-service.js","dependencies":[{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\services\\auction-service.js","mtime":1762087622756},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762215254891},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js","mtime":1762215256120}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqDQogKiDmi43ljZbmnI3liqENCiAqLwpjbGFzcyBBdWN0aW9uU2VydmljZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLmN1cnJlbnRBdWN0aW9ucyA9IFtdOyAvLyDmlK/mjIHlpJrku7blkIzml7bmi43ljZYKICAgIHRoaXMuYXVjdGlvbkhpc3RvcnkgPSBbXTsKICAgIHRoaXMuZGVmYXVsdFRpbWVMaW1pdCA9IDMwOyAvLyDpu5jorqQ2MOenkgogIH0KCiAgLyoqDQogICAqIOW8gOWni+aLjeWNlg0KICAgKiBAcGFyYW0ge09iamVjdH0gYXJ0aWZhY3QgLSDopoHmi43ljZbnmoTlpYfniakNCiAgICogQHBhcmFtIHtudW1iZXJ9IHRpbWVMaW1pdCAtIOaLjeWNluaXtumXtOmZkOWItu+8iOenku+8iQ0KICAgKi8KICBzdGFydEF1Y3Rpb24oYXJ0aWZhY3QsIHRpbWVMaW1pdCA9IHRoaXMuZGVmYXVsdFRpbWVMaW1pdCkgewogICAgY29uc3QgYXVjdGlvbiA9IHsKICAgICAgaWQ6IGAke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygxNikuc2xpY2UoMil9YCwKICAgICAgYXJ0aWZhY3Q6IGFydGlmYWN0LAogICAgICBoaWdoZXN0QmlkOiAwLAogICAgICBoaWdoZXN0QmlkZGVyOiBudWxsLAogICAgICB0aW1lUmVtYWluaW5nOiB0aW1lTGltaXQsCiAgICAgIHRpbWVMaW1pdDogdGltZUxpbWl0LAogICAgICBiaWRzOiBbXSwKICAgICAgc3RhcnRUaW1lOiBEYXRlLm5vdygpLAogICAgICBzdGF0dXM6ICdhY3RpdmUnLAogICAgICBfdGltZXI6IG51bGwKICAgIH07CiAgICB0aGlzLmN1cnJlbnRBdWN0aW9ucy5wdXNoKGF1Y3Rpb24pOwogICAgLy8g5byA5aeL5YCS6K6h5pe2CiAgICB0aGlzLnN0YXJ0Q291bnRkb3duKGF1Y3Rpb24pOwogICAgcmV0dXJuIGF1Y3Rpb247CiAgfQoKICAvKioNCiAgICog5Ye65Lu3DQogICAqIEBwYXJhbSB7c3RyaW5nfSBwbGF5ZXJJZCAtIOeOqeWutklEDQogICAqIEBwYXJhbSB7c3RyaW5nfSBwbGF5ZXJOYW1lIC0g546p5a625ZCN56ewDQogICAqIEBwYXJhbSB7bnVtYmVyfSBiaWRBbW91bnQgLSDlh7rku7fph5Hpop0NCiAgICovCiAgcGxhY2VCaWQoYXVjdGlvbklkLCBwbGF5ZXJJZCwgcGxheWVyTmFtZSwgYmlkQW1vdW50KSB7CiAgICBjb25zdCBhdWN0aW9uID0gdGhpcy5nZXRBdWN0aW9uQnlJZChhdWN0aW9uSWQpOwogICAgaWYgKCFhdWN0aW9uIHx8IGF1Y3Rpb24uc3RhdHVzICE9PSAnYWN0aXZlJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ+W9k+WJjeayoeaciea0u+i3g+eahOaLjeWNlicpOwogICAgfQogICAgaWYgKGJpZEFtb3VudCA8PSBhdWN0aW9uLmhpZ2hlc3RCaWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCflh7rku7flv4Xpobvpq5jkuo7lvZPliY3mnIDpq5jku7cnKTsKICAgIH0KICAgIGNvbnN0IGJpZCA9IHsKICAgICAgcGxheWVySWQsCiAgICAgIHBsYXllck5hbWUsCiAgICAgIGFtb3VudDogYmlkQW1vdW50LAogICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgIH07CiAgICBhdWN0aW9uLmJpZHMucHVzaChiaWQpOwogICAgYXVjdGlvbi5oaWdoZXN0QmlkID0gYmlkQW1vdW50OwogICAgYXVjdGlvbi5oaWdoZXN0QmlkZGVyID0gcGxheWVySWQ7CiAgICByZXR1cm4gYmlkOwogIH0KCiAgLyoqDQogICAqIOe7k+adn+aLjeWNlg0KICAgKi8KICBlbmRBdWN0aW9uKGF1Y3Rpb25JZCkgewogICAgY29uc3QgYXVjdGlvbiA9IHRoaXMuZ2V0QXVjdGlvbkJ5SWQoYXVjdGlvbklkKTsKICAgIGlmICghYXVjdGlvbikgcmV0dXJuIG51bGw7CiAgICBhdWN0aW9uLnN0YXR1cyA9ICdlbmRlZCc7CiAgICBhdWN0aW9uLmVuZFRpbWUgPSBEYXRlLm5vdygpOwogICAgaWYgKGF1Y3Rpb24uX3RpbWVyKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwoYXVjdGlvbi5fdGltZXIpOwogICAgICBhdWN0aW9uLl90aW1lciA9IG51bGw7CiAgICB9CiAgICAvLyDorrDlvZXliLDljoblj7IKICAgIHRoaXMuYXVjdGlvbkhpc3RvcnkucHVzaCh7CiAgICAgIC4uLmF1Y3Rpb24KICAgIH0pOwogICAgY29uc3QgcmVzdWx0ID0gewogICAgICBpZDogYXVjdGlvbi5pZCwKICAgICAgd2lubmVyOiBhdWN0aW9uLmhpZ2hlc3RCaWRkZXIsCiAgICAgIHdpbm5pbmdCaWQ6IGF1Y3Rpb24uaGlnaGVzdEJpZCwKICAgICAgYXJ0aWZhY3Q6IGF1Y3Rpb24uYXJ0aWZhY3QKICAgIH07CiAgICAvLyDku47lvZPliY3liJfooajnp7vpmaQKICAgIHRoaXMuY3VycmVudEF1Y3Rpb25zID0gdGhpcy5jdXJyZW50QXVjdGlvbnMuZmlsdGVyKGEgPT4gYS5pZCAhPT0gYXVjdGlvbklkKTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioNCiAgICog5byA5aeL5YCS6K6h5pe2DQogICAqLwogIHN0YXJ0Q291bnRkb3duKGF1Y3Rpb24pIHsKICAgIGlmICghYXVjdGlvbikgcmV0dXJuOwogICAgYXVjdGlvbi5fdGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgIGlmICghYXVjdGlvbiB8fCBhdWN0aW9uLnN0YXR1cyAhPT0gJ2FjdGl2ZScpIHsKICAgICAgICBjbGVhckludGVydmFsKGF1Y3Rpb24uX3RpbWVyKTsKICAgICAgICBhdWN0aW9uLl90aW1lciA9IG51bGw7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGF1Y3Rpb24udGltZVJlbWFpbmluZy0tOwogICAgICBpZiAoYXVjdGlvbi50aW1lUmVtYWluaW5nIDw9IDApIHsKICAgICAgICBjbGVhckludGVydmFsKGF1Y3Rpb24uX3RpbWVyKTsKICAgICAgICBhdWN0aW9uLl90aW1lciA9IG51bGw7CiAgICAgICAgdGhpcy5lbmRBdWN0aW9uKGF1Y3Rpb24uaWQpOwogICAgICB9CiAgICB9LCAxMDAwKTsKICB9CgogIC8qKg0KICAgKiDojrflj5blvZPliY3mi43ljZbnirbmgIENCiAgICovCiAgZ2V0Q3VycmVudEF1Y3Rpb25zKCkgewogICAgcmV0dXJuIHRoaXMuY3VycmVudEF1Y3Rpb25zOwogIH0KICBnZXRBdWN0aW9uQnlJZChhdWN0aW9uSWQpIHsKICAgIHJldHVybiB0aGlzLmN1cnJlbnRBdWN0aW9ucy5maW5kKGEgPT4gYS5pZCA9PT0gYXVjdGlvbklkKTsKICB9CgogIC8qKg0KICAgKiDojrflj5bmi43ljZbljoblj7INCiAgICovCiAgZ2V0QXVjdGlvbkhpc3RvcnkoKSB7CiAgICByZXR1cm4gdGhpcy5hdWN0aW9uSGlzdG9yeTsKICB9CgogIC8qKg0KICAgKiDlgZzmraLlubbmuIXnqbrmiYDmnInmnKzlnLDmi43ljZborqHml7blmajvvIjnlKjkuo7miL/pl7TooqvmuIXnqbrmiJbpobXpnaLpgIDlh7rvvIkNCiAgICovCiAgc3RvcEFsbCgpIHsKICAgIHRyeSB7CiAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLmN1cnJlbnRBdWN0aW9ucykgewogICAgICAgIGlmIChhICYmIGEuX3RpbWVyKSB7CiAgICAgICAgICBjbGVhckludGVydmFsKGEuX3RpbWVyKTsKICAgICAgICAgIGEuX3RpbWVyID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgYS5zdGF0dXMgPSAnZW5kZWQnOwogICAgICB9CiAgICB9IGNhdGNoIChfKSB7fQogICAgdGhpcy5jdXJyZW50QXVjdGlvbnMgPSBbXTsKICB9Cn0KZXhwb3J0IGRlZmF1bHQgbmV3IEF1Y3Rpb25TZXJ2aWNlKCk7"},{"version":3,"names":["AuctionService","constructor","currentAuctions","auctionHistory","defaultTimeLimit","startAuction","artifact","timeLimit","auction","id","Date","now","Math","random","toString","slice","highestBid","highestBidder","timeRemaining","bids","startTime","status","_timer","push","startCountdown","placeBid","auctionId","playerId","playerName","bidAmount","getAuctionById","Error","bid","amount","timestamp","endAuction","endTime","clearInterval","result","winner","winningBid","filter","a","setInterval","getCurrentAuctions","find","getAuctionHistory","stopAll","_"],"sources":["D:/大学生活/大三/全栈ai/项目/-Time-Traveler-Auction/src/services/auction-service.js"],"sourcesContent":["/**\r\n * 拍卖服务\r\n */\r\nclass AuctionService {\r\n  constructor() {\r\n    this.currentAuctions = [] // 支持多件同时拍卖\r\n    this.auctionHistory = []\r\n    this.defaultTimeLimit = 30 // 默认60秒\r\n  }\r\n\r\n  /**\r\n   * 开始拍卖\r\n   * @param {Object} artifact - 要拍卖的奇物\r\n   * @param {number} timeLimit - 拍卖时间限制（秒）\r\n   */\r\n  startAuction(artifact, timeLimit = this.defaultTimeLimit) {\r\n    const auction = {\r\n      id: `${Date.now()}_${Math.random().toString(16).slice(2)}`,\r\n      artifact: artifact,\r\n      highestBid: 0,\r\n      highestBidder: null,\r\n      timeRemaining: timeLimit,\r\n      timeLimit: timeLimit,\r\n      bids: [],\r\n      startTime: Date.now(),\r\n      status: 'active',\r\n      _timer: null\r\n    }\r\n    this.currentAuctions.push(auction)\r\n    // 开始倒计时\r\n    this.startCountdown(auction)\r\n    return auction\r\n  }\r\n\r\n  /**\r\n   * 出价\r\n   * @param {string} playerId - 玩家ID\r\n   * @param {string} playerName - 玩家名称\r\n   * @param {number} bidAmount - 出价金额\r\n   */\r\n  placeBid(auctionId, playerId, playerName, bidAmount) {\r\n    const auction = this.getAuctionById(auctionId)\r\n    if (!auction || auction.status !== 'active') {\r\n      throw new Error('当前没有活跃的拍卖')\r\n    }\r\n    if (bidAmount <= auction.highestBid) {\r\n      throw new Error('出价必须高于当前最高价')\r\n    }\r\n    const bid = { playerId, playerName, amount: bidAmount, timestamp: Date.now() }\r\n    auction.bids.push(bid)\r\n    auction.highestBid = bidAmount\r\n    auction.highestBidder = playerId\r\n    return bid\r\n  }\r\n\r\n  /**\r\n   * 结束拍卖\r\n   */\r\n   endAuction(auctionId) {\r\n    const auction = this.getAuctionById(auctionId)\r\n    if (!auction) return null\r\n    auction.status = 'ended'\r\n    auction.endTime = Date.now()\r\n    if (auction._timer) {\r\n      clearInterval(auction._timer)\r\n      auction._timer = null\r\n    }\r\n    // 记录到历史\r\n    this.auctionHistory.push({ ...auction })\r\n    const result = {\r\n      id: auction.id,\r\n      winner: auction.highestBidder,\r\n      winningBid: auction.highestBid,\r\n      artifact: auction.artifact\r\n    }\r\n    // 从当前列表移除\r\n    this.currentAuctions = this.currentAuctions.filter(a => a.id !== auctionId)\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * 开始倒计时\r\n   */\r\n  startCountdown(auction) {\r\n    if (!auction) return\r\n    auction._timer = setInterval(() => {\r\n      if (!auction || auction.status !== 'active') {\r\n        clearInterval(auction._timer)\r\n        auction._timer = null\r\n        return\r\n      }\r\n      auction.timeRemaining--\r\n      if (auction.timeRemaining <= 0) {\r\n        clearInterval(auction._timer)\r\n        auction._timer = null\r\n        this.endAuction(auction.id)\r\n      }\r\n    }, 1000)\r\n  }\r\n\r\n  /**\r\n   * 获取当前拍卖状态\r\n   */\r\n  getCurrentAuctions() {\r\n    return this.currentAuctions\r\n  }\r\n\r\n  getAuctionById(auctionId) {\r\n    return this.currentAuctions.find(a => a.id === auctionId)\r\n  }\r\n\r\n  /**\r\n   * 获取拍卖历史\r\n   */\r\n  getAuctionHistory() {\r\n    return this.auctionHistory\r\n  }\r\n\r\n  /**\r\n   * 停止并清空所有本地拍卖计时器（用于房间被清空或页面退出）\r\n   */\r\n  stopAll() {\r\n    try {\r\n      for (const a of this.currentAuctions) {\r\n        if (a && a._timer) { clearInterval(a._timer); a._timer = null }\r\n        a.status = 'ended'\r\n      }\r\n    } catch (_) {}\r\n    this.currentAuctions = []\r\n  }\r\n}\r\n\r\nexport default new AuctionService()\r\n"],"mappings":"AAAA;AACA;AACA;AACA,MAAMA,cAAc,CAAC;EACnBC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACC,eAAe,GAAG,EAAE,EAAC;IAC1B,IAAI,CAACC,cAAc,GAAG,EAAE;IACxB,IAAI,CAACC,gBAAgB,GAAG,EAAE,EAAC;EAC7B;;EAEA;AACF;AACA;AACA;AACA;EACEC,YAAYA,CAACC,QAAQ,EAAEC,SAAS,GAAG,IAAI,CAACH,gBAAgB,EAAE;IACxD,MAAMI,OAAO,GAAG;MACdC,EAAE,EAAE,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,KAAK,CAAC,CAAC,CAAC,EAAE;MAC1DT,QAAQ,EAAEA,QAAQ;MAClBU,UAAU,EAAE,CAAC;MACbC,aAAa,EAAE,IAAI;MACnBC,aAAa,EAAEX,SAAS;MACxBA,SAAS,EAAEA,SAAS;MACpBY,IAAI,EAAE,EAAE;MACRC,SAAS,EAAEV,IAAI,CAACC,GAAG,CAAC,CAAC;MACrBU,MAAM,EAAE,QAAQ;MAChBC,MAAM,EAAE;IACV,CAAC;IACD,IAAI,CAACpB,eAAe,CAACqB,IAAI,CAACf,OAAO,CAAC;IAClC;IACA,IAAI,CAACgB,cAAc,CAAChB,OAAO,CAAC;IAC5B,OAAOA,OAAO;EAChB;;EAEA;AACF;AACA;AACA;AACA;AACA;EACEiB,QAAQA,CAACC,SAAS,EAAEC,QAAQ,EAAEC,UAAU,EAAEC,SAAS,EAAE;IACnD,MAAMrB,OAAO,GAAG,IAAI,CAACsB,cAAc,CAACJ,SAAS,CAAC;IAC9C,IAAI,CAAClB,OAAO,IAAIA,OAAO,CAACa,MAAM,KAAK,QAAQ,EAAE;MAC3C,MAAM,IAAIU,KAAK,CAAC,WAAW,CAAC;IAC9B;IACA,IAAIF,SAAS,IAAIrB,OAAO,CAACQ,UAAU,EAAE;MACnC,MAAM,IAAIe,KAAK,CAAC,aAAa,CAAC;IAChC;IACA,MAAMC,GAAG,GAAG;MAAEL,QAAQ;MAAEC,UAAU;MAAEK,MAAM,EAAEJ,SAAS;MAAEK,SAAS,EAAExB,IAAI,CAACC,GAAG,CAAC;IAAE,CAAC;IAC9EH,OAAO,CAACW,IAAI,CAACI,IAAI,CAACS,GAAG,CAAC;IACtBxB,OAAO,CAACQ,UAAU,GAAGa,SAAS;IAC9BrB,OAAO,CAACS,aAAa,GAAGU,QAAQ;IAChC,OAAOK,GAAG;EACZ;;EAEA;AACF;AACA;EACGG,UAAUA,CAACT,SAAS,EAAE;IACrB,MAAMlB,OAAO,GAAG,IAAI,CAACsB,cAAc,CAACJ,SAAS,CAAC;IAC9C,IAAI,CAAClB,OAAO,EAAE,OAAO,IAAI;IACzBA,OAAO,CAACa,MAAM,GAAG,OAAO;IACxBb,OAAO,CAAC4B,OAAO,GAAG1B,IAAI,CAACC,GAAG,CAAC,CAAC;IAC5B,IAAIH,OAAO,CAACc,MAAM,EAAE;MAClBe,aAAa,CAAC7B,OAAO,CAACc,MAAM,CAAC;MAC7Bd,OAAO,CAACc,MAAM,GAAG,IAAI;IACvB;IACA;IACA,IAAI,CAACnB,cAAc,CAACoB,IAAI,CAAC;MAAE,GAAGf;IAAQ,CAAC,CAAC;IACxC,MAAM8B,MAAM,GAAG;MACb7B,EAAE,EAAED,OAAO,CAACC,EAAE;MACd8B,MAAM,EAAE/B,OAAO,CAACS,aAAa;MAC7BuB,UAAU,EAAEhC,OAAO,CAACQ,UAAU;MAC9BV,QAAQ,EAAEE,OAAO,CAACF;IACpB,CAAC;IACD;IACA,IAAI,CAACJ,eAAe,GAAG,IAAI,CAACA,eAAe,CAACuC,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACjC,EAAE,KAAKiB,SAAS,CAAC;IAC3E,OAAOY,MAAM;EACf;;EAEA;AACF;AACA;EACEd,cAAcA,CAAChB,OAAO,EAAE;IACtB,IAAI,CAACA,OAAO,EAAE;IACdA,OAAO,CAACc,MAAM,GAAGqB,WAAW,CAAC,MAAM;MACjC,IAAI,CAACnC,OAAO,IAAIA,OAAO,CAACa,MAAM,KAAK,QAAQ,EAAE;QAC3CgB,aAAa,CAAC7B,OAAO,CAACc,MAAM,CAAC;QAC7Bd,OAAO,CAACc,MAAM,GAAG,IAAI;QACrB;MACF;MACAd,OAAO,CAACU,aAAa,EAAE;MACvB,IAAIV,OAAO,CAACU,aAAa,IAAI,CAAC,EAAE;QAC9BmB,aAAa,CAAC7B,OAAO,CAACc,MAAM,CAAC;QAC7Bd,OAAO,CAACc,MAAM,GAAG,IAAI;QACrB,IAAI,CAACa,UAAU,CAAC3B,OAAO,CAACC,EAAE,CAAC;MAC7B;IACF,CAAC,EAAE,IAAI,CAAC;EACV;;EAEA;AACF;AACA;EACEmC,kBAAkBA,CAAA,EAAG;IACnB,OAAO,IAAI,CAAC1C,eAAe;EAC7B;EAEA4B,cAAcA,CAACJ,SAAS,EAAE;IACxB,OAAO,IAAI,CAACxB,eAAe,CAAC2C,IAAI,CAACH,CAAC,IAAIA,CAAC,CAACjC,EAAE,KAAKiB,SAAS,CAAC;EAC3D;;EAEA;AACF;AACA;EACEoB,iBAAiBA,CAAA,EAAG;IAClB,OAAO,IAAI,CAAC3C,cAAc;EAC5B;;EAEA;AACF;AACA;EACE4C,OAAOA,CAAA,EAAG;IACR,IAAI;MACF,KAAK,MAAML,CAAC,IAAI,IAAI,CAACxC,eAAe,EAAE;QACpC,IAAIwC,CAAC,IAAIA,CAAC,CAACpB,MAAM,EAAE;UAAEe,aAAa,CAACK,CAAC,CAACpB,MAAM,CAAC;UAAEoB,CAAC,CAACpB,MAAM,GAAG,IAAI;QAAC;QAC9DoB,CAAC,CAACrB,MAAM,GAAG,OAAO;MACpB;IACF,CAAC,CAAC,OAAO2B,CAAC,EAAE,CAAC;IACb,IAAI,CAAC9C,eAAe,GAAG,EAAE;EAC3B;AACF;AAEA,eAAe,IAAIF,cAAc,CAAC,CAAC","ignoreList":[]}]}