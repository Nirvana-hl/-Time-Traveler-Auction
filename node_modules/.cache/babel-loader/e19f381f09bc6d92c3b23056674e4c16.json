{"remainingRequest":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js!D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\services\\game-state-service.js","dependencies":[{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\services\\game-state-service.js","mtime":1762087622758},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762215254891},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js","mtime":1762215256120}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqDQogKiDmuLjmiI/nirbmgIHnrqHnkIbmnI3liqENCiAqLwpjbGFzcyBHYW1lU3RhdGVTZXJ2aWNlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuZ2FtZVN0YXRlID0gewogICAgICBnYW1lSWQ6IG51bGwsCiAgICAgIHBoYXNlOiAncHJlcGFyYXRpb24nLAogICAgICAvLyBwcmVwYXJhdGlvbiwgYXVjdGlvbiwgaXRlbSwgc2V0dGxlbWVudAogICAgICBwbGF5ZXJzOiBbXSwKICAgICAgY3VycmVudEF1Y3Rpb246IG51bGwsCiAgICAgIGRlY2s6IFtdLAogICAgICB1c2VkSXRlbXM6IFtdLAogICAgICBnYW1lTG9nOiBbXQogICAgfTsKICB9CgogIC8qKg0KICAgKiDliJ3lp4vljJbmuLjmiI8NCiAgICogQHBhcmFtIHtBcnJheX0gcGxheWVyTmFtZXMgLSDnjqnlrrblkI3np7DliJfooagNCiAgICovCiAgaW5pdGlhbGl6ZUdhbWUocGxheWVyTmFtZXMpIHsKICAgIHRoaXMuZ2FtZVN0YXRlLmdhbWVJZCA9IHRoaXMuZ2VuZXJhdGVHYW1lSWQoKTsKICAgIHRoaXMuZ2FtZVN0YXRlLnBoYXNlID0gJ3ByZXBhcmF0aW9uJzsKICAgIHRoaXMuZ2FtZVN0YXRlLnBsYXllcnMgPSBwbGF5ZXJOYW1lcy5tYXAoKG5hbWUsIGluZGV4KSA9PiAoewogICAgICBpZDogYHBsYXllcl8ke2luZGV4ICsgMX1gLAogICAgICBuYW1lOiBuYW1lLAogICAgICBlbmVyZ3k6IDUwLAogICAgICAvLyDliJ3lp4vog73ph48KICAgICAgYXJ0aWZhY3RzOiBbXSwKICAgICAgaXRlbXM6IFtdLAogICAgICBjb2xsZWN0aW9uczogewogICAgICAgICLoibrmnK/nkbDlrp0iOiAwLAogICAgICAgICLnp5HmioDlpYfngrkiOiAwLAogICAgICAgICLnlJ/lkb3lpaXnp5giOiAwLAogICAgICAgICLmnYPlipvosaHlvoEiOiAwCiAgICAgIH0KICAgIH0pKTsKICAgIHRoaXMuZ2FtZVN0YXRlLmRlY2sgPSB0aGlzLmluaXRpYWxpemVEZWNrKCk7CiAgICB0aGlzLmdhbWVTdGF0ZS5nYW1lTG9nID0gW107CiAgICB0aGlzLmFkZEdhbWVMb2coJ+a4uOaIj+W8gOWni++8geaJgOacieeOqeWutuiOt+W+lzUw54K55Yid5aeL6IO96YePJyk7CiAgICByZXR1cm4gdGhpcy5nYW1lU3RhdGU7CiAgfQoKICAvKioNCiAgICog55Sf5oiQ5ri45oiPSUQNCiAgICovCiAgZ2VuZXJhdGVHYW1lSWQoKSB7CiAgICByZXR1cm4gYGdhbWVfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gOwogIH0KCiAgLyoqDQogICAqIOWIneWni+WMlueJjOWghg0KICAgKi8KICBhc3luYyBpbml0aWFsaXplRGVjaygpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGRhdGEgPSByZXF1aXJlKCcuLi8uLi9zdGF0aWMvZGF0YS9hcnRpZmFjdHMuanNvbicpOwogICAgICBjb25zdCBhcnRpZmFjdHMgPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YSA6IGRhdGEuZGVmYXVsdCB8fCBbXTsKICAgICAgcmV0dXJuIHRoaXMuc2h1ZmZsZUFycmF5KFsuLi5hcnRpZmFjdHNdKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ+WKoOi9veWNoeeJjOaVsOaNruWksei0pTonLCBlcnJvcik7CiAgICAgIHJldHVybiBbXTsKICAgIH0KICB9CgogIC8qKg0KICAgKiDmiZPkubHmlbDnu4QNCiAgICovCiAgc2h1ZmZsZUFycmF5KGFycmF5KSB7CiAgICBjb25zdCBuZXdBcnJheSA9IFsuLi5hcnJheV07CiAgICBmb3IgKGxldCBpID0gbmV3QXJyYXkubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkgewogICAgICBjb25zdCBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGkgKyAxKSk7CiAgICAgIFtuZXdBcnJheVtpXSwgbmV3QXJyYXlbal1dID0gW25ld0FycmF5W2pdLCBuZXdBcnJheVtpXV07CiAgICB9CiAgICByZXR1cm4gbmV3QXJyYXk7CiAgfQoKICAvKioNCiAgICog5byA5aeL5ouN5Y2W6Zi25q61DQogICAqLwogIHN0YXJ0QXVjdGlvblBoYXNlKCkgewogICAgdGhpcy5nYW1lU3RhdGUucGhhc2UgPSAnYXVjdGlvbic7CiAgICB0aGlzLmFkZEdhbWVMb2coJ+aLjeWNlumYtuauteW8gOWni++8gScpOwogICAgcmV0dXJuIHRoaXMuZ2FtZVN0YXRlOwogIH0KCiAgLyoqDQogICAqIOW8gOWni+mBk+WFt+mYtuautQ0KICAgKi8KICBzdGFydEl0ZW1QaGFzZSgpIHsKICAgIHRoaXMuZ2FtZVN0YXRlLnBoYXNlID0gJ2l0ZW0nOwogICAgdGhpcy5hZGRHYW1lTG9nKCfpgZPlhbfpmLbmrrXlvIDlp4vvvIHnjqnlrrblj6/ku6XotK3kubDlkozkvb/nlKjpgZPlhbcnKTsKICAgIHJldHVybiB0aGlzLmdhbWVTdGF0ZTsKICB9CgogIC8qKg0KICAgKiDnu5PmnZ/muLjmiI8NCiAgICovCiAgZW5kR2FtZSgpIHsKICAgIHRoaXMuZ2FtZVN0YXRlLnBoYXNlID0gJ3NldHRsZW1lbnQnOwogICAgdGhpcy5jYWxjdWxhdGVGaW5hbFNjb3JlcygpOwogICAgdGhpcy5hZGRHYW1lTG9nKCfmuLjmiI/nu5PmnZ/vvIHlvIDlp4vnu5PnrpfliIbmlbAnKTsKICAgIHJldHVybiB0aGlzLmdhbWVTdGF0ZTsKICB9CgogIC8qKg0KICAgKiDorqHnrpfmnIDnu4jliIbmlbANCiAgICovCiAgY2FsY3VsYXRlRmluYWxTY29yZXMoKSB7CiAgICB0aGlzLmdhbWVTdGF0ZS5wbGF5ZXJzLmZvckVhY2gocGxheWVyID0+IHsKICAgICAgbGV0IHRvdGFsU2NvcmUgPSAwOwoKICAgICAgLy8g5pS26JeP6ZuG5aWW5Yqx5YiG5pWwCiAgICAgIE9iamVjdC5rZXlzKHBsYXllci5jb2xsZWN0aW9ucykuZm9yRWFjaChjb2xsZWN0aW9uTmFtZSA9PiB7CiAgICAgICAgY29uc3QgY29sbGVjdGlvbiA9IHRoaXMuZ2V0Q29sbGVjdGlvbkJ5TmFtZShjb2xsZWN0aW9uTmFtZSk7CiAgICAgICAgaWYgKGNvbGxlY3Rpb24gJiYgcGxheWVyLmNvbGxlY3Rpb25zW2NvbGxlY3Rpb25OYW1lXSA+PSBjb2xsZWN0aW9uLnJlcXVpcmVkQ291bnQpIHsKICAgICAgICAgIHRvdGFsU2NvcmUgKz0gY29sbGVjdGlvbi5yZXdhcmRQb2ludHM7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIOmbtuaVo+Wlh+eJqeWIhuaVsO+8iOS4gOWNiuS7t+WAvO+8iQogICAgICBwbGF5ZXIuYXJ0aWZhY3RzLmZvckVhY2goYXJ0aWZhY3RJZCA9PiB7CiAgICAgICAgY29uc3QgYXJ0aWZhY3QgPSB0aGlzLmdldEFydGlmYWN0QnlJZChhcnRpZmFjdElkKTsKICAgICAgICBpZiAoYXJ0aWZhY3QpIHsKICAgICAgICAgIHRvdGFsU2NvcmUgKz0gTWF0aC5mbG9vcihhcnRpZmFjdC5iYXNlVmFsdWUgLyAyKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBwbGF5ZXIuZmluYWxTY29yZSA9IHRvdGFsU2NvcmU7CiAgICB9KTsKCiAgICAvLyDmjInliIbmlbDmjpLluo8KICAgIHRoaXMuZ2FtZVN0YXRlLnBsYXllcnMuc29ydCgoYSwgYikgPT4gYi5maW5hbFNjb3JlIC0gYS5maW5hbFNjb3JlKTsKICB9CgogIC8qKg0KICAgKiDojrflj5bmlLbol4/pm4bkv6Hmga8NCiAgICovCiAgYXN5bmMgZ2V0Q29sbGVjdGlvbkJ5TmFtZShjb2xsZWN0aW9uTmFtZSkgewogICAgdHJ5IHsKICAgICAgY29uc3QgZGF0YSA9IHJlcXVpcmUoJy4uLy4uL3N0YXRpYy9kYXRhL2NvbGxlY3Rpb25zLmpzb24nKTsKICAgICAgY29uc3QgbGlzdCA9IEFycmF5LmlzQXJyYXkoZGF0YSkgPyBkYXRhIDogZGF0YS5kZWZhdWx0IHx8IFtdOwogICAgICByZXR1cm4gbGlzdC5maW5kKGNvbGxlY3Rpb24gPT4gY29sbGVjdGlvbi5uYW1lID09PSBjb2xsZWN0aW9uTmFtZSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCfliqDovb3mlLbol4/pm4bmlbDmja7lpLHotKU6JywgZXJyb3IpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9CgogIC8qKg0KICAgKiDojrflj5blpYfniankv6Hmga8NCiAgICovCiAgYXN5bmMgZ2V0QXJ0aWZhY3RCeUlkKGFydGlmYWN0SWQpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGRhdGEgPSByZXF1aXJlKCcuLi8uLi9zdGF0aWMvZGF0YS9hcnRpZmFjdHMuanNvbicpOwogICAgICBjb25zdCBsaXN0ID0gQXJyYXkuaXNBcnJheShkYXRhKSA/IGRhdGEgOiBkYXRhLmRlZmF1bHQgfHwgW107CiAgICAgIHJldHVybiBsaXN0LmZpbmQoYXJ0aWZhY3QgPT4gYXJ0aWZhY3QuaWQgPT09IGFydGlmYWN0SWQpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5lcnJvcign5Yqg6L295aWH54mp5pWw5o2u5aSx6LSlOicsIGVycm9yKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQoKICAvKioNCiAgICog5pu05paw546p5a625pS26JeP6ZuG6L+b5bqmDQogICAqLwogIHVwZGF0ZUNvbGxlY3Rpb25Qcm9ncmVzcyhwbGF5ZXJJZCwgYXJ0aWZhY3QpIHsKICAgIGNvbnN0IHBsYXllciA9IHRoaXMuZ2FtZVN0YXRlLnBsYXllcnMuZmluZChwID0+IHAuaWQgPT09IHBsYXllcklkKTsKICAgIGlmICghcGxheWVyKSByZXR1cm47CgogICAgLy8g5pu05paw5a+55bqU5pS26JeP6ZuG6L+b5bqmCiAgICBhcnRpZmFjdC5jb2xsZWN0aW9uVGFncy5mb3JFYWNoKHRhZyA9PiB7CiAgICAgIGlmIChwbGF5ZXIuY29sbGVjdGlvbnMuaGFzT3duUHJvcGVydHkodGFnKSkgewogICAgICAgIHBsYXllci5jb2xsZWN0aW9uc1t0YWddKys7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgLyoqDQogICAqIOa3u+WKoOa4uOaIj+aXpeW/lw0KICAgKi8KICBhZGRHYW1lTG9nKG1lc3NhZ2UpIHsKICAgIHRoaXMuZ2FtZVN0YXRlLmdhbWVMb2cucHVzaCh7CiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgbWVzc2FnZTogbWVzc2FnZQogICAgfSk7CiAgfQoKICAvKioNCiAgICog6I635Y+W5ri45oiP54q25oCBDQogICAqLwogIGdldEdhbWVTdGF0ZSgpIHsKICAgIHJldHVybiB0aGlzLmdhbWVTdGF0ZTsKICB9CgogIC8qKg0KICAgKiDojrflj5bnjqnlrrbkv6Hmga8NCiAgICovCiAgZ2V0UGxheWVyKHBsYXllcklkKSB7CiAgICByZXR1cm4gdGhpcy5nYW1lU3RhdGUucGxheWVycy5maW5kKHAgPT4gcC5pZCA9PT0gcGxheWVySWQpOwogIH0KCiAgLyoqDQogICAqIOabtOaWsOeOqeWutuiDvemHjw0KICAgKi8KICB1cGRhdGVQbGF5ZXJFbmVyZ3kocGxheWVySWQsIGVuZXJneUNoYW5nZSkgewogICAgY29uc3QgcGxheWVyID0gdGhpcy5nZXRQbGF5ZXIocGxheWVySWQpOwogICAgaWYgKHBsYXllcikgewogICAgICBwbGF5ZXIuZW5lcmd5ID0gTWF0aC5tYXgoMCwgcGxheWVyLmVuZXJneSArIGVuZXJneUNoYW5nZSk7CiAgICAgIHRoaXMuYWRkR2FtZUxvZyhgJHtwbGF5ZXIubmFtZX0g55qE6IO96YeP5Y+Y5YyWOiAke2VuZXJneUNoYW5nZSA+IDAgPyAnKycgOiAnJ30ke2VuZXJneUNoYW5nZX1gKTsKICAgIH0KICB9CgogIC8qKg0KICAgKiDmt7vliqDlpYfnianliLDnjqnlrrYNCiAgICovCiAgYWRkQXJ0aWZhY3RUb1BsYXllcihwbGF5ZXJJZCwgYXJ0aWZhY3QpIHsKICAgIGNvbnN0IHBsYXllciA9IHRoaXMuZ2V0UGxheWVyKHBsYXllcklkKTsKICAgIGlmIChwbGF5ZXIpIHsKICAgICAgcGxheWVyLmFydGlmYWN0cy5wdXNoKGFydGlmYWN0LmlkKTsKICAgICAgdGhpcy51cGRhdGVDb2xsZWN0aW9uUHJvZ3Jlc3MocGxheWVySWQsIGFydGlmYWN0KTsKICAgICAgdGhpcy5hZGRHYW1lTG9nKGAke3BsYXllci5uYW1lfSDojrflvpfkuoblpYfniak6ICR7YXJ0aWZhY3QubmFtZX1gKTsKICAgIH0KICB9CgogIC8qKg0KICAgKiDku47njqnlrrbnp7vpmaTlpYfniakNCiAgICovCiAgcmVtb3ZlQXJ0aWZhY3RGcm9tUGxheWVyKHBsYXllcklkLCBhcnRpZmFjdElkKSB7CiAgICBjb25zdCBwbGF5ZXIgPSB0aGlzLmdldFBsYXllcihwbGF5ZXJJZCk7CiAgICBpZiAocGxheWVyKSB7CiAgICAgIGNvbnN0IGluZGV4ID0gcGxheWVyLmFydGlmYWN0cy5pbmRleE9mKGFydGlmYWN0SWQpOwogICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgIHBsYXllci5hcnRpZmFjdHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB0aGlzLmFkZEdhbWVMb2coYCR7cGxheWVyLm5hbWV9IOWkseWOu+S6huWlh+eJqWApOwogICAgICB9CiAgICB9CiAgfQp9CmV4cG9ydCBkZWZhdWx0IG5ldyBHYW1lU3RhdGVTZXJ2aWNlKCk7"},{"version":3,"names":["GameStateService","constructor","gameState","gameId","phase","players","currentAuction","deck","usedItems","gameLog","initializeGame","playerNames","generateGameId","map","name","index","id","energy","artifacts","items","collections","initializeDeck","addGameLog","Date","now","Math","random","toString","substr","data","require","Array","isArray","default","shuffleArray","error","console","array","newArray","i","length","j","floor","startAuctionPhase","startItemPhase","endGame","calculateFinalScores","forEach","player","totalScore","Object","keys","collectionName","collection","getCollectionByName","requiredCount","rewardPoints","artifactId","artifact","getArtifactById","baseValue","finalScore","sort","a","b","list","find","updateCollectionProgress","playerId","p","collectionTags","tag","hasOwnProperty","message","push","timestamp","getGameState","getPlayer","updatePlayerEnergy","energyChange","max","addArtifactToPlayer","removeArtifactFromPlayer","indexOf","splice"],"sources":["D:/大学生活/大三/全栈ai/项目/-Time-Traveler-Auction/src/services/game-state-service.js"],"sourcesContent":["/**\r\n * 游戏状态管理服务\r\n */\r\nclass GameStateService {\r\n  constructor() {\r\n    this.gameState = {\r\n      gameId: null,\r\n      phase: 'preparation', // preparation, auction, item, settlement\r\n      players: [],\r\n      currentAuction: null,\r\n      deck: [],\r\n      usedItems: [],\r\n      gameLog: []\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 初始化游戏\r\n   * @param {Array} playerNames - 玩家名称列表\r\n   */\r\n  initializeGame(playerNames) {\r\n    this.gameState.gameId = this.generateGameId()\r\n    this.gameState.phase = 'preparation'\r\n    this.gameState.players = playerNames.map((name, index) => ({\r\n      id: `player_${index + 1}`,\r\n      name: name,\r\n      energy: 50, // 初始能量\r\n      artifacts: [],\r\n      items: [],\r\n      collections: {\r\n        \"艺术瑰宝\": 0,\r\n        \"科技奇点\": 0,\r\n        \"生命奥秘\": 0,\r\n        \"权力象征\": 0\r\n      }\r\n    }))\r\n    \r\n    this.gameState.deck = this.initializeDeck()\r\n    this.gameState.gameLog = []\r\n    \r\n    this.addGameLog('游戏开始！所有玩家获得50点初始能量')\r\n    return this.gameState\r\n  }\r\n\r\n  /**\r\n   * 生成游戏ID\r\n   */\r\n  generateGameId() {\r\n    return `game_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\r\n  }\r\n\r\n  /**\r\n   * 初始化牌堆\r\n   */\r\n  async initializeDeck() {\r\n    try {\r\n      const data = require('../../static/data/artifacts.json')\r\n      const artifacts = Array.isArray(data) ? data : (data.default || [])\r\n      return this.shuffleArray([...artifacts])\r\n    } catch (error) {\r\n      console.error('加载卡牌数据失败:', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 打乱数组\r\n   */\r\n  shuffleArray(array) {\r\n    const newArray = [...array]\r\n    for (let i = newArray.length - 1; i > 0; i--) {\r\n      const j = Math.floor(Math.random() * (i + 1));\r\n      [newArray[i], newArray[j]] = [newArray[j], newArray[i]]\r\n    }\r\n    return newArray\r\n  }\r\n\r\n  /**\r\n   * 开始拍卖阶段\r\n   */\r\n  startAuctionPhase() {\r\n    this.gameState.phase = 'auction'\r\n    this.addGameLog('拍卖阶段开始！')\r\n    return this.gameState\r\n  }\r\n\r\n  /**\r\n   * 开始道具阶段\r\n   */\r\n  startItemPhase() {\r\n    this.gameState.phase = 'item'\r\n    this.addGameLog('道具阶段开始！玩家可以购买和使用道具')\r\n    return this.gameState\r\n  }\r\n\r\n  /**\r\n   * 结束游戏\r\n   */\r\n  endGame() {\r\n    this.gameState.phase = 'settlement'\r\n    this.calculateFinalScores()\r\n    this.addGameLog('游戏结束！开始结算分数')\r\n    return this.gameState\r\n  }\r\n\r\n  /**\r\n   * 计算最终分数\r\n   */\r\n  calculateFinalScores() {\r\n    this.gameState.players.forEach(player => {\r\n      let totalScore = 0\r\n      \r\n      // 收藏集奖励分数\r\n      Object.keys(player.collections).forEach(collectionName => {\r\n        const collection = this.getCollectionByName(collectionName)\r\n        if (collection && player.collections[collectionName] >= collection.requiredCount) {\r\n          totalScore += collection.rewardPoints\r\n        }\r\n      })\r\n      \r\n      // 零散奇物分数（一半价值）\r\n      player.artifacts.forEach(artifactId => {\r\n        const artifact = this.getArtifactById(artifactId)\r\n        if (artifact) {\r\n          totalScore += Math.floor(artifact.baseValue / 2)\r\n        }\r\n      })\r\n      \r\n      player.finalScore = totalScore\r\n    })\r\n    \r\n    // 按分数排序\r\n    this.gameState.players.sort((a, b) => b.finalScore - a.finalScore)\r\n  }\r\n\r\n  /**\r\n   * 获取收藏集信息\r\n   */\r\n  async getCollectionByName(collectionName) {\r\n    try {\r\n      const data = require('../../static/data/collections.json')\r\n      const list = Array.isArray(data) ? data : (data.default || [])\r\n      return list.find(collection => collection.name === collectionName)\r\n    } catch (error) {\r\n      console.error('加载收藏集数据失败:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取奇物信息\r\n   */\r\n  async getArtifactById(artifactId) {\r\n    try {\r\n      const data = require('../../static/data/artifacts.json')\r\n      const list = Array.isArray(data) ? data : (data.default || [])\r\n      return list.find(artifact => artifact.id === artifactId)\r\n    } catch (error) {\r\n      console.error('加载奇物数据失败:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新玩家收藏集进度\r\n   */\r\n  updateCollectionProgress(playerId, artifact) {\r\n    const player = this.gameState.players.find(p => p.id === playerId)\r\n    if (!player) return\r\n\r\n    // 更新对应收藏集进度\r\n    artifact.collectionTags.forEach(tag => {\r\n      if (player.collections.hasOwnProperty(tag)) {\r\n        player.collections[tag]++\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 添加游戏日志\r\n   */\r\n  addGameLog(message) {\r\n    this.gameState.gameLog.push({\r\n      timestamp: Date.now(),\r\n      message: message\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 获取游戏状态\r\n   */\r\n  getGameState() {\r\n    return this.gameState\r\n  }\r\n\r\n  /**\r\n   * 获取玩家信息\r\n   */\r\n  getPlayer(playerId) {\r\n    return this.gameState.players.find(p => p.id === playerId)\r\n  }\r\n\r\n  /**\r\n   * 更新玩家能量\r\n   */\r\n  updatePlayerEnergy(playerId, energyChange) {\r\n    const player = this.getPlayer(playerId)\r\n    if (player) {\r\n      player.energy = Math.max(0, player.energy + energyChange)\r\n      this.addGameLog(`${player.name} 的能量变化: ${energyChange > 0 ? '+' : ''}${energyChange}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 添加奇物到玩家\r\n   */\r\n  addArtifactToPlayer(playerId, artifact) {\r\n    const player = this.getPlayer(playerId)\r\n    if (player) {\r\n      player.artifacts.push(artifact.id)\r\n      this.updateCollectionProgress(playerId, artifact)\r\n      this.addGameLog(`${player.name} 获得了奇物: ${artifact.name}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 从玩家移除奇物\r\n   */\r\n  removeArtifactFromPlayer(playerId, artifactId) {\r\n    const player = this.getPlayer(playerId)\r\n    if (player) {\r\n      const index = player.artifacts.indexOf(artifactId)\r\n      if (index > -1) {\r\n        player.artifacts.splice(index, 1)\r\n        this.addGameLog(`${player.name} 失去了奇物`)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default new GameStateService()\r\n"],"mappings":"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","ignoreList":[]}]}