{"remainingRequest":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js!D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\services\\game-state-service.js","dependencies":[{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\services\\game-state-service.js","mtime":1762822693162},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762215254891},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js","mtime":1762215256120}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqDQogKiDmuLjmiI/nirbmgIHnrqHnkIbmnI3liqENCiAqLwpjbGFzcyBHYW1lU3RhdGVTZXJ2aWNlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuZ2FtZVN0YXRlID0gewogICAgICBnYW1lSWQ6IG51bGwsCiAgICAgIHBoYXNlOiAncHJlcGFyYXRpb24nLAogICAgICAvLyBwcmVwYXJhdGlvbiwgYXVjdGlvbiwgc2V0dGxlbWVudAogICAgICBwbGF5ZXJzOiBbXSwKICAgICAgY3VycmVudEF1Y3Rpb246IG51bGwsCiAgICAgIGRlY2s6IFtdLAogICAgICBnYW1lTG9nOiBbXQogICAgfTsKICB9CgogIC8qKg0KICAgKiDliJ3lp4vljJbmuLjmiI8NCiAgICogQHBhcmFtIHtBcnJheX0gcGxheWVyTmFtZXMgLSDnjqnlrrblkI3np7DliJfooagNCiAgICovCiAgaW5pdGlhbGl6ZUdhbWUocGxheWVyTmFtZXMpIHsKICAgIHRoaXMuZ2FtZVN0YXRlLmdhbWVJZCA9IHRoaXMuZ2VuZXJhdGVHYW1lSWQoKTsKICAgIHRoaXMuZ2FtZVN0YXRlLnBoYXNlID0gJ3ByZXBhcmF0aW9uJzsKICAgIHRoaXMuZ2FtZVN0YXRlLnBsYXllcnMgPSBwbGF5ZXJOYW1lcy5tYXAoKG5hbWUsIGluZGV4KSA9PiAoewogICAgICBpZDogYHBsYXllcl8ke2luZGV4ICsgMX1gLAogICAgICBuYW1lOiBuYW1lLAogICAgICBlbmVyZ3k6IDUwLAogICAgICAvLyDliJ3lp4vog73ph48KICAgICAgYXJ0aWZhY3RzOiBbXSwKICAgICAgY29sbGVjdGlvbnM6IHsKICAgICAgICAi6Im65pyv55Gw5a6dIjogMCwKICAgICAgICAi56eR5oqA5aWH54K5IjogMCwKICAgICAgICAi55Sf5ZG95aWl56eYIjogMCwKICAgICAgICAi5p2D5Yqb6LGh5b6BIjogMAogICAgICB9CiAgICB9KSk7CiAgICB0aGlzLmdhbWVTdGF0ZS5kZWNrID0gdGhpcy5pbml0aWFsaXplRGVjaygpOwogICAgdGhpcy5nYW1lU3RhdGUuZ2FtZUxvZyA9IFtdOwogICAgdGhpcy5hZGRHYW1lTG9nKCfmuLjmiI/lvIDlp4vvvIHmiYDmnInnjqnlrrbojrflvpc1MOeCueWIneWni+iDvemHjycpOwogICAgcmV0dXJuIHRoaXMuZ2FtZVN0YXRlOwogIH0KCiAgLyoqDQogICAqIOeUn+aIkOa4uOaIj0lEDQogICAqLwogIGdlbmVyYXRlR2FtZUlkKCkgewogICAgcmV0dXJuIGBnYW1lXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDsKICB9CgogIC8qKg0KICAgKiDliJ3lp4vljJbniYzloIYNCiAgICovCiAgYXN5bmMgaW5pdGlhbGl6ZURlY2soKSB7CiAgICB0cnkgewogICAgICBjb25zdCBkYXRhID0gcmVxdWlyZSgnLi4vLi4vc3RhdGljL2RhdGEvYXJ0aWZhY3RzLmpzb24nKTsKICAgICAgY29uc3QgYXJ0aWZhY3RzID0gQXJyYXkuaXNBcnJheShkYXRhKSA/IGRhdGEgOiBkYXRhLmRlZmF1bHQgfHwgW107CiAgICAgIHJldHVybiB0aGlzLnNodWZmbGVBcnJheShbLi4uYXJ0aWZhY3RzXSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCfliqDovb3ljaHniYzmlbDmja7lpLHotKU6JywgZXJyb3IpOwogICAgICByZXR1cm4gW107CiAgICB9CiAgfQoKICAvKioNCiAgICog5omT5Lmx5pWw57uEDQogICAqLwogIHNodWZmbGVBcnJheShhcnJheSkgewogICAgY29uc3QgbmV3QXJyYXkgPSBbLi4uYXJyYXldOwogICAgZm9yIChsZXQgaSA9IG5ld0FycmF5Lmxlbmd0aCAtIDE7IGkgPiAwOyBpLS0pIHsKICAgICAgY29uc3QgaiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpOwogICAgICBbbmV3QXJyYXlbaV0sIG5ld0FycmF5W2pdXSA9IFtuZXdBcnJheVtqXSwgbmV3QXJyYXlbaV1dOwogICAgfQogICAgcmV0dXJuIG5ld0FycmF5OwogIH0KCiAgLyoqDQogICAqIOW8gOWni+aLjeWNlumYtuautQ0KICAgKi8KICBzdGFydEF1Y3Rpb25QaGFzZSgpIHsKICAgIHRoaXMuZ2FtZVN0YXRlLnBoYXNlID0gJ2F1Y3Rpb24nOwogICAgdGhpcy5hZGRHYW1lTG9nKCfmi43ljZbpmLbmrrXlvIDlp4vvvIEnKTsKICAgIHJldHVybiB0aGlzLmdhbWVTdGF0ZTsKICB9CgogIC8qKg0KICAgKiDnu5PmnZ/muLjmiI8NCiAgICovCiAgZW5kR2FtZSgpIHsKICAgIHRoaXMuZ2FtZVN0YXRlLnBoYXNlID0gJ3NldHRsZW1lbnQnOwogICAgdGhpcy5jYWxjdWxhdGVGaW5hbFNjb3JlcygpOwogICAgdGhpcy5hZGRHYW1lTG9nKCfmuLjmiI/nu5PmnZ/vvIHlvIDlp4vnu5PnrpfliIbmlbAnKTsKICAgIHJldHVybiB0aGlzLmdhbWVTdGF0ZTsKICB9CgogIC8qKg0KICAgKiDorqHnrpfmnIDnu4jliIbmlbANCiAgICovCiAgY2FsY3VsYXRlRmluYWxTY29yZXMoKSB7CiAgICB0aGlzLmdhbWVTdGF0ZS5wbGF5ZXJzLmZvckVhY2gocGxheWVyID0+IHsKICAgICAgbGV0IHRvdGFsU2NvcmUgPSAwOwoKICAgICAgLy8g5pS26JeP6ZuG5aWW5Yqx5YiG5pWwCiAgICAgIE9iamVjdC5rZXlzKHBsYXllci5jb2xsZWN0aW9ucykuZm9yRWFjaChjb2xsZWN0aW9uTmFtZSA9PiB7CiAgICAgICAgY29uc3QgY29sbGVjdGlvbiA9IHRoaXMuZ2V0Q29sbGVjdGlvbkJ5TmFtZShjb2xsZWN0aW9uTmFtZSk7CiAgICAgICAgaWYgKGNvbGxlY3Rpb24gJiYgcGxheWVyLmNvbGxlY3Rpb25zW2NvbGxlY3Rpb25OYW1lXSA+PSBjb2xsZWN0aW9uLnJlcXVpcmVkQ291bnQpIHsKICAgICAgICAgIHRvdGFsU2NvcmUgKz0gY29sbGVjdGlvbi5yZXdhcmRQb2ludHM7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIOmbtuaVo+Wlh+eJqeWIhuaVsO+8iOS4gOWNiuS7t+WAvO+8iQogICAgICBwbGF5ZXIuYXJ0aWZhY3RzLmZvckVhY2goYXJ0aWZhY3RJZCA9PiB7CiAgICAgICAgY29uc3QgYXJ0aWZhY3QgPSB0aGlzLmdldEFydGlmYWN0QnlJZChhcnRpZmFjdElkKTsKICAgICAgICBpZiAoYXJ0aWZhY3QpIHsKICAgICAgICAgIHRvdGFsU2NvcmUgKz0gTWF0aC5mbG9vcihhcnRpZmFjdC5iYXNlVmFsdWUgLyAyKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBwbGF5ZXIuZmluYWxTY29yZSA9IHRvdGFsU2NvcmU7CiAgICB9KTsKCiAgICAvLyDmjInliIbmlbDmjpLluo8KICAgIHRoaXMuZ2FtZVN0YXRlLnBsYXllcnMuc29ydCgoYSwgYikgPT4gYi5maW5hbFNjb3JlIC0gYS5maW5hbFNjb3JlKTsKICB9CgogIC8qKg0KICAgKiDojrflj5bmlLbol4/pm4bkv6Hmga8NCiAgICog5rOo5oSP77ya5q2k5pa55rOV5bey5bqf5byD77yM5bu66K6u5L2/55SoIGxvYWRDb2xsZWN0aW9uc0Zyb21BcnRpZmFjdHMg5Yqo5oCB55Sf5oiQDQogICAqIOS/neeVmeatpOaWueazleS7peS/neaMgeWQkeWQjuWFvOWuuQ0KICAgKi8KICBhc3luYyBnZXRDb2xsZWN0aW9uQnlOYW1lKGNvbGxlY3Rpb25OYW1lKSB7CiAgICB0cnkgewogICAgICAvLyDlsJ3or5Xku47liqjmgIHnlJ/miJDnmoTmlLbol4/pm4bkuK3mn6Xmib4KICAgICAgaWYgKHRoaXMuZ2FtZVN0YXRlLmRlY2sgJiYgdGhpcy5nYW1lU3RhdGUuZGVjay5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgbG9hZENvbGxlY3Rpb25zRnJvbUFydGlmYWN0cwogICAgICAgIH0gPSByZXF1aXJlKCcuLi9mZWF0dXJlcy9nYW1lL2NvbGxlY3Rpb25zLnV0aWxzJyk7CiAgICAgICAgY29uc3QgYXJ0aWZhY3RNYXAgPSB7fTsKICAgICAgICB0aGlzLmdhbWVTdGF0ZS5kZWNrLmZvckVhY2goYXJ0aWZhY3QgPT4gewogICAgICAgICAgaWYgKGFydGlmYWN0ICYmIGFydGlmYWN0LmlkKSB7CiAgICAgICAgICAgIGFydGlmYWN0TWFwW2FydGlmYWN0LmlkXSA9IGFydGlmYWN0OwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGNvbGxlY3Rpb25zID0gbG9hZENvbGxlY3Rpb25zRnJvbUFydGlmYWN0cyhhcnRpZmFjdE1hcCk7CiAgICAgICAgY29uc3QgZm91bmQgPSBjb2xsZWN0aW9ucy5maW5kKGNvbCA9PiBjb2wubmFtZSA9PT0gY29sbGVjdGlvbk5hbWUpOwogICAgICAgIGlmIChmb3VuZCkgcmV0dXJuIGZvdW5kOwogICAgICB9CgogICAgICAvLyDlm57pgIDliLAgSlNPTiDmlofku7bvvIjlpoLmnpzlrZjlnKjvvIkKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBkYXRhID0gcmVxdWlyZSgnLi4vLi4vc3RhdGljL2RhdGEvY29sbGVjdGlvbnMuanNvbicpOwogICAgICAgIGNvbnN0IGxpc3QgPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YSA6IGRhdGEuZGVmYXVsdCB8fCBbXTsKICAgICAgICByZXR1cm4gbGlzdC5maW5kKGNvbGxlY3Rpb24gPT4gY29sbGVjdGlvbi5uYW1lID09PSBjb2xsZWN0aW9uTmFtZSkgfHwgbnVsbDsKICAgICAgfSBjYXRjaCAoanNvbkVycm9yKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ+WKoOi9veaUtuiXj+mbhuaVsOaNruWksei0pTonLCBlcnJvcik7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KCiAgLyoqDQogICAqIOiOt+WPluWlh+eJqeS/oeaBrw0KICAgKi8KICBhc3luYyBnZXRBcnRpZmFjdEJ5SWQoYXJ0aWZhY3RJZCkgewogICAgdHJ5IHsKICAgICAgY29uc3QgZGF0YSA9IHJlcXVpcmUoJy4uLy4uL3N0YXRpYy9kYXRhL2FydGlmYWN0cy5qc29uJyk7CiAgICAgIGNvbnN0IGxpc3QgPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YSA6IGRhdGEuZGVmYXVsdCB8fCBbXTsKICAgICAgcmV0dXJuIGxpc3QuZmluZChhcnRpZmFjdCA9PiBhcnRpZmFjdC5pZCA9PT0gYXJ0aWZhY3RJZCk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCfliqDovb3lpYfnianmlbDmja7lpLHotKU6JywgZXJyb3IpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9CgogIC8qKg0KICAgKiDmm7TmlrDnjqnlrrbmlLbol4/pm4bov5vluqYNCiAgICovCiAgdXBkYXRlQ29sbGVjdGlvblByb2dyZXNzKHBsYXllcklkLCBhcnRpZmFjdCkgewogICAgY29uc3QgcGxheWVyID0gdGhpcy5nYW1lU3RhdGUucGxheWVycy5maW5kKHAgPT4gcC5pZCA9PT0gcGxheWVySWQpOwogICAgaWYgKCFwbGF5ZXIpIHJldHVybjsKCiAgICAvLyDmm7TmlrDlr7nlupTmlLbol4/pm4bov5vluqYKICAgIGFydGlmYWN0LmNvbGxlY3Rpb25UYWdzLmZvckVhY2godGFnID0+IHsKICAgICAgaWYgKHBsYXllci5jb2xsZWN0aW9ucy5oYXNPd25Qcm9wZXJ0eSh0YWcpKSB7CiAgICAgICAgcGxheWVyLmNvbGxlY3Rpb25zW3RhZ10rKzsKICAgICAgfQogICAgfSk7CiAgfQoKICAvKioNCiAgICog5re75Yqg5ri45oiP5pel5b+XDQogICAqLwogIGFkZEdhbWVMb2cobWVzc2FnZSkgewogICAgdGhpcy5nYW1lU3RhdGUuZ2FtZUxvZy5wdXNoKHsKICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLAogICAgICBtZXNzYWdlOiBtZXNzYWdlCiAgICB9KTsKICB9CgogIC8qKg0KICAgKiDojrflj5bmuLjmiI/nirbmgIENCiAgICovCiAgZ2V0R2FtZVN0YXRlKCkgewogICAgcmV0dXJuIHRoaXMuZ2FtZVN0YXRlOwogIH0KCiAgLyoqDQogICAqIOiOt+WPlueOqeWutuS/oeaBrw0KICAgKi8KICBnZXRQbGF5ZXIocGxheWVySWQpIHsKICAgIHJldHVybiB0aGlzLmdhbWVTdGF0ZS5wbGF5ZXJzLmZpbmQocCA9PiBwLmlkID09PSBwbGF5ZXJJZCk7CiAgfQoKICAvKioNCiAgICog5pu05paw546p5a626IO96YePDQogICAqLwogIHVwZGF0ZVBsYXllckVuZXJneShwbGF5ZXJJZCwgZW5lcmd5Q2hhbmdlKSB7CiAgICBjb25zdCBwbGF5ZXIgPSB0aGlzLmdldFBsYXllcihwbGF5ZXJJZCk7CiAgICBpZiAocGxheWVyKSB7CiAgICAgIHBsYXllci5lbmVyZ3kgPSBNYXRoLm1heCgwLCBwbGF5ZXIuZW5lcmd5ICsgZW5lcmd5Q2hhbmdlKTsKICAgICAgdGhpcy5hZGRHYW1lTG9nKGAke3BsYXllci5uYW1lfSDnmoTog73ph4/lj5jljJY6ICR7ZW5lcmd5Q2hhbmdlID4gMCA/ICcrJyA6ICcnfSR7ZW5lcmd5Q2hhbmdlfWApOwogICAgfQogIH0KCiAgLyoqDQogICAqIOa3u+WKoOWlh+eJqeWIsOeOqeWutg0KICAgKi8KICBhZGRBcnRpZmFjdFRvUGxheWVyKHBsYXllcklkLCBhcnRpZmFjdCkgewogICAgY29uc3QgcGxheWVyID0gdGhpcy5nZXRQbGF5ZXIocGxheWVySWQpOwogICAgaWYgKHBsYXllcikgewogICAgICBwbGF5ZXIuYXJ0aWZhY3RzLnB1c2goYXJ0aWZhY3QuaWQpOwogICAgICB0aGlzLnVwZGF0ZUNvbGxlY3Rpb25Qcm9ncmVzcyhwbGF5ZXJJZCwgYXJ0aWZhY3QpOwogICAgICB0aGlzLmFkZEdhbWVMb2coYCR7cGxheWVyLm5hbWV9IOiOt+W+l+S6huWlh+eJqTogJHthcnRpZmFjdC5uYW1lfWApOwogICAgfQogIH0KCiAgLyoqDQogICAqIOS7jueOqeWutuenu+mZpOWlh+eJqQ0KICAgKi8KICByZW1vdmVBcnRpZmFjdEZyb21QbGF5ZXIocGxheWVySWQsIGFydGlmYWN0SWQpIHsKICAgIGNvbnN0IHBsYXllciA9IHRoaXMuZ2V0UGxheWVyKHBsYXllcklkKTsKICAgIGlmIChwbGF5ZXIpIHsKICAgICAgY29uc3QgaW5kZXggPSBwbGF5ZXIuYXJ0aWZhY3RzLmluZGV4T2YoYXJ0aWZhY3RJZCk7CiAgICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgICAgcGxheWVyLmFydGlmYWN0cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIHRoaXMuYWRkR2FtZUxvZyhgJHtwbGF5ZXIubmFtZX0g5aSx5Y675LqG5aWH54mpYCk7CiAgICAgIH0KICAgIH0KICB9Cn0KZXhwb3J0IGRlZmF1bHQgbmV3IEdhbWVTdGF0ZVNlcnZpY2UoKTs="},{"version":3,"names":["GameStateService","constructor","gameState","gameId","phase","players","currentAuction","deck","gameLog","initializeGame","playerNames","generateGameId","map","name","index","id","energy","artifacts","collections","initializeDeck","addGameLog","Date","now","Math","random","toString","substr","data","require","Array","isArray","default","shuffleArray","error","console","array","newArray","i","length","j","floor","startAuctionPhase","endGame","calculateFinalScores","forEach","player","totalScore","Object","keys","collectionName","collection","getCollectionByName","requiredCount","rewardPoints","artifactId","artifact","getArtifactById","baseValue","finalScore","sort","a","b","loadCollectionsFromArtifacts","artifactMap","found","find","col","list","jsonError","updateCollectionProgress","playerId","p","collectionTags","tag","hasOwnProperty","message","push","timestamp","getGameState","getPlayer","updatePlayerEnergy","energyChange","max","addArtifactToPlayer","removeArtifactFromPlayer","indexOf","splice"],"sources":["D:/大学生活/大三/全栈ai/项目/-Time-Traveler-Auction/src/services/game-state-service.js"],"sourcesContent":["/**\r\n * 游戏状态管理服务\r\n */\r\nclass GameStateService {\r\n  constructor() {\r\n    this.gameState = {\r\n      gameId: null,\r\n      phase: 'preparation', // preparation, auction, settlement\r\n      players: [],\r\n      currentAuction: null,\r\n      deck: [],\r\n      gameLog: []\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 初始化游戏\r\n   * @param {Array} playerNames - 玩家名称列表\r\n   */\r\n  initializeGame(playerNames) {\r\n    this.gameState.gameId = this.generateGameId()\r\n    this.gameState.phase = 'preparation'\r\n    this.gameState.players = playerNames.map((name, index) => ({\r\n      id: `player_${index + 1}`,\r\n      name: name,\r\n      energy: 50, // 初始能量\r\n      artifacts: [],\r\n      collections: {\r\n        \"艺术瑰宝\": 0,\r\n        \"科技奇点\": 0,\r\n        \"生命奥秘\": 0,\r\n        \"权力象征\": 0\r\n      }\r\n    }))\r\n    \r\n    this.gameState.deck = this.initializeDeck()\r\n    this.gameState.gameLog = []\r\n    \r\n    this.addGameLog('游戏开始！所有玩家获得50点初始能量')\r\n    return this.gameState\r\n  }\r\n\r\n  /**\r\n   * 生成游戏ID\r\n   */\r\n  generateGameId() {\r\n    return `game_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\r\n  }\r\n\r\n  /**\r\n   * 初始化牌堆\r\n   */\r\n  async initializeDeck() {\r\n    try {\r\n      const data = require('../../static/data/artifacts.json')\r\n      const artifacts = Array.isArray(data) ? data : (data.default || [])\r\n      return this.shuffleArray([...artifacts])\r\n    } catch (error) {\r\n      console.error('加载卡牌数据失败:', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 打乱数组\r\n   */\r\n  shuffleArray(array) {\r\n    const newArray = [...array]\r\n    for (let i = newArray.length - 1; i > 0; i--) {\r\n      const j = Math.floor(Math.random() * (i + 1));\r\n      [newArray[i], newArray[j]] = [newArray[j], newArray[i]]\r\n    }\r\n    return newArray\r\n  }\r\n\r\n  /**\r\n   * 开始拍卖阶段\r\n   */\r\n  startAuctionPhase() {\r\n    this.gameState.phase = 'auction'\r\n    this.addGameLog('拍卖阶段开始！')\r\n    return this.gameState\r\n  }\r\n\r\n  /**\r\n   * 结束游戏\r\n   */\r\n  endGame() {\r\n    this.gameState.phase = 'settlement'\r\n    this.calculateFinalScores()\r\n    this.addGameLog('游戏结束！开始结算分数')\r\n    return this.gameState\r\n  }\r\n\r\n  /**\r\n   * 计算最终分数\r\n   */\r\n  calculateFinalScores() {\r\n    this.gameState.players.forEach(player => {\r\n      let totalScore = 0\r\n      \r\n      // 收藏集奖励分数\r\n      Object.keys(player.collections).forEach(collectionName => {\r\n        const collection = this.getCollectionByName(collectionName)\r\n        if (collection && player.collections[collectionName] >= collection.requiredCount) {\r\n          totalScore += collection.rewardPoints\r\n        }\r\n      })\r\n      \r\n      // 零散奇物分数（一半价值）\r\n      player.artifacts.forEach(artifactId => {\r\n        const artifact = this.getArtifactById(artifactId)\r\n        if (artifact) {\r\n          totalScore += Math.floor(artifact.baseValue / 2)\r\n        }\r\n      })\r\n      \r\n      player.finalScore = totalScore\r\n    })\r\n    \r\n    // 按分数排序\r\n    this.gameState.players.sort((a, b) => b.finalScore - a.finalScore)\r\n  }\r\n\r\n  /**\r\n   * 获取收藏集信息\r\n   * 注意：此方法已废弃，建议使用 loadCollectionsFromArtifacts 动态生成\r\n   * 保留此方法以保持向后兼容\r\n   */\r\n  async getCollectionByName(collectionName) {\r\n    try {\r\n      // 尝试从动态生成的收藏集中查找\r\n      if (this.gameState.deck && this.gameState.deck.length > 0) {\r\n        const { loadCollectionsFromArtifacts } = require('../features/game/collections.utils')\r\n        const artifactMap = {}\r\n        this.gameState.deck.forEach(artifact => {\r\n          if (artifact && artifact.id) {\r\n            artifactMap[artifact.id] = artifact\r\n          }\r\n        })\r\n        const collections = loadCollectionsFromArtifacts(artifactMap)\r\n        const found = collections.find(col => col.name === collectionName)\r\n        if (found) return found\r\n      }\r\n      \r\n      // 回退到 JSON 文件（如果存在）\r\n      try {\r\n        const data = require('../../static/data/collections.json')\r\n        const list = Array.isArray(data) ? data : (data.default || [])\r\n        return list.find(collection => collection.name === collectionName) || null\r\n      } catch (jsonError) {\r\n        return null\r\n      }\r\n    } catch (error) {\r\n      console.error('加载收藏集数据失败:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取奇物信息\r\n   */\r\n  async getArtifactById(artifactId) {\r\n    try {\r\n      const data = require('../../static/data/artifacts.json')\r\n      const list = Array.isArray(data) ? data : (data.default || [])\r\n      return list.find(artifact => artifact.id === artifactId)\r\n    } catch (error) {\r\n      console.error('加载奇物数据失败:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新玩家收藏集进度\r\n   */\r\n  updateCollectionProgress(playerId, artifact) {\r\n    const player = this.gameState.players.find(p => p.id === playerId)\r\n    if (!player) return\r\n\r\n    // 更新对应收藏集进度\r\n    artifact.collectionTags.forEach(tag => {\r\n      if (player.collections.hasOwnProperty(tag)) {\r\n        player.collections[tag]++\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 添加游戏日志\r\n   */\r\n  addGameLog(message) {\r\n    this.gameState.gameLog.push({\r\n      timestamp: Date.now(),\r\n      message: message\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 获取游戏状态\r\n   */\r\n  getGameState() {\r\n    return this.gameState\r\n  }\r\n\r\n  /**\r\n   * 获取玩家信息\r\n   */\r\n  getPlayer(playerId) {\r\n    return this.gameState.players.find(p => p.id === playerId)\r\n  }\r\n\r\n  /**\r\n   * 更新玩家能量\r\n   */\r\n  updatePlayerEnergy(playerId, energyChange) {\r\n    const player = this.getPlayer(playerId)\r\n    if (player) {\r\n      player.energy = Math.max(0, player.energy + energyChange)\r\n      this.addGameLog(`${player.name} 的能量变化: ${energyChange > 0 ? '+' : ''}${energyChange}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 添加奇物到玩家\r\n   */\r\n  addArtifactToPlayer(playerId, artifact) {\r\n    const player = this.getPlayer(playerId)\r\n    if (player) {\r\n      player.artifacts.push(artifact.id)\r\n      this.updateCollectionProgress(playerId, artifact)\r\n      this.addGameLog(`${player.name} 获得了奇物: ${artifact.name}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 从玩家移除奇物\r\n   */\r\n  removeArtifactFromPlayer(playerId, artifactId) {\r\n    const player = this.getPlayer(playerId)\r\n    if (player) {\r\n      const index = player.artifacts.indexOf(artifactId)\r\n      if (index > -1) {\r\n        player.artifacts.splice(index, 1)\r\n        this.addGameLog(`${player.name} 失去了奇物`)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default new GameStateService()\r\n"],"mappings":"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","ignoreList":[]}]}