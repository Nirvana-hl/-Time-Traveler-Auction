{"remainingRequest":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js!D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\pages\\index\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\pages\\index\\index.vue","mtime":1762781804553},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762215254891},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js","mtime":1762215256120},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762215254891},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\vue-loader\\lib\\index.js","mtime":1762215256637}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgbWFwU3RhdGUsIG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IEF1Y3Rpb25QYW5lbCBmcm9tICcuLi8uLi9jb21wb25lbnRzL2F1Y3Rpb24tcGFuZWwvYXVjdGlvbi1wYW5lbC52dWUnOwppbXBvcnQgSXRlbVNob3AgZnJvbSAnLi4vLi4vY29tcG9uZW50cy9pdGVtLXNob3AvaXRlbS1zaG9wLnZ1ZSc7CmltcG9ydCByb29tU2VydmljZSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9yb29tLXNlcnZpY2UnOwppbXBvcnQgeyBnZXRTdXBhYmFzZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3N1cGFiYXNlLWNsaWVudCc7CmltcG9ydCBhdWN0aW9uU2VydmljZSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9hdWN0aW9uLXNlcnZpY2UnOwppbXBvcnQgeyBzdGFydENvdW50ZG93biwgY2xlYXJDb3VudGRvd24gfSBmcm9tICcuLi8uLi9mZWF0dXJlcy9nYW1lL2NvdW50ZG93bic7CmltcG9ydCB7IGxvYWRSb29tU3RhdGUgYXMgbG9hZFJvb21TdGF0ZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9mZWF0dXJlcy9nYW1lL3Jvb20tc3RhdGUuc2VydmljZSc7CmltcG9ydCB7IHN1YnNjcmliZVJvb21SZWFsdGltZSBhcyBzdWJzY3JpYmVSb29tUmVhbHRpbWVTZXJ2aWNlLCB1bnN1YnNjcmliZVJvb21SZWFsdGltZSBhcyB1bnN1YnNjcmliZVJvb21SZWFsdGltZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9mZWF0dXJlcy9nYW1lL3Jvb20tcmVhbHRpbWUnOwppbXBvcnQgeyBzdGFydEdhbWUgYXMgc3RhcnRHYW1lRmxvdywgYXV0b1N0YXJ0QXVjdGlvbiBhcyBhdXRvU3RhcnRBdWN0aW9uRmxvdyB9IGZyb20gJy4uLy4uL2ZlYXR1cmVzL2dhbWUvYXVjdGlvbi1mbG93LnNlcnZpY2UnOwppbXBvcnQgeyBzZW5kQ2hhdE1lc3NhZ2UgfSBmcm9tICcuLi8uLi9mZWF0dXJlcy9nYW1lL2NoYXQuc2VydmljZSc7CmltcG9ydCB7IHRvZ2dsZVJlYWR5IGFzIHRvZ2dsZVJlYWR5QWN0aW9uLCBtb3ZlVG9TZWF0IGFzIG1vdmVUb1NlYXRBY3Rpb24sIGxlYXZlUm9vbSBhcyBsZWF2ZVJvb21BY3Rpb24gfSBmcm9tICcuLi8uLi9mZWF0dXJlcy9nYW1lL3Jvb20tYWN0aW9ucy5zZXJ2aWNlJzsKaW1wb3J0IHsgbG9hZEFydGlmYWN0cyBhcyBsb2FkQXJ0aWZhY3RzU2VydmljZSB9IGZyb20gJy4uLy4uL2ZlYXR1cmVzL2dhbWUvYXJ0aWZhY3RzLnNlcnZpY2UnOwppbXBvcnQgeyBsb2FkQ29sbGVjdGlvbnNGcm9tQXJ0aWZhY3RzLCBnZXRDdXJyZW50Q29sbGVjdGlvbkNvdW50IGFzIGdldENvbGxlY3Rpb25Db3VudFV0aWwsIGdldENvbGxlY3Rpb25Qcm9ncmVzcyBhcyBnZXRDb2xsZWN0aW9uUHJvZ3Jlc3NVdGlsIH0gZnJvbSAnLi4vLi4vZmVhdHVyZXMvZ2FtZS9jb2xsZWN0aW9ucy51dGlscyc7CmltcG9ydCB7IGZvcm1hdE1lc3NhZ2VUaW1lIGFzIGZvcm1hdE1lc3NhZ2VUaW1lSGVscGVyLCBnZXRBdmF0YXJGb3IgYXMgZ2V0QXZhdGFyRm9ySGVscGVyLCBnZXROYW1lRm9yIGFzIGdldE5hbWVGb3JIZWxwZXIgfSBmcm9tICcuLi8uLi9mZWF0dXJlcy9nYW1lL3VpLmhlbHBlcnMnOwppbXBvcnQgeyBmaXJzdExvZ2luRGlhbG9ndWUgYXMgZmlyc3RMb2dpbkRpYWxvZ3VlQ29uZmlnLCBnZXRDdXJyZW50TGFuZ3VhZ2UgYXMgZ2V0Q3VycmVudExhbmd1YWdlSW1wb3J0ZWQgfSBmcm9tICcuLi8uLi9jb25maWcvZGlhbG9ndWUtY29uZmlnJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdHYW1lSW5kZXgnLAogIGNvbXBvbmVudHM6IHsKICAgIEF1Y3Rpb25QYW5lbCwKICAgIEl0ZW1TaG9wCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgc2VsZWN0ZWRDYXJkOiBudWxsLAogICAgICBzaG93SGFuZFBvcHVwOiBmYWxzZSwKICAgICAgaGFuZFBsYXllcjogbnVsbCwKICAgICAgYXJ0aWZhY3RNYXA6IHt9LAogICAgICByb29tOiBudWxsLAogICAgICBwcm9maWxlTWFwOiB7fSwKICAgICAgcmVmcmVzaFRpbWVyOiBudWxsLAogICAgICBjb2xsZWN0aW9uczogW10sCiAgICAgIHNob3dHYW1lRW5kRGlhbG9nOiBmYWxzZSwKICAgICAgZmluYWxTY29yZXM6IFtdLAogICAgICB3aW5uZXJJbmZvOiBudWxsLAogICAgICBhdWN0aW9uQ291bnRkb3duOiAwLAogICAgICBhdWN0aW9uVGltZXI6IG51bGwsCiAgICAgIGN1cnJlbnRBdWN0aW9uOiBudWxsLAogICAgICAvLyDlm57lkIjnm7jlhbPvvIjliY3nq6/lrp7ml7bmmL7npLrvvIzmiL/kuLvmr4/ova7lvIDmi43ml7blub/mkq3ku6Xkv53mjIHlkIzmraXvvIkKICAgICAgcm91bmRDb3VudDogMCwKICAgICAgdG90YWxSb3VuZHM6IDYsCiAgICAgIGNoYXRNZXNzYWdlczogW10sCiAgICAgIG5ld01lc3NhZ2U6ICcnLAogICAgICBjaGF0Q2hhbm5lbDogbnVsbCwKICAgICAgY291bnRkb3duSW5Qcm9ncmVzczogZmFsc2UsCiAgICAgIGV4cGFuZGVkQ29sbGVjdGlvbnM6IHt9LAogICAgICBzaG93TmFycmF0aW9uOiBmYWxzZSwKICAgICAgdHlwaW5nVGV4dDogJycsCiAgICAgIHR5cGluZ1RpbWVyOiBudWxsLAogICAgICAvLyDlrZjlgqjmiYDmnInnjqnlrrbnmoTmiYvniYzmlbDmja7vvIznlKjkuo7ku7flgLzorqHnrpcKICAgICAgYWxsUGxheWVyc0FydGlmYWN0czoge30KICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwU3RhdGUoWydnYW1lUGhhc2UnLCAnZ2FtZUxvZycsICdzaG93Q2FyZERldGFpbCcsICdzaG93U2hvcCcsICd1c2VyJywgJ3Jvb21JZCcsICdyb3VuZEN1cnJlbnQnLCAncm91bmRUb3RhbCddKSwKICAgIC8vIOWwhuW9k+WJjeeOqeWutuazqOWFpeWIsOa4suafk+S4iuS4i+aWh++8jOmBv+WFjeaooeadv+W8leeUqOaKpemUmQogICAgY3VycmVudFBsYXllcigpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRQbGF5ZXI7CiAgICB9LAogICAgaXNPd25lcigpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbSAmJiB0aGlzLnVzZXIgJiYgdGhpcy5yb29tLm93bmVyX2lkID09PSB0aGlzLnVzZXIuaWQ7CiAgICB9LAogICAgYWxsUmVhZHkoKSB7CiAgICAgIGNvbnN0IHBsYXllcnMgPSB0aGlzLnJvb20gJiYgdGhpcy5yb29tLnJvb21fcGxheWVycyA/IHRoaXMucm9vbS5yb29tX3BsYXllcnMgOiBbXTsKICAgICAgcmV0dXJuIHBsYXllcnMubGVuZ3RoID4gMCAmJiBwbGF5ZXJzLmV2ZXJ5KHAgPT4gISFwLmlzX3JlYWR5KTsKICAgIH0sCiAgICBjdXJyZW50VXNlclJlYWR5KCkgewogICAgICBjb25zdCB1c2VyID0gdGhpcy51c2VyOwogICAgICBjb25zdCBwbGF5ZXJzID0gdGhpcy5yb29tICYmIHRoaXMucm9vbS5yb29tX3BsYXllcnMgPyB0aGlzLnJvb20ucm9vbV9wbGF5ZXJzIDogW107CiAgICAgIGlmICghdXNlcikgcmV0dXJuIGZhbHNlOwogICAgICBjb25zdCBtZSA9IHBsYXllcnMuZmluZChwID0+IHAudXNlcl9pZCA9PT0gdXNlci5pZCk7CiAgICAgIHJldHVybiAhIShtZSAmJiBtZS5pc19yZWFkeSk7CiAgICB9LAogICAgcGxheWVyQ291bnQoKSB7CiAgICAgIHJldHVybiB0aGlzLnJvb20gJiYgdGhpcy5yb29tLnJvb21fcGxheWVycyA/IHRoaXMucm9vbS5yb29tX3BsYXllcnMubGVuZ3RoIDogMDsKICAgIH0sCiAgICBvd25lck5hbWUoKSB7CiAgICAgIGlmICghdGhpcy5yb29tKSByZXR1cm4gJy0nOwogICAgICByZXR1cm4gdGhpcy5nZXROYW1lRm9yKHRoaXMucm9vbS5vd25lcl9pZCk7CiAgICB9LAogICAgc2VhdENvdW50KCkgewogICAgICByZXR1cm4gdGhpcy5yb29tICYmIE51bWJlcih0aGlzLnJvb20ubWF4X3BsYXllcnMpID8gTnVtYmVyKHRoaXMucm9vbS5tYXhfcGxheWVycykgOiAwOwogICAgfSwKICAgIHNlYXRzKCkgewogICAgICBjb25zdCBwbGF5ZXJzID0gdGhpcy5yb29tICYmIHRoaXMucm9vbS5yb29tX3BsYXllcnMgPyB0aGlzLnJvb20ucm9vbV9wbGF5ZXJzIDogW107CiAgICAgIGNvbnN0IG1heCA9IHRoaXMuc2VhdENvdW50OwogICAgICBjb25zdCBzZWF0cyA9IEFycmF5LmZyb20oewogICAgICAgIGxlbmd0aDogbWF4CiAgICAgIH0sICgpID0+ICh7CiAgICAgICAgcGxheWVyOiBudWxsCiAgICAgIH0pKTsKICAgICAgLy8g5pS+572u5bey6K6+572u5bqn5L2N55qE546p5a62CiAgICAgIHBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICBjb25zdCBpZHggPSB0eXBlb2YgcC5zZWF0X2luZGV4ID09PSAnbnVtYmVyJyA/IHAuc2VhdF9pbmRleCA6IC0xOwogICAgICAgIGlmIChpZHggPj0gMCAmJiBpZHggPCBtYXggJiYgIXNlYXRzW2lkeF0ucGxheWVyKSBzZWF0c1tpZHhdLnBsYXllciA9IHA7CiAgICAgIH0pOwogICAgICAvLyDlsIbmnKrorr7nva7luqfkvY3nmoTnjqnlrrbkvp3mrKHmlL7liLDnqbrkvY0KICAgICAgcGxheWVycy5maWx0ZXIocCA9PiB0eXBlb2YgcC5zZWF0X2luZGV4ICE9PSAnbnVtYmVyJyB8fCBwLnNlYXRfaW5kZXggPCAwKS5mb3JFYWNoKHAgPT4gewogICAgICAgIGNvbnN0IGVtcHR5SWR4ID0gc2VhdHMuZmluZEluZGV4KHMgPT4gIXMucGxheWVyKTsKICAgICAgICBpZiAoZW1wdHlJZHggPj0gMCkgc2VhdHNbZW1wdHlJZHhdLnBsYXllciA9IHA7CiAgICAgIH0pOwogICAgICByZXR1cm4gc2VhdHM7CiAgICB9LAogICAgZ2FtZVBoYXNlVGV4dCgpIHsKICAgICAgY29uc3QgcGhhc2VNYXAgPSB7CiAgICAgICAgJ3ByZXBhcmF0aW9uJzogJ+WHhuWkh+mYtuautScsCiAgICAgICAgJ2NvdW50ZG93bic6ICfpooTlgJLorqHml7YnLAogICAgICAgICdpbnRlcm1pc3Npb24nOiAn6Ze05q2H6Zi25q61JywKICAgICAgICAnYXVjdGlvbic6ICfmi43ljZbpmLbmrrUnLAogICAgICAgICdpdGVtJzogJ+mBk+WFt+mYtuautScsCiAgICAgICAgJ3NldHRsZW1lbnQnOiAn57uT566X6Zi25q61JwogICAgICB9OwogICAgICByZXR1cm4gcGhhc2VNYXBbdGhpcy5nYW1lUGhhc2VdIHx8ICfmnKrnn6XpmLbmrrUnOwogICAgfSwKICAgIC8vIOagueaNruW9k+WJjeeUqOaIt+aJi+eJjOiuoeeul+aUtuiXj+mbhuaYvuekuuaVsOaNru+8jOW4pue8k+WtmOWtl+aute+8jOS+v+S6juaooeadv+ebtOaOpeW8leeUqAogICAgY29sbGVjdGlvbnNDb21wdXRlZCgpIHsKICAgICAgY29uc3QgbGlzdCA9IEFycmF5LmlzQXJyYXkodGhpcy5jb2xsZWN0aW9ucykgPyB0aGlzLmNvbGxlY3Rpb25zIDogW107CiAgICAgIC8vIOS7heWxleekuueUqOaIt+aJi+eJjOS4reiHs+WwkeWMheWQqzHku7bor6XmlLbol4/pm4bnmoTmg4XlhrUKICAgICAgcmV0dXJuIGxpc3QubWFwKGNvbCA9PiB7CiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0Q3VycmVudENvbGxlY3Rpb25Db3VudChjb2wpOwogICAgICAgIGNvbnN0IHByb2dyZXNzID0gTWF0aC5taW4oY3VycmVudCAvIChjb2wucmVxdWlyZWRDb3VudCB8fCAxKSAqIDEwMCwgMTAwKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgLi4uY29sLAogICAgICAgICAgX2N1cnJlbnQ6IGN1cnJlbnQsCiAgICAgICAgICBfcHJvZ3Jlc3M6IHByb2dyZXNzCiAgICAgICAgfTsKICAgICAgfSkuZmlsdGVyKGNvbCA9PiBjb2wuX2N1cnJlbnQgPiAwKTsKICAgIH0sCiAgICAvLyDlkIjlubbogYrlpKnkuI7ns7vnu5/ml6Xlv5fkuLrlkIzkuIDkv6Hmga/mtYHvvIzmjInml7bpl7TmjpLluo8KICAgIGNoYXRGZWVkKCkgewogICAgICBjb25zdCBsb2dzID0gKHRoaXMuZ2FtZUxvZyB8fCBbXSkubWFwKChsLCBpZHgpID0+ICh7CiAgICAgICAgaWQ6IGBsb2ctJHtsLnRpbWVzdGFtcCB8fCBpZHh9YCwKICAgICAgICB0eXBlOiAnbG9nJywKICAgICAgICB1c2VySWQ6IG51bGwsCiAgICAgICAgdXNlcm5hbWU6ICfns7vnu58nLAogICAgICAgIGNvbnRlbnQ6IGwubWVzc2FnZSwKICAgICAgICB0aW1lc3RhbXA6IGwudGltZXN0YW1wIHx8IDAKICAgICAgfSkpOwogICAgICBjb25zdCBjaGF0cyA9ICh0aGlzLmNoYXRNZXNzYWdlcyB8fCBbXSkubWFwKG0gPT4gKHsKICAgICAgICAuLi5tLAogICAgICAgIHR5cGU6ICdjaGF0JwogICAgICB9KSk7CiAgICAgIGNvbnN0IG1lcmdlZCA9IFsuLi5sb2dzLCAuLi5jaGF0c107CiAgICAgIHJldHVybiBtZXJnZWQuc29ydCgoYSwgYikgPT4gKGEudGltZXN0YW1wIHx8IDApIC0gKGIudGltZXN0YW1wIHx8IDApKTsKICAgIH0sCiAgICAvLyDmmrTpnLLlr7nor53phY3nva7kvpvmqKHmnb/kvb/nlKgKICAgIGZpcnN0TG9naW5Db25maWcoKSB7CiAgICAgIHJldHVybiBmaXJzdExvZ2luRGlhbG9ndWVDb25maWc7CiAgICB9LAogICAgLy8g5b2T5YmN6K6y6L+w6KeS6Imy6YWN572u5LiO5ZCN56ewCiAgICBuYXJyYXRpb25DaGFyYWN0ZXJOYW1lKCkgewogICAgICByZXR1cm4gdGhpcy5nZXRDdXJyZW50TGFuZ3VhZ2UoKSA9PT0gJ3poLUNOJyA/ICflpKfmnKjljZrlo6snIDogJ0RyLiBBbGluYSc7CiAgICB9LAogICAgbmFycmF0aW9uQ2hhcmFjdGVyKCkgewogICAgICBjb25zdCBrZXkgPSB0aGlzLm5hcnJhdGlvbkNoYXJhY3Rlck5hbWU7CiAgICAgIGNvbnN0IGNoYXJzID0gZmlyc3RMb2dpbkRpYWxvZ3VlQ29uZmlnICYmIGZpcnN0TG9naW5EaWFsb2d1ZUNvbmZpZy5jaGFyYWN0ZXJzOwogICAgICByZXR1cm4gY2hhcnMgJiYgY2hhcnNba2V5XSA/IGNoYXJzW2tleV0gOiB7CiAgICAgICAgaW1hZ2U6ICcvaW1hZ2VzL2d1aWRlLnBuZycsCiAgICAgICAgcG9zaXRpb246ICdyaWdodCcsCiAgICAgICAgY29sb3I6ICcjM2I4MmY2JwogICAgICB9OwogICAgfQogIH0sCiAgYXN5bmMgbW91bnRlZCgpIHsKICAgIGNvbnN0IHJvb21JZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnJvb21JZDsKICAgIGlmIChyb29tSWQpIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX1JPT01fSUQnLCByb29tSWQpOwogICAgYXdhaXQgdGhpcy5pbml0aWFsaXplR2FtZSgpOwogICAgYXdhaXQgdGhpcy5sb2FkUm9vbVN0YXRlKCk7CiAgICAvLyBsb2FkUm9vbVN0YXRlIOS4reW3sue7j+iwg+eUqOS6hiBsb2FkQWxsUGxheWVyc0FydGlmYWN0c++8jOi/memHjOehruS/neaVsOaNruWKoOi9vQogICAgYXdhaXQgdGhpcy5zdWJzY3JpYmVSb29tUmVhbHRpbWUoKTsKICB9LAogIGJlZm9yZURlc3Ryb3koKSB7CiAgICB0aGlzLnVuc3Vic2NyaWJlUm9vbVJlYWx0aW1lKCk7CiAgICBpZiAodGhpcy5yZWZyZXNoVGltZXIpIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnJlZnJlc2hUaW1lcik7CiAgICAgIHRoaXMucmVmcmVzaFRpbWVyID0gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLmF1Y3Rpb25UaW1lcikgewogICAgICBjbGVhckludGVydmFsKHRoaXMuYXVjdGlvblRpbWVyKTsKICAgICAgdGhpcy5hdWN0aW9uVGltZXIgPSBudWxsOwogICAgfQogICAgaWYgKHRoaXMudHlwaW5nVGltZXIpIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnR5cGluZ1RpbWVyKTsKICAgICAgdGhpcy50eXBpbmdUaW1lciA9IG51bGw7CiAgICB9CiAgICB0aGlzLiRzZXQodGhpcywgJ2F1Y3Rpb25Db3VudGRvd24nLCAwKTsKICB9LAogIHdhdGNoOiB7CiAgICBnYW1lTG9nKCkgewogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgY29uc3QgY2hhdENvbnRhaW5lciA9IHRoaXMuJHJlZnMuY2hhdENvbnRhaW5lcjsKICAgICAgICBpZiAoY2hhdENvbnRhaW5lcikgewogICAgICAgICAgY2hhdENvbnRhaW5lci5zY3JvbGxUb3AgPSBjaGF0Q29udGFpbmVyLnNjcm9sbEhlaWdodDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgLy8g5Y675o6J5qih5ouf5Yid5aeL5YyW546p5a6277yM5pS55Li65L2/55So5oi/6Ze055qE5a6e6ZmF546p5a625YiX6KGoCiAgICBhc3luYyBpbml0aWFsaXplR2FtZSgpIHsKICAgICAgY29uc3QgYXJ0aWZhY3RzID0gYXdhaXQgdGhpcy5sb2FkQXJ0aWZhY3RzKCk7CiAgICAgIHRoaXMuYXJ0aWZhY3RNYXAgPSBhcnRpZmFjdHMucmVkdWNlKChhY2MsIGEpID0+IHsKICAgICAgICBhY2NbYS5pZF0gPSBhOwogICAgICAgIHJldHVybiBhY2M7CiAgICAgIH0sIHt9KTsKICAgICAgYXdhaXQgdGhpcy5sb2FkQ29sbGVjdGlvbnMoKTsKICAgIH0sCiAgICBhc3luYyBzdWJzY3JpYmVSb29tUmVhbHRpbWUoKSB7CiAgICAgIGNvbnN0IHJpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnJvb21JZDsKICAgICAgaWYgKCFyaWQpIHJldHVybjsKICAgICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogICAgICBjb25zdCB7CiAgICAgICAgcm9vbUNoYW5uZWwsCiAgICAgICAgYnJvYWRjYXN0Q2hhbm5lbAogICAgICB9ID0gc3Vic2NyaWJlUm9vbVJlYWx0aW1lU2VydmljZSh7CiAgICAgICAgcm9vbUlkOiByaWQsCiAgICAgICAgc3VwYWJhc2UsCiAgICAgICAgb25Mb2FkUm9vbVN0YXRlOiB0aGlzLmxvYWRSb29tU3RhdGUKICAgICAgfSwgewogICAgICAgIG9uR2FtZVN0YXJ0ZWQ6IGFzeW5jIF9wYXlsb2FkID0+IHsKICAgICAgICAgIC8vIOmYsuatoumHjeWkjeWQr+WKqOWkmuS4quWAkuiuoeaXtgogICAgICAgICAgaWYgKHRoaXMuY291bnRkb3duSW5Qcm9ncmVzcykgcmV0dXJuOwogICAgICAgICAgdGhpcy5jb3VudGRvd25JblByb2dyZXNzID0gdHJ1ZTsKCiAgICAgICAgICAvLyDmlrDlsYDlvIDlp4vvvJrph43nva7ogYrlpKnmtojmga/lkozku7flgLzmlbDmja4KICAgICAgICAgIHRoaXMuY2hhdE1lc3NhZ2VzID0gW107CiAgICAgICAgICB0aGlzLmFsbFBsYXllcnNBcnRpZmFjdHMgPSB7fTsKICAgICAgICAgIC8vIOmHjee9ruWbnuWQiOaVsAogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdSRVNFVF9ST1VORCcpOwogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfUk9VTkRfVE9UQUwnLCA2KTsKICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX0dBTUVfUEhBU0UnLCAnY291bnRkb3duJyk7CiAgICAgICAgICB0aGlzLiRzZXQodGhpcywgJ2F1Y3Rpb25Db3VudGRvd24nLCA1KTsKICAgICAgICAgIGNvbnN0IG1lID0gKHRoaXMucm9vbSAmJiB0aGlzLnJvb20ucm9vbV9wbGF5ZXJzID8gdGhpcy5yb29tLnJvb21fcGxheWVycyA6IFtdKS5maW5kKHAgPT4gcC51c2VyX2lkID09PSB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmlkKTsKICAgICAgICAgIGlmIChtZSkgewogICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9DVVJSRU5UX1BMQVlFUicsIHsKICAgICAgICAgICAgICBpZDogbWUudXNlcl9pZCwKICAgICAgICAgICAgICBuYW1lOiB0aGlzLmdldE5hbWVGb3IobWUudXNlcl9pZCksCiAgICAgICAgICAgICAgZW5lcmd5OiA1MCwKICAgICAgICAgICAgICBhcnRpZmFjdHM6IFtdLAogICAgICAgICAgICAgIGl0ZW1zOiBbXQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmF1Y3Rpb25UaW1lcikgewogICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuYXVjdGlvblRpbWVyKTsKICAgICAgICAgICAgdGhpcy5hdWN0aW9uVGltZXIgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICBzdGFydENvdW50ZG93bih7CiAgICAgICAgICAgICAgc2Vjb25kczogNSwKICAgICAgICAgICAgICBvblRpY2s6IHMgPT4gewogICAgICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMsICdhdWN0aW9uQ291bnRkb3duJywgcyk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBvbkRvbmU6IGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuY291bnRkb3duSW5Qcm9ncmVzcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPd25lcikgewogICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmF1dG9TdGFydEF1Y3Rpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGdldFJlZjogKCkgPT4gdGhpcy5hdWN0aW9uVGltZXIsCiAgICAgICAgICAgICAgc2V0UmVmOiBpZCA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmF1Y3Rpb25UaW1lciA9IGlkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uQXVjdGlvblN0YXJ0ZWQ6IGFzeW5jIChkdXJhdGlvbiwgcGF5bG9hZCkgPT4gewogICAgICAgICAgLy8g56Gu5L+d5omA5pyJ546p5a626YO96IO955yL5Yiw5ouN5Y2W5pWw5o2uCiAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRSb29tU3RhdGUoKTsKCiAgICAgICAgICAvLyDlkIzmraXlm57lkIjmlbDvvIjlpoLmnpzlub/mkq3kuK3ljIXlkKvkuoblm57lkIjkv6Hmga/vvIkKICAgICAgICAgIGlmIChwYXlsb2FkICYmIHR5cGVvZiBwYXlsb2FkLnJvdW5kQ3VycmVudCA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfUk9VTkRfQ1VSUkVOVCcsIHBheWxvYWQucm91bmRDdXJyZW50KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChwYXlsb2FkICYmIHR5cGVvZiBwYXlsb2FkLnJvdW5kVG90YWwgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX1JPVU5EX1RPVEFMJywgcGF5bG9hZC5yb3VuZFRvdGFsKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc3RhcnRBdWN0aW9uVGltZXIoZHVyYXRpb24pOwogICAgICAgIH0sCiAgICAgICAgb25CaWRVcGRhdGU6ICh7CiAgICAgICAgICBhdWN0aW9uSWQsCiAgICAgICAgICBoaWdoZXN0QmlkLAogICAgICAgICAgaGlnaGVzdEJpZGRlcgogICAgICAgIH0pID0+IHsKICAgICAgICAgIGlmICghYXVjdGlvbklkKSByZXR1cm47CiAgICAgICAgICBjb25zdCBsaXN0ID0gdGhpcy4kc3RvcmUuc3RhdGUuY3VycmVudEF1Y3Rpb25zIHx8IFtdOwogICAgICAgICAgY29uc3QgaWR4ID0gbGlzdC5maW5kSW5kZXgoYSA9PiBhLmlkID09PSBhdWN0aW9uSWQpOwogICAgICAgICAgaWYgKGlkeCA+PSAwKSB7CiAgICAgICAgICAgIGNvbnN0IG5leHQgPSB7CiAgICAgICAgICAgICAgLi4ubGlzdFtpZHhdLAogICAgICAgICAgICAgIGhpZ2hlc3RCaWQsCiAgICAgICAgICAgICAgaGlnaGVzdEJpZGRlcgogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ0FERF9PUl9VUERBVEVfQVVDVElPTicsIG5leHQpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLy8g5pen5Zue5ZCI5bm/5pKt5bey56e76Zmk77yM57uf5LiA5pys5Zyw5o6o6L+b77yM5LiN5YaN5o6l5pS26K+l5LqL5Lu2CiAgICAgICAgb25Sb3VuZFVwZGF0ZWQ6IF9kYXRhID0+IHt9LAogICAgICAgIG9uR2FtZUVuZGVkOiAoKSA9PiB7CiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9HQU1FX1BIQVNFJywgJ3NldHRsZW1lbnQnKTsKICAgICAgICAgIHRoaXMuY29tcHV0ZUZpbmFsU2NvcmVzKCkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc2hvd0dhbWVFbmREaWFsb2cgPSB0cnVlOwogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAodGhpcy5hdWN0aW9uVGltZXIpIHsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmF1Y3Rpb25UaW1lcik7CiAgICAgICAgICAgIHRoaXMuYXVjdGlvblRpbWVyID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9uQXVjdGlvbkVuZGVkOiBhc3luYyAoKSA9PiB7CiAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRSb29tU3RhdGUoKTsKICAgICAgICB9LAogICAgICAgIG9uQ2hhdE1lc3NhZ2U6IG1lc3NhZ2UgPT4gewogICAgICAgICAgLy8g6YG/5YWN6YeN5aSN5re75Yqg5raI5oGvCiAgICAgICAgICBpZiAoIW1lc3NhZ2UgfHwgIW1lc3NhZ2UuaWQpIHJldHVybjsKICAgICAgICAgIGNvbnN0IGV4aXN0aW5nID0gdGhpcy5jaGF0TWVzc2FnZXMuZmluZChtID0+IG0uaWQgPT09IG1lc3NhZ2UuaWQgfHwgbS51c2VySWQgPT09IG1lc3NhZ2UudXNlcklkICYmIG0udGltZXN0YW1wID09PSBtZXNzYWdlLnRpbWVzdGFtcCAmJiBtLmNvbnRlbnQgPT09IG1lc3NhZ2UuY29udGVudCk7CiAgICAgICAgICBpZiAoZXhpc3RpbmcpIHJldHVybjsKICAgICAgICAgIHRoaXMuY2hhdE1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7CiAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGNoYXRDb250YWluZXIgPSB0aGlzLiRyZWZzLmNoYXRDb250YWluZXI7CiAgICAgICAgICAgIGlmIChjaGF0Q29udGFpbmVyKSB7CiAgICAgICAgICAgICAgY2hhdENvbnRhaW5lci5zY3JvbGxUb3AgPSBjaGF0Q29udGFpbmVyLnNjcm9sbEhlaWdodDsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCAoKSA9PiB7CiAgICAgICAgaWYgKCF0aGlzLnJlZnJlc2hUaW1lcikgewogICAgICAgICAgdGhpcy5yZWZyZXNoVGltZXIgPSBzZXRJbnRlcnZhbCh0aGlzLmxvYWRSb29tU3RhdGUsIDEwMDApOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMucm9vbUNoYW5uZWwgPSByb29tQ2hhbm5lbDsKICAgICAgdGhpcy5icm9hZGNhc3RDaGFubmVsID0gYnJvYWRjYXN0Q2hhbm5lbDsKICAgIH0sCiAgICB1bnN1YnNjcmliZVJvb21SZWFsdGltZSgpIHsKICAgICAgdW5zdWJzY3JpYmVSb29tUmVhbHRpbWVTZXJ2aWNlKHRoaXMucm9vbUNoYW5uZWwsIHRoaXMuYnJvYWRjYXN0Q2hhbm5lbCk7CiAgICAgIHRoaXMucm9vbUNoYW5uZWwgPSBudWxsOwogICAgICB0aGlzLmJyb2FkY2FzdENoYW5uZWwgPSBudWxsOwogICAgfSwKICAgIGFzeW5jIGxvYWRSb29tU3RhdGUoKSB7CiAgICAgIGNvbnN0IHJpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnJvb21JZDsKICAgICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogICAgICBhd2FpdCBsb2FkUm9vbVN0YXRlU2VydmljZSh7CiAgICAgICAgcm9vbUlkOiByaWQsCiAgICAgICAgcm9vbVNlcnZpY2UsCiAgICAgICAgc3VwYWJhc2UsCiAgICAgICAgYXJ0aWZhY3RNYXA6IHRoaXMuYXJ0aWZhY3RNYXAsCiAgICAgICAgc3RvcmU6IHRoaXMuJHN0b3JlLAogICAgICAgIHNldFJvb206IHJvb20gPT4gewogICAgICAgICAgdGhpcy5yb29tID0gcm9vbTsKICAgICAgICB9LAogICAgICAgIHNldFByb2ZpbGVNYXA6IG1hcCA9PiB7CiAgICAgICAgICB0aGlzLnByb2ZpbGVNYXAgPSBtYXA7CiAgICAgICAgfSwKICAgICAgICBzZXRHYW1lUGhhc2U6IHBoYXNlID0+IHsKICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX0dBTUVfUEhBU0UnLCBwaGFzZSk7CiAgICAgICAgfSwKICAgICAgICBjbGVhckF1Y3Rpb25UaW1lcjogKCkgPT4gewogICAgICAgICAgaWYgKHRoaXMuYXVjdGlvblRpbWVyKSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5hdWN0aW9uVGltZXIpOwogICAgICAgICAgICB0aGlzLmF1Y3Rpb25UaW1lciA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZXRBdWN0aW9uQ291bnRkb3duOiBuID0+IHsKICAgICAgICAgIHRoaXMuJHNldCh0aGlzLCAnYXVjdGlvbkNvdW50ZG93bicsIG4pOwogICAgICAgIH0sCiAgICAgICAgb25TaG93R2FtZUVuZDogKCkgPT4gewogICAgICAgICAgdGhpcy5zaG93R2FtZUVuZERpYWxvZyA9IHRydWU7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVHYW1lRW5kKCk7CiAgICAgICAgICB9LCAzMDAwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICAvLyDliqDovb3miYDmnInnjqnlrrbnmoTmiYvniYzmlbDmja7vvIznlKjkuo7ku7flgLzorqHnrpcKICAgICAgYXdhaXQgdGhpcy5sb2FkQWxsUGxheWVyc0FydGlmYWN0cygpOwogICAgICAvLyDlpoLmnpzliLfmlrDlkI7lj5HnjrDku43mnInmtLvot4Pmi43ljZbvvIzkvYbmnKzlnLDml6DlgJLorqHml7bvvIzliJnnlKjlvZPliY3liankvZnml7bpl7TlkK/liqjnu5/kuIDlgJLorqHml7YKICAgICAgY29uc3QgYXVjdGlvbnMgPSB0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50QXVjdGlvbnMgfHwgW107CiAgICAgIGlmICh0aGlzLiRzdG9yZS5zdGF0ZS5nYW1lUGhhc2UgPT09ICdhdWN0aW9uJyAmJiBhdWN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3QgcmVtYWluaW5nID0gTnVtYmVyKHRoaXMuYXVjdGlvbkNvdW50ZG93biB8fCAwKTsKICAgICAgICBpZiAoIXRoaXMuYXVjdGlvblRpbWVyICYmIHJlbWFpbmluZyA+IDApIHsKICAgICAgICAgIHN0YXJ0Q291bnRkb3duKHsKICAgICAgICAgICAgc2Vjb25kczogcmVtYWluaW5nLAogICAgICAgICAgICBvblRpY2s6IHMgPT4gewogICAgICAgICAgICAgIHRoaXMuJHNldCh0aGlzLCAnYXVjdGlvbkNvdW50ZG93bicsIHMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkRvbmU6IGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9uQXVjdGlvblRpbWVVcCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRSZWY6ICgpID0+IHRoaXMuYXVjdGlvblRpbWVyLAogICAgICAgICAgICBzZXRSZWY6IGlkID0+IHsKICAgICAgICAgICAgICB0aGlzLmF1Y3Rpb25UaW1lciA9IGlkOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDliqDovb3miYDmnInnjqnlrrbnmoTmiYvniYzmlbDmja4KICAgIGFzeW5jIGxvYWRBbGxQbGF5ZXJzQXJ0aWZhY3RzKCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnJvb21JZDsKICAgICAgICBpZiAoIXJpZCkgewogICAgICAgICAgdGhpcy5hbGxQbGF5ZXJzQXJ0aWZhY3RzID0ge307CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTsKICAgICAgICAvLyDojrflj5bmiL/pl7TlhoXmiYDmnInnjqnlrrbnmoTmiYvniYzmlbDmja4KICAgICAgICBjb25zdCB7CiAgICAgICAgICBkYXRhOiBhbGxBcnRpZmFjdHMKICAgICAgICB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgncm9vbV9hcnRpZmFjdHMnKS5zZWxlY3QoJ293bmVyX3VzZXJfaWQsIGFydGlmYWN0X2lkJykuZXEoJ3Jvb21faWQnLCByaWQpOwoKICAgICAgICAvLyDmjInnjqnlrrZJROWIhue7hAogICAgICAgIGNvbnN0IHBsYXllckFydGlmYWN0c01hcCA9IHt9OwogICAgICAgIGlmIChhbGxBcnRpZmFjdHMgJiYgYWxsQXJ0aWZhY3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGFsbEFydGlmYWN0cy5mb3JFYWNoKHJvdyA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJJZCA9IHJvdy5vd25lcl91c2VyX2lkOwogICAgICAgICAgICBpZiAoIXBsYXllckFydGlmYWN0c01hcFt1c2VySWRdKSB7CiAgICAgICAgICAgICAgcGxheWVyQXJ0aWZhY3RzTWFwW3VzZXJJZF0gPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwbGF5ZXJBcnRpZmFjdHNNYXBbdXNlcklkXS5wdXNoKHJvdy5hcnRpZmFjdF9pZCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIOS9v+eUqCBWdWUuc2V0IOehruS/neWTjeW6lOW8j+abtOaWsAogICAgICAgIHRoaXMuJHNldCh0aGlzLCAnYWxsUGxheWVyc0FydGlmYWN0cycsIHBsYXllckFydGlmYWN0c01hcCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1tnYW1lXSBsb2FkQWxsUGxheWVyc0FydGlmYWN0cyBmYWlsZWQnLCBlKTsKICAgICAgICB0aGlzLmFsbFBsYXllcnNBcnRpZmFjdHMgPSB7fTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIHRvZ2dsZVJlYWR5KCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnJvb21JZDsKICAgICAgICBjb25zdCB1aWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyICYmIHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIuaWQ7CiAgICAgICAgaWYgKCFyaWQgfHwgIXVpZCkgcmV0dXJuOwogICAgICAgIGF3YWl0IHRvZ2dsZVJlYWR5QWN0aW9uKHsKICAgICAgICAgIHJvb21JZDogcmlkLAogICAgICAgICAgdXNlcklkOiB1aWQsCiAgICAgICAgICByb29tOiB0aGlzLnJvb20sCiAgICAgICAgICByb29tU2VydmljZSwKICAgICAgICAgIHJlbG9hZDogdGhpcy5sb2FkUm9vbVN0YXRlCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1tnYW1lXSB0b2dnbGVSZWFkeSBmYWlsZWQnLCBlKTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIG1vdmVUb1NlYXQoaWR4KSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmlkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9vbUlkOwogICAgICAgIGNvbnN0IHVpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIgJiYgdGhpcy4kc3RvcmUuc3RhdGUudXNlci5pZDsKICAgICAgICBpZiAoIXJpZCB8fCAhdWlkKSByZXR1cm47CiAgICAgICAgY29uc3QgdGFyZ2V0U2VhdCA9IHsKICAgICAgICAgIGluZGV4OiBpZHgsCiAgICAgICAgICBwbGF5ZXI6IHRoaXMuc2VhdHNbaWR4XSAmJiB0aGlzLnNlYXRzW2lkeF0ucGxheWVyCiAgICAgICAgfTsKICAgICAgICBhd2FpdCBtb3ZlVG9TZWF0QWN0aW9uKHsKICAgICAgICAgIHJvb21JZDogcmlkLAogICAgICAgICAgdXNlcklkOiB1aWQsCiAgICAgICAgICByb29tOiB0aGlzLnJvb20sCiAgICAgICAgICBzZWF0czogdGFyZ2V0U2VhdCwKICAgICAgICAgIHJvb21TZXJ2aWNlLAogICAgICAgICAgcmVsb2FkOiB0aGlzLmxvYWRSb29tU3RhdGUKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybignW2dhbWVdIG1vdmVUb1NlYXQgZmFpbGVkJywgZSk7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBsZWF2ZVJvb20oKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmlkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9vbUlkOwogICAgICAgIGNvbnN0IHVpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIgJiYgdGhpcy4kc3RvcmUuc3RhdGUudXNlci5pZDsKICAgICAgICBpZiAoIXJpZCB8fCAhdWlkKSByZXR1cm47CiAgICAgICAgYXdhaXQgbGVhdmVSb29tQWN0aW9uKHsKICAgICAgICAgIHJvb21JZDogcmlkLAogICAgICAgICAgdXNlcklkOiB1aWQsCiAgICAgICAgICBjbGVhckF1Y3Rpb25UaW1lcjogKCkgPT4gewogICAgICAgICAgICBpZiAodGhpcy5hdWN0aW9uVGltZXIpIHsKICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuYXVjdGlvblRpbWVyKTsKICAgICAgICAgICAgICB0aGlzLmF1Y3Rpb25UaW1lciA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBzZXRDb3VudGRvd246IG4gPT4gewogICAgICAgICAgICB0aGlzLiRzZXQodGhpcywgJ2F1Y3Rpb25Db3VudGRvd24nLCBuKTsKICAgICAgICAgIH0sCiAgICAgICAgICBzdG9yZTogdGhpcy4kc3RvcmUsCiAgICAgICAgICBhdWN0aW9uU2VydmljZSwKICAgICAgICAgIHJvb21TZXJ2aWNlLAogICAgICAgICAgdW5zdWJzY3JpYmU6ICgpID0+IHRoaXMudW5zdWJzY3JpYmVSb29tUmVhbHRpbWUoKSwKICAgICAgICAgIHNldFJvb21JZDogdiA9PiB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9ST09NX0lEJywgdiksCiAgICAgICAgICBzZXRMb2NhbFJvb206IHYgPT4gewogICAgICAgICAgICB0aGlzLnJvb20gPSB2OwogICAgICAgICAgfSwKICAgICAgICAgIG5hdmlnYXRlVG9Sb29tczogKCkgPT4gdGhpcy4kcm91dGVyLnB1c2goJy9yb29tcycpCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1tnYW1lXSBsZWF2ZVJvb20gZmFpbGVkJywgZSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDmuLjmiI/nu5PmnZ/lpITnkIYKICAgIGFzeW5jIGhhbmRsZUdhbWVFbmQoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmlkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9vbUlkOwogICAgICAgIGlmIChyaWQpIHsKICAgICAgICAgIC8vIOWwhuaIv+mXtOeKtuaAgemHjee9ruS4uiB3YWl0aW5n77yM5L6/5LqO57un57ut5oi/6Ze05YaF5YeG5aSHL+aWsOS4gOWxgAogICAgICAgICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogICAgICAgICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgncm9vbXMnKS51cGRhdGUoewogICAgICAgICAgICBzdGF0dXM6ICd3YWl0aW5nJwogICAgICAgICAgfSkuZXEoJ2lkJywgcmlkKTsKICAgICAgICAgIC8vIOi3s+i9rOWbnuaIv+mXtOmhtemdou+8iOa4uOaIj+mhteaQuuW4piByb29tSWQg5Y2z5piv5oi/6Ze055WM6Z2i77yJCiAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgIHBhdGg6ICcvZ2FtZScsCiAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgcm9vbUlkOiByaWQsCiAgICAgICAgICAgICAgZ2FtZUVuZGVkOiAndHJ1ZScKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvcm9vbXMnKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1tnYW1lXSBoYW5kbGVHYW1lRW5kIGZhaWxlZCcsIGUpOwogICAgICAgIC8vIOWFnOW6lei3s+WbnuaIv+mXtOWIl+ihqAogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvcm9vbXMnKTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIHN0YXJ0R2FtZSgpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByaWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS5yb29tSWQ7CiAgICAgICAgY29uc3QgdWlkID0gdGhpcy4kc3RvcmUuc3RhdGUudXNlciAmJiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmlkOwogICAgICAgIGlmICghcmlkIHx8ICF1aWQgfHwgIXRoaXMuaXNPd25lciB8fCAhdGhpcy5hbGxSZWFkeSkgcmV0dXJuOwogICAgICAgIC8vIOaWsOWxgOW8gOWni+WJjemHjee9ruezu+e7n+aXpeW/l+OAgeiBiuWkqea2iOaBr+WSjOS7t+WAvOaVsOaNrgogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ0NMRUFSX0dBTUVfTE9HJyk7CiAgICAgICAgfSBjYXRjaCAoXykge30KICAgICAgICB0aGlzLmNoYXRNZXNzYWdlcyA9IFtdOwogICAgICAgIHRoaXMuYWxsUGxheWVyc0FydGlmYWN0cyA9IHt9OwogICAgICAgIGF3YWl0IHJvb21TZXJ2aWNlLnN0YXJ0R2FtZShyaWQsIHVpZCk7CiAgICAgICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogICAgICAgIHRoaXMucm91bmRDb3VudCA9IDA7CiAgICAgICAgYXdhaXQgc3RhcnRHYW1lRmxvdyh7CiAgICAgICAgICByb29tSWQ6IHJpZCwKICAgICAgICAgIHVzZXJJZDogdWlkLAogICAgICAgICAgaXNPd25lcjogdGhpcy5pc093bmVyLAogICAgICAgICAgYWxsUmVhZHk6IHRoaXMuYWxsUmVhZHksCiAgICAgICAgICBzdG9yZTogdGhpcy4kc3RvcmUsCiAgICAgICAgICBzdXBhYmFzZSwKICAgICAgICAgIHNldENvdW50ZG93bjogbiA9PiB0aGlzLiRzZXQodGhpcywgJ2F1Y3Rpb25Db3VudGRvd24nLCBuKSwKICAgICAgICAgIHNldEN1cnJlbnRQbGF5ZXJGcm9tUm9vbTogKCkgPT4gewogICAgICAgICAgICBjb25zdCBtZSA9ICh0aGlzLnJvb20gJiYgdGhpcy5yb29tLnJvb21fcGxheWVycyA/IHRoaXMucm9vbS5yb29tX3BsYXllcnMgOiBbXSkuZmluZChwID0+IHAudXNlcl9pZCA9PT0gdWlkKTsKICAgICAgICAgICAgaWYgKG1lKSB7CiAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfQ1VSUkVOVF9QTEFZRVInLCB7CiAgICAgICAgICAgICAgICBpZDogbWUudXNlcl9pZCwKICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuZ2V0TmFtZUZvcihtZS51c2VyX2lkKSwKICAgICAgICAgICAgICAgIGVuZXJneTogNTAsCiAgICAgICAgICAgICAgICBhcnRpZmFjdHM6IFtdLAogICAgICAgICAgICAgICAgaXRlbXM6IFtdCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBvbkNvdW50ZG93bkRvbmU6IGFzeW5jICgpID0+IHsKICAgICAgICAgICAgaWYgKHRoaXMuaXNPd25lcikgewogICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXV0b1N0YXJ0QXVjdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgLy8g5oi/5Li75pys5Zyw5Lmf5ZCv5Yqo6aKE5YCS6K6h5pe277yM6Ziy5q2i5bm/5pKt5LiN5Zue5Lyg5a+86Ie05LiN6Kem5Y+RIG9uR2FtZVN0YXJ0ZWQKICAgICAgICBpZiAoIXRoaXMuY291bnRkb3duSW5Qcm9ncmVzcykgewogICAgICAgICAgdGhpcy5jb3VudGRvd25JblByb2dyZXNzID0gdHJ1ZTsKICAgICAgICAgIC8vIOehruS/neacrOWcsOS5n+mHjee9ruaVsOaNrgogICAgICAgICAgdGhpcy5jaGF0TWVzc2FnZXMgPSBbXTsKICAgICAgICAgIHRoaXMuYWxsUGxheWVyc0FydGlmYWN0cyA9IHt9OwogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfR0FNRV9QSEFTRScsICdjb3VudGRvd24nKTsKICAgICAgICAgIHRoaXMuJHNldCh0aGlzLCAnYXVjdGlvbkNvdW50ZG93bicsIDUpOwogICAgICAgICAgY29uc3QgbWUgPSAodGhpcy5yb29tICYmIHRoaXMucm9vbS5yb29tX3BsYXllcnMgPyB0aGlzLnJvb20ucm9vbV9wbGF5ZXJzIDogW10pLmZpbmQocCA9PiBwLnVzZXJfaWQgPT09IHVpZCk7CiAgICAgICAgICBpZiAobWUpIHsKICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfQ1VSUkVOVF9QTEFZRVInLCB7CiAgICAgICAgICAgICAgaWQ6IG1lLnVzZXJfaWQsCiAgICAgICAgICAgICAgbmFtZTogdGhpcy5nZXROYW1lRm9yKG1lLnVzZXJfaWQpLAogICAgICAgICAgICAgIGVuZXJneTogNTAsCiAgICAgICAgICAgICAgYXJ0aWZhY3RzOiBbXSwKICAgICAgICAgICAgICBpdGVtczogW10KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5hdWN0aW9uVGltZXIpIHsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmF1Y3Rpb25UaW1lcik7CiAgICAgICAgICAgIHRoaXMuYXVjdGlvblRpbWVyID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgICAgc3RhcnRDb3VudGRvd24oewogICAgICAgICAgICAgIHNlY29uZHM6IDUsCiAgICAgICAgICAgICAgb25UaWNrOiBzID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuJHNldCh0aGlzLCAnYXVjdGlvbkNvdW50ZG93bicsIHMpOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb25Eb25lOiBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmNvdW50ZG93bkluUHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT3duZXIpIHsKICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRvU3RhcnRBdWN0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBnZXRSZWY6ICgpID0+IHRoaXMuYXVjdGlvblRpbWVyLAogICAgICAgICAgICAgIHNldFJlZjogaWQgPT4gewogICAgICAgICAgICAgICAgdGhpcy5hdWN0aW9uVGltZXIgPSBpZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdbZ2FtZV0gc3RhcnRHYW1lIGZhaWxlZCcsIGUpOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgc3RhcnRBdWN0aW9uKCkgewogICAgICAvLyDlkIzml7bmir3lj5blpJrku7bov5vooYzmi43ljZbvvIjnpLrkvovkuLoy5Lu277yJCiAgICAgIGNvbnN0IGFydGlmYWN0cyA9IGF3YWl0IHRoaXMubG9hZEFydGlmYWN0cygpOwogICAgICBpZiAoYXJ0aWZhY3RzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBwaWNrcyA9IFtdOwogICAgICAgIHdoaWxlIChwaWNrcy5sZW5ndGggPCBNYXRoLm1pbigyLCBhcnRpZmFjdHMubGVuZ3RoKSkgewogICAgICAgICAgY29uc3QgY2FuZGlkYXRlID0gYXJ0aWZhY3RzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFydGlmYWN0cy5sZW5ndGgpXTsKICAgICAgICAgIGlmICghcGlja3MuZmluZChwID0+IHAuaWQgPT09IGNhbmRpZGF0ZS5pZCkpIHBpY2tzLnB1c2goY2FuZGlkYXRlKTsKICAgICAgICB9CiAgICAgICAgZm9yIChjb25zdCBhcnQgb2YgcGlja3MpIHsKICAgICAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdzdGFydEF1Y3Rpb24nLCBhcnQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFzeW5jIGxvYWRBcnRpZmFjdHMoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogICAgICAgIHJldHVybiBhd2FpdCBsb2FkQXJ0aWZhY3RzU2VydmljZSh7CiAgICAgICAgICBzdXBhYmFzZQogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WKoOi9veWNoeeJjOaVsOaNruWksei0pTonLCBlcnJvcik7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICB9LAogICAgb3BlblNob3AoKSB7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX1NIT1dfU0hPUCcsIHRydWUpOwogICAgfSwKICAgIGNsb3NlU2hvcCgpIHsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfU0hPV19TSE9QJywgZmFsc2UpOwogICAgfSwKICAgIHNob3dBcnRpZmFjdERldGFpbChhcnRpZmFjdElkKSB7CiAgICAgIC8vIOiLpeW3suWKoOi9vWFydGlmYWN0TWFw77yM5YiZ5LyY5YWI5bGV56S655yf5a6e5pWw5o2uCiAgICAgIGNvbnN0IGFydGlmYWN0ID0gdGhpcy5hcnRpZmFjdE1hcFthcnRpZmFjdElkXTsKICAgICAgaWYgKGFydGlmYWN0KSB7CiAgICAgICAgdGhpcy5zZWxlY3RlZENhcmQgPSBhcnRpZmFjdDsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDlm57pgIDvvJrnu7TmjIHljp/npLrkvosKICAgICAgICB0aGlzLnNlbGVjdGVkQ2FyZCA9IHsKICAgICAgICAgIGlkOiBhcnRpZmFjdElkLAogICAgICAgICAgbmFtZTogJ+ekuuS+i+Wlh+eJqScsCiAgICAgICAgICBlcmE6ICflj6Tku6MnLAogICAgICAgICAgbG9jYXRpb246ICfmnKrnn6UnLAogICAgICAgICAgc3Rvcnk6ICfov5nmmK/kuIDkuKrnpZ7np5jnmoTlpYfniakuLi4nLAogICAgICAgICAgY29sbGVjdGlvblRhZ3M6IFsn6Im65pyv55Gw5a6dJ10sCiAgICAgICAgICBiYXNlVmFsdWU6IDgsCiAgICAgICAgICBpbWFnZTogJ2h0dHBzOi8vdmlhLnBsYWNlaG9sZGVyLmNvbS8zMDB4MjAwP3RleHQ956S65L6L5aWH54mpJwogICAgICAgIH07CiAgICAgIH0KICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfU0hPV19DQVJEX0RFVEFJTCcsIHRydWUpOwogICAgfSwKICAgIGhpZGVDYXJkRGV0YWlsKCkgewogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9TSE9XX0NBUkRfREVUQUlMJywgZmFsc2UpOwogICAgICB0aGlzLnNlbGVjdGVkQ2FyZCA9IG51bGw7CiAgICB9LAogICAgc2hvd0FydGlmYWN0RGV0YWlsRnJvbUF1Y3Rpb24oYXJ0aWZhY3QpIHsKICAgICAgdGhpcy5zZWxlY3RlZENhcmQgPSBhcnRpZmFjdDsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfU0hPV19DQVJEX0RFVEFJTCcsIGZhbHNlKTsKICAgICAgdGhpcy5vcGVuTmFycmF0aW9uKCk7CiAgICB9LAogICAgLy8g6K6h566X546p5a625oC75Lu35YC877yI5pSv5oyB5omA5pyJ546p5a6277yJCiAgICBnZXRQbGF5ZXJUb3RhbFZhbHVlKHVzZXJJZCkgewogICAgICBpZiAoIXVzZXJJZCkgcmV0dXJuIDA7CgogICAgICAvLyDkvJjlhYjku44gYWxsUGxheWVyc0FydGlmYWN0cyDojrflj5bmiYDmnInnjqnlrrbnmoTmiYvniYzmlbDmja4KICAgICAgbGV0IG93bmVkID0gW107CiAgICAgIGlmICh0aGlzLmFsbFBsYXllcnNBcnRpZmFjdHMgJiYgdGhpcy5hbGxQbGF5ZXJzQXJ0aWZhY3RzW3VzZXJJZF0pIHsKICAgICAgICBvd25lZCA9IEFycmF5LmlzQXJyYXkodGhpcy5hbGxQbGF5ZXJzQXJ0aWZhY3RzW3VzZXJJZF0pID8gdGhpcy5hbGxQbGF5ZXJzQXJ0aWZhY3RzW3VzZXJJZF0gOiBbXTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDlm57pgIDvvJrlpoLmnpwgYWxsUGxheWVyc0FydGlmYWN0cyDkuK3msqHmnInvvIzlsJ3or5Xku47lvZPliY3njqnlrrbmlbDmja7ojrflj5YKICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy4kc3RvcmUuc3RhdGUuY3VycmVudFBsYXllcjsKICAgICAgICBpZiAoY3VycmVudCAmJiBjdXJyZW50LmlkID09PSB1c2VySWQpIHsKICAgICAgICAgIG93bmVkID0gQXJyYXkuaXNBcnJheSh0aGlzLiRzdG9yZS5zdGF0ZS5wbGF5ZXJBcnRpZmFjdHMpID8gdGhpcy4kc3RvcmUuc3RhdGUucGxheWVyQXJ0aWZhY3RzIDogW107CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghb3duZWQgfHwgb3duZWQubGVuZ3RoID09PSAwKSByZXR1cm4gMDsKCiAgICAgIC8vIOehruS/nSBhcnRpZmFjdE1hcCDlt7LliqDovb0KICAgICAgaWYgKCF0aGlzLmFydGlmYWN0TWFwIHx8IE9iamVjdC5rZXlzKHRoaXMuYXJ0aWZhY3RNYXApLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7CiAgICAgIGxldCB0b3RhbCA9IDA7CiAgICAgIG93bmVkLmZvckVhY2goYWlkID0+IHsKICAgICAgICBjb25zdCBhID0gdGhpcy5hcnRpZmFjdE1hcFthaWRdOwogICAgICAgIGlmIChhICYmIHR5cGVvZiBhLmJhc2VWYWx1ZSA9PT0gJ251bWJlcicpIHsKICAgICAgICAgIHRvdGFsICs9IGEuYmFzZVZhbHVlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiB0b3RhbDsKICAgIH0sCiAgICBzaG93UGxheWVySGFuZChwbGF5ZXIpIHsKICAgICAgLy8g5p6E6YCg546p5a625a+56LGh77yM5YyF5ZCr5omL54mM5L+h5oGvCiAgICAgIGNvbnN0IHBsYXllckRhdGEgPSB7CiAgICAgICAgaWQ6IHBsYXllci51c2VyX2lkLAogICAgICAgIG5hbWU6IHRoaXMuZ2V0TmFtZUZvcihwbGF5ZXIudXNlcl9pZCksCiAgICAgICAgYXJ0aWZhY3RzOiB0aGlzLmN1cnJlbnRQbGF5ZXIgJiYgdGhpcy5jdXJyZW50UGxheWVyLmlkID09PSBwbGF5ZXIudXNlcl9pZCA/IHRoaXMuY3VycmVudFBsYXllci5hcnRpZmFjdHMgfHwgW10gOiBbXQogICAgICB9OwogICAgICB0aGlzLmhhbmRQbGF5ZXIgPSBwbGF5ZXJEYXRhOwogICAgICB0aGlzLnNob3dIYW5kUG9wdXAgPSB0cnVlOwogICAgfSwKICAgIGhpZGVIYW5kKCkgewogICAgICB0aGlzLmhhbmRQbGF5ZXIgPSBudWxsOwogICAgICB0aGlzLnNob3dIYW5kUG9wdXAgPSBmYWxzZTsKICAgIH0sCiAgICBnZXRBdmF0YXJGb3IodXNlcklkKSB7CiAgICAgIHJldHVybiBnZXRBdmF0YXJGb3JIZWxwZXIoewogICAgICAgIHByb2ZpbGVNYXA6IHRoaXMucHJvZmlsZU1hcCwKICAgICAgICB1c2VySWQKICAgICAgfSk7CiAgICB9LAogICAgZ2V0TmFtZUZvcih1c2VySWQpIHsKICAgICAgcmV0dXJuIGdldE5hbWVGb3JIZWxwZXIoewogICAgICAgIHByb2ZpbGVNYXA6IHRoaXMucHJvZmlsZU1hcCwKICAgICAgICByb29tOiB0aGlzLnJvb20sCiAgICAgICAgdXNlcklkCiAgICAgIH0pOwogICAgfSwKICAgIGdldEN1cnJlbnRMYW5ndWFnZSgpIHsKICAgICAgcmV0dXJuIGdldEN1cnJlbnRMYW5ndWFnZUltcG9ydGVkKCk7CiAgICB9LAogICAgLy8g5Yqg6L295pS26JeP6ZuG5pWw5o2u77ya5Z+65LqO5pWw5o2u5bqTIGFydGlmYWN0cyDnmoQgY29sbGVjdGlvbl90YWdzIOWKqOaAgeeUn+aIkAogICAgYXN5bmMgbG9hZENvbGxlY3Rpb25zKCkgewogICAgICB0cnkgewogICAgICAgIHRoaXMuY29sbGVjdGlvbnMgPSBsb2FkQ29sbGVjdGlvbnNGcm9tQXJ0aWZhY3RzKHRoaXMuYXJ0aWZhY3RNYXApOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WKoOi9veaUtuiXj+mbhuaVsOaNruWksei0pTonLCBlcnJvcik7CiAgICAgICAgdGhpcy5jb2xsZWN0aW9ucyA9IFtdOwogICAgICB9CiAgICB9LAogICAgLy8g6I635Y+W5b2T5YmN5pS26JeP6ZuG5pWw6YeP77yI5Z+65LqO5b2T5YmN55So5oi35omL54mM77yM5LiU5Y+X5pyA5aSn6KaB5rGC5pWw5LiK6ZmQ6ZmQ5Yi277yJCiAgICBnZXRDdXJyZW50Q29sbGVjdGlvbkNvdW50KGNvbGxlY3Rpb24pIHsKICAgICAgY29uc3Qgb3duZWQgPSB0aGlzLmN1cnJlbnRQbGF5ZXIgJiYgdGhpcy5jdXJyZW50UGxheWVyLmFydGlmYWN0cyA/IHRoaXMuY3VycmVudFBsYXllci5hcnRpZmFjdHMgOiBbXTsKICAgICAgcmV0dXJuIGdldENvbGxlY3Rpb25Db3VudFV0aWwoewogICAgICAgIGFydGlmYWN0TWFwOiB0aGlzLmFydGlmYWN0TWFwLAogICAgICAgIG93bmVkQXJ0aWZhY3RJZHM6IG93bmVkLAogICAgICAgIGNvbGxlY3Rpb24KICAgICAgfSk7CiAgICB9LAogICAgLy8g5bGV5byAL+aUtui1t+aUtuiXj+mbhgogICAgdG9nZ2xlQ29sbGVjdGlvbihjb2xsZWN0aW9uKSB7CiAgICAgIGNvbnN0IGlkID0gY29sbGVjdGlvbiAmJiBjb2xsZWN0aW9uLmlkOwogICAgICBpZiAoIWlkKSByZXR1cm47CiAgICAgIHRoaXMuJHNldCh0aGlzLmV4cGFuZGVkQ29sbGVjdGlvbnMsIGlkLCAhdGhpcy5leHBhbmRlZENvbGxlY3Rpb25zW2lkXSk7CiAgICB9LAogICAgLy8g5YWz6Zet5ri45oiP57uT5p2f5a+56K+d5qGGCiAgICBjbG9zZUdhbWVFbmREaWFsb2coKSB7CiAgICAgIHRoaXMuc2hvd0dhbWVFbmREaWFsb2cgPSBmYWxzZTsKICAgIH0sCiAgICAvLyDnlZnlnKjmiL/pl7QKICAgIHN0YXlJblJvb20oKSB7CiAgICAgIHRoaXMuc2hvd0dhbWVFbmREaWFsb2cgPSBmYWxzZTsKICAgICAgdHJ5IHsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ0NMRUFSX0dBTUVfTE9HJyk7CiAgICAgIH0gY2F0Y2ggKF8pIHt9CiAgICAgIC8vIOi/lOWbnuW9k+WJjeaIv+mXtOWHhuWkh+eVjOmdogogICAgICBjb25zdCByaWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS5yb29tSWQ7CiAgICAgIGlmIChyaWQpIHsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9HQU1FX1BIQVNFJywgJ3ByZXBhcmF0aW9uJyk7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgcGF0aDogJy9nYW1lJywKICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgIHJvb21JZDogcmlkCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDov5Tlm57miL/pl7TliJfooagKICAgIGdvVG9Sb29tcygpIHsKICAgICAgdGhpcy5zaG93R2FtZUVuZERpYWxvZyA9IGZhbHNlOwogICAgICB0aGlzLnVuc3Vic2NyaWJlUm9vbVJlYWx0aW1lKCk7CiAgICAgIHRyeSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdDTEVBUl9HQU1FX0xPRycpOwogICAgICB9IGNhdGNoIChfKSB7fQogICAgICAvLyDov5Tlm57lvZPliY3miL/pl7Tlh4blpIfnlYzpnaLvvIjmm7TnrKblkIjmnJ/mnJvvvIkKICAgICAgY29uc3QgcmlkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9vbUlkOwogICAgICBpZiAocmlkKSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfR0FNRV9QSEFTRScsICdwcmVwYXJhdGlvbicpOwogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgIHBhdGg6ICcvZ2FtZScsCiAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICByb29tSWQ6IHJpZAogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvcm9vbXMnKTsKICAgICAgfQogICAgfSwKICAgIC8vIOaXtumXtOWIsO+8mue7k+adn+W9k+WJjeaJgOacieaLjeWNluW5tue7k+eul+WIsOWvueW6lOeOqeWutuaJi+eJjO+8jOeEtuWQjui/m+WFpTEwc+mXtOath+aIlue7k+adn+a4uOaIjwogICAgYXN5bmMgb25BdWN0aW9uVGltZVVwKCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IGF1Y3Rpb25zID0gdGhpcy4kc3RvcmUuc3RhdGUuY3VycmVudEF1Y3Rpb25zIHx8IFtdOwogICAgICAgIC8vIOe7n+S4gOWAkuiuoeaXtue7k+adn++8mue7k+adn+aJgOacieW9k+WJjeaLjeWNlgogICAgICAgIGZvciAoY29uc3QgYSBvZiBhdWN0aW9ucykgewogICAgICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2VuZEF1Y3Rpb24nLCBhLmlkKTsKICAgICAgICB9CiAgICAgICAgLy8g5Yik5pat5piv5ZCm6L6+5Yiw5oC75Zue5ZCI5pWwCiAgICAgICAgY29uc3QgY3VyID0gTnVtYmVyKHRoaXMuJHN0b3JlLnN0YXRlLnJvdW5kQ3VycmVudCB8fCAwKTsKICAgICAgICBjb25zdCB0b3QgPSBOdW1iZXIodGhpcy4kc3RvcmUuc3RhdGUucm91bmRUb3RhbCB8fCA2KTsKICAgICAgICBpZiAoY3VyID49IHRvdCkgewogICAgICAgICAgLy8g6Kem5Y+R57uT5p2fCiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9HQU1FX1BIQVNFJywgJ3NldHRsZW1lbnQnKTsKICAgICAgICAgIGF3YWl0IHRoaXMuY29tcHV0ZUZpbmFsU2NvcmVzKCk7CiAgICAgICAgICB0aGlzLnNob3dHYW1lRW5kRGlhbG9nID0gdHJ1ZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8g5ZCm5YiZ6L+b5YWlMTBz6Ze05q2H6Zi25q61CiAgICAgICAgdGhpcy5zdGFydEludGVybWlzc2lvblRpbWVyKDEwKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybignW2dhbWVdIG9uQXVjdGlvblRpbWVVcCBmYWlsZWQnLCBlKTsKICAgICAgfQogICAgfSwKICAgIC8vIOW8gOWni+aLjeWNluWAkuiuoeaXtu+8mue7n+S4gOavj+i9ruaLjeWNluWPquacieS4gOS4quWAkuiuoeaXtgogICAgc3RhcnRBdWN0aW9uVGltZXIoZHVyYXRpb24gPSAzMCkgewogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9HQU1FX1BIQVNFJywgJ2F1Y3Rpb24nKTsKICAgICAgc3RhcnRDb3VudGRvd24oewogICAgICAgIHNlY29uZHM6IGR1cmF0aW9uLAogICAgICAgIG9uVGljazogcyA9PiB7CiAgICAgICAgICB0aGlzLiRzZXQodGhpcywgJ2F1Y3Rpb25Db3VudGRvd24nLCBzKTsKICAgICAgICB9LAogICAgICAgIG9uRG9uZTogYXN5bmMgKCkgPT4gewogICAgICAgICAgYXdhaXQgdGhpcy5vbkF1Y3Rpb25UaW1lVXAoKTsKICAgICAgICB9LAogICAgICAgIGdldFJlZjogKCkgPT4gdGhpcy5hdWN0aW9uVGltZXIsCiAgICAgICAgc2V0UmVmOiBpZCA9PiB7CiAgICAgICAgICB0aGlzLmF1Y3Rpb25UaW1lciA9IGlkOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8g5q+P6L2u5LmL6Ze055qE6Ze05q2H6K6h5pe25Zmo77yM57uT5p2f5ZCO6Ieq5Yqo5byA5aeL5LiL5LiA6L2u5ouN5Y2WCiAgICBzdGFydEludGVybWlzc2lvblRpbWVyKGR1cmF0aW9uID0gMTApIHsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfR0FNRV9QSEFTRScsICdpbnRlcm1pc3Npb24nKTsKICAgICAgc3RhcnRDb3VudGRvd24oewogICAgICAgIHNlY29uZHM6IGR1cmF0aW9uLAogICAgICAgIG9uVGljazogcyA9PiB7CiAgICAgICAgICB0aGlzLiRzZXQodGhpcywgJ2F1Y3Rpb25Db3VudGRvd24nLCBzKTsKICAgICAgICB9LAogICAgICAgIG9uRG9uZTogYXN5bmMgKCkgPT4gewogICAgICAgICAgaWYgKHRoaXMuaXNPd25lcikgewogICAgICAgICAgICBhd2FpdCB0aGlzLmF1dG9TdGFydEF1Y3Rpb24oKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGdldFJlZjogKCkgPT4gdGhpcy5hdWN0aW9uVGltZXIsCiAgICAgICAgc2V0UmVmOiBpZCA9PiB7CiAgICAgICAgICB0aGlzLmF1Y3Rpb25UaW1lciA9IGlkOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8g6Ieq5Yqo5byA5aeL5ouN5Y2WCiAgICBhc3luYyBhdXRvU3RhcnRBdWN0aW9uKCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnJvb21JZDsKICAgICAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7CiAgICAgICAgYXdhaXQgYXV0b1N0YXJ0QXVjdGlvbkZsb3coewogICAgICAgICAgcm9vbUlkOiByaWQsCiAgICAgICAgICBzdG9yZTogdGhpcy4kc3RvcmUsCiAgICAgICAgICBzdXBhYmFzZSwKICAgICAgICAgIGxvYWRBcnRpZmFjdHM6ICgpID0+IHRoaXMubG9hZEFydGlmYWN0cygpLAogICAgICAgICAgZGlzcGF0Y2hTdGFydEF1Y3Rpb246IGFydCA9PiB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnc3RhcnRBdWN0aW9uJywgYXJ0KSwKICAgICAgICAgIHN0YXJ0QXVjdGlvblRpbWVyOiBzZWMgPT4gdGhpcy5zdGFydEF1Y3Rpb25UaW1lcihzZWMpLAogICAgICAgICAgcm91bmRDb3VudDogdGhpcy5yb3VuZENvdW50LAogICAgICAgICAgdG90YWxSb3VuZHM6IHRoaXMudG90YWxSb3VuZHMsCiAgICAgICAgICBzZXRSb3VuZENvdW50OiBuID0+IHsKICAgICAgICAgICAgdGhpcy5yb3VuZENvdW50ID0gbjsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybignW2dhbWVdIGF1dG9TdGFydEF1Y3Rpb24gZmFpbGVkJywgZSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDlj5HpgIHogYrlpKnmtojmga8KICAgIGFzeW5jIHNlbmRNZXNzYWdlKCkgewogICAgICBpZiAoIXRoaXMubmV3TWVzc2FnZS50cmltKCkgfHwgIXRoaXMudXNlcikgcmV0dXJuOwogICAgICBjb25zdCBtZXNzYWdlID0gewogICAgICAgIGlkOiBEYXRlLm5vdygpLAogICAgICAgIHVzZXJJZDogdGhpcy51c2VyLmlkLAogICAgICAgIHVzZXJuYW1lOiB0aGlzLmdldE5hbWVGb3IodGhpcy51c2VyLmlkKSwKICAgICAgICBjb250ZW50OiB0aGlzLm5ld01lc3NhZ2UudHJpbSgpLAogICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKQogICAgICB9OwogICAgICAvLyDmnKzlnLDnq4vljbPmmL7npLrvvIzmj5DkvpvljbPml7blj43ppogKICAgICAgdGhpcy5jaGF0TWVzc2FnZXMucHVzaChtZXNzYWdlKTsKICAgICAgdGhpcy5uZXdNZXNzYWdlID0gJyc7CgogICAgICAvLyDmu5rliqjliLDlupXpg6gKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIGNvbnN0IGNoYXRDb250YWluZXIgPSB0aGlzLiRyZWZzLmNoYXRDb250YWluZXI7CiAgICAgICAgaWYgKGNoYXRDb250YWluZXIpIHsKICAgICAgICAgIGNoYXRDb250YWluZXIuc2Nyb2xsVG9wID0gY2hhdENvbnRhaW5lci5zY3JvbGxIZWlnaHQ7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIOWPkemAgeWIsOacjeWKoeWZqO+8jOW5v+aSree7meaJgOacieeOqeWutgogICAgICBjb25zdCByaWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS5yb29tSWQ7CiAgICAgIGlmIChyaWQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogICAgICAgICAgYXdhaXQgc2VuZENoYXRNZXNzYWdlKHsKICAgICAgICAgICAgc3VwYWJhc2UsCiAgICAgICAgICAgIHJvb21JZDogcmlkLAogICAgICAgICAgICBtZXNzYWdlCiAgICAgICAgICB9KTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ1tnYW1lXSBzZW5kTWVzc2FnZSBmYWlsZWQnLCBlKTsKICAgICAgICAgIC8vIOWPkemAgeWksei0peaXtu+8jOWPr+S7pemAieaLqeenu+mZpOacrOWcsOa2iOaBr+aIluS/neeVme+8iOS/neeVmeaPkOS+m+abtOWlveeahOeUqOaIt+S9k+mqjO+8iQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIOagvOW8j+WMlua2iOaBr+aXtumXtAogICAgZm9ybWF0TWVzc2FnZVRpbWUodGltZXN0YW1wKSB7CiAgICAgIHJldHVybiBmb3JtYXRNZXNzYWdlVGltZUhlbHBlcih0aW1lc3RhbXApOwogICAgfSwKICAgIC8vIOiuoeeul+acgOe7iOW+l+WIhuW5tuehruWumui1ouWutgogICAgYXN5bmMgY29tcHV0ZUZpbmFsU2NvcmVzKCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnJvb21JZDsKICAgICAgICBpZiAoIXJpZCkgcmV0dXJuOwogICAgICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBkYXRhOiByb3dzCiAgICAgICAgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Jvb21fYXJ0aWZhY3RzJykuc2VsZWN0KCdvd25lcl91c2VyX2lkLCBhcnRpZmFjdF9pZCcpLmVxKCdyb29tX2lkJywgcmlkKTsKICAgICAgICBjb25zdCB1c2VyVG9BcnRpZmFjdHMgPSB7fTsKICAgICAgICAocm93cyB8fCBbXSkuZm9yRWFjaChyID0+IHsKICAgICAgICAgIGlmICghdXNlclRvQXJ0aWZhY3RzW3Iub3duZXJfdXNlcl9pZF0pIHVzZXJUb0FydGlmYWN0c1tyLm93bmVyX3VzZXJfaWRdID0gW107CiAgICAgICAgICB1c2VyVG9BcnRpZmFjdHNbci5vd25lcl91c2VyX2lkXS5wdXNoKHIuYXJ0aWZhY3RfaWQpOwogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGNvbGxlY3Rpb25zID0gQXJyYXkuaXNBcnJheSh0aGlzLmNvbGxlY3Rpb25zKSA/IHRoaXMuY29sbGVjdGlvbnMgOiBbXTsKICAgICAgICBjb25zdCBzY29yZXMgPSBPYmplY3Qua2V5cyh1c2VyVG9BcnRpZmFjdHMpLm1hcCh1aWQgPT4gewogICAgICAgICAgY29uc3Qgb3duZWQgPSB1c2VyVG9BcnRpZmFjdHNbdWlkXTsKICAgICAgICAgIC8vIOaUtuiXj+mbhuWIhuaVsAogICAgICAgICAgbGV0IGNvbGxlY3Rpb25TY29yZSA9IDA7CiAgICAgICAgICBjb2xsZWN0aW9ucy5mb3JFYWNoKGNvbCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBnZXRDb2xsZWN0aW9uQ291bnRVdGlsKHsKICAgICAgICAgICAgICBhcnRpZmFjdE1hcDogdGhpcy5hcnRpZmFjdE1hcCwKICAgICAgICAgICAgICBvd25lZEFydGlmYWN0SWRzOiBvd25lZCwKICAgICAgICAgICAgICBjb2xsZWN0aW9uOiBjb2wKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChjdXJyZW50ID49IChjb2wucmVxdWlyZWRDb3VudCB8fCAxKSkgY29sbGVjdGlvblNjb3JlICs9IGNvbC5yZXdhcmRQb2ludHMgfHwgMDsKICAgICAgICAgIH0pOwogICAgICAgICAgLy8g6Zu25pWj5aWH54mp5YiG5pWw77yI5Z+656GA5Lu35YC85LiA5Y2K77yM5ZCR5LiL5Y+W5pW077yJCiAgICAgICAgICBsZXQgYXJ0aWZhY3RTY29yZSA9IDA7CiAgICAgICAgICBvd25lZC5mb3JFYWNoKGFpZCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLmFydGlmYWN0TWFwW2FpZF07CiAgICAgICAgICAgIGlmIChhICYmIHR5cGVvZiBhLmJhc2VWYWx1ZSA9PT0gJ251bWJlcicpIGFydGlmYWN0U2NvcmUgKz0gTWF0aC5mbG9vcihhLmJhc2VWYWx1ZSAvIDIpOwogICAgICAgICAgfSk7CiAgICAgICAgICBjb25zdCB0b3RhbCA9IGNvbGxlY3Rpb25TY29yZSArIGFydGlmYWN0U2NvcmU7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB1c2VySWQ6IHVpZCwKICAgICAgICAgICAgbmFtZTogdGhpcy5nZXROYW1lRm9yKHVpZCksCiAgICAgICAgICAgIGF2YXRhcjogdGhpcy5nZXRBdmF0YXJGb3IodWlkKSwKICAgICAgICAgICAgY29sbGVjdGlvblNjb3JlLAogICAgICAgICAgICBhcnRpZmFjdFNjb3JlLAogICAgICAgICAgICB0b3RhbAogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICBjb25zdCBzb3J0ZWQgPSBzY29yZXMuc29ydCgoYSwgYikgPT4gYi50b3RhbCAtIGEudG90YWwpOwogICAgICAgIHRoaXMuZmluYWxTY29yZXMgPSBzb3J0ZWQ7CiAgICAgICAgdGhpcy53aW5uZXJJbmZvID0gc29ydGVkWzBdIHx8IG51bGw7CiAgICAgICAgaWYgKHRoaXMud2lubmVySW5mbykgewogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdBRERfR0FNRV9MT0cnLCB7CiAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgbWVzc2FnZTogYOacrOWxgOe7k+adn++8jOiDnOiAhe+8miR7dGhpcy53aW5uZXJJbmZvLm5hbWV977yI5oC75YiGICR7dGhpcy53aW5uZXJJbmZvLnRvdGFsfe+8iWAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybignW2dhbWVdIGNvbXB1dGVGaW5hbFNjb3JlcyBmYWlsZWQnLCBlKTsKICAgICAgfQogICAgfSwKICAgIC8vIOW8gOWQry/lhbPpl63mlofnianorrLov7AKICAgIG9wZW5OYXJyYXRpb24oKSB7CiAgICAgIC8vIOaehOmAoOiusui/sOaWh+acrO+8jOWMheWQq+WfuuacrOS7i+e7jSArIOaVheS6iwogICAgICBjb25zdCBiYXNlID0gYCR7dGhpcy5zZWxlY3RlZENhcmQubmFtZX3vvIzmnaXoh6ogJHt0aGlzLnNlbGVjdGVkQ2FyZC5lcmF9JHt0aGlzLnNlbGVjdGVkQ2FyZC5sb2NhdGlvbiA/ICcgwrcgJyArIHRoaXMuc2VsZWN0ZWRDYXJkLmxvY2F0aW9uIDogJyd944CCXG5gOwogICAgICBjb25zdCBzdG9yeSA9ICh0aGlzLnNlbGVjdGVkQ2FyZC5zdG9yeSB8fCAnJykudHJpbSgpOwogICAgICBjb25zdCBmdWxsID0gYCR7YmFzZX0ke3N0b3J5fWAudHJpbSgpOwogICAgICAvLyDmiZPlrZfmnLrmlYjmnpwKICAgICAgdGhpcy50eXBpbmdUZXh0ID0gJyc7CiAgICAgIHRoaXMuc2hvd05hcnJhdGlvbiA9IHRydWU7CiAgICAgIGNvbnN0IHNwZWVkID0gZmlyc3RMb2dpbkRpYWxvZ3VlQ29uZmlnICYmIGZpcnN0TG9naW5EaWFsb2d1ZUNvbmZpZy5hbmltYXRpb25zICYmIGZpcnN0TG9naW5EaWFsb2d1ZUNvbmZpZy5hbmltYXRpb25zLnRleHRUeXBpbmdTcGVlZCB8fCAzMDsKICAgICAgaWYgKHRoaXMudHlwaW5nVGltZXIpIHsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMudHlwaW5nVGltZXIpOwogICAgICAgIHRoaXMudHlwaW5nVGltZXIgPSBudWxsOwogICAgICB9CiAgICAgIGxldCBpID0gMDsKICAgICAgdGhpcy50eXBpbmdUaW1lciA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICBpZiAoaSA+PSBmdWxsLmxlbmd0aCkgewogICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnR5cGluZ1RpbWVyKTsKICAgICAgICAgIHRoaXMudHlwaW5nVGltZXIgPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnR5cGluZ1RleHQgKz0gZnVsbFtpXTsKICAgICAgICAgIGkgKz0gMTsKICAgICAgICB9CiAgICAgIH0sIHNwZWVkKTsKICAgIH0sCiAgICBjbG9zZU5hcnJhdGlvbigpIHsKICAgICAgaWYgKHRoaXMudHlwaW5nVGltZXIpIHsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMudHlwaW5nVGltZXIpOwogICAgICAgIHRoaXMudHlwaW5nVGltZXIgPSBudWxsOwogICAgICB9CiAgICAgIHRoaXMuc2hvd05hcnJhdGlvbiA9IGZhbHNlOwogICAgICB0aGlzLnR5cGluZ1RleHQgPSAnJzsKICAgIH0KICB9Cn07"},{"version":3,"names":["mapState","mapGetters","AuctionPanel","ItemShop","roomService","getSupabase","auctionService","startCountdown","clearCountdown","loadRoomState","loadRoomStateService","subscribeRoomRealtime","subscribeRoomRealtimeService","unsubscribeRoomRealtime","unsubscribeRoomRealtimeService","startGame","startGameFlow","autoStartAuction","autoStartAuctionFlow","sendChatMessage","toggleReady","toggleReadyAction","moveToSeat","moveToSeatAction","leaveRoom","leaveRoomAction","loadArtifacts","loadArtifactsService","loadCollectionsFromArtifacts","getCurrentCollectionCount","getCollectionCountUtil","getCollectionProgress","getCollectionProgressUtil","formatMessageTime","formatMessageTimeHelper","getAvatarFor","getAvatarForHelper","getNameFor","getNameForHelper","firstLoginDialogue","firstLoginDialogueConfig","getCurrentLanguage","getCurrentLanguageImported","name","components","data","selectedCard","showHandPopup","handPlayer","artifactMap","room","profileMap","refreshTimer","collections","showGameEndDialog","finalScores","winnerInfo","auctionCountdown","auctionTimer","currentAuction","roundCount","totalRounds","chatMessages","newMessage","chatChannel","countdownInProgress","expandedCollections","showNarration","typingText","typingTimer","allPlayersArtifacts","computed","currentPlayer","$store","state","isOwner","user","owner_id","id","allReady","players","room_players","length","every","p","is_ready","currentUserReady","me","find","user_id","playerCount","ownerName","seatCount","Number","max_players","seats","max","Array","from","player","forEach","idx","seat_index","filter","emptyIdx","findIndex","s","gamePhaseText","phaseMap","gamePhase","collectionsComputed","list","isArray","map","col","current","progress","Math","min","requiredCount","_current","_progress","chatFeed","logs","gameLog","l","timestamp","type","userId","username","content","message","chats","m","merged","sort","a","b","firstLoginConfig","narrationCharacterName","narrationCharacter","key","chars","characters","image","position","color","mounted","roomId","$route","query","commit","initializeGame","beforeDestroy","clearInterval","$set","watch","$nextTick","chatContainer","$refs","scrollTop","scrollHeight","methods","artifacts","reduce","acc","loadCollections","rid","supabase","roomChannel","broadcastChannel","onLoadRoomState","onGameStarted","_payload","energy","items","seconds","onTick","onDone","getRef","setRef","onAuctionStarted","duration","payload","roundCurrent","roundTotal","startAuctionTimer","onBidUpdate","auctionId","highestBid","highestBidder","currentAuctions","next","onRoundUpdated","_data","onGameEnded","computeFinalScores","finally","onAuctionEnded","onChatMessage","existing","push","setInterval","store","setRoom","setProfileMap","setGamePhase","phase","clearAuctionTimer","setAuctionCountdown","n","onShowGameEnd","setTimeout","handleGameEnd","loadAllPlayersArtifacts","auctions","remaining","onAuctionTimeUp","allArtifacts","select","eq","playerArtifactsMap","row","owner_user_id","artifact_id","e","console","warn","uid","reload","targetSeat","index","setCountdown","unsubscribe","setRoomId","v","setLocalRoom","navigateToRooms","$router","update","status","path","gameEnded","_","setCurrentPlayerFromRoom","onCountdownDone","startAuction","picks","candidate","floor","random","art","dispatch","error","openShop","closeShop","showArtifactDetail","artifactId","artifact","era","location","story","collectionTags","baseValue","hideCardDetail","showArtifactDetailFromAuction","openNarration","getPlayerTotalValue","owned","playerArtifacts","Object","keys","total","aid","showPlayerHand","playerData","hideHand","collection","ownedArtifactIds","toggleCollection","closeGameEndDialog","stayInRoom","goToRooms","cur","tot","startIntermissionTimer","dispatchStartAuction","sec","setRoundCount","sendMessage","trim","Date","now","rows","userToArtifacts","r","scores","collectionScore","rewardPoints","artifactScore","avatar","sorted","base","full","speed","animations","textTypingSpeed","i","closeNarration"],"sources":["src/pages/index/index.vue"],"sourcesContent":["<template>\n  <div class=\"game-container\" :class=\"{ 'post-start': gamePhase !== 'preparation' }\">\n    <!-- 顶部状态栏：品牌/用户信息/导航控制（登录、个人中心、准备/开始/商店/退出） -->\n    <div class=\"top-auth-bar\">\n      <div class=\"left\">\n        <span class=\"brand\">时空旅人拍卖会</span>\n      </div>\n      <div class=\"right\" v-if=\"user\">\n        <span class=\"user-email\">{{ user.email }}</span>\n        <button class=\"nav-button\" @click=\"$router.push('/profile')\">个人中心</button>\n      </div>\n      <div class=\"right\" v-else>\n        <button class=\"nav-button primary\" @click=\"$router.push('/login')\">登录 / 注册</button>\n      </div>\n    </div>\n\n    <div class=\"game-status\">\n      <div class=\"room-info\">\n        <div class=\"room-name\">{{ room ? (room.name || '未命名房间') : '未加入房间' }}</div>\n        <div class=\"room-meta\" v-if=\"room\">玩家 {{ playerCount }}/{{ seatCount }} · 房主：{{ ownerName }}</div>\n        <div class=\"room-id-pill\">ID: {{ room ? (room.short_id || room.id) : '-' }}</div>\n      </div>\n      <span class=\"game-phase\">{{ gamePhaseText }}</span>\n       <div class=\"player-energy-hud\" v-if=\"currentPlayer && gamePhase === 'item'\">\n        <span class=\"icon\">⚡</span>\n        <span class=\"label\">能量</span>\n        <span class=\"value\">{{ $store.state.playerEnergy }}</span>\n      </div>\n      <div class=\"game-controls\">\n        <button class=\"control-button\" @click=\"toggleReady\" v-if=\"gamePhase === 'preparation'\">{{ currentUserReady ? '取消准备' : '准备' }}</button>\n        <button class=\"control-button\" @click=\"startGame\" v-if=\"gamePhase === 'preparation' && isOwner && allReady\">开始游戏</button>\n        <button class=\"control-button\" @click=\"startAuction\" v-if=\"false\">开始拍卖</button>\n        <button class=\"control-button\" @click=\"openShop\" v-if=\"gamePhase === 'item'\">道具商店</button>\n        <button class=\"control-button danger\" @click=\"leaveRoom\">退出房间</button>\n      </div>\n    </div>\n\n    <!-- 玩家头像区域：展示房间玩家，点击头像可查看该玩家手牌（当前仅展示自己的手牌明细） -->\n    <div class=\"players-avatars\" v-if=\"playerCount > 0 && gamePhase !== 'preparation'\">\n      <div class=\"avatar-item\" v-for=\"p in (room ? room.room_players : [])\" :key=\"p.user_id\" @click=\"showPlayerHand(p)\">\n        <div class=\"avatar-wrap\">\n          <img class=\"player-avatar\" :src=\"getAvatarFor(p.user_id)\" />\n          <span class=\"ready-indicator\" :class=\"{ on: !!p.is_ready }\"></span>\n        </div>\n        <div class=\"player-name\">{{ getNameFor(p.user_id) }}</div>\n        <div class=\"player-value\">价值 {{ getPlayerTotalValue(p.user_id) }}</div>\n      </div>\n    </div>\n\n    <!-- 拍卖舞台：在不同的 gamePhase 下显示倒计时/间歇/拍卖面板或占位提示 -->\n    <div class=\"auction-stage\" :class=\"{ 'align-left': gamePhase === 'auction' }\">\n      <!-- 预倒计时阶段（游戏开始后5s预热） -->\n      <template v-if=\"gamePhase === 'countdown'\">\n        <div class=\"countdown-stage\">\n          <div class=\"countdown-content\">\n            <div class=\"countdown-icon\">⏳</div>\n            <div class=\"countdown-title\">游戏即将开始</div>\n            <div class=\"countdown-timer\">{{ auctionCountdown }}s</div>\n            <div class=\"countdown-subtitle\">请稍候，拍卖即将开始...</div>\n          </div>\n        </div>\n      </template>\n            <!-- 间歇阶段（每轮结束后的休息时间） -->\n      <template v-else-if=\"gamePhase === 'intermission'\">\n        <div class=\"countdown-stage\">\n          <div class=\"countdown-content\">\n            <div class=\"countdown-icon\">🧭</div>\n            <div class=\"countdown-title\">间歇中</div>\n            <div class=\"countdown-timer\">{{ auctionCountdown }}s</div>\n            <div class=\"countdown-subtitle\">请稍候，下一轮拍卖即将开始...</div>\n          </div>\n        </div>\n      </template>\n      \n      <!-- 拍卖阶段：展示拍卖面板（当前拍品列表、轮次信息、点击卡片触发讲述） -->\n      <auction-panel \n        v-else-if=\"gamePhase === 'auction' && $store.state.currentAuctions && $store.state.currentAuctions.length\" \n        :auctions=\"$store.state.currentAuctions\" \n        :countdown=\"auctionCountdown\"\n        :round-current=\"$store.state.roundCurrent\"\n        :round-total=\"$store.state.roundTotal\"\n        @artifact-click=\"showArtifactDetailFromAuction\" \n      />\n      <!-- 其他情况显示占位提示 -->\n      <div v-else class=\"stage-placeholder\">拍卖会台空闲，等待新一轮拍卖</div>\n    </div>\n\n    <!-- 房间座位区（准备阶段）：点击空位入座，已入座玩家显示头像与准备标记 -->\n    <div class=\"seats\" v-if=\"seatCount > 0 && gamePhase === 'preparation'\" :style=\"{ gridTemplateColumns: 'repeat(' + seatCount + ', 1fr)' }\">\n      <div class=\"seat\" v-for=\"(seat, idx) in seats\" :key=\"idx\" :class=\"{ occupied: !!seat.player }\" @click=\"moveToSeat(idx)\">\n        <div class=\"seat-index\">{{ idx + 1 }}/{{ seatCount }}</div>\n        <div class=\"seat-body\">\n          <div v-if=\"seat.player\" class=\"seat-player\">\n            <div class=\"avatar-wrap\">\n              <img class=\"seat-avatar\" :src=\"getAvatarFor(seat.player.user_id)\" />\n              <span v-if=\"seat.player.is_ready\" class=\"ready-badge\">✓</span>\n            </div>\n            <div class=\"seat-name\">{{ getNameFor(seat.player.user_id) }}</div>\n          </div>\n          <div v-else class=\"seat-empty\">空位</div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 当前玩家手牌：展示自己已拥有的奇物，点击查看详情（或触发讲述） -->\n    <div class=\"my-hand\" v-if=\"gamePhase !== 'preparation'\">\n      <h3 class=\"hand-title\">我的手牌</h3>\n      <div class=\"hand-grid\">\n        <div\n          v-for=\"(aid, idx) in (currentPlayer ? currentPlayer.artifacts : [])\"\n          :key=\"aid + '-' + idx\"\n          class=\"hand-card fancy\"\n          @click=\"showArtifactDetail(aid)\"\n        >\n          <div class=\"hand-media\">\n            <img\n              class=\"hand-image\"\n              :src=\"artifactMap[aid] ? artifactMap[aid].image : 'https://via.placeholder.com/160x100?text=未知卡牌'\"\n            />\n            <div class=\"hand-overlay\"></div>\n          </div>\n          <div class=\"hand-info\">\n            <div class=\"hand-name\" :title=\"artifactMap[aid] ? artifactMap[aid].name : aid\">\n              {{ artifactMap[aid] ? artifactMap[aid].name : aid }}\n            </div>\n            <div class=\"hand-era\" v-if=\"artifactMap[aid] && (artifactMap[aid].era || artifactMap[aid].location)\">\n              {{ artifactMap[aid].era }}<span v-if=\"artifactMap[aid].location\"> · {{ artifactMap[aid].location }}</span>\n            </div>\n            <div class=\"hand-tags\" v-if=\"artifactMap[aid] && artifactMap[aid].collectionTags && artifactMap[aid].collectionTags.length\">\n              <span\n                class=\"hand-tag\"\n                v-for=\"tag in artifactMap[aid].collectionTags.slice(0,2)\"\n                :key=\"tag\"\n              >{{ tag }}</span>\n              <span class=\"hand-tag more\" v-if=\"artifactMap[aid].collectionTags.length > 2\">+{{ artifactMap[aid].collectionTags.length - 2 }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 收藏集进度：仅展示与自己已拥有奇物相关的收藏集，支持展开查看成员清单 -->\n    <div class=\"collections-panel\" v-if=\"gamePhase !== 'preparation'\">\n      <div class=\"collections-section\">\n        <h4 class=\"collections-title\">收藏集进度</h4>\n        <div class=\"collections-list\">\n          <div \n            v-for=\"collection in collectionsComputed\" \n            :key=\"collection.id\"\n            class=\"collection-progress-item\"\n            :class=\"{ completed: collection._current >= collection.requiredCount }\"\n          >\n            <div class=\"collection-header\" @click=\"toggleCollection(collection)\">\n              <div class=\"collection-icon\">🏆</div>\n              <div class=\"collection-info\">\n                <div class=\"collection-name\">{{ collection.name }}</div>\n                <div class=\"collection-description\">{{ collection.description }}</div>\n              </div>\n              <div class=\"collection-reward\" v-if=\"collection._current >= collection.requiredCount\">\n                <span class=\"reward-badge\">✓</span>\n              </div>\n            </div>\n            <!-- 展开展示该收藏集所需所有商品 -->\n            <div class=\"collection-members\" v-if=\"expandedCollections[collection.id]\">\n              <div class=\"member-item\" v-for=\"aid in (collection.artifactIds || [])\" :key=\"aid\">\n                <img class=\"member-image\" :src=\"artifactMap[aid] ? artifactMap[aid].image : 'https://via.placeholder.com/60x40?text=No+Img'\" />\n                <div class=\"member-info\">\n                  <div class=\"member-name\">{{ artifactMap[aid] ? artifactMap[aid].name : aid }}</div>\n                  <div class=\"member-meta\">{{ artifactMap[aid] && artifactMap[aid].era }}<span v-if=\"artifactMap[aid] && artifactMap[aid].location\"> · {{ artifactMap[aid].location }}</span></div>\n                </div>\n                <div class=\"member-status\" :class=\"{ owned: currentPlayer && currentPlayer.artifacts && currentPlayer.artifacts.includes(aid) }\">\n                  {{ currentPlayer && currentPlayer.artifacts && currentPlayer.artifacts.includes(aid) ? '已拥有' : '未拥有' }}\n                </div>\n              </div>\n            </div>\n            <div class=\"progress-container\">\n              <div class=\"progress-bar\">\n                <div \n                  class=\"progress-fill\"\n                  :style=\"{ width: collection._progress + '%' }\"\n                ></div>\n              </div>\n              <div class=\"progress-text\">\n                {{ collection._current }}/{{ collection.requiredCount }}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 聊天/日志面板：合并系统日志与聊天消息为统一时间序信息流 -->\n    <div class=\"chat-panel\" v-if=\"gamePhase !== 'preparation'\">\n      <div class=\"chat-header\">\n        <h4 class=\"chat-title\">聊天 / 日志</h4>\n        <div class=\"chat-status\">\n          <span class=\"status-dot\"></span>\n          <span class=\"status-text\">在线</span>\n        </div>\n      </div>\n      \n      <div class=\"chat-messages\" ref=\"chatContainer\">\n        <div \n          v-for=\"message in chatFeed\" \n          :key=\"message.id\"\n          class=\"chat-message\"\n          :class=\"{ 'own-message': message.type === 'chat' && message.userId === (user && user.id), 'system-log': message.type === 'log' }\"\n        >\n          <div class=\"message-header\">\n            <span class=\"message-username\">{{ message.type === 'log' ? '系统' : message.username }}</span>\n            <span class=\"message-time\">{{ formatMessageTime(message.timestamp) }}</span>\n          </div>\n          <div class=\"message-content\">{{ message.content }}</div>\n        </div>\n      </div>\n      \n      <div class=\"chat-input\">\n        <input \n          v-model=\"newMessage\"\n          @keyup.enter=\"sendMessage\"\n          placeholder=\"输入消息...\"\n          class=\"message-input\"\n        />\n        <button @click=\"sendMessage\" class=\"send-button\" :disabled=\"!newMessage.trim()\">\n          <span class=\"send-icon\">📤</span>\n        </button>\n      </div>\n    </div>\n\n    <!-- 卡牌详情弹窗：展示所选奇物的核心信息与标签 -->\n    <div v-if=\"showCardDetail\" class=\"card-detail-popup\">\n      <div class=\"popup-overlay\" @click=\"hideCardDetail\"></div>\n      <div class=\"popup-content\" v-if=\"selectedCard\">\n        <img \n          class=\"detail-image\" \n          :src=\"selectedCard.image\" \n          alt=\"奇物图片\"\n        />\n        <div class=\"detail-content\">\n          <h3 class=\"detail-name\">{{ selectedCard.name }}</h3>\n          <p class=\"detail-era\">{{ selectedCard.era }} - {{ selectedCard.location }}</p>\n          <p class=\"detail-story\">{{ selectedCard.story }}</p>\n          <div class=\"detail-tags\">\n            <span \n              v-for=\"tag in selectedCard.collectionTags\" \n              :key=\"tag\"\n              class=\"detail-tag\"\n            >\n              {{ tag }}\n            </span>\n          </div>\n          <p class=\"detail-value\">基础价值: {{ selectedCard.baseValue }}</p>\n            \n        </div>\n        <button class=\"close-button\" @click=\"hideCardDetail\">关闭</button>\n      </div>\n    </div>\n\n      <!-- 文物讲述弹层：以角色对白形式讲述 selectedCard 的关键信息 -->\n      <div v-if=\"showNarration && selectedCard\" class=\"narration-popup\">\n        <div class=\"popup-overlay\" @click=\"closeNarration\"></div>\n        <div class=\"popup-content narration-content\">\n          <!-- 顶部：文物大图与快速元信息，图片下方显示名称 -->\n          <div class=\"artifact-media\" v-if=\"selectedCard\">\n            <img class=\"artifact-image-large\" :src=\"selectedCard.image || 'https://via.placeholder.com/800x240?text=Artifact'\" alt=\"artifact\" />\n            <div class=\"artifact-quick-meta\">\n              <span class=\"badge era\" v-if=\"selectedCard.era\">{{ selectedCard.era }}</span>\n              <span class=\"badge location\" v-if=\"selectedCard.location\">{{ selectedCard.location }}</span>\n              <span class=\"badge value\" v-if=\"selectedCard.baseValue !== undefined\">价值 {{ selectedCard.baseValue }}</span>\n              <span class=\"badge tags\" v-if=\"(selectedCard.collectionTags || []).length\">{{ (selectedCard.collectionTags || []).slice(0,3).join('、') }}</span>\n            </div>\n          </div>\n          <div class=\"artifact-caption\" v-if=\"selectedCard && selectedCard.name\">{{ selectedCard.name }}</div>\n\n          <!-- 下方：人物与对白一行排列 -->\n          <div class=\"narration-dialog\">\n            <!-- 左侧：角色大图与姓名 -->\n            <div class=\"character-side\" :style=\"{ borderColor: narrationCharacter && narrationCharacter.color ? narrationCharacter.color : '#3b82f6' }\">\n              <img class=\"character-image\" :src=\"(narrationCharacter && narrationCharacter.image) || '/images/guide.png'\" />\n              <div class=\"character-name\" :style=\"{ color: narrationCharacter && narrationCharacter.color ? narrationCharacter.color : '#3b82f6' }\">\n                {{ narrationCharacterName }}\n              </div>\n            </div>\n            <!-- 右侧：对白气泡 -->\n            <div class=\"speech-side\">\n              <div class=\"speech-bubble\">\n                <div class=\"speech-text\">{{ typingText }}</div>\n              </div>\n              <div class=\"narration-actions\">\n                <button class=\"control-button primary\" @click=\"closeNarration\">好的</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    <!-- 道具商店弹窗：复用全局商店组件 <item-shop />，与 /shop 页面共用一套逻辑 -->\n    <div v-if=\"showShop\" class=\"shop-popup\">\n      <div class=\"popup-overlay\" @click=\"closeShop\"></div>\n      <div class=\"popup-content\">\n        <item-shop />\n        <button class=\"close-button\" @click=\"closeShop\">关闭商店</button>\n      </div>\n    </div>\n\n    <!-- 手牌弹窗：查看某位玩家的手牌缩略（当前仅展示当前玩家持有的真实列表） -->\n    <div v-if=\"showHandPopup\" class=\"hand-popup\">\n      <div class=\"popup-overlay\" @click=\"hideHand\"></div>\n      <div class=\"popup-content\">\n        <h3 class=\"hand-title\">{{ handPlayer ? handPlayer.name + ' 的手牌' : '手牌' }}</h3>\n        <div class=\"hand-grid\">\n          <div v-for=\"aid in (handPlayer ? handPlayer.artifacts : [])\" :key=\"aid\" class=\"hand-card\">\n            <img class=\"hand-image\" :src=\"artifactMap[aid] ? artifactMap[aid].image : 'https://via.placeholder.com/160x100?text=未知卡牌'\" />\n            <div class=\"hand-name\">{{ artifactMap[aid] ? artifactMap[aid].name : aid }}</div>\n          </div>\n        </div>\n        <button class=\"close-button\" @click=\"hideHand\">关闭</button>\n      </div>\n    </div>\n\n    <!-- 游戏结束对话框：展示最终排名与赢家信息，提供回房或去列表的导航 -->\n    <div v-if=\"showGameEndDialog\" class=\"game-end-popup\">\n      <div class=\"popup-overlay\" @click=\"closeGameEndDialog\"></div>\n      <div class=\"popup-content game-end-content\">\n        <div class=\"game-end-header\">\n          <div class=\"game-end-icon\">🏆</div>\n          <h2 class=\"game-end-title\">游戏结束</h2>\n          <p class=\"game-end-subtitle\" v-if=\"winnerInfo\">胜者：{{ winnerInfo.name }} · 总分 {{ winnerInfo.total }}</p>\n          <p class=\"game-end-subtitle\" v-else>感谢参与时空旅人拍卖会！</p>\n        </div>\n        <div class=\"final-scoreboard\" v-if=\"finalScores && finalScores.length\">\n          <div class=\"score-row\" v-for=\"(p, idx) in finalScores\" :key=\"p.userId\">\n            <div class=\"rank\">{{ idx + 1 }}</div>\n            <img class=\"score-avatar\" :src=\"p.avatar\" />\n            <div class=\"name\">{{ p.name }}</div>\n            <div class=\"detail\">收藏集 {{ p.collectionScore }} + 奇物 {{ p.artifactScore }} = <b>{{ p.total }}</b></div>\n          </div>\n        </div>\n        \n        <div class=\"game-end-actions\">\n          <button class=\"action-button primary\" @click=\"stayInRoom\">\n            <span class=\"btn-icon\">🏠</span>\n            留在房间\n          </button>\n          <button class=\"action-button secondary\" @click=\"goToRooms\">\n            <span class=\"btn-icon\">📋</span>\n            返回房间列表\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapGetters } from 'vuex'\nimport AuctionPanel from '../../components/auction-panel/auction-panel.vue'\nimport ItemShop from '../../components/item-shop/item-shop.vue'\nimport roomService from '../../services/room-service'\nimport { getSupabase } from '../../services/supabase-client'\nimport auctionService from '../../services/auction-service'\nimport { startCountdown, clearCountdown } from '../../features/game/countdown'\nimport { loadRoomState as loadRoomStateService } from '../../features/game/room-state.service'\nimport { subscribeRoomRealtime as subscribeRoomRealtimeService, unsubscribeRoomRealtime as unsubscribeRoomRealtimeService } from '../../features/game/room-realtime'\nimport { startGame as startGameFlow, autoStartAuction as autoStartAuctionFlow } from '../../features/game/auction-flow.service'\nimport { sendChatMessage } from '../../features/game/chat.service'\nimport { toggleReady as toggleReadyAction, moveToSeat as moveToSeatAction, leaveRoom as leaveRoomAction } from '../../features/game/room-actions.service'\nimport { loadArtifacts as loadArtifactsService } from '../../features/game/artifacts.service'\nimport { loadCollectionsFromArtifacts, getCurrentCollectionCount as getCollectionCountUtil, getCollectionProgress as getCollectionProgressUtil } from '../../features/game/collections.utils'\nimport { formatMessageTime as formatMessageTimeHelper, getAvatarFor as getAvatarForHelper, getNameFor as getNameForHelper } from '../../features/game/ui.helpers'\nimport { firstLoginDialogue as firstLoginDialogueConfig, getCurrentLanguage as getCurrentLanguageImported } from '../../config/dialogue-config'\nexport default {\n  name: 'GameIndex',\n  components: {\n    AuctionPanel,\n    ItemShop\n  },\n  data() {\n    return {\n      selectedCard: null,\n      showHandPopup: false,\n      handPlayer: null,\n      artifactMap: {},\n      room: null,\n      profileMap: {},\n      refreshTimer: null,\n      collections: [],\n      showGameEndDialog: false,\n      finalScores: [],\n      winnerInfo: null,\n      auctionCountdown: 0,\n      auctionTimer: null,\n      currentAuction: null,\n      // 回合相关（前端实时显示，房主每轮开拍时广播以保持同步）\n      roundCount: 0,\n      totalRounds: 6,\n      chatMessages: [],\n      newMessage: '',\n      chatChannel: null,\n      countdownInProgress: false,\n      expandedCollections: {},\n      showNarration: false,\n      typingText: '',\n      typingTimer: null,\n      // 存储所有玩家的手牌数据，用于价值计算\n      allPlayersArtifacts: {}\n    }\n  },\n  computed: {\n    ...mapState(['gamePhase', 'gameLog', 'showCardDetail', 'showShop', 'user', 'roomId', 'roundCurrent', 'roundTotal']),\n    // 将当前玩家注入到渲染上下文，避免模板引用报错\n    currentPlayer() { return this.$store.state.currentPlayer },\n    isOwner() { return this.room && this.user && this.room.owner_id === this.user.id },\n    allReady() {\n      const players = (this.room && this.room.room_players) ? this.room.room_players : []\n      return players.length > 0 && players.every(p => !!p.is_ready)\n    },\n    currentUserReady() {\n      const user = this.user\n      const players = (this.room && this.room.room_players) ? this.room.room_players : []\n      if (!user) return false\n      const me = players.find(p => p.user_id === user.id)\n      return !!(me && me.is_ready)\n    },\n    playerCount() {\n      return (this.room && this.room.room_players) ? this.room.room_players.length : 0\n    },\n    ownerName() {\n      if (!this.room) return '-'\n      return this.getNameFor(this.room.owner_id)\n    },\n    seatCount() { return (this.room && Number(this.room.max_players)) ? Number(this.room.max_players) : 0 },\n    seats() {\n      const players = (this.room && this.room.room_players) ? this.room.room_players : []\n      const max = this.seatCount\n      const seats = Array.from({ length: max }, () => ({ player: null }))\n      // 放置已设置座位的玩家\n      players.forEach(p => {\n        const idx = typeof p.seat_index === 'number' ? p.seat_index : -1\n        if (idx >= 0 && idx < max && !seats[idx].player) seats[idx].player = p\n      })\n      // 将未设置座位的玩家依次放到空位\n      players.filter(p => typeof p.seat_index !== 'number' || p.seat_index < 0).forEach(p => {\n        const emptyIdx = seats.findIndex(s => !s.player)\n        if (emptyIdx >= 0) seats[emptyIdx].player = p\n      })\n      return seats\n    },\n    gamePhaseText() {\n      const phaseMap = {\n        'preparation': '准备阶段',\n        'countdown': '预倒计时',\n        'intermission': '间歇阶段',\n        'auction': '拍卖阶段',\n        'item': '道具阶段',\n        'settlement': '结算阶段'\n      }\n      return phaseMap[this.gamePhase] || '未知阶段'\n    },\n   \n\n    // 根据当前用户手牌计算收藏集显示数据，带缓存字段，便于模板直接引用\n    collectionsComputed() {\n      const list = Array.isArray(this.collections) ? this.collections : []\n      // 仅展示用户手牌中至少包含1件该收藏集的情况\n      return list\n        .map(col => {\n          const current = this.getCurrentCollectionCount(col)\n          const progress = Math.min((current / (col.requiredCount || 1)) * 100, 100)\n          return { ...col, _current: current, _progress: progress }\n        })\n        .filter(col => col._current > 0)\n    },\n\n    // 合并聊天与系统日志为同一信息流，按时间排序\n    chatFeed() {\n      const logs = (this.gameLog || []).map((l, idx) => ({\n        id: `log-${l.timestamp || idx}`,\n        type: 'log',\n        userId: null,\n        username: '系统',\n        content: l.message,\n        timestamp: l.timestamp || 0\n      }))\n      const chats = (this.chatMessages || []).map(m => ({ ...m, type: 'chat' }))\n      const merged = [...logs, ...chats]\n      return merged.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0))\n    },\n    // 暴露对话配置供模板使用\n    firstLoginConfig() { return firstLoginDialogueConfig },\n    // 当前讲述角色配置与名称\n    narrationCharacterName() { return (this.getCurrentLanguage() === 'zh-CN') ? '大木博士' : 'Dr. Alina' },\n    narrationCharacter() {\n      const key = this.narrationCharacterName\n      const chars = firstLoginDialogueConfig && firstLoginDialogueConfig.characters\n      return (chars && chars[key]) ? chars[key] : { image: '/images/guide.png', position: 'right', color: '#3b82f6' }\n    }\n  },\n  async mounted() {\n    const roomId = this.$route.query.roomId\n    if (roomId) this.$store.commit('SET_ROOM_ID', roomId)\n    await this.initializeGame()\n    await this.loadRoomState()\n    // loadRoomState 中已经调用了 loadAllPlayersArtifacts，这里确保数据加载\n    await this.subscribeRoomRealtime()\n  },\n  beforeDestroy() {\n    this.unsubscribeRoomRealtime()\n    if (this.refreshTimer) { clearInterval(this.refreshTimer); this.refreshTimer = null }\n    if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null }\n    if (this.typingTimer) { clearInterval(this.typingTimer); this.typingTimer = null }\n    this.$set(this, 'auctionCountdown', 0)\n  },\n  watch: {\n    gameLog() {\n      this.$nextTick(() => {\n        const chatContainer = this.$refs.chatContainer\n        if (chatContainer) { chatContainer.scrollTop = chatContainer.scrollHeight }\n      })\n    }\n  },\n  methods: {\n    // 去掉模拟初始化玩家，改为使用房间的实际玩家列表\n    async initializeGame() {\n      const artifacts = await this.loadArtifacts()\n      this.artifactMap = artifacts.reduce((acc, a) => { acc[a.id] = a; return acc }, {})\n      await this.loadCollections()\n    },\n    async subscribeRoomRealtime() {\n      const rid = this.$store.state.roomId\n      if (!rid) return\n      const supabase = getSupabase()\n      const { roomChannel, broadcastChannel } = subscribeRoomRealtimeService(\n        { roomId: rid, supabase, onLoadRoomState: this.loadRoomState },\n        {\n          onGameStarted: async (_payload) => {\n            // 防止重复启动多个倒计时\n            if (this.countdownInProgress) return\n            this.countdownInProgress = true\n            \n            // 新局开始：重置聊天消息和价值数据\n            this.chatMessages = []\n            this.allPlayersArtifacts = {}\n            // 重置回合数\n            this.$store.commit('RESET_ROUND')\n            this.$store.commit('SET_ROUND_TOTAL', 6)\n            \n            this.$store.commit('SET_GAME_PHASE', 'countdown')\n            this.$set(this, 'auctionCountdown', 5)\n            const me = (this.room && this.room.room_players ? this.room.room_players : []).find(p => p.user_id === this.$store.state.user.id)\n            if (me) {\n              this.$store.commit('SET_CURRENT_PLAYER', { id: me.user_id, name: this.getNameFor(me.user_id), energy: 50, artifacts: [], items: [] })\n            }\n            if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null }\n            this.$nextTick(() => {\n              startCountdown({\n                seconds: 5,\n                onTick: (s) => { this.$set(this, 'auctionCountdown', s) },\n                onDone: async () => { this.countdownInProgress = false; if (this.isOwner) { await this.autoStartAuction() } },\n                getRef: () => this.auctionTimer,\n                setRef: (id) => { this.auctionTimer = id },\n              })\n            })\n          },\n          onAuctionStarted: async (duration, payload) => { \n            // 确保所有玩家都能看到拍卖数据\n            await this.loadRoomState()\n            \n            // 同步回合数（如果广播中包含了回合信息）\n            if (payload && typeof payload.roundCurrent === 'number') {\n              this.$store.commit('SET_ROUND_CURRENT', payload.roundCurrent)\n            }\n            if (payload && typeof payload.roundTotal === 'number') {\n              this.$store.commit('SET_ROUND_TOTAL', payload.roundTotal)\n            }\n            \n            this.startAuctionTimer(duration) \n          },\n          onBidUpdate: ({ auctionId, highestBid, highestBidder }) => {\n            if (!auctionId) return\n            const list = this.$store.state.currentAuctions || []\n            const idx = list.findIndex(a => a.id === auctionId)\n            if (idx >= 0) {\n              const next = { ...list[idx], highestBid, highestBidder }\n              this.$store.commit('ADD_OR_UPDATE_AUCTION', next)\n            }\n          },\n          // 旧回合广播已移除，统一本地推进，不再接收该事件\n          onRoundUpdated: (_data) => {},\n          onGameEnded: () => {\n            this.$store.commit('SET_GAME_PHASE', 'settlement')\n        this.computeFinalScores().finally(() => { this.showGameEndDialog = true })\n            if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null }\n          },\n          onAuctionEnded: async () => { await this.loadRoomState() },\n          onChatMessage: (message) => {\n            // 避免重复添加消息\n            if (!message || !message.id) return\n            const existing = this.chatMessages.find(m => m.id === message.id || (m.userId === message.userId && m.timestamp === message.timestamp && m.content === message.content))\n            if (existing) return\n            \n            this.chatMessages.push(message)\n            this.$nextTick(() => {\n              const chatContainer = this.$refs.chatContainer\n              if (chatContainer) { chatContainer.scrollTop = chatContainer.scrollHeight }\n            })\n          },\n        },\n        () => { if (!this.refreshTimer) { this.refreshTimer = setInterval(this.loadRoomState, 1000) } }\n      )\n      this.roomChannel = roomChannel\n      this.broadcastChannel = broadcastChannel\n    },\n    unsubscribeRoomRealtime() {\n      unsubscribeRoomRealtimeService(this.roomChannel, this.broadcastChannel)\n      this.roomChannel = null\n      this.broadcastChannel = null\n    },\n    async loadRoomState() {\n      const rid = this.$store.state.roomId\n      const supabase = getSupabase()\n      await loadRoomStateService({\n        roomId: rid,\n        roomService,\n        supabase,\n        artifactMap: this.artifactMap,\n        store: this.$store,\n        setRoom: (room) => { this.room = room },\n        setProfileMap: (map) => { this.profileMap = map },\n        setGamePhase: (phase) => { this.$store.commit('SET_GAME_PHASE', phase) },\n        clearAuctionTimer: () => { if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null } },\n        setAuctionCountdown: (n) => { this.$set(this, 'auctionCountdown', n) },\n        onShowGameEnd: () => { this.showGameEndDialog = true; setTimeout(() => { this.handleGameEnd() }, 3000) },\n      })\n      // 加载所有玩家的手牌数据，用于价值计算\n      await this.loadAllPlayersArtifacts()\n      // 如果刷新后发现仍有活跃拍卖，但本地无倒计时，则用当前剩余时间启动统一倒计时\n      const auctions = this.$store.state.currentAuctions || []\n      if (this.$store.state.gamePhase === 'auction' && auctions.length > 0) {\n        const remaining = Number(this.auctionCountdown || 0)\n        if (!this.auctionTimer && remaining > 0) {\n          startCountdown({\n            seconds: remaining,\n            onTick: (s) => { this.$set(this, 'auctionCountdown', s); },\n            onDone: async () => { await this.onAuctionTimeUp() },\n            getRef: () => this.auctionTimer,\n            setRef: (id) => { this.auctionTimer = id },\n          })\n        }\n      }\n    },\n    \n    // 加载所有玩家的手牌数据\n    async loadAllPlayersArtifacts() {\n      try {\n        const rid = this.$store.state.roomId\n        if (!rid) {\n          this.allPlayersArtifacts = {}\n          return\n        }\n        \n        const supabase = getSupabase()\n        // 获取房间内所有玩家的手牌数据\n        const { data: allArtifacts } = await supabase\n          .from('room_artifacts')\n          .select('owner_user_id, artifact_id')\n          .eq('room_id', rid)\n        \n        // 按玩家ID分组\n        const playerArtifactsMap = {}\n        if (allArtifacts && allArtifacts.length > 0) {\n          allArtifacts.forEach(row => {\n            const userId = row.owner_user_id\n            if (!playerArtifactsMap[userId]) {\n              playerArtifactsMap[userId] = []\n            }\n            playerArtifactsMap[userId].push(row.artifact_id)\n          })\n        }\n        \n        // 使用 Vue.set 确保响应式更新\n        this.$set(this, 'allPlayersArtifacts', playerArtifactsMap)\n      } catch (e) {\n        console.warn('[game] loadAllPlayersArtifacts failed', e)\n        this.allPlayersArtifacts = {}\n      }\n    },\n    async toggleReady() {\n      try {\n        const rid = this.$store.state.roomId\n        const uid = this.$store.state.user && this.$store.state.user.id\n        if (!rid || !uid) return\n        await toggleReadyAction({ roomId: rid, userId: uid, room: this.room, roomService, reload: this.loadRoomState })\n      } catch (e) { console.warn('[game] toggleReady failed', e) }\n    },\n    async moveToSeat(idx) {\n      try {\n        const rid = this.$store.state.roomId\n        const uid = this.$store.state.user && this.$store.state.user.id\n        if (!rid || !uid) return\n        const targetSeat = { index: idx, player: this.seats[idx] && this.seats[idx].player }\n        await moveToSeatAction({ roomId: rid, userId: uid, room: this.room, seats: targetSeat, roomService, reload: this.loadRoomState })\n      } catch (e) { console.warn('[game] moveToSeat failed', e) }\n    },\n    async leaveRoom() {\n      try {\n        const rid = this.$store.state.roomId\n        const uid = this.$store.state.user && this.$store.state.user.id\n        if (!rid || !uid) return\n        await leaveRoomAction({\n          roomId: rid,\n          userId: uid,\n          clearAuctionTimer: () => { if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null } },\n          setCountdown: (n) => { this.$set(this, 'auctionCountdown', n) },\n          store: this.$store,\n          auctionService,\n          roomService,\n          unsubscribe: () => this.unsubscribeRoomRealtime(),\n          setRoomId: (v) => this.$store.commit('SET_ROOM_ID', v),\n          setLocalRoom: (v) => { this.room = v },\n          navigateToRooms: () => this.$router.push('/rooms'),\n        })\n      } catch (e) { console.warn('[game] leaveRoom failed', e) }\n    },\n    \n    // 游戏结束处理\n    async handleGameEnd() {\n      try {\n        const rid = this.$store.state.roomId\n        if (rid) {\n          // 将房间状态重置为 waiting，便于继续房间内准备/新一局\n          const supabase = getSupabase()\n          await supabase.from('rooms').update({ status: 'waiting' }).eq('id', rid)\n          // 跳转回房间页面（游戏页携带 roomId 即是房间界面）\n          this.$router.push({ path: '/game', query: { roomId: rid, gameEnded: 'true' } })\n        } else {\n          this.$router.push('/rooms')\n        }\n      } catch (e) {\n        console.warn('[game] handleGameEnd failed', e)\n        // 兜底跳回房间列表\n        this.$router.push('/rooms')\n      }\n    },\n    async startGame() {\n      try {\n        const rid = this.$store.state.roomId\n        const uid = this.$store.state.user && this.$store.state.user.id\n        if (!rid || !uid || !this.isOwner || !this.allReady) return\n        // 新局开始前重置系统日志、聊天消息和价值数据\n        try { this.$store.commit('CLEAR_GAME_LOG') } catch (_) {}\n        this.chatMessages = []\n        this.allPlayersArtifacts = {}\n        await roomService.startGame(rid, uid)\n        const supabase = getSupabase()\n        this.roundCount = 0\n        await startGameFlow({\n          roomId: rid,\n          userId: uid,\n          isOwner: this.isOwner,\n          allReady: this.allReady,\n          store: this.$store,\n          supabase,\n          setCountdown: (n) => this.$set(this, 'auctionCountdown', n),\n          setCurrentPlayerFromRoom: () => {\n            const me = (this.room && this.room.room_players ? this.room.room_players : []).find(p => p.user_id === uid)\n            if (me) { this.$store.commit('SET_CURRENT_PLAYER', { id: me.user_id, name: this.getNameFor(me.user_id), energy: 50, artifacts: [], items: [] }) }\n          },\n          onCountdownDone: async () => {\n            if (this.isOwner) { await this.autoStartAuction() }\n          },\n        })\n        // 房主本地也启动预倒计时，防止广播不回传导致不触发 onGameStarted\n        if (!this.countdownInProgress) {\n          this.countdownInProgress = true\n          // 确保本地也重置数据\n          this.chatMessages = []\n          this.allPlayersArtifacts = {}\n          this.$store.commit('SET_GAME_PHASE', 'countdown')\n          this.$set(this, 'auctionCountdown', 5)\n          const me = (this.room && this.room.room_players ? this.room.room_players : []).find(p => p.user_id === uid)\n          if (me) {\n            this.$store.commit('SET_CURRENT_PLAYER', { id: me.user_id, name: this.getNameFor(me.user_id), energy: 50, artifacts: [], items: [] })\n          }\n          if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null }\n          this.$nextTick(() => {\n            startCountdown({\n              seconds: 5,\n              onTick: (s) => { this.$set(this, 'auctionCountdown', s) },\n              onDone: async () => { this.countdownInProgress = false; if (this.isOwner) { await this.autoStartAuction() } },\n              getRef: () => this.auctionTimer,\n              setRef: (id) => { this.auctionTimer = id },\n            })\n          })\n        }\n      } catch (e) { console.warn('[game] startGame failed', e) }\n    },\n    \n    async startAuction() {\n      // 同时抽取多件进行拍卖（示例为2件）\n      const artifacts = await this.loadArtifacts()\n      if (artifacts.length > 0) {\n        const picks = []\n        while (picks.length < Math.min(2, artifacts.length)) {\n          const candidate = artifacts[Math.floor(Math.random() * artifacts.length)]\n          if (!picks.find(p => p.id === candidate.id)) picks.push(candidate)\n        }\n        for (const art of picks) {\n          await this.$store.dispatch('startAuction', art)\n        }\n      }\n    },\n    \n    async loadArtifacts() {\n      try {\n        const supabase = getSupabase()\n        return await loadArtifactsService({ supabase })\n      } catch (error) { console.error('加载卡牌数据失败:', error); return [] }\n    },\n    \n    openShop() {\n      this.$store.commit('SET_SHOW_SHOP', true)\n    },\n    \n    closeShop() {\n      this.$store.commit('SET_SHOW_SHOP', false)\n    },\n    \n    showArtifactDetail(artifactId) {\n      // 若已加载artifactMap，则优先展示真实数据\n      const artifact = this.artifactMap[artifactId]\n      if (artifact) {\n        this.selectedCard = artifact\n      } else {\n        // 回退：维持原示例\n        this.selectedCard = {\n          id: artifactId,\n          name: '示例奇物',\n          era: '古代',\n          location: '未知',\n          story: '这是一个神秘的奇物...',\n          collectionTags: ['艺术瑰宝'],\n          baseValue: 8,\n          image: 'https://via.placeholder.com/300x200?text=示例奇物'\n        }\n      }\n      this.$store.commit('SET_SHOW_CARD_DETAIL', true)\n    },\n    \n    hideCardDetail() {\n      this.$store.commit('SET_SHOW_CARD_DETAIL', false)\n      this.selectedCard = null\n    },\n    showArtifactDetailFromAuction(artifact) {\n      this.selectedCard = artifact\n      this.$store.commit('SET_SHOW_CARD_DETAIL', false)\n      this.openNarration()\n    },\n    // 计算玩家总价值（支持所有玩家）\n    getPlayerTotalValue(userId) {\n      if (!userId) return 0\n      \n      // 优先从 allPlayersArtifacts 获取所有玩家的手牌数据\n      let owned = []\n      if (this.allPlayersArtifacts && this.allPlayersArtifacts[userId]) {\n        owned = Array.isArray(this.allPlayersArtifacts[userId]) ? this.allPlayersArtifacts[userId] : []\n      } else {\n        // 回退：如果 allPlayersArtifacts 中没有，尝试从当前玩家数据获取\n        const current = this.$store.state.currentPlayer\n        if (current && current.id === userId) {\n          owned = Array.isArray(this.$store.state.playerArtifacts) ? this.$store.state.playerArtifacts : []\n        }\n      }\n      \n      if (!owned || owned.length === 0) return 0\n      \n      // 确保 artifactMap 已加载\n      if (!this.artifactMap || Object.keys(this.artifactMap).length === 0) return 0\n      \n      let total = 0\n      owned.forEach(aid => {\n        const a = this.artifactMap[aid]\n        if (a && typeof a.baseValue === 'number') {\n          total += a.baseValue\n        }\n      })\n      return total\n    },\n\n    showPlayerHand(player) {\n      // 构造玩家对象，包含手牌信息\n      const playerData = {\n        id: player.user_id,\n        name: this.getNameFor(player.user_id),\n        artifacts: this.currentPlayer && this.currentPlayer.id === player.user_id ? \n          (this.currentPlayer.artifacts || []) : []\n      }\n      this.handPlayer = playerData\n      this.showHandPopup = true\n    },\n\n    hideHand() {\n      this.handPlayer = null\n      this.showHandPopup = false\n    },\n    \n    \n    getAvatarFor(userId) { return getAvatarForHelper({ profileMap: this.profileMap, userId }) },\n    getNameFor(userId) { return getNameForHelper({ profileMap: this.profileMap, room: this.room, userId }) },\n    getCurrentLanguage() { return getCurrentLanguageImported() },\n    \n    // 加载收藏集数据：基于数据库 artifacts 的 collection_tags 动态生成\n    async loadCollections() {\n      try { this.collections = loadCollectionsFromArtifacts(this.artifactMap) }\n      catch (error) { console.error('加载收藏集数据失败:', error); this.collections = [] }\n    },\n    \n   \n    \n    // 获取当前收藏集数量（基于当前用户手牌，且受最大要求数上限限制）\n    getCurrentCollectionCount(collection) {\n      const owned = (this.currentPlayer && this.currentPlayer.artifacts) ? this.currentPlayer.artifacts : []\n      return getCollectionCountUtil({ artifactMap: this.artifactMap, ownedArtifactIds: owned, collection })\n    },\n\n\n    // 展开/收起收藏集\n    toggleCollection(collection) {\n      const id = collection && collection.id\n      if (!id) return\n      this.$set(this.expandedCollections, id, !this.expandedCollections[id])\n    },\n    \n    // 关闭游戏结束对话框\n    closeGameEndDialog() {\n      this.showGameEndDialog = false\n    },\n    \n    // 留在房间\n    stayInRoom() {\n      this.showGameEndDialog = false\n      try { this.$store.commit('CLEAR_GAME_LOG') } catch (_) {}\n      // 返回当前房间准备界面\n      const rid = this.$store.state.roomId\n      if (rid) {\n        this.$store.commit('SET_GAME_PHASE', 'preparation')\n        this.$router.push({ path: '/game', query: { roomId: rid } })\n      }\n    },\n    \n    // 返回房间列表\n    goToRooms() {\n      this.showGameEndDialog = false\n      this.unsubscribeRoomRealtime()\n      try { this.$store.commit('CLEAR_GAME_LOG') } catch (_) {}\n      // 返回当前房间准备界面（更符合期望）\n      const rid = this.$store.state.roomId\n      if (rid) {\n        this.$store.commit('SET_GAME_PHASE', 'preparation')\n        this.$router.push({ path: '/game', query: { roomId: rid } })\n      } else {\n        this.$router.push('/rooms')\n      }\n    },\n    \n    // 时间到：结束当前所有拍卖并结算到对应玩家手牌，然后进入10s间歇或结束游戏\n    async onAuctionTimeUp() {\n      try {\n        const auctions = this.$store.state.currentAuctions || []\n        // 统一倒计时结束：结束所有当前拍卖\n        for (const a of auctions) {\n          await this.$store.dispatch('endAuction', a.id)\n        }\n        // 判断是否达到总回合数\n        const cur = Number(this.$store.state.roundCurrent || 0)\n        const tot = Number(this.$store.state.roundTotal || 6)\n        if (cur >= tot) {\n          // 触发结束\n          this.$store.commit('SET_GAME_PHASE', 'settlement')\n          await this.computeFinalScores()\n          this.showGameEndDialog = true\n          return\n        }\n        // 否则进入10s间歇阶段\n        this.startIntermissionTimer(10)\n      } catch (e) { console.warn('[game] onAuctionTimeUp failed', e) }\n    },\n\n    // 开始拍卖倒计时：统一每轮拍卖只有一个倒计时\n    startAuctionTimer(duration = 30) {\n      this.$store.commit('SET_GAME_PHASE', 'auction')\n      startCountdown({\n        seconds: duration,\n        onTick: (s) => { this.$set(this, 'auctionCountdown', s); },\n        onDone: async () => { await this.onAuctionTimeUp() },\n        getRef: () => this.auctionTimer,\n        setRef: (id) => { this.auctionTimer = id },\n      })\n    },\n\n\n    \n    // 每轮之间的间歇计时器，结束后自动开始下一轮拍卖\n    startIntermissionTimer(duration = 10) {\n      this.$store.commit('SET_GAME_PHASE', 'intermission')\n      startCountdown({\n        seconds: duration,\n        onTick: (s) => { this.$set(this, 'auctionCountdown', s); },\n        onDone: async () => {\n          if (this.isOwner) {\n            await this.autoStartAuction()\n          }\n        },\n        getRef: () => this.auctionTimer,\n        setRef: (id) => { this.auctionTimer = id },\n      })\n    },\n    \n    // 自动开始拍卖\n    async autoStartAuction() {\n      try {\n        const rid = this.$store.state.roomId\n        const supabase = getSupabase()\n        await autoStartAuctionFlow({\n          roomId: rid,\n          store: this.$store,\n          supabase,\n          loadArtifacts: () => this.loadArtifacts(),\n          dispatchStartAuction: (art) => this.$store.dispatch('startAuction', art),\n          startAuctionTimer: (sec) => this.startAuctionTimer(sec),\n          roundCount: this.roundCount,\n          totalRounds: this.totalRounds,\n          setRoundCount: (n) => { this.roundCount = n },\n        })\n      } catch (e) { console.warn('[game] autoStartAuction failed', e) }\n    },\n    \n    // 发送聊天消息\n    async sendMessage() {\n      if (!this.newMessage.trim() || !this.user) return\n      const message = { \n        id: Date.now(), \n        userId: this.user.id, \n        username: this.getNameFor(this.user.id), \n        content: this.newMessage.trim(), \n        timestamp: Date.now() \n      }\n      // 本地立即显示，提供即时反馈\n      this.chatMessages.push(message)\n      this.newMessage = ''\n      \n      // 滚动到底部\n      this.$nextTick(() => {\n        const chatContainer = this.$refs.chatContainer\n        if (chatContainer) { chatContainer.scrollTop = chatContainer.scrollHeight }\n      })\n      \n      // 发送到服务器，广播给所有玩家\n      const rid = this.$store.state.roomId\n      if (rid) { \n        try { \n          const supabase = getSupabase()\n          await sendChatMessage({ supabase, roomId: rid, message }) \n        } catch (e) { \n          console.warn('[game] sendMessage failed', e)\n          // 发送失败时，可以选择移除本地消息或保留（保留提供更好的用户体验）\n        } \n      }\n    },\n    \n    // 格式化消息时间\n    formatMessageTime(timestamp) { return formatMessageTimeHelper(timestamp) }\n    ,\n\n    // 计算最终得分并确定赢家\n    async computeFinalScores() {\n      try {\n        const rid = this.$store.state.roomId\n        if (!rid) return\n        const supabase = getSupabase()\n        const { data: rows } = await supabase\n          .from('room_artifacts')\n          .select('owner_user_id, artifact_id')\n          .eq('room_id', rid)\n        const userToArtifacts = {}\n        ;(rows || []).forEach(r => {\n          if (!userToArtifacts[r.owner_user_id]) userToArtifacts[r.owner_user_id] = []\n          userToArtifacts[r.owner_user_id].push(r.artifact_id)\n        })\n\n        const collections = Array.isArray(this.collections) ? this.collections : []\n        const scores = Object.keys(userToArtifacts).map(uid => {\n          const owned = userToArtifacts[uid]\n          // 收藏集分数\n          let collectionScore = 0\n          collections.forEach(col => {\n            const current = getCollectionCountUtil({ artifactMap: this.artifactMap, ownedArtifactIds: owned, collection: col })\n            if (current >= (col.requiredCount || 1)) collectionScore += (col.rewardPoints || 0)\n          })\n          // 零散奇物分数（基础价值一半，向下取整）\n          let artifactScore = 0\n          owned.forEach(aid => {\n            const a = this.artifactMap[aid]\n            if (a && typeof a.baseValue === 'number') artifactScore += Math.floor(a.baseValue / 2)\n          })\n        \n          const total = collectionScore + artifactScore\n          return {\n            userId: uid,\n            name: this.getNameFor(uid),\n            avatar: this.getAvatarFor(uid),\n            collectionScore,\n            artifactScore,\n            total\n          }\n        })\n\n        const sorted = scores.sort((a, b) => b.total - a.total)\n        this.finalScores = sorted\n        this.winnerInfo = sorted[0] || null\n\n        if (this.winnerInfo) {\n          this.$store.commit('ADD_GAME_LOG', { timestamp: Date.now(), message: `本局结束，胜者：${this.winnerInfo.name}（总分 ${this.winnerInfo.total}）` })\n        }\n      } catch (e) { console.warn('[game] computeFinalScores failed', e) }\n    },\n\n    // 开启/关闭文物讲述\n    openNarration() {\n      // 构造讲述文本，包含基本介绍 + 故事\n      const base = `${this.selectedCard.name}，来自 ${this.selectedCard.era}${this.selectedCard.location ? ' · ' + this.selectedCard.location : ''}。\\n`\n      const story = (this.selectedCard.story || '').trim()\n      const full = `${base}${story}`.trim()\n      // 打字机效果\n      this.typingText = ''\n      this.showNarration = true\n      const speed = (firstLoginDialogueConfig && firstLoginDialogueConfig.animations && firstLoginDialogueConfig.animations.textTypingSpeed) || 30\n      if (this.typingTimer) { clearInterval(this.typingTimer); this.typingTimer = null }\n      let i = 0\n      this.typingTimer = setInterval(() => {\n        if (i >= full.length) {\n          clearInterval(this.typingTimer)\n          this.typingTimer = null\n        } else {\n          this.typingText += full[i]\n          i += 1\n        }\n      }, speed)\n    },\n    closeNarration() {\n      if (this.typingTimer) { clearInterval(this.typingTimer); this.typingTimer = null }\n      this.showNarration = false\n      this.typingText = ''\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped src=\"./index.scss\"></style>"],"mappings":"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","ignoreList":[]}]}