{"remainingRequest":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js!D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\pages\\index\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\pages\\index\\index.vue","mtime":1762820278876},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762215254891},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\babel-loader\\lib\\index.js","mtime":1762215256120},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762215254891},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\vue-loader\\lib\\index.js","mtime":1762215256637}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgbWFwU3RhdGUsIG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IEF1Y3Rpb25QYW5lbCBmcm9tICcuLi8uLi9jb21wb25lbnRzL2F1Y3Rpb24tcGFuZWwvYXVjdGlvbi1wYW5lbC52dWUnOwppbXBvcnQgcm9vbVNlcnZpY2UgZnJvbSAnLi4vLi4vc2VydmljZXMvcm9vbS1zZXJ2aWNlJzsKaW1wb3J0IHsgZ2V0U3VwYWJhc2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zdXBhYmFzZS1jbGllbnQnOwppbXBvcnQgYXVjdGlvblNlcnZpY2UgZnJvbSAnLi4vLi4vc2VydmljZXMvYXVjdGlvbi1zZXJ2aWNlJzsKaW1wb3J0IHsgc3RhcnRDb3VudGRvd24sIGNsZWFyQ291bnRkb3duIH0gZnJvbSAnLi4vLi4vZmVhdHVyZXMvZ2FtZS9jb3VudGRvd24nOwppbXBvcnQgeyBsb2FkUm9vbVN0YXRlIGFzIGxvYWRSb29tU3RhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vZmVhdHVyZXMvZ2FtZS9yb29tLXN0YXRlLnNlcnZpY2UnOwppbXBvcnQgeyBzdWJzY3JpYmVSb29tUmVhbHRpbWUgYXMgc3Vic2NyaWJlUm9vbVJlYWx0aW1lU2VydmljZSwgdW5zdWJzY3JpYmVSb29tUmVhbHRpbWUgYXMgdW5zdWJzY3JpYmVSb29tUmVhbHRpbWVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vZmVhdHVyZXMvZ2FtZS9yb29tLXJlYWx0aW1lJzsKaW1wb3J0IHsgc3RhcnRHYW1lIGFzIHN0YXJ0R2FtZUZsb3csIGF1dG9TdGFydEF1Y3Rpb24gYXMgYXV0b1N0YXJ0QXVjdGlvbkZsb3cgfSBmcm9tICcuLi8uLi9mZWF0dXJlcy9nYW1lL2F1Y3Rpb24tZmxvdy5zZXJ2aWNlJzsKaW1wb3J0IHsgc2VuZENoYXRNZXNzYWdlIH0gZnJvbSAnLi4vLi4vZmVhdHVyZXMvZ2FtZS9jaGF0LnNlcnZpY2UnOwppbXBvcnQgeyB0b2dnbGVSZWFkeSBhcyB0b2dnbGVSZWFkeUFjdGlvbiwgbW92ZVRvU2VhdCBhcyBtb3ZlVG9TZWF0QWN0aW9uLCBsZWF2ZVJvb20gYXMgbGVhdmVSb29tQWN0aW9uIH0gZnJvbSAnLi4vLi4vZmVhdHVyZXMvZ2FtZS9yb29tLWFjdGlvbnMuc2VydmljZSc7CmltcG9ydCB7IGxvYWRBcnRpZmFjdHMgYXMgbG9hZEFydGlmYWN0c1NlcnZpY2UgfSBmcm9tICcuLi8uLi9mZWF0dXJlcy9nYW1lL2FydGlmYWN0cy5zZXJ2aWNlJzsKaW1wb3J0IHsgbG9hZENvbGxlY3Rpb25zRnJvbUFydGlmYWN0cywgZ2V0Q3VycmVudENvbGxlY3Rpb25Db3VudCBhcyBnZXRDb2xsZWN0aW9uQ291bnRVdGlsLCBnZXRDb2xsZWN0aW9uUHJvZ3Jlc3MgYXMgZ2V0Q29sbGVjdGlvblByb2dyZXNzVXRpbCB9IGZyb20gJy4uLy4uL2ZlYXR1cmVzL2dhbWUvY29sbGVjdGlvbnMudXRpbHMnOwppbXBvcnQgeyBmb3JtYXRNZXNzYWdlVGltZSBhcyBmb3JtYXRNZXNzYWdlVGltZUhlbHBlciwgZ2V0QXZhdGFyRm9yIGFzIGdldEF2YXRhckZvckhlbHBlciwgZ2V0TmFtZUZvciBhcyBnZXROYW1lRm9ySGVscGVyIH0gZnJvbSAnLi4vLi4vZmVhdHVyZXMvZ2FtZS91aS5oZWxwZXJzJzsKaW1wb3J0IHsgZmlyc3RMb2dpbkRpYWxvZ3VlIGFzIGZpcnN0TG9naW5EaWFsb2d1ZUNvbmZpZywgZ2V0Q3VycmVudExhbmd1YWdlIGFzIGdldEN1cnJlbnRMYW5ndWFnZUltcG9ydGVkIH0gZnJvbSAnLi4vLi4vY29uZmlnL2RpYWxvZ3VlLWNvbmZpZyc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnR2FtZUluZGV4JywKICBjb21wb25lbnRzOiB7CiAgICBBdWN0aW9uUGFuZWwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzZWxlY3RlZENhcmQ6IG51bGwsCiAgICAgIHNob3dIYW5kUG9wdXA6IGZhbHNlLAogICAgICBoYW5kUGxheWVyOiBudWxsLAogICAgICBhcnRpZmFjdE1hcDoge30sCiAgICAgIHJvb206IG51bGwsCiAgICAgIHByb2ZpbGVNYXA6IHt9LAogICAgICByZWZyZXNoVGltZXI6IG51bGwsCiAgICAgIGNvbGxlY3Rpb25zOiBbXSwKICAgICAgc2hvd0dhbWVFbmREaWFsb2c6IGZhbHNlLAogICAgICBmaW5hbFNjb3JlczogW10sCiAgICAgIHdpbm5lckluZm86IG51bGwsCiAgICAgIGF1Y3Rpb25Db3VudGRvd246IDAsCiAgICAgIGF1Y3Rpb25UaW1lcjogbnVsbCwKICAgICAgY3VycmVudEF1Y3Rpb246IG51bGwsCiAgICAgIC8vIOWbnuWQiOebuOWFs++8iOWJjeerr+WunuaXtuaYvuekuu+8jOaIv+S4u+avj+i9ruW8gOaLjeaXtuW5v+aSreS7peS/neaMgeWQjOatpe+8iQogICAgICByb3VuZENvdW50OiAwLAogICAgICB0b3RhbFJvdW5kczogNiwKICAgICAgY2hhdE1lc3NhZ2VzOiBbXSwKICAgICAgbmV3TWVzc2FnZTogJycsCiAgICAgIGNoYXRDaGFubmVsOiBudWxsLAogICAgICBjb3VudGRvd25JblByb2dyZXNzOiBmYWxzZSwKICAgICAgZXhwYW5kZWRDb2xsZWN0aW9uczoge30sCiAgICAgIHNob3dOYXJyYXRpb246IGZhbHNlLAogICAgICB0eXBpbmdUZXh0OiAnJywKICAgICAgdHlwaW5nVGltZXI6IG51bGwsCiAgICAgIC8vIOWtmOWCqOaJgOacieeOqeWutueahOaJi+eJjOaVsOaNru+8jOeUqOS6juS7t+WAvOiuoeeulwogICAgICBhbGxQbGF5ZXJzQXJ0aWZhY3RzOiB7fQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBTdGF0ZShbJ2dhbWVQaGFzZScsICdnYW1lTG9nJywgJ3Nob3dDYXJkRGV0YWlsJywgJ3VzZXInLCAncm9vbUlkJywgJ3JvdW5kQ3VycmVudCcsICdyb3VuZFRvdGFsJ10pLAogICAgLy8g5bCG5b2T5YmN546p5a625rOo5YWl5Yiw5riy5p+T5LiK5LiL5paH77yM6YG/5YWN5qih5p2/5byV55So5oql6ZSZCiAgICBjdXJyZW50UGxheWVyKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUuY3VycmVudFBsYXllcjsKICAgIH0sCiAgICBpc093bmVyKCkgewogICAgICByZXR1cm4gdGhpcy5yb29tICYmIHRoaXMudXNlciAmJiB0aGlzLnJvb20ub3duZXJfaWQgPT09IHRoaXMudXNlci5pZDsKICAgIH0sCiAgICBhbGxSZWFkeSgpIHsKICAgICAgY29uc3QgcGxheWVycyA9IHRoaXMucm9vbSAmJiB0aGlzLnJvb20ucm9vbV9wbGF5ZXJzID8gdGhpcy5yb29tLnJvb21fcGxheWVycyA6IFtdOwogICAgICByZXR1cm4gcGxheWVycy5sZW5ndGggPiAwICYmIHBsYXllcnMuZXZlcnkocCA9PiAhIXAuaXNfcmVhZHkpOwogICAgfSwKICAgIGN1cnJlbnRVc2VyUmVhZHkoKSB7CiAgICAgIGNvbnN0IHVzZXIgPSB0aGlzLnVzZXI7CiAgICAgIGNvbnN0IHBsYXllcnMgPSB0aGlzLnJvb20gJiYgdGhpcy5yb29tLnJvb21fcGxheWVycyA/IHRoaXMucm9vbS5yb29tX3BsYXllcnMgOiBbXTsKICAgICAgaWYgKCF1c2VyKSByZXR1cm4gZmFsc2U7CiAgICAgIGNvbnN0IG1lID0gcGxheWVycy5maW5kKHAgPT4gcC51c2VyX2lkID09PSB1c2VyLmlkKTsKICAgICAgcmV0dXJuICEhKG1lICYmIG1lLmlzX3JlYWR5KTsKICAgIH0sCiAgICBwbGF5ZXJDb3VudCgpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbSAmJiB0aGlzLnJvb20ucm9vbV9wbGF5ZXJzID8gdGhpcy5yb29tLnJvb21fcGxheWVycy5sZW5ndGggOiAwOwogICAgfSwKICAgIG93bmVyTmFtZSgpIHsKICAgICAgaWYgKCF0aGlzLnJvb20pIHJldHVybiAnLSc7CiAgICAgIHJldHVybiB0aGlzLmdldE5hbWVGb3IodGhpcy5yb29tLm93bmVyX2lkKTsKICAgIH0sCiAgICBzZWF0Q291bnQoKSB7CiAgICAgIHJldHVybiB0aGlzLnJvb20gJiYgTnVtYmVyKHRoaXMucm9vbS5tYXhfcGxheWVycykgPyBOdW1iZXIodGhpcy5yb29tLm1heF9wbGF5ZXJzKSA6IDA7CiAgICB9LAogICAgc2VhdHMoKSB7CiAgICAgIGNvbnN0IHBsYXllcnMgPSB0aGlzLnJvb20gJiYgdGhpcy5yb29tLnJvb21fcGxheWVycyA/IHRoaXMucm9vbS5yb29tX3BsYXllcnMgOiBbXTsKICAgICAgY29uc3QgbWF4ID0gdGhpcy5zZWF0Q291bnQ7CiAgICAgIGNvbnN0IHNlYXRzID0gQXJyYXkuZnJvbSh7CiAgICAgICAgbGVuZ3RoOiBtYXgKICAgICAgfSwgKCkgPT4gKHsKICAgICAgICBwbGF5ZXI6IG51bGwKICAgICAgfSkpOwogICAgICAvLyDmlL7nva7lt7Lorr7nva7luqfkvY3nmoTnjqnlrrYKICAgICAgcGxheWVycy5mb3JFYWNoKHAgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IHR5cGVvZiBwLnNlYXRfaW5kZXggPT09ICdudW1iZXInID8gcC5zZWF0X2luZGV4IDogLTE7CiAgICAgICAgaWYgKGlkeCA+PSAwICYmIGlkeCA8IG1heCAmJiAhc2VhdHNbaWR4XS5wbGF5ZXIpIHNlYXRzW2lkeF0ucGxheWVyID0gcDsKICAgICAgfSk7CiAgICAgIC8vIOWwhuacquiuvue9ruW6p+S9jeeahOeOqeWutuS+neasoeaUvuWIsOepuuS9jQogICAgICBwbGF5ZXJzLmZpbHRlcihwID0+IHR5cGVvZiBwLnNlYXRfaW5kZXggIT09ICdudW1iZXInIHx8IHAuc2VhdF9pbmRleCA8IDApLmZvckVhY2gocCA9PiB7CiAgICAgICAgY29uc3QgZW1wdHlJZHggPSBzZWF0cy5maW5kSW5kZXgocyA9PiAhcy5wbGF5ZXIpOwogICAgICAgIGlmIChlbXB0eUlkeCA+PSAwKSBzZWF0c1tlbXB0eUlkeF0ucGxheWVyID0gcDsKICAgICAgfSk7CiAgICAgIHJldHVybiBzZWF0czsKICAgIH0sCiAgICBnYW1lUGhhc2VUZXh0KCkgewogICAgICBjb25zdCBwaGFzZU1hcCA9IHsKICAgICAgICAncHJlcGFyYXRpb24nOiAn5YeG5aSH6Zi25q61JywKICAgICAgICAnY291bnRkb3duJzogJ+mihOWAkuiuoeaXticsCiAgICAgICAgJ2ludGVybWlzc2lvbic6ICfpl7TmrYfpmLbmrrUnLAogICAgICAgICdhdWN0aW9uJzogJ+aLjeWNlumYtuautScsCiAgICAgICAgJ2l0ZW0nOiAn6YGT5YW36Zi25q61JywKICAgICAgICAnc2V0dGxlbWVudCc6ICfnu5PnrpfpmLbmrrUnCiAgICAgIH07CiAgICAgIHJldHVybiBwaGFzZU1hcFt0aGlzLmdhbWVQaGFzZV0gfHwgJ+acquefpemYtuautSc7CiAgICB9LAogICAgLy8g5qC55o2u5b2T5YmN55So5oi35omL54mM6K6h566X5pS26JeP6ZuG5pi+56S65pWw5o2u77yM5bim57yT5a2Y5a2X5q6177yM5L6/5LqO5qih5p2/55u05o6l5byV55SoCiAgICBjb2xsZWN0aW9uc0NvbXB1dGVkKCkgewogICAgICBjb25zdCBsaXN0ID0gQXJyYXkuaXNBcnJheSh0aGlzLmNvbGxlY3Rpb25zKSA/IHRoaXMuY29sbGVjdGlvbnMgOiBbXTsKICAgICAgLy8g5LuF5bGV56S655So5oi35omL54mM5Lit6Iez5bCR5YyF5ZCrMeS7tuivpeaUtuiXj+mbhueahOaDheWGtQogICAgICByZXR1cm4gbGlzdC5tYXAoY29sID0+IHsKICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5nZXRDdXJyZW50Q29sbGVjdGlvbkNvdW50KGNvbCk7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBNYXRoLm1pbihjdXJyZW50IC8gKGNvbC5yZXF1aXJlZENvdW50IHx8IDEpICogMTAwLCAxMDApOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAuLi5jb2wsCiAgICAgICAgICBfY3VycmVudDogY3VycmVudCwKICAgICAgICAgIF9wcm9ncmVzczogcHJvZ3Jlc3MKICAgICAgICB9OwogICAgICB9KS5maWx0ZXIoY29sID0+IGNvbC5fY3VycmVudCA+IDApOwogICAgfSwKICAgIC8vIOWQiOW5tuiBiuWkqeS4juezu+e7n+aXpeW/l+S4uuWQjOS4gOS/oeaBr+a1ge+8jOaMieaXtumXtOaOkuW6jwogICAgY2hhdEZlZWQoKSB7CiAgICAgIGNvbnN0IGxvZ3MgPSAodGhpcy5nYW1lTG9nIHx8IFtdKS5tYXAoKGwsIGlkeCkgPT4gKHsKICAgICAgICBpZDogYGxvZy0ke2wudGltZXN0YW1wIHx8IGlkeH1gLAogICAgICAgIHR5cGU6ICdsb2cnLAogICAgICAgIHVzZXJJZDogbnVsbCwKICAgICAgICB1c2VybmFtZTogJ+ezu+e7nycsCiAgICAgICAgY29udGVudDogbC5tZXNzYWdlLAogICAgICAgIHRpbWVzdGFtcDogbC50aW1lc3RhbXAgfHwgMAogICAgICB9KSk7CiAgICAgIGNvbnN0IGNoYXRzID0gKHRoaXMuY2hhdE1lc3NhZ2VzIHx8IFtdKS5tYXAobSA9PiAoewogICAgICAgIC4uLm0sCiAgICAgICAgdHlwZTogJ2NoYXQnCiAgICAgIH0pKTsKICAgICAgY29uc3QgbWVyZ2VkID0gWy4uLmxvZ3MsIC4uLmNoYXRzXTsKICAgICAgcmV0dXJuIG1lcmdlZC5zb3J0KChhLCBiKSA9PiAoYS50aW1lc3RhbXAgfHwgMCkgLSAoYi50aW1lc3RhbXAgfHwgMCkpOwogICAgfSwKICAgIC8vIOaatOmcsuWvueivnemFjee9ruS+m+aooeadv+S9v+eUqAogICAgZmlyc3RMb2dpbkNvbmZpZygpIHsKICAgICAgcmV0dXJuIGZpcnN0TG9naW5EaWFsb2d1ZUNvbmZpZzsKICAgIH0sCiAgICAvLyDlvZPliY3orrLov7Dop5LoibLphY3nva7kuI7lkI3np7AKICAgIG5hcnJhdGlvbkNoYXJhY3Rlck5hbWUoKSB7CiAgICAgIHJldHVybiB0aGlzLmdldEN1cnJlbnRMYW5ndWFnZSgpID09PSAnemgtQ04nID8gJ+Wkp+acqOWNmuWjqycgOiAnRHIuIEFsaW5hJzsKICAgIH0sCiAgICBuYXJyYXRpb25DaGFyYWN0ZXIoKSB7CiAgICAgIGNvbnN0IGtleSA9IHRoaXMubmFycmF0aW9uQ2hhcmFjdGVyTmFtZTsKICAgICAgY29uc3QgY2hhcnMgPSBmaXJzdExvZ2luRGlhbG9ndWVDb25maWcgJiYgZmlyc3RMb2dpbkRpYWxvZ3VlQ29uZmlnLmNoYXJhY3RlcnM7CiAgICAgIHJldHVybiBjaGFycyAmJiBjaGFyc1trZXldID8gY2hhcnNba2V5XSA6IHsKICAgICAgICBpbWFnZTogJy9pbWFnZXMvZ3VpZGUucG5nJywKICAgICAgICBwb3NpdGlvbjogJ3JpZ2h0JywKICAgICAgICBjb2xvcjogJyMzYjgyZjYnCiAgICAgIH07CiAgICB9CiAgfSwKICBhc3luYyBtb3VudGVkKCkgewogICAgY29uc3Qgcm9vbUlkID0gdGhpcy4kcm91dGUucXVlcnkucm9vbUlkOwogICAgaWYgKHJvb21JZCkgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfUk9PTV9JRCcsIHJvb21JZCk7CiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVHYW1lKCk7CiAgICBhd2FpdCB0aGlzLmxvYWRSb29tU3RhdGUoKTsKICAgIC8vIGxvYWRSb29tU3RhdGUg5Lit5bey57uP6LCD55So5LqGIGxvYWRBbGxQbGF5ZXJzQXJ0aWZhY3Rz77yM6L+Z6YeM56Gu5L+d5pWw5o2u5Yqg6L29CiAgICBhd2FpdCB0aGlzLnN1YnNjcmliZVJvb21SZWFsdGltZSgpOwogIH0sCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIHRoaXMudW5zdWJzY3JpYmVSb29tUmVhbHRpbWUoKTsKICAgIGlmICh0aGlzLnJlZnJlc2hUaW1lcikgewogICAgICBjbGVhckludGVydmFsKHRoaXMucmVmcmVzaFRpbWVyKTsKICAgICAgdGhpcy5yZWZyZXNoVGltZXIgPSBudWxsOwogICAgfQogICAgaWYgKHRoaXMuYXVjdGlvblRpbWVyKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5hdWN0aW9uVGltZXIpOwogICAgICB0aGlzLmF1Y3Rpb25UaW1lciA9IG51bGw7CiAgICB9CiAgICBpZiAodGhpcy50eXBpbmdUaW1lcikgewogICAgICBjbGVhckludGVydmFsKHRoaXMudHlwaW5nVGltZXIpOwogICAgICB0aGlzLnR5cGluZ1RpbWVyID0gbnVsbDsKICAgIH0KICAgIHRoaXMuJHNldCh0aGlzLCAnYXVjdGlvbkNvdW50ZG93bicsIDApOwogIH0sCiAgd2F0Y2g6IHsKICAgIGdhbWVMb2coKSB7CiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICBjb25zdCBjaGF0Q29udGFpbmVyID0gdGhpcy4kcmVmcy5jaGF0Q29udGFpbmVyOwogICAgICAgIGlmIChjaGF0Q29udGFpbmVyKSB7CiAgICAgICAgICBjaGF0Q29udGFpbmVyLnNjcm9sbFRvcCA9IGNoYXRDb250YWluZXIuc2Nyb2xsSGVpZ2h0OwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyDljrvmjonmqKHmi5/liJ3lp4vljJbnjqnlrrbvvIzmlLnkuLrkvb/nlKjmiL/pl7TnmoTlrp7pmYXnjqnlrrbliJfooagKICAgIGFzeW5jIGluaXRpYWxpemVHYW1lKCkgewogICAgICBjb25zdCBhcnRpZmFjdHMgPSBhd2FpdCB0aGlzLmxvYWRBcnRpZmFjdHMoKTsKICAgICAgdGhpcy5hcnRpZmFjdE1hcCA9IGFydGlmYWN0cy5yZWR1Y2UoKGFjYywgYSkgPT4gewogICAgICAgIGFjY1thLmlkXSA9IGE7CiAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgfSwge30pOwogICAgICBhd2FpdCB0aGlzLmxvYWRDb2xsZWN0aW9ucygpOwogICAgfSwKICAgIGFzeW5jIHN1YnNjcmliZVJvb21SZWFsdGltZSgpIHsKICAgICAgY29uc3QgcmlkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9vbUlkOwogICAgICBpZiAoIXJpZCkgcmV0dXJuOwogICAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7CiAgICAgIGNvbnN0IHsKICAgICAgICByb29tQ2hhbm5lbCwKICAgICAgICBicm9hZGNhc3RDaGFubmVsCiAgICAgIH0gPSBzdWJzY3JpYmVSb29tUmVhbHRpbWVTZXJ2aWNlKHsKICAgICAgICByb29tSWQ6IHJpZCwKICAgICAgICBzdXBhYmFzZSwKICAgICAgICBvbkxvYWRSb29tU3RhdGU6IHRoaXMubG9hZFJvb21TdGF0ZQogICAgICB9LCB7CiAgICAgICAgb25HYW1lU3RhcnRlZDogYXN5bmMgX3BheWxvYWQgPT4gewogICAgICAgICAgLy8g6Ziy5q2i6YeN5aSN5ZCv5Yqo5aSa5Liq5YCS6K6h5pe2CiAgICAgICAgICBpZiAodGhpcy5jb3VudGRvd25JblByb2dyZXNzKSByZXR1cm47CiAgICAgICAgICB0aGlzLmNvdW50ZG93bkluUHJvZ3Jlc3MgPSB0cnVlOwoKICAgICAgICAgIC8vIOaWsOWxgOW8gOWni++8mumHjee9ruiBiuWkqea2iOaBr+WSjOS7t+WAvOaVsOaNrgogICAgICAgICAgdGhpcy5jaGF0TWVzc2FnZXMgPSBbXTsKICAgICAgICAgIHRoaXMuYWxsUGxheWVyc0FydGlmYWN0cyA9IHt9OwogICAgICAgICAgLy8g6YeN572u5Zue5ZCI5pWwCiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1JFU0VUX1JPVU5EJyk7CiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9ST1VORF9UT1RBTCcsIDYpOwogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfR0FNRV9QSEFTRScsICdjb3VudGRvd24nKTsKICAgICAgICAgIHRoaXMuJHNldCh0aGlzLCAnYXVjdGlvbkNvdW50ZG93bicsIDUpOwogICAgICAgICAgY29uc3QgbWUgPSAodGhpcy5yb29tICYmIHRoaXMucm9vbS5yb29tX3BsYXllcnMgPyB0aGlzLnJvb20ucm9vbV9wbGF5ZXJzIDogW10pLmZpbmQocCA9PiBwLnVzZXJfaWQgPT09IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIuaWQpOwogICAgICAgICAgaWYgKG1lKSB7CiAgICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX0NVUlJFTlRfUExBWUVSJywgewogICAgICAgICAgICAgIGlkOiBtZS51c2VyX2lkLAogICAgICAgICAgICAgIG5hbWU6IHRoaXMuZ2V0TmFtZUZvcihtZS51c2VyX2lkKSwKICAgICAgICAgICAgICBlbmVyZ3k6IDUwLAogICAgICAgICAgICAgIGFydGlmYWN0czogW10sCiAgICAgICAgICAgICAgaXRlbXM6IFtdCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuYXVjdGlvblRpbWVyKSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5hdWN0aW9uVGltZXIpOwogICAgICAgICAgICB0aGlzLmF1Y3Rpb25UaW1lciA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgIHN0YXJ0Q291bnRkb3duKHsKICAgICAgICAgICAgICBzZWNvbmRzOiA1LAogICAgICAgICAgICAgIG9uVGljazogcyA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLiRzZXQodGhpcywgJ2F1Y3Rpb25Db3VudGRvd24nLCBzKTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIG9uRG9uZTogYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5jb3VudGRvd25JblByb2dyZXNzID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc093bmVyKSB7CiAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXV0b1N0YXJ0QXVjdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZ2V0UmVmOiAoKSA9PiB0aGlzLmF1Y3Rpb25UaW1lciwKICAgICAgICAgICAgICBzZXRSZWY6IGlkID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuYXVjdGlvblRpbWVyID0gaWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25BdWN0aW9uU3RhcnRlZDogYXN5bmMgKGR1cmF0aW9uLCBwYXlsb2FkKSA9PiB7CiAgICAgICAgICAvLyDnoa7kv53miYDmnInnjqnlrrbpg73og73nnIvliLDmi43ljZbmlbDmja4KICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFJvb21TdGF0ZSgpOwoKICAgICAgICAgIC8vIOWQjOatpeWbnuWQiOaVsO+8iOWmguaenOW5v+aSreS4reWMheWQq+S6huWbnuWQiOS/oeaBr++8iQogICAgICAgICAgaWYgKHBheWxvYWQgJiYgdHlwZW9mIHBheWxvYWQucm91bmRDdXJyZW50ID09PSAnbnVtYmVyJykgewogICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9ST1VORF9DVVJSRU5UJywgcGF5bG9hZC5yb3VuZEN1cnJlbnQpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHBheWxvYWQgJiYgdHlwZW9mIHBheWxvYWQucm91bmRUb3RhbCA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfUk9VTkRfVE9UQUwnLCBwYXlsb2FkLnJvdW5kVG90YWwpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zdGFydEF1Y3Rpb25UaW1lcihkdXJhdGlvbik7CiAgICAgICAgfSwKICAgICAgICBvbkJpZFVwZGF0ZTogKHsKICAgICAgICAgIGF1Y3Rpb25JZCwKICAgICAgICAgIGhpZ2hlc3RCaWQsCiAgICAgICAgICBoaWdoZXN0QmlkZGVyCiAgICAgICAgfSkgPT4gewogICAgICAgICAgaWYgKCFhdWN0aW9uSWQpIHJldHVybjsKICAgICAgICAgIGNvbnN0IGxpc3QgPSB0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50QXVjdGlvbnMgfHwgW107CiAgICAgICAgICBjb25zdCBpZHggPSBsaXN0LmZpbmRJbmRleChhID0+IGEuaWQgPT09IGF1Y3Rpb25JZCk7CiAgICAgICAgICBpZiAoaWR4ID49IDApIHsKICAgICAgICAgICAgY29uc3QgbmV4dCA9IHsKICAgICAgICAgICAgICAuLi5saXN0W2lkeF0sCiAgICAgICAgICAgICAgaGlnaGVzdEJpZCwKICAgICAgICAgICAgICBoaWdoZXN0QmlkZGVyCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnQUREX09SX1VQREFURV9BVUNUSU9OJywgbmV4dCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvLyDml6flm57lkIjlub/mkq3lt7Lnp7vpmaTvvIznu5/kuIDmnKzlnLDmjqjov5vvvIzkuI3lho3mjqXmlLbor6Xkuovku7YKICAgICAgICBvblJvdW5kVXBkYXRlZDogX2RhdGEgPT4ge30sCiAgICAgICAgb25HYW1lRW5kZWQ6ICgpID0+IHsKICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX0dBTUVfUEhBU0UnLCAnc2V0dGxlbWVudCcpOwogICAgICAgICAgdGhpcy5jb21wdXRlRmluYWxTY29yZXMoKS5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgdGhpcy5zaG93R2FtZUVuZERpYWxvZyA9IHRydWU7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmICh0aGlzLmF1Y3Rpb25UaW1lcikgewogICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuYXVjdGlvblRpbWVyKTsKICAgICAgICAgICAgdGhpcy5hdWN0aW9uVGltZXIgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgb25BdWN0aW9uRW5kZWQ6IGFzeW5jICgpID0+IHsKICAgICAgICAgIGF3YWl0IHRoaXMubG9hZFJvb21TdGF0ZSgpOwogICAgICAgIH0sCiAgICAgICAgb25DaGF0TWVzc2FnZTogbWVzc2FnZSA9PiB7CiAgICAgICAgICAvLyDpgb/lhY3ph43lpI3mt7vliqDmtojmga8KICAgICAgICAgIGlmICghbWVzc2FnZSB8fCAhbWVzc2FnZS5pZCkgcmV0dXJuOwogICAgICAgICAgY29uc3QgZXhpc3RpbmcgPSB0aGlzLmNoYXRNZXNzYWdlcy5maW5kKG0gPT4gbS5pZCA9PT0gbWVzc2FnZS5pZCB8fCBtLnVzZXJJZCA9PT0gbWVzc2FnZS51c2VySWQgJiYgbS50aW1lc3RhbXAgPT09IG1lc3NhZ2UudGltZXN0YW1wICYmIG0uY29udGVudCA9PT0gbWVzc2FnZS5jb250ZW50KTsKICAgICAgICAgIGlmIChleGlzdGluZykgcmV0dXJuOwogICAgICAgICAgdGhpcy5jaGF0TWVzc2FnZXMucHVzaChtZXNzYWdlKTsKICAgICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgICAgY29uc3QgY2hhdENvbnRhaW5lciA9IHRoaXMuJHJlZnMuY2hhdENvbnRhaW5lcjsKICAgICAgICAgICAgaWYgKGNoYXRDb250YWluZXIpIHsKICAgICAgICAgICAgICBjaGF0Q29udGFpbmVyLnNjcm9sbFRvcCA9IGNoYXRDb250YWluZXIuc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sICgpID0+IHsKICAgICAgICBpZiAoIXRoaXMucmVmcmVzaFRpbWVyKSB7CiAgICAgICAgICB0aGlzLnJlZnJlc2hUaW1lciA9IHNldEludGVydmFsKHRoaXMubG9hZFJvb21TdGF0ZSwgMTAwMCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5yb29tQ2hhbm5lbCA9IHJvb21DaGFubmVsOwogICAgICB0aGlzLmJyb2FkY2FzdENoYW5uZWwgPSBicm9hZGNhc3RDaGFubmVsOwogICAgfSwKICAgIHVuc3Vic2NyaWJlUm9vbVJlYWx0aW1lKCkgewogICAgICB1bnN1YnNjcmliZVJvb21SZWFsdGltZVNlcnZpY2UodGhpcy5yb29tQ2hhbm5lbCwgdGhpcy5icm9hZGNhc3RDaGFubmVsKTsKICAgICAgdGhpcy5yb29tQ2hhbm5lbCA9IG51bGw7CiAgICAgIHRoaXMuYnJvYWRjYXN0Q2hhbm5lbCA9IG51bGw7CiAgICB9LAogICAgYXN5bmMgbG9hZFJvb21TdGF0ZSgpIHsKICAgICAgY29uc3QgcmlkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9vbUlkOwogICAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7CiAgICAgIGF3YWl0IGxvYWRSb29tU3RhdGVTZXJ2aWNlKHsKICAgICAgICByb29tSWQ6IHJpZCwKICAgICAgICByb29tU2VydmljZSwKICAgICAgICBzdXBhYmFzZSwKICAgICAgICBhcnRpZmFjdE1hcDogdGhpcy5hcnRpZmFjdE1hcCwKICAgICAgICBzdG9yZTogdGhpcy4kc3RvcmUsCiAgICAgICAgc2V0Um9vbTogcm9vbSA9PiB7CiAgICAgICAgICB0aGlzLnJvb20gPSByb29tOwogICAgICAgIH0sCiAgICAgICAgc2V0UHJvZmlsZU1hcDogbWFwID0+IHsKICAgICAgICAgIHRoaXMucHJvZmlsZU1hcCA9IG1hcDsKICAgICAgICB9LAogICAgICAgIHNldEdhbWVQaGFzZTogcGhhc2UgPT4gewogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfR0FNRV9QSEFTRScsIHBoYXNlKTsKICAgICAgICB9LAogICAgICAgIGNsZWFyQXVjdGlvblRpbWVyOiAoKSA9PiB7CiAgICAgICAgICBpZiAodGhpcy5hdWN0aW9uVGltZXIpIHsKICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmF1Y3Rpb25UaW1lcik7CiAgICAgICAgICAgIHRoaXMuYXVjdGlvblRpbWVyID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldEF1Y3Rpb25Db3VudGRvd246IG4gPT4gewogICAgICAgICAgdGhpcy4kc2V0KHRoaXMsICdhdWN0aW9uQ291bnRkb3duJywgbik7CiAgICAgICAgfSwKICAgICAgICBvblNob3dHYW1lRW5kOiAoKSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dHYW1lRW5kRGlhbG9nID0gdHJ1ZTsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZUdhbWVFbmQoKTsKICAgICAgICAgIH0sIDMwMDApOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIC8vIOWKoOi9veaJgOacieeOqeWutueahOaJi+eJjOaVsOaNru+8jOeUqOS6juS7t+WAvOiuoeeulwogICAgICBhd2FpdCB0aGlzLmxvYWRBbGxQbGF5ZXJzQXJ0aWZhY3RzKCk7CiAgICAgIC8vIOWmguaenOWIt+aWsOWQjuWPkeeOsOS7jeaciea0u+i3g+aLjeWNlu+8jOS9huacrOWcsOaXoOWAkuiuoeaXtu+8jOWImeeUqOW9k+WJjeWJqeS9meaXtumXtOWQr+WKqOe7n+S4gOWAkuiuoeaXtgogICAgICBjb25zdCBhdWN0aW9ucyA9IHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRBdWN0aW9ucyB8fCBbXTsKICAgICAgaWYgKHRoaXMuJHN0b3JlLnN0YXRlLmdhbWVQaGFzZSA9PT0gJ2F1Y3Rpb24nICYmIGF1Y3Rpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCByZW1haW5pbmcgPSBOdW1iZXIodGhpcy5hdWN0aW9uQ291bnRkb3duIHx8IDApOwogICAgICAgIGlmICghdGhpcy5hdWN0aW9uVGltZXIgJiYgcmVtYWluaW5nID4gMCkgewogICAgICAgICAgc3RhcnRDb3VudGRvd24oewogICAgICAgICAgICBzZWNvbmRzOiByZW1haW5pbmcsCiAgICAgICAgICAgIG9uVGljazogcyA9PiB7CiAgICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMsICdhdWN0aW9uQ291bnRkb3duJywgcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uRG9uZTogYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgIGF3YWl0IHRoaXMub25BdWN0aW9uVGltZVVwKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFJlZjogKCkgPT4gdGhpcy5hdWN0aW9uVGltZXIsCiAgICAgICAgICAgIHNldFJlZjogaWQgPT4gewogICAgICAgICAgICAgIHRoaXMuYXVjdGlvblRpbWVyID0gaWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIOWKoOi9veaJgOacieeOqeWutueahOaJi+eJjOaVsOaNrgogICAgYXN5bmMgbG9hZEFsbFBsYXllcnNBcnRpZmFjdHMoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmlkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9vbUlkOwogICAgICAgIGlmICghcmlkKSB7CiAgICAgICAgICB0aGlzLmFsbFBsYXllcnNBcnRpZmFjdHMgPSB7fTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogICAgICAgIC8vIOiOt+WPluaIv+mXtOWGheaJgOacieeOqeWutueahOaJi+eJjOaVsOaNrgogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGRhdGE6IGFsbEFydGlmYWN0cwogICAgICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tX2FydGlmYWN0cycpLnNlbGVjdCgnb3duZXJfdXNlcl9pZCwgYXJ0aWZhY3RfaWQnKS5lcSgncm9vbV9pZCcsIHJpZCk7CgogICAgICAgIC8vIOaMieeOqeWutklE5YiG57uECiAgICAgICAgY29uc3QgcGxheWVyQXJ0aWZhY3RzTWFwID0ge307CiAgICAgICAgaWYgKGFsbEFydGlmYWN0cyAmJiBhbGxBcnRpZmFjdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgYWxsQXJ0aWZhY3RzLmZvckVhY2gocm93ID0+IHsKICAgICAgICAgICAgY29uc3QgdXNlcklkID0gcm93Lm93bmVyX3VzZXJfaWQ7CiAgICAgICAgICAgIGlmICghcGxheWVyQXJ0aWZhY3RzTWFwW3VzZXJJZF0pIHsKICAgICAgICAgICAgICBwbGF5ZXJBcnRpZmFjdHNNYXBbdXNlcklkXSA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBsYXllckFydGlmYWN0c01hcFt1c2VySWRdLnB1c2gocm93LmFydGlmYWN0X2lkKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8g5L2/55SoIFZ1ZS5zZXQg56Gu5L+d5ZON5bqU5byP5pu05pawCiAgICAgICAgdGhpcy4kc2V0KHRoaXMsICdhbGxQbGF5ZXJzQXJ0aWZhY3RzJywgcGxheWVyQXJ0aWZhY3RzTWFwKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybignW2dhbWVdIGxvYWRBbGxQbGF5ZXJzQXJ0aWZhY3RzIGZhaWxlZCcsIGUpOwogICAgICAgIHRoaXMuYWxsUGxheWVyc0FydGlmYWN0cyA9IHt9OwogICAgICB9CiAgICB9LAogICAgYXN5bmMgdG9nZ2xlUmVhZHkoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmlkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9vbUlkOwogICAgICAgIGNvbnN0IHVpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIgJiYgdGhpcy4kc3RvcmUuc3RhdGUudXNlci5pZDsKICAgICAgICBpZiAoIXJpZCB8fCAhdWlkKSByZXR1cm47CiAgICAgICAgYXdhaXQgdG9nZ2xlUmVhZHlBY3Rpb24oewogICAgICAgICAgcm9vbUlkOiByaWQsCiAgICAgICAgICB1c2VySWQ6IHVpZCwKICAgICAgICAgIHJvb206IHRoaXMucm9vbSwKICAgICAgICAgIHJvb21TZXJ2aWNlLAogICAgICAgICAgcmVsb2FkOiB0aGlzLmxvYWRSb29tU3RhdGUKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybignW2dhbWVdIHRvZ2dsZVJlYWR5IGZhaWxlZCcsIGUpOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgbW92ZVRvU2VhdChpZHgpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByaWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS5yb29tSWQ7CiAgICAgICAgY29uc3QgdWlkID0gdGhpcy4kc3RvcmUuc3RhdGUudXNlciAmJiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmlkOwogICAgICAgIGlmICghcmlkIHx8ICF1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB0YXJnZXRTZWF0ID0gewogICAgICAgICAgaW5kZXg6IGlkeCwKICAgICAgICAgIHBsYXllcjogdGhpcy5zZWF0c1tpZHhdICYmIHRoaXMuc2VhdHNbaWR4XS5wbGF5ZXIKICAgICAgICB9OwogICAgICAgIGF3YWl0IG1vdmVUb1NlYXRBY3Rpb24oewogICAgICAgICAgcm9vbUlkOiByaWQsCiAgICAgICAgICB1c2VySWQ6IHVpZCwKICAgICAgICAgIHJvb206IHRoaXMucm9vbSwKICAgICAgICAgIHNlYXRzOiB0YXJnZXRTZWF0LAogICAgICAgICAgcm9vbVNlcnZpY2UsCiAgICAgICAgICByZWxvYWQ6IHRoaXMubG9hZFJvb21TdGF0ZQogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdbZ2FtZV0gbW92ZVRvU2VhdCBmYWlsZWQnLCBlKTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGxlYXZlUm9vbSgpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByaWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS5yb29tSWQ7CiAgICAgICAgY29uc3QgdWlkID0gdGhpcy4kc3RvcmUuc3RhdGUudXNlciAmJiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmlkOwogICAgICAgIGlmICghcmlkIHx8ICF1aWQpIHJldHVybjsKICAgICAgICBhd2FpdCBsZWF2ZVJvb21BY3Rpb24oewogICAgICAgICAgcm9vbUlkOiByaWQsCiAgICAgICAgICB1c2VySWQ6IHVpZCwKICAgICAgICAgIGNsZWFyQXVjdGlvblRpbWVyOiAoKSA9PiB7CiAgICAgICAgICAgIGlmICh0aGlzLmF1Y3Rpb25UaW1lcikgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5hdWN0aW9uVGltZXIpOwogICAgICAgICAgICAgIHRoaXMuYXVjdGlvblRpbWVyID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHNldENvdW50ZG93bjogbiA9PiB7CiAgICAgICAgICAgIHRoaXMuJHNldCh0aGlzLCAnYXVjdGlvbkNvdW50ZG93bicsIG4pOwogICAgICAgICAgfSwKICAgICAgICAgIHN0b3JlOiB0aGlzLiRzdG9yZSwKICAgICAgICAgIGF1Y3Rpb25TZXJ2aWNlLAogICAgICAgICAgcm9vbVNlcnZpY2UsCiAgICAgICAgICB1bnN1YnNjcmliZTogKCkgPT4gdGhpcy51bnN1YnNjcmliZVJvb21SZWFsdGltZSgpLAogICAgICAgICAgc2V0Um9vbUlkOiB2ID0+IHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX1JPT01fSUQnLCB2KSwKICAgICAgICAgIHNldExvY2FsUm9vbTogdiA9PiB7CiAgICAgICAgICAgIHRoaXMucm9vbSA9IHY7CiAgICAgICAgICB9LAogICAgICAgICAgbmF2aWdhdGVUb1Jvb21zOiAoKSA9PiB0aGlzLiRyb3V0ZXIucHVzaCgnL3Jvb21zJykKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybignW2dhbWVdIGxlYXZlUm9vbSBmYWlsZWQnLCBlKTsKICAgICAgfQogICAgfSwKICAgIC8vIOa4uOaIj+e7k+adn+WkhOeQhgogICAgYXN5bmMgaGFuZGxlR2FtZUVuZCgpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByaWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS5yb29tSWQ7CiAgICAgICAgaWYgKHJpZCkgewogICAgICAgICAgLy8g5bCG5oi/6Ze054q25oCB6YeN572u5Li6IHdhaXRpbmfvvIzkvr/kuo7nu6fnu63miL/pl7TlhoXlh4blpIcv5paw5LiA5bGACiAgICAgICAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7CiAgICAgICAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tcycpLnVwZGF0ZSh7CiAgICAgICAgICAgIHN0YXR1czogJ3dhaXRpbmcnCiAgICAgICAgICB9KS5lcSgnaWQnLCByaWQpOwogICAgICAgICAgLy8g6Lez6L2s5Zue5oi/6Ze06aG16Z2i77yI5ri45oiP6aG15pC65bimIHJvb21JZCDljbPmmK/miL/pl7TnlYzpnaLvvIkKICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgcGF0aDogJy9nYW1lJywKICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICByb29tSWQ6IHJpZCwKICAgICAgICAgICAgICBnYW1lRW5kZWQ6ICd0cnVlJwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9yb29tcycpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybignW2dhbWVdIGhhbmRsZUdhbWVFbmQgZmFpbGVkJywgZSk7CiAgICAgICAgLy8g5YWc5bqV6Lez5Zue5oi/6Ze05YiX6KGoCiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9yb29tcycpOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgc3RhcnRHYW1lKCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnJvb21JZDsKICAgICAgICBjb25zdCB1aWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyICYmIHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIuaWQ7CiAgICAgICAgaWYgKCFyaWQgfHwgIXVpZCB8fCAhdGhpcy5pc093bmVyIHx8ICF0aGlzLmFsbFJlYWR5KSByZXR1cm47CiAgICAgICAgLy8g5paw5bGA5byA5aeL5YmN6YeN572u57O757uf5pel5b+X44CB6IGK5aSp5raI5oGv5ZKM5Lu35YC85pWw5o2uCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnQ0xFQVJfR0FNRV9MT0cnKTsKICAgICAgICB9IGNhdGNoIChfKSB7fQogICAgICAgIHRoaXMuY2hhdE1lc3NhZ2VzID0gW107CiAgICAgICAgdGhpcy5hbGxQbGF5ZXJzQXJ0aWZhY3RzID0ge307CiAgICAgICAgYXdhaXQgcm9vbVNlcnZpY2Uuc3RhcnRHYW1lKHJpZCwgdWlkKTsKICAgICAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7CiAgICAgICAgdGhpcy5yb3VuZENvdW50ID0gMDsKICAgICAgICBhd2FpdCBzdGFydEdhbWVGbG93KHsKICAgICAgICAgIHJvb21JZDogcmlkLAogICAgICAgICAgdXNlcklkOiB1aWQsCiAgICAgICAgICBpc093bmVyOiB0aGlzLmlzT3duZXIsCiAgICAgICAgICBhbGxSZWFkeTogdGhpcy5hbGxSZWFkeSwKICAgICAgICAgIHN0b3JlOiB0aGlzLiRzdG9yZSwKICAgICAgICAgIHN1cGFiYXNlLAogICAgICAgICAgc2V0Q291bnRkb3duOiBuID0+IHRoaXMuJHNldCh0aGlzLCAnYXVjdGlvbkNvdW50ZG93bicsIG4pLAogICAgICAgICAgc2V0Q3VycmVudFBsYXllckZyb21Sb29tOiAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IG1lID0gKHRoaXMucm9vbSAmJiB0aGlzLnJvb20ucm9vbV9wbGF5ZXJzID8gdGhpcy5yb29tLnJvb21fcGxheWVycyA6IFtdKS5maW5kKHAgPT4gcC51c2VyX2lkID09PSB1aWQpOwogICAgICAgICAgICBpZiAobWUpIHsKICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9DVVJSRU5UX1BMQVlFUicsIHsKICAgICAgICAgICAgICAgIGlkOiBtZS51c2VyX2lkLAogICAgICAgICAgICAgICAgbmFtZTogdGhpcy5nZXROYW1lRm9yKG1lLnVzZXJfaWQpLAogICAgICAgICAgICAgICAgZW5lcmd5OiA1MCwKICAgICAgICAgICAgICAgIGFydGlmYWN0czogW10sCiAgICAgICAgICAgICAgICBpdGVtczogW10KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIG9uQ291bnRkb3duRG9uZTogYXN5bmMgKCkgPT4gewogICAgICAgICAgICBpZiAodGhpcy5pc093bmVyKSB7CiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRvU3RhcnRBdWN0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAvLyDmiL/kuLvmnKzlnLDkuZ/lkK/liqjpooTlgJLorqHml7bvvIzpmLLmraLlub/mkq3kuI3lm57kvKDlr7zoh7TkuI3op6blj5Egb25HYW1lU3RhcnRlZAogICAgICAgIGlmICghdGhpcy5jb3VudGRvd25JblByb2dyZXNzKSB7CiAgICAgICAgICB0aGlzLmNvdW50ZG93bkluUHJvZ3Jlc3MgPSB0cnVlOwogICAgICAgICAgLy8g56Gu5L+d5pys5Zyw5Lmf6YeN572u5pWw5o2uCiAgICAgICAgICB0aGlzLmNoYXRNZXNzYWdlcyA9IFtdOwogICAgICAgICAgdGhpcy5hbGxQbGF5ZXJzQXJ0aWZhY3RzID0ge307CiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9HQU1FX1BIQVNFJywgJ2NvdW50ZG93bicpOwogICAgICAgICAgdGhpcy4kc2V0KHRoaXMsICdhdWN0aW9uQ291bnRkb3duJywgNSk7CiAgICAgICAgICBjb25zdCBtZSA9ICh0aGlzLnJvb20gJiYgdGhpcy5yb29tLnJvb21fcGxheWVycyA/IHRoaXMucm9vbS5yb29tX3BsYXllcnMgOiBbXSkuZmluZChwID0+IHAudXNlcl9pZCA9PT0gdWlkKTsKICAgICAgICAgIGlmIChtZSkgewogICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVF9DVVJSRU5UX1BMQVlFUicsIHsKICAgICAgICAgICAgICBpZDogbWUudXNlcl9pZCwKICAgICAgICAgICAgICBuYW1lOiB0aGlzLmdldE5hbWVGb3IobWUudXNlcl9pZCksCiAgICAgICAgICAgICAgZW5lcmd5OiA1MCwKICAgICAgICAgICAgICBhcnRpZmFjdHM6IFtdLAogICAgICAgICAgICAgIGl0ZW1zOiBbXQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmF1Y3Rpb25UaW1lcikgewogICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuYXVjdGlvblRpbWVyKTsKICAgICAgICAgICAgdGhpcy5hdWN0aW9uVGltZXIgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICBzdGFydENvdW50ZG93bih7CiAgICAgICAgICAgICAgc2Vjb25kczogNSwKICAgICAgICAgICAgICBvblRpY2s6IHMgPT4gewogICAgICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMsICdhdWN0aW9uQ291bnRkb3duJywgcyk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBvbkRvbmU6IGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuY291bnRkb3duSW5Qcm9ncmVzcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPd25lcikgewogICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmF1dG9TdGFydEF1Y3Rpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGdldFJlZjogKCkgPT4gdGhpcy5hdWN0aW9uVGltZXIsCiAgICAgICAgICAgICAgc2V0UmVmOiBpZCA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmF1Y3Rpb25UaW1lciA9IGlkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1tnYW1lXSBzdGFydEdhbWUgZmFpbGVkJywgZSk7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBzdGFydEF1Y3Rpb24oKSB7CiAgICAgIC8vIOWQjOaXtuaKveWPluWkmuS7tui/m+ihjOaLjeWNlu+8iOekuuS+i+S4ujLku7bvvIkKICAgICAgY29uc3QgYXJ0aWZhY3RzID0gYXdhaXQgdGhpcy5sb2FkQXJ0aWZhY3RzKCk7CiAgICAgIGlmIChhcnRpZmFjdHMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IHBpY2tzID0gW107CiAgICAgICAgd2hpbGUgKHBpY2tzLmxlbmd0aCA8IE1hdGgubWluKDIsIGFydGlmYWN0cy5sZW5ndGgpKSB7CiAgICAgICAgICBjb25zdCBjYW5kaWRhdGUgPSBhcnRpZmFjdHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXJ0aWZhY3RzLmxlbmd0aCldOwogICAgICAgICAgaWYgKCFwaWNrcy5maW5kKHAgPT4gcC5pZCA9PT0gY2FuZGlkYXRlLmlkKSkgcGlja3MucHVzaChjYW5kaWRhdGUpOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IGFydCBvZiBwaWNrcykgewogICAgICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3N0YXJ0QXVjdGlvbicsIGFydCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgYXN5bmMgbG9hZEFydGlmYWN0cygpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7CiAgICAgICAgcmV0dXJuIGF3YWl0IGxvYWRBcnRpZmFjdHNTZXJ2aWNlKHsKICAgICAgICAgIHN1cGFiYXNlCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Yqg6L295Y2h54mM5pWw5o2u5aSx6LSlOicsIGVycm9yKTsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgIH0sCiAgICBzaG93QXJ0aWZhY3REZXRhaWwoYXJ0aWZhY3RJZCkgewogICAgICAvLyDoi6Xlt7LliqDovb1hcnRpZmFjdE1hcO+8jOWImeS8mOWFiOWxleekuuecn+WunuaVsOaNrgogICAgICBjb25zdCBhcnRpZmFjdCA9IHRoaXMuYXJ0aWZhY3RNYXBbYXJ0aWZhY3RJZF07CiAgICAgIGlmIChhcnRpZmFjdCkgewogICAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkID0gYXJ0aWZhY3Q7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5Zue6YCA77ya57u05oyB5Y6f56S65L6LCiAgICAgICAgdGhpcy5zZWxlY3RlZENhcmQgPSB7CiAgICAgICAgICBpZDogYXJ0aWZhY3RJZCwKICAgICAgICAgIG5hbWU6ICfnpLrkvovlpYfniaknLAogICAgICAgICAgZXJhOiAn5Y+k5LujJywKICAgICAgICAgIGxvY2F0aW9uOiAn5pyq55+lJywKICAgICAgICAgIHN0b3J5OiAn6L+Z5piv5LiA5Liq56We56eY55qE5aWH54mpLi4uJywKICAgICAgICAgIGNvbGxlY3Rpb25UYWdzOiBbJ+iJuuacr+eRsOWunSddLAogICAgICAgICAgYmFzZVZhbHVlOiA4LAogICAgICAgICAgaW1hZ2U6ICdodHRwczovL3ZpYS5wbGFjZWhvbGRlci5jb20vMzAweDIwMD90ZXh0PeekuuS+i+Wlh+eJqScKICAgICAgICB9OwogICAgICB9CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX1NIT1dfQ0FSRF9ERVRBSUwnLCB0cnVlKTsKICAgIH0sCiAgICBoaWRlQ2FyZERldGFpbCgpIHsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfU0hPV19DQVJEX0RFVEFJTCcsIGZhbHNlKTsKICAgICAgdGhpcy5zZWxlY3RlZENhcmQgPSBudWxsOwogICAgfSwKICAgIHNob3dBcnRpZmFjdERldGFpbEZyb21BdWN0aW9uKGFydGlmYWN0KSB7CiAgICAgIHRoaXMuc2VsZWN0ZWRDYXJkID0gYXJ0aWZhY3Q7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX1NIT1dfQ0FSRF9ERVRBSUwnLCBmYWxzZSk7CiAgICAgIHRoaXMub3Blbk5hcnJhdGlvbigpOwogICAgfSwKICAgIC8vIOiuoeeul+eOqeWutuaAu+S7t+WAvO+8iOaUr+aMgeaJgOacieeOqeWutu+8iQogICAgZ2V0UGxheWVyVG90YWxWYWx1ZSh1c2VySWQpIHsKICAgICAgaWYgKCF1c2VySWQpIHJldHVybiAwOwoKICAgICAgLy8g5LyY5YWI5LuOIGFsbFBsYXllcnNBcnRpZmFjdHMg6I635Y+W5omA5pyJ546p5a6255qE5omL54mM5pWw5o2uCiAgICAgIGxldCBvd25lZCA9IFtdOwogICAgICBpZiAodGhpcy5hbGxQbGF5ZXJzQXJ0aWZhY3RzICYmIHRoaXMuYWxsUGxheWVyc0FydGlmYWN0c1t1c2VySWRdKSB7CiAgICAgICAgb3duZWQgPSBBcnJheS5pc0FycmF5KHRoaXMuYWxsUGxheWVyc0FydGlmYWN0c1t1c2VySWRdKSA/IHRoaXMuYWxsUGxheWVyc0FydGlmYWN0c1t1c2VySWRdIDogW107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5Zue6YCA77ya5aaC5p6cIGFsbFBsYXllcnNBcnRpZmFjdHMg5Lit5rKh5pyJ77yM5bCd6K+V5LuO5b2T5YmN546p5a625pWw5o2u6I635Y+WCiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRQbGF5ZXI7CiAgICAgICAgaWYgKGN1cnJlbnQgJiYgY3VycmVudC5pZCA9PT0gdXNlcklkKSB7CiAgICAgICAgICBvd25lZCA9IEFycmF5LmlzQXJyYXkodGhpcy4kc3RvcmUuc3RhdGUucGxheWVyQXJ0aWZhY3RzKSA/IHRoaXMuJHN0b3JlLnN0YXRlLnBsYXllckFydGlmYWN0cyA6IFtdOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIW93bmVkIHx8IG93bmVkLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7CgogICAgICAvLyDnoa7kv50gYXJ0aWZhY3RNYXAg5bey5Yqg6L29CiAgICAgIGlmICghdGhpcy5hcnRpZmFjdE1hcCB8fCBPYmplY3Qua2V5cyh0aGlzLmFydGlmYWN0TWFwKS5sZW5ndGggPT09IDApIHJldHVybiAwOwogICAgICBsZXQgdG90YWwgPSAwOwogICAgICBvd25lZC5mb3JFYWNoKGFpZCA9PiB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuYXJ0aWZhY3RNYXBbYWlkXTsKICAgICAgICBpZiAoYSAmJiB0eXBlb2YgYS5iYXNlVmFsdWUgPT09ICdudW1iZXInKSB7CiAgICAgICAgICB0b3RhbCArPSBhLmJhc2VWYWx1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gdG90YWw7CiAgICB9LAogICAgc2hvd1BsYXllckhhbmQocGxheWVyKSB7CiAgICAgIC8vIOaehOmAoOeOqeWutuWvueixoe+8jOWMheWQq+aJi+eJjOS/oeaBrwogICAgICBjb25zdCBwbGF5ZXJEYXRhID0gewogICAgICAgIGlkOiBwbGF5ZXIudXNlcl9pZCwKICAgICAgICBuYW1lOiB0aGlzLmdldE5hbWVGb3IocGxheWVyLnVzZXJfaWQpLAogICAgICAgIGFydGlmYWN0czogdGhpcy5jdXJyZW50UGxheWVyICYmIHRoaXMuY3VycmVudFBsYXllci5pZCA9PT0gcGxheWVyLnVzZXJfaWQgPyB0aGlzLmN1cnJlbnRQbGF5ZXIuYXJ0aWZhY3RzIHx8IFtdIDogW10KICAgICAgfTsKICAgICAgdGhpcy5oYW5kUGxheWVyID0gcGxheWVyRGF0YTsKICAgICAgdGhpcy5zaG93SGFuZFBvcHVwID0gdHJ1ZTsKICAgIH0sCiAgICBoaWRlSGFuZCgpIHsKICAgICAgdGhpcy5oYW5kUGxheWVyID0gbnVsbDsKICAgICAgdGhpcy5zaG93SGFuZFBvcHVwID0gZmFsc2U7CiAgICB9LAogICAgZ2V0QXZhdGFyRm9yKHVzZXJJZCkgewogICAgICByZXR1cm4gZ2V0QXZhdGFyRm9ySGVscGVyKHsKICAgICAgICBwcm9maWxlTWFwOiB0aGlzLnByb2ZpbGVNYXAsCiAgICAgICAgdXNlcklkCiAgICAgIH0pOwogICAgfSwKICAgIGdldE5hbWVGb3IodXNlcklkKSB7CiAgICAgIHJldHVybiBnZXROYW1lRm9ySGVscGVyKHsKICAgICAgICBwcm9maWxlTWFwOiB0aGlzLnByb2ZpbGVNYXAsCiAgICAgICAgcm9vbTogdGhpcy5yb29tLAogICAgICAgIHVzZXJJZAogICAgICB9KTsKICAgIH0sCiAgICBnZXRDdXJyZW50TGFuZ3VhZ2UoKSB7CiAgICAgIHJldHVybiBnZXRDdXJyZW50TGFuZ3VhZ2VJbXBvcnRlZCgpOwogICAgfSwKICAgIC8vIOWKoOi9veaUtuiXj+mbhuaVsOaNru+8muWfuuS6juaVsOaNruW6kyBhcnRpZmFjdHMg55qEIGNvbGxlY3Rpb25fdGFncyDliqjmgIHnlJ/miJAKICAgIGFzeW5jIGxvYWRDb2xsZWN0aW9ucygpIHsKICAgICAgdHJ5IHsKICAgICAgICB0aGlzLmNvbGxlY3Rpb25zID0gbG9hZENvbGxlY3Rpb25zRnJvbUFydGlmYWN0cyh0aGlzLmFydGlmYWN0TWFwKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliqDovb3mlLbol4/pm4bmlbDmja7lpLHotKU6JywgZXJyb3IpOwogICAgICAgIHRoaXMuY29sbGVjdGlvbnMgPSBbXTsKICAgICAgfQogICAgfSwKICAgIC8vIOiOt+WPluW9k+WJjeaUtuiXj+mbhuaVsOmHj++8iOWfuuS6juW9k+WJjeeUqOaIt+aJi+eJjO+8jOS4lOWPl+acgOWkp+imgeaxguaVsOS4iumZkOmZkOWItu+8iQogICAgZ2V0Q3VycmVudENvbGxlY3Rpb25Db3VudChjb2xsZWN0aW9uKSB7CiAgICAgIGNvbnN0IG93bmVkID0gdGhpcy5jdXJyZW50UGxheWVyICYmIHRoaXMuY3VycmVudFBsYXllci5hcnRpZmFjdHMgPyB0aGlzLmN1cnJlbnRQbGF5ZXIuYXJ0aWZhY3RzIDogW107CiAgICAgIHJldHVybiBnZXRDb2xsZWN0aW9uQ291bnRVdGlsKHsKICAgICAgICBhcnRpZmFjdE1hcDogdGhpcy5hcnRpZmFjdE1hcCwKICAgICAgICBvd25lZEFydGlmYWN0SWRzOiBvd25lZCwKICAgICAgICBjb2xsZWN0aW9uCiAgICAgIH0pOwogICAgfSwKICAgIC8vIOWxleW8gC/mlLbotbfmlLbol4/pm4YKICAgIHRvZ2dsZUNvbGxlY3Rpb24oY29sbGVjdGlvbikgewogICAgICBjb25zdCBpZCA9IGNvbGxlY3Rpb24gJiYgY29sbGVjdGlvbi5pZDsKICAgICAgaWYgKCFpZCkgcmV0dXJuOwogICAgICB0aGlzLiRzZXQodGhpcy5leHBhbmRlZENvbGxlY3Rpb25zLCBpZCwgIXRoaXMuZXhwYW5kZWRDb2xsZWN0aW9uc1tpZF0pOwogICAgfSwKICAgIC8vIOWFs+mXrea4uOaIj+e7k+adn+WvueivneahhgogICAgY2xvc2VHYW1lRW5kRGlhbG9nKCkgewogICAgICB0aGlzLnNob3dHYW1lRW5kRGlhbG9nID0gZmFsc2U7CiAgICB9LAogICAgLy8g55WZ5Zyo5oi/6Ze0CiAgICBzdGF5SW5Sb29tKCkgewogICAgICB0aGlzLnNob3dHYW1lRW5kRGlhbG9nID0gZmFsc2U7CiAgICAgIHRyeSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdDTEVBUl9HQU1FX0xPRycpOwogICAgICB9IGNhdGNoIChfKSB7fQogICAgICAvLyDov5Tlm57lvZPliY3miL/pl7Tlh4blpIfnlYzpnaIKICAgICAgY29uc3QgcmlkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9vbUlkOwogICAgICBpZiAocmlkKSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfR0FNRV9QSEFTRScsICdwcmVwYXJhdGlvbicpOwogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgIHBhdGg6ICcvZ2FtZScsCiAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICByb29tSWQ6IHJpZAogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgLy8g6L+U5Zue5oi/6Ze05YiX6KGoCiAgICBnb1RvUm9vbXMoKSB7CiAgICAgIHRoaXMuc2hvd0dhbWVFbmREaWFsb2cgPSBmYWxzZTsKICAgICAgdGhpcy51bnN1YnNjcmliZVJvb21SZWFsdGltZSgpOwogICAgICB0cnkgewogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnQ0xFQVJfR0FNRV9MT0cnKTsKICAgICAgfSBjYXRjaCAoXykge30KICAgICAgLy8g6L+U5Zue5b2T5YmN5oi/6Ze05YeG5aSH55WM6Z2i77yI5pu056ym5ZCI5pyf5pyb77yJCiAgICAgIGNvbnN0IHJpZCA9IHRoaXMuJHN0b3JlLnN0YXRlLnJvb21JZDsKICAgICAgaWYgKHJpZCkgewogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX0dBTUVfUEhBU0UnLCAncHJlcGFyYXRpb24nKTsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBwYXRoOiAnL2dhbWUnLAogICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgcm9vbUlkOiByaWQKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL3Jvb21zJyk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDml7bpl7TliLDvvJrnu5PmnZ/lvZPliY3miYDmnInmi43ljZblubbnu5PnrpfliLDlr7nlupTnjqnlrrbmiYvniYzvvIznhLblkI7ov5vlhaUxMHPpl7TmrYfmiJbnu5PmnZ/muLjmiI8KICAgIGFzeW5jIG9uQXVjdGlvblRpbWVVcCgpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBhdWN0aW9ucyA9IHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRBdWN0aW9ucyB8fCBbXTsKICAgICAgICAvLyDnu5/kuIDlgJLorqHml7bnu5PmnZ/vvJrnu5PmnZ/miYDmnInlvZPliY3mi43ljZYKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgYXVjdGlvbnMpIHsKICAgICAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdlbmRBdWN0aW9uJywgYS5pZCk7CiAgICAgICAgfQogICAgICAgIC8vIOWIpOaWreaYr+WQpui+vuWIsOaAu+WbnuWQiOaVsAogICAgICAgIGNvbnN0IGN1ciA9IE51bWJlcih0aGlzLiRzdG9yZS5zdGF0ZS5yb3VuZEN1cnJlbnQgfHwgMCk7CiAgICAgICAgY29uc3QgdG90ID0gTnVtYmVyKHRoaXMuJHN0b3JlLnN0YXRlLnJvdW5kVG90YWwgfHwgNik7CiAgICAgICAgaWYgKGN1ciA+PSB0b3QpIHsKICAgICAgICAgIC8vIOinpuWPkee7k+adnwogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfR0FNRV9QSEFTRScsICdzZXR0bGVtZW50Jyk7CiAgICAgICAgICBhd2FpdCB0aGlzLmNvbXB1dGVGaW5hbFNjb3JlcygpOwogICAgICAgICAgdGhpcy5zaG93R2FtZUVuZERpYWxvZyA9IHRydWU7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIOWQpuWImei/m+WFpTEwc+mXtOath+mYtuautQogICAgICAgIHRoaXMuc3RhcnRJbnRlcm1pc3Npb25UaW1lcigxMCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1tnYW1lXSBvbkF1Y3Rpb25UaW1lVXAgZmFpbGVkJywgZSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDlvIDlp4vmi43ljZblgJLorqHml7bvvJrnu5/kuIDmr4/ova7mi43ljZblj6rmnInkuIDkuKrlgJLorqHml7YKICAgIHN0YXJ0QXVjdGlvblRpbWVyKGR1cmF0aW9uID0gMzApIHsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdTRVRfR0FNRV9QSEFTRScsICdhdWN0aW9uJyk7CiAgICAgIHN0YXJ0Q291bnRkb3duKHsKICAgICAgICBzZWNvbmRzOiBkdXJhdGlvbiwKICAgICAgICBvblRpY2s6IHMgPT4gewogICAgICAgICAgdGhpcy4kc2V0KHRoaXMsICdhdWN0aW9uQ291bnRkb3duJywgcyk7CiAgICAgICAgfSwKICAgICAgICBvbkRvbmU6IGFzeW5jICgpID0+IHsKICAgICAgICAgIGF3YWl0IHRoaXMub25BdWN0aW9uVGltZVVwKCk7CiAgICAgICAgfSwKICAgICAgICBnZXRSZWY6ICgpID0+IHRoaXMuYXVjdGlvblRpbWVyLAogICAgICAgIHNldFJlZjogaWQgPT4gewogICAgICAgICAgdGhpcy5hdWN0aW9uVGltZXIgPSBpZDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOavj+i9ruS5i+mXtOeahOmXtOath+iuoeaXtuWZqO+8jOe7k+adn+WQjuiHquWKqOW8gOWni+S4i+S4gOi9ruaLjeWNlgogICAgc3RhcnRJbnRlcm1pc3Npb25UaW1lcihkdXJhdGlvbiA9IDEwKSB7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUX0dBTUVfUEhBU0UnLCAnaW50ZXJtaXNzaW9uJyk7CiAgICAgIHN0YXJ0Q291bnRkb3duKHsKICAgICAgICBzZWNvbmRzOiBkdXJhdGlvbiwKICAgICAgICBvblRpY2s6IHMgPT4gewogICAgICAgICAgdGhpcy4kc2V0KHRoaXMsICdhdWN0aW9uQ291bnRkb3duJywgcyk7CiAgICAgICAgfSwKICAgICAgICBvbkRvbmU6IGFzeW5jICgpID0+IHsKICAgICAgICAgIGlmICh0aGlzLmlzT3duZXIpIHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRvU3RhcnRBdWN0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBnZXRSZWY6ICgpID0+IHRoaXMuYXVjdGlvblRpbWVyLAogICAgICAgIHNldFJlZjogaWQgPT4gewogICAgICAgICAgdGhpcy5hdWN0aW9uVGltZXIgPSBpZDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOiHquWKqOW8gOWni+aLjeWNlgogICAgYXN5bmMgYXV0b1N0YXJ0QXVjdGlvbigpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByaWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS5yb29tSWQ7CiAgICAgICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpOwogICAgICAgIGF3YWl0IGF1dG9TdGFydEF1Y3Rpb25GbG93KHsKICAgICAgICAgIHJvb21JZDogcmlkLAogICAgICAgICAgc3RvcmU6IHRoaXMuJHN0b3JlLAogICAgICAgICAgc3VwYWJhc2UsCiAgICAgICAgICBsb2FkQXJ0aWZhY3RzOiAoKSA9PiB0aGlzLmxvYWRBcnRpZmFjdHMoKSwKICAgICAgICAgIGRpc3BhdGNoU3RhcnRBdWN0aW9uOiBhcnQgPT4gdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3N0YXJ0QXVjdGlvbicsIGFydCksCiAgICAgICAgICBzdGFydEF1Y3Rpb25UaW1lcjogc2VjID0+IHRoaXMuc3RhcnRBdWN0aW9uVGltZXIoc2VjKSwKICAgICAgICAgIHJvdW5kQ291bnQ6IHRoaXMucm91bmRDb3VudCwKICAgICAgICAgIHRvdGFsUm91bmRzOiB0aGlzLnRvdGFsUm91bmRzLAogICAgICAgICAgc2V0Um91bmRDb3VudDogbiA9PiB7CiAgICAgICAgICAgIHRoaXMucm91bmRDb3VudCA9IG47CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1tnYW1lXSBhdXRvU3RhcnRBdWN0aW9uIGZhaWxlZCcsIGUpOwogICAgICB9CiAgICB9LAogICAgLy8g5Y+R6YCB6IGK5aSp5raI5oGvCiAgICBhc3luYyBzZW5kTWVzc2FnZSgpIHsKICAgICAgaWYgKCF0aGlzLm5ld01lc3NhZ2UudHJpbSgpIHx8ICF0aGlzLnVzZXIpIHJldHVybjsKICAgICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgICBpZDogRGF0ZS5ub3coKSwKICAgICAgICB1c2VySWQ6IHRoaXMudXNlci5pZCwKICAgICAgICB1c2VybmFtZTogdGhpcy5nZXROYW1lRm9yKHRoaXMudXNlci5pZCksCiAgICAgICAgY29udGVudDogdGhpcy5uZXdNZXNzYWdlLnRyaW0oKSwKICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgICAgfTsKICAgICAgLy8g5pys5Zyw56uL5Y2z5pi+56S677yM5o+Q5L6b5Y2z5pe25Y+N6aaICiAgICAgIHRoaXMuY2hhdE1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7CiAgICAgIHRoaXMubmV3TWVzc2FnZSA9ICcnOwoKICAgICAgLy8g5rua5Yqo5Yiw5bqV6YOoCiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICBjb25zdCBjaGF0Q29udGFpbmVyID0gdGhpcy4kcmVmcy5jaGF0Q29udGFpbmVyOwogICAgICAgIGlmIChjaGF0Q29udGFpbmVyKSB7CiAgICAgICAgICBjaGF0Q29udGFpbmVyLnNjcm9sbFRvcCA9IGNoYXRDb250YWluZXIuc2Nyb2xsSGVpZ2h0OwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyDlj5HpgIHliLDmnI3liqHlmajvvIzlub/mkq3nu5nmiYDmnInnjqnlrrYKICAgICAgY29uc3QgcmlkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9vbUlkOwogICAgICBpZiAocmlkKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTsKICAgICAgICAgIGF3YWl0IHNlbmRDaGF0TWVzc2FnZSh7CiAgICAgICAgICAgIHN1cGFiYXNlLAogICAgICAgICAgICByb29tSWQ6IHJpZCwKICAgICAgICAgICAgbWVzc2FnZQogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS53YXJuKCdbZ2FtZV0gc2VuZE1lc3NhZ2UgZmFpbGVkJywgZSk7CiAgICAgICAgICAvLyDlj5HpgIHlpLHotKXml7bvvIzlj6/ku6XpgInmi6nnp7vpmaTmnKzlnLDmtojmga/miJbkv53nlZnvvIjkv53nlZnmj5Dkvpvmm7Tlpb3nmoTnlKjmiLfkvZPpqozvvIkKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDmoLzlvI/ljJbmtojmga/ml7bpl7QKICAgIGZvcm1hdE1lc3NhZ2VUaW1lKHRpbWVzdGFtcCkgewogICAgICByZXR1cm4gZm9ybWF0TWVzc2FnZVRpbWVIZWxwZXIodGltZXN0YW1wKTsKICAgIH0sCiAgICAvLyDorqHnrpfmnIDnu4jlvpfliIblubbnoa7lrprotaLlrrYKICAgIGFzeW5jIGNvbXB1dGVGaW5hbFNjb3JlcygpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByaWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS5yb29tSWQ7CiAgICAgICAgaWYgKCFyaWQpIHJldHVybjsKICAgICAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7CiAgICAgICAgY29uc3QgewogICAgICAgICAgZGF0YTogcm93cwogICAgICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdyb29tX2FydGlmYWN0cycpLnNlbGVjdCgnb3duZXJfdXNlcl9pZCwgYXJ0aWZhY3RfaWQnKS5lcSgncm9vbV9pZCcsIHJpZCk7CiAgICAgICAgY29uc3QgdXNlclRvQXJ0aWZhY3RzID0ge307CiAgICAgICAgKHJvd3MgfHwgW10pLmZvckVhY2gociA9PiB7CiAgICAgICAgICBpZiAoIXVzZXJUb0FydGlmYWN0c1tyLm93bmVyX3VzZXJfaWRdKSB1c2VyVG9BcnRpZmFjdHNbci5vd25lcl91c2VyX2lkXSA9IFtdOwogICAgICAgICAgdXNlclRvQXJ0aWZhY3RzW3Iub3duZXJfdXNlcl9pZF0ucHVzaChyLmFydGlmYWN0X2lkKTsKICAgICAgICB9KTsKICAgICAgICBjb25zdCBjb2xsZWN0aW9ucyA9IEFycmF5LmlzQXJyYXkodGhpcy5jb2xsZWN0aW9ucykgPyB0aGlzLmNvbGxlY3Rpb25zIDogW107CiAgICAgICAgY29uc3Qgc2NvcmVzID0gT2JqZWN0LmtleXModXNlclRvQXJ0aWZhY3RzKS5tYXAodWlkID0+IHsKICAgICAgICAgIGNvbnN0IG93bmVkID0gdXNlclRvQXJ0aWZhY3RzW3VpZF07CiAgICAgICAgICAvLyDmlLbol4/pm4bliIbmlbAKICAgICAgICAgIGxldCBjb2xsZWN0aW9uU2NvcmUgPSAwOwogICAgICAgICAgY29sbGVjdGlvbnMuZm9yRWFjaChjb2wgPT4gewogICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gZ2V0Q29sbGVjdGlvbkNvdW50VXRpbCh7CiAgICAgICAgICAgICAgYXJ0aWZhY3RNYXA6IHRoaXMuYXJ0aWZhY3RNYXAsCiAgICAgICAgICAgICAgb3duZWRBcnRpZmFjdElkczogb3duZWQsCiAgICAgICAgICAgICAgY29sbGVjdGlvbjogY29sCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoY3VycmVudCA+PSAoY29sLnJlcXVpcmVkQ291bnQgfHwgMSkpIGNvbGxlY3Rpb25TY29yZSArPSBjb2wucmV3YXJkUG9pbnRzIHx8IDA7CiAgICAgICAgICB9KTsKICAgICAgICAgIC8vIOmbtuaVo+Wlh+eJqeWIhuaVsO+8iOWfuuehgOS7t+WAvOS4gOWNiu+8jOWQkeS4i+WPluaVtO+8iQogICAgICAgICAgbGV0IGFydGlmYWN0U2NvcmUgPSAwOwogICAgICAgICAgb3duZWQuZm9yRWFjaChhaWQgPT4gewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5hcnRpZmFjdE1hcFthaWRdOwogICAgICAgICAgICBpZiAoYSAmJiB0eXBlb2YgYS5iYXNlVmFsdWUgPT09ICdudW1iZXInKSBhcnRpZmFjdFNjb3JlICs9IE1hdGguZmxvb3IoYS5iYXNlVmFsdWUgLyAyKTsKICAgICAgICAgIH0pOwogICAgICAgICAgY29uc3QgdG90YWwgPSBjb2xsZWN0aW9uU2NvcmUgKyBhcnRpZmFjdFNjb3JlOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdXNlcklkOiB1aWQsCiAgICAgICAgICAgIG5hbWU6IHRoaXMuZ2V0TmFtZUZvcih1aWQpLAogICAgICAgICAgICBhdmF0YXI6IHRoaXMuZ2V0QXZhdGFyRm9yKHVpZCksCiAgICAgICAgICAgIGNvbGxlY3Rpb25TY29yZSwKICAgICAgICAgICAgYXJ0aWZhY3RTY29yZSwKICAgICAgICAgICAgdG90YWwKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgICAgY29uc3Qgc29ydGVkID0gc2NvcmVzLnNvcnQoKGEsIGIpID0+IGIudG90YWwgLSBhLnRvdGFsKTsKICAgICAgICB0aGlzLmZpbmFsU2NvcmVzID0gc29ydGVkOwogICAgICAgIHRoaXMud2lubmVySW5mbyA9IHNvcnRlZFswXSB8fCBudWxsOwogICAgICAgIGlmICh0aGlzLndpbm5lckluZm8pIHsKICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnQUREX0dBTUVfTE9HJywgewogICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksCiAgICAgICAgICAgIG1lc3NhZ2U6IGDmnKzlsYDnu5PmnZ/vvIzog5zogIXvvJoke3RoaXMud2lubmVySW5mby5uYW1lfe+8iOaAu+WIhiAke3RoaXMud2lubmVySW5mby50b3RhbH3vvIlgCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1tnYW1lXSBjb21wdXRlRmluYWxTY29yZXMgZmFpbGVkJywgZSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDlvIDlkK8v5YWz6Zet5paH54mp6K6y6L+wCiAgICBvcGVuTmFycmF0aW9uKCkgewogICAgICAvLyDmnoTpgKDorrLov7DmlofmnKzvvIzljIXlkKvln7rmnKzku4vnu40gKyDmlYXkuosKICAgICAgY29uc3QgYmFzZSA9IGAke3RoaXMuc2VsZWN0ZWRDYXJkLm5hbWV977yM5p2l6IeqICR7dGhpcy5zZWxlY3RlZENhcmQuZXJhfSR7dGhpcy5zZWxlY3RlZENhcmQubG9jYXRpb24gPyAnIMK3ICcgKyB0aGlzLnNlbGVjdGVkQ2FyZC5sb2NhdGlvbiA6ICcnfeOAglxuYDsKICAgICAgY29uc3Qgc3RvcnkgPSAodGhpcy5zZWxlY3RlZENhcmQuc3RvcnkgfHwgJycpLnRyaW0oKTsKICAgICAgY29uc3QgZnVsbCA9IGAke2Jhc2V9JHtzdG9yeX1gLnRyaW0oKTsKICAgICAgLy8g5omT5a2X5py65pWI5p6cCiAgICAgIHRoaXMudHlwaW5nVGV4dCA9ICcnOwogICAgICB0aGlzLnNob3dOYXJyYXRpb24gPSB0cnVlOwogICAgICBjb25zdCBzcGVlZCA9IGZpcnN0TG9naW5EaWFsb2d1ZUNvbmZpZyAmJiBmaXJzdExvZ2luRGlhbG9ndWVDb25maWcuYW5pbWF0aW9ucyAmJiBmaXJzdExvZ2luRGlhbG9ndWVDb25maWcuYW5pbWF0aW9ucy50ZXh0VHlwaW5nU3BlZWQgfHwgMzA7CiAgICAgIGlmICh0aGlzLnR5cGluZ1RpbWVyKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnR5cGluZ1RpbWVyKTsKICAgICAgICB0aGlzLnR5cGluZ1RpbWVyID0gbnVsbDsKICAgICAgfQogICAgICBsZXQgaSA9IDA7CiAgICAgIHRoaXMudHlwaW5nVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgaWYgKGkgPj0gZnVsbC5sZW5ndGgpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy50eXBpbmdUaW1lcik7CiAgICAgICAgICB0aGlzLnR5cGluZ1RpbWVyID0gbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy50eXBpbmdUZXh0ICs9IGZ1bGxbaV07CiAgICAgICAgICBpICs9IDE7CiAgICAgICAgfQogICAgICB9LCBzcGVlZCk7CiAgICB9LAogICAgY2xvc2VOYXJyYXRpb24oKSB7CiAgICAgIGlmICh0aGlzLnR5cGluZ1RpbWVyKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnR5cGluZ1RpbWVyKTsKICAgICAgICB0aGlzLnR5cGluZ1RpbWVyID0gbnVsbDsKICAgICAgfQogICAgICB0aGlzLnNob3dOYXJyYXRpb24gPSBmYWxzZTsKICAgICAgdGhpcy50eXBpbmdUZXh0ID0gJyc7CiAgICB9CiAgfQp9Ow=="},{"version":3,"names":["mapState","mapGetters","AuctionPanel","roomService","getSupabase","auctionService","startCountdown","clearCountdown","loadRoomState","loadRoomStateService","subscribeRoomRealtime","subscribeRoomRealtimeService","unsubscribeRoomRealtime","unsubscribeRoomRealtimeService","startGame","startGameFlow","autoStartAuction","autoStartAuctionFlow","sendChatMessage","toggleReady","toggleReadyAction","moveToSeat","moveToSeatAction","leaveRoom","leaveRoomAction","loadArtifacts","loadArtifactsService","loadCollectionsFromArtifacts","getCurrentCollectionCount","getCollectionCountUtil","getCollectionProgress","getCollectionProgressUtil","formatMessageTime","formatMessageTimeHelper","getAvatarFor","getAvatarForHelper","getNameFor","getNameForHelper","firstLoginDialogue","firstLoginDialogueConfig","getCurrentLanguage","getCurrentLanguageImported","name","components","data","selectedCard","showHandPopup","handPlayer","artifactMap","room","profileMap","refreshTimer","collections","showGameEndDialog","finalScores","winnerInfo","auctionCountdown","auctionTimer","currentAuction","roundCount","totalRounds","chatMessages","newMessage","chatChannel","countdownInProgress","expandedCollections","showNarration","typingText","typingTimer","allPlayersArtifacts","computed","currentPlayer","$store","state","isOwner","user","owner_id","id","allReady","players","room_players","length","every","p","is_ready","currentUserReady","me","find","user_id","playerCount","ownerName","seatCount","Number","max_players","seats","max","Array","from","player","forEach","idx","seat_index","filter","emptyIdx","findIndex","s","gamePhaseText","phaseMap","gamePhase","collectionsComputed","list","isArray","map","col","current","progress","Math","min","requiredCount","_current","_progress","chatFeed","logs","gameLog","l","timestamp","type","userId","username","content","message","chats","m","merged","sort","a","b","firstLoginConfig","narrationCharacterName","narrationCharacter","key","chars","characters","image","position","color","mounted","roomId","$route","query","commit","initializeGame","beforeDestroy","clearInterval","$set","watch","$nextTick","chatContainer","$refs","scrollTop","scrollHeight","methods","artifacts","reduce","acc","loadCollections","rid","supabase","roomChannel","broadcastChannel","onLoadRoomState","onGameStarted","_payload","energy","items","seconds","onTick","onDone","getRef","setRef","onAuctionStarted","duration","payload","roundCurrent","roundTotal","startAuctionTimer","onBidUpdate","auctionId","highestBid","highestBidder","currentAuctions","next","onRoundUpdated","_data","onGameEnded","computeFinalScores","finally","onAuctionEnded","onChatMessage","existing","push","setInterval","store","setRoom","setProfileMap","setGamePhase","phase","clearAuctionTimer","setAuctionCountdown","n","onShowGameEnd","setTimeout","handleGameEnd","loadAllPlayersArtifacts","auctions","remaining","onAuctionTimeUp","allArtifacts","select","eq","playerArtifactsMap","row","owner_user_id","artifact_id","e","console","warn","uid","reload","targetSeat","index","setCountdown","unsubscribe","setRoomId","v","setLocalRoom","navigateToRooms","$router","update","status","path","gameEnded","_","setCurrentPlayerFromRoom","onCountdownDone","startAuction","picks","candidate","floor","random","art","dispatch","error","showArtifactDetail","artifactId","artifact","era","location","story","collectionTags","baseValue","hideCardDetail","showArtifactDetailFromAuction","openNarration","getPlayerTotalValue","owned","playerArtifacts","Object","keys","total","aid","showPlayerHand","playerData","hideHand","collection","ownedArtifactIds","toggleCollection","closeGameEndDialog","stayInRoom","goToRooms","cur","tot","startIntermissionTimer","dispatchStartAuction","sec","setRoundCount","sendMessage","trim","Date","now","rows","userToArtifacts","r","scores","collectionScore","rewardPoints","artifactScore","avatar","sorted","base","full","speed","animations","textTypingSpeed","i","closeNarration"],"sources":["src/pages/index/index.vue"],"sourcesContent":["<template>\n  <div class=\"game-container\" :class=\"{ 'post-start': gamePhase !== 'preparation' }\">\n    <!-- 顶部状态栏：品牌/用户信息/导航控制（登录、个人中心、准备/开始/商店/退出） -->\n    <div class=\"top-auth-bar\">\n      <div class=\"left\">\n        <span class=\"brand\">时空旅人拍卖会</span>\n      </div>\n      <div class=\"right\" v-if=\"user\">\n        <span class=\"user-email\">{{ user.email }}</span>\n        <button class=\"nav-button\" @click=\"$router.push('/profile')\">个人中心</button>\n      </div>\n      <div class=\"right\" v-else>\n        <button class=\"nav-button primary\" @click=\"$router.push('/login')\">登录 / 注册</button>\n      </div>\n    </div>\n\n    <div class=\"game-status\">\n      <div class=\"room-info\">\n        <div class=\"room-name\">{{ room ? (room.name || '未命名房间') : '未加入房间' }}</div>\n        <div class=\"room-meta\" v-if=\"room\">玩家 {{ playerCount }}/{{ seatCount }} · 房主：{{ ownerName }}</div>\n        <div class=\"room-id-pill\">ID: {{ room ? (room.short_id || room.id) : '-' }}</div>\n      </div>\n      <span class=\"game-phase\">{{ gamePhaseText }}</span>\n       <div class=\"player-energy-hud\" v-if=\"currentPlayer && gamePhase === 'item'\">\n        <span class=\"icon\">⚡</span>\n        <span class=\"label\">能量</span>\n        <span class=\"value\">{{ $store.state.playerEnergy }}</span>\n      </div>\n      <div class=\"game-controls\">\n        <button class=\"control-button\" @click=\"toggleReady\" v-if=\"gamePhase === 'preparation'\">{{ currentUserReady ? '取消准备' : '准备' }}</button>\n        <button class=\"control-button\" @click=\"startGame\" v-if=\"gamePhase === 'preparation' && isOwner && allReady\">开始游戏</button>\n        <button class=\"control-button\" @click=\"startAuction\" v-if=\"false\">开始拍卖</button>\n        <button class=\"control-button danger\" @click=\"leaveRoom\">退出房间</button>\n      </div>\n    </div>\n\n    <!-- 玩家头像区域：展示房间玩家，点击头像可查看该玩家手牌（当前仅展示自己的手牌明细） -->\n    <div class=\"players-avatars\" v-if=\"playerCount > 0 && gamePhase !== 'preparation'\">\n      <div class=\"avatar-item\" v-for=\"p in (room ? room.room_players : [])\" :key=\"p.user_id\" @click=\"showPlayerHand(p)\">\n        <div class=\"avatar-wrap\">\n          <img class=\"player-avatar\" :src=\"getAvatarFor(p.user_id)\" />\n          <span class=\"ready-indicator\" :class=\"{ on: !!p.is_ready }\"></span>\n        </div>\n        <div class=\"player-name\">{{ getNameFor(p.user_id) }}</div>\n        <div class=\"player-value\">价值 {{ getPlayerTotalValue(p.user_id) }}</div>\n      </div>\n    </div>\n\n    <!-- 拍卖舞台：在不同的 gamePhase 下显示倒计时/间歇/拍卖面板或占位提示 -->\n    <div class=\"auction-stage\" :class=\"{ 'align-left': gamePhase === 'auction' }\">\n      <!-- 预倒计时阶段（游戏开始后5s预热） -->\n      <template v-if=\"gamePhase === 'countdown'\">\n        <div class=\"countdown-stage\">\n          <div class=\"countdown-content\">\n            <div class=\"countdown-icon\">⏳</div>\n            <div class=\"countdown-title\">游戏即将开始</div>\n            <div class=\"countdown-timer\">{{ auctionCountdown }}s</div>\n            <div class=\"countdown-subtitle\">请稍候，拍卖即将开始...</div>\n          </div>\n        </div>\n      </template>\n            <!-- 间歇阶段（每轮结束后的休息时间） -->\n      <template v-else-if=\"gamePhase === 'intermission'\">\n        <div class=\"countdown-stage\">\n          <div class=\"countdown-content\">\n            <div class=\"countdown-icon\">🧭</div>\n            <div class=\"countdown-title\">间歇中</div>\n            <div class=\"countdown-timer\">{{ auctionCountdown }}s</div>\n            <div class=\"countdown-subtitle\">请稍候，下一轮拍卖即将开始...</div>\n          </div>\n        </div>\n      </template>\n      \n      <!-- 拍卖阶段：展示拍卖面板（当前拍品列表、轮次信息、点击卡片触发讲述） -->\n      <auction-panel \n        v-else-if=\"gamePhase === 'auction' && $store.state.currentAuctions && $store.state.currentAuctions.length\" \n        :auctions=\"$store.state.currentAuctions\" \n        :countdown=\"auctionCountdown\"\n        :round-current=\"$store.state.roundCurrent\"\n        :round-total=\"$store.state.roundTotal\"\n        @artifact-click=\"showArtifactDetailFromAuction\" \n      />\n      <!-- 其他情况显示占位提示 -->\n      <div v-else class=\"stage-placeholder\">拍卖会台空闲，等待新一轮拍卖</div>\n    </div>\n\n    <!-- 房间座位区（准备阶段）：点击空位入座，已入座玩家显示头像与准备标记 -->\n    <div class=\"seats\" v-if=\"seatCount > 0 && gamePhase === 'preparation'\" :style=\"{ gridTemplateColumns: 'repeat(' + seatCount + ', 1fr)' }\">\n      <div class=\"seat\" v-for=\"(seat, idx) in seats\" :key=\"idx\" :class=\"{ occupied: !!seat.player }\" @click=\"moveToSeat(idx)\">\n        <div class=\"seat-index\">{{ idx + 1 }}/{{ seatCount }}</div>\n        <div class=\"seat-body\">\n          <div v-if=\"seat.player\" class=\"seat-player\">\n            <div class=\"avatar-wrap\">\n              <img class=\"seat-avatar\" :src=\"getAvatarFor(seat.player.user_id)\" />\n              <span v-if=\"seat.player.is_ready\" class=\"ready-badge\">✓</span>\n            </div>\n            <div class=\"seat-name\">{{ getNameFor(seat.player.user_id) }}</div>\n          </div>\n          <div v-else class=\"seat-empty\">空位</div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 当前玩家手牌：展示自己已拥有的奇物，点击查看详情（或触发讲述） -->\n    <div class=\"my-hand\" v-if=\"gamePhase !== 'preparation'\">\n      <h3 class=\"hand-title\">我的手牌</h3>\n      <div class=\"hand-grid\">\n        <div\n          v-for=\"(aid, idx) in (currentPlayer ? currentPlayer.artifacts : [])\"\n          :key=\"aid + '-' + idx\"\n          class=\"hand-card fancy\"\n          @click=\"showArtifactDetail(aid)\"\n        >\n          <div class=\"hand-media\">\n            <img\n              class=\"hand-image\"\n              :src=\"artifactMap[aid] ? artifactMap[aid].image : 'https://via.placeholder.com/160x100?text=未知卡牌'\"\n            />\n            <div class=\"hand-overlay\"></div>\n          </div>\n          <div class=\"hand-info\">\n            <div class=\"hand-name\" :title=\"artifactMap[aid] ? artifactMap[aid].name : aid\">\n              {{ artifactMap[aid] ? artifactMap[aid].name : aid }}\n            </div>\n            <div class=\"hand-era\" v-if=\"artifactMap[aid] && (artifactMap[aid].era || artifactMap[aid].location)\">\n              {{ artifactMap[aid].era }}<span v-if=\"artifactMap[aid].location\"> · {{ artifactMap[aid].location }}</span>\n            </div>\n            <div class=\"hand-tags\" v-if=\"artifactMap[aid] && artifactMap[aid].collectionTags && artifactMap[aid].collectionTags.length\">\n              <span\n                class=\"hand-tag\"\n                v-for=\"tag in artifactMap[aid].collectionTags.slice(0,2)\"\n                :key=\"tag\"\n              >{{ tag }}</span>\n              <span class=\"hand-tag more\" v-if=\"artifactMap[aid].collectionTags.length > 2\">+{{ artifactMap[aid].collectionTags.length - 2 }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 收藏集进度：仅展示与自己已拥有奇物相关的收藏集，支持展开查看成员清单 -->\n    <div class=\"collections-panel\" v-if=\"gamePhase !== 'preparation'\">\n      <div class=\"collections-section\">\n        <h4 class=\"collections-title\">收藏集进度</h4>\n        <div class=\"collections-list\">\n          <div \n            v-for=\"collection in collectionsComputed\" \n            :key=\"collection.id\"\n            class=\"collection-progress-item\"\n            :class=\"{ completed: collection._current >= collection.requiredCount }\"\n          >\n            <div class=\"collection-header\" @click=\"toggleCollection(collection)\">\n              <div class=\"collection-icon\">🏆</div>\n              <div class=\"collection-info\">\n                <div class=\"collection-name\">{{ collection.name }}</div>\n                <div class=\"collection-description\">{{ collection.description }}</div>\n              </div>\n              <div class=\"collection-reward\" v-if=\"collection._current >= collection.requiredCount\">\n                <span class=\"reward-badge\">✓</span>\n              </div>\n            </div>\n            <!-- 展开展示该收藏集所需所有商品 -->\n            <div class=\"collection-members\" v-if=\"expandedCollections[collection.id]\">\n              <div class=\"member-item\" v-for=\"aid in (collection.artifactIds || [])\" :key=\"aid\">\n                <img class=\"member-image\" :src=\"artifactMap[aid] ? artifactMap[aid].image : 'https://via.placeholder.com/60x40?text=No+Img'\" />\n                <div class=\"member-info\">\n                  <div class=\"member-name\">{{ artifactMap[aid] ? artifactMap[aid].name : aid }}</div>\n                  <div class=\"member-meta\">{{ artifactMap[aid] && artifactMap[aid].era }}<span v-if=\"artifactMap[aid] && artifactMap[aid].location\"> · {{ artifactMap[aid].location }}</span></div>\n                </div>\n                <div class=\"member-status\" :class=\"{ owned: currentPlayer && currentPlayer.artifacts && currentPlayer.artifacts.includes(aid) }\">\n                  {{ currentPlayer && currentPlayer.artifacts && currentPlayer.artifacts.includes(aid) ? '已拥有' : '未拥有' }}\n                </div>\n              </div>\n            </div>\n            <div class=\"progress-container\">\n              <div class=\"progress-bar\">\n                <div \n                  class=\"progress-fill\"\n                  :style=\"{ width: collection._progress + '%' }\"\n                ></div>\n              </div>\n              <div class=\"progress-text\">\n                {{ collection._current }}/{{ collection.requiredCount }}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 聊天/日志面板：合并系统日志与聊天消息为统一时间序信息流 -->\n    <div class=\"chat-panel\" v-if=\"gamePhase !== 'preparation'\">\n      <div class=\"chat-header\">\n        <h4 class=\"chat-title\">聊天 / 日志</h4>\n        <div class=\"chat-status\">\n          <span class=\"status-dot\"></span>\n          <span class=\"status-text\">在线</span>\n        </div>\n      </div>\n      \n      <div class=\"chat-messages\" ref=\"chatContainer\">\n        <div \n          v-for=\"message in chatFeed\" \n          :key=\"message.id\"\n          class=\"chat-message\"\n          :class=\"{ 'own-message': message.type === 'chat' && message.userId === (user && user.id), 'system-log': message.type === 'log' }\"\n        >\n          <div class=\"message-header\">\n            <span class=\"message-username\">{{ message.type === 'log' ? '系统' : message.username }}</span>\n            <span class=\"message-time\">{{ formatMessageTime(message.timestamp) }}</span>\n          </div>\n          <div class=\"message-content\">{{ message.content }}</div>\n        </div>\n      </div>\n      \n      <div class=\"chat-input\">\n        <input \n          v-model=\"newMessage\"\n          @keyup.enter=\"sendMessage\"\n          placeholder=\"输入消息...\"\n          class=\"message-input\"\n        />\n        <button @click=\"sendMessage\" class=\"send-button\" :disabled=\"!newMessage.trim()\">\n          <span class=\"send-icon\">📤</span>\n        </button>\n      </div>\n    </div>\n\n    <!-- 卡牌详情弹窗：展示所选奇物的核心信息与标签 -->\n    <div v-if=\"showCardDetail\" class=\"card-detail-popup\">\n      <div class=\"popup-overlay\" @click=\"hideCardDetail\"></div>\n      <div class=\"popup-content\" v-if=\"selectedCard\">\n        <img \n          class=\"detail-image\" \n          :src=\"selectedCard.image\" \n          alt=\"奇物图片\"\n        />\n        <div class=\"detail-content\">\n          <h3 class=\"detail-name\">{{ selectedCard.name }}</h3>\n          <p class=\"detail-era\">{{ selectedCard.era }} - {{ selectedCard.location }}</p>\n          <p class=\"detail-story\">{{ selectedCard.story }}</p>\n          <div class=\"detail-tags\">\n            <span \n              v-for=\"tag in selectedCard.collectionTags\" \n              :key=\"tag\"\n              class=\"detail-tag\"\n            >\n              {{ tag }}\n            </span>\n          </div>\n          <p class=\"detail-value\">基础价值: {{ selectedCard.baseValue }}</p>\n            \n        </div>\n        <button class=\"close-button\" @click=\"hideCardDetail\">关闭</button>\n      </div>\n    </div>\n\n      <!-- 文物讲述弹层：以角色对白形式讲述 selectedCard 的关键信息 -->\n      <div v-if=\"showNarration && selectedCard\" class=\"narration-popup\">\n        <div class=\"popup-overlay\" @click=\"closeNarration\"></div>\n        <div class=\"popup-content narration-content\">\n          <!-- 顶部：文物大图与快速元信息，图片下方显示名称 -->\n          <div class=\"artifact-media\" v-if=\"selectedCard\">\n            <img class=\"artifact-image-large\" :src=\"selectedCard.image || 'https://via.placeholder.com/800x240?text=Artifact'\" alt=\"artifact\" />\n            <div class=\"artifact-quick-meta\">\n              <span class=\"badge era\" v-if=\"selectedCard.era\">{{ selectedCard.era }}</span>\n              <span class=\"badge location\" v-if=\"selectedCard.location\">{{ selectedCard.location }}</span>\n              <span class=\"badge value\" v-if=\"selectedCard.baseValue !== undefined\">价值 {{ selectedCard.baseValue }}</span>\n              <span class=\"badge tags\" v-if=\"(selectedCard.collectionTags || []).length\">{{ (selectedCard.collectionTags || []).slice(0,3).join('、') }}</span>\n            </div>\n          </div>\n          <div class=\"artifact-caption\" v-if=\"selectedCard && selectedCard.name\">{{ selectedCard.name }}</div>\n\n          <!-- 下方：人物与对白一行排列 -->\n          <div class=\"narration-dialog\">\n            <!-- 左侧：角色大图与姓名 -->\n            <div class=\"character-side\" :style=\"{ borderColor: narrationCharacter && narrationCharacter.color ? narrationCharacter.color : '#3b82f6' }\">\n              <img class=\"character-image\" :src=\"(narrationCharacter && narrationCharacter.image) || '/images/guide.png'\" />\n              <div class=\"character-name\" :style=\"{ color: narrationCharacter && narrationCharacter.color ? narrationCharacter.color : '#3b82f6' }\">\n                {{ narrationCharacterName }}\n              </div>\n            </div>\n            <!-- 右侧：对白气泡 -->\n            <div class=\"speech-side\">\n              <div class=\"speech-bubble\">\n                <div class=\"speech-text\">{{ typingText }}</div>\n              </div>\n              <div class=\"narration-actions\">\n                <button class=\"control-button primary\" @click=\"closeNarration\">好的</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n\n    <!-- 手牌弹窗：查看某位玩家的手牌缩略（当前仅展示当前玩家持有的真实列表） -->\n    <div v-if=\"showHandPopup\" class=\"hand-popup\">\n      <div class=\"popup-overlay\" @click=\"hideHand\"></div>\n      <div class=\"popup-content\">\n        <h3 class=\"hand-title\">{{ handPlayer ? handPlayer.name + ' 的手牌' : '手牌' }}</h3>\n        <div class=\"hand-grid\">\n          <div v-for=\"aid in (handPlayer ? handPlayer.artifacts : [])\" :key=\"aid\" class=\"hand-card\">\n            <img class=\"hand-image\" :src=\"artifactMap[aid] ? artifactMap[aid].image : 'https://via.placeholder.com/160x100?text=未知卡牌'\" />\n            <div class=\"hand-name\">{{ artifactMap[aid] ? artifactMap[aid].name : aid }}</div>\n          </div>\n        </div>\n        <button class=\"close-button\" @click=\"hideHand\">关闭</button>\n      </div>\n    </div>\n\n    <!-- 游戏结束对话框：展示最终排名与赢家信息，提供回房或去列表的导航 -->\n    <div v-if=\"showGameEndDialog\" class=\"game-end-popup\">\n      <div class=\"popup-overlay\" @click=\"closeGameEndDialog\"></div>\n      <div class=\"popup-content game-end-content\">\n        <div class=\"game-end-header\">\n          <div class=\"game-end-icon\">🏆</div>\n          <h2 class=\"game-end-title\">游戏结束</h2>\n          <p class=\"game-end-subtitle\" v-if=\"winnerInfo\">胜者：{{ winnerInfo.name }} · 总分 {{ winnerInfo.total }}</p>\n          <p class=\"game-end-subtitle\" v-else>感谢参与时空旅人拍卖会！</p>\n        </div>\n        <div class=\"final-scoreboard\" v-if=\"finalScores && finalScores.length\">\n          <div class=\"score-row\" v-for=\"(p, idx) in finalScores\" :key=\"p.userId\">\n            <div class=\"rank\">{{ idx + 1 }}</div>\n            <img class=\"score-avatar\" :src=\"p.avatar\" />\n            <div class=\"name\">{{ p.name }}</div>\n            <div class=\"detail\">收藏集 {{ p.collectionScore }} + 奇物 {{ p.artifactScore }} = <b>{{ p.total }}</b></div>\n          </div>\n        </div>\n        \n        <div class=\"game-end-actions\">\n          <button class=\"action-button primary\" @click=\"stayInRoom\">\n            <span class=\"btn-icon\">🏠</span>\n            留在房间\n          </button>\n          <button class=\"action-button secondary\" @click=\"goToRooms\">\n            <span class=\"btn-icon\">📋</span>\n            返回房间列表\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapGetters } from 'vuex'\nimport AuctionPanel from '../../components/auction-panel/auction-panel.vue'\nimport roomService from '../../services/room-service'\nimport { getSupabase } from '../../services/supabase-client'\nimport auctionService from '../../services/auction-service'\nimport { startCountdown, clearCountdown } from '../../features/game/countdown'\nimport { loadRoomState as loadRoomStateService } from '../../features/game/room-state.service'\nimport { subscribeRoomRealtime as subscribeRoomRealtimeService, unsubscribeRoomRealtime as unsubscribeRoomRealtimeService } from '../../features/game/room-realtime'\nimport { startGame as startGameFlow, autoStartAuction as autoStartAuctionFlow } from '../../features/game/auction-flow.service'\nimport { sendChatMessage } from '../../features/game/chat.service'\nimport { toggleReady as toggleReadyAction, moveToSeat as moveToSeatAction, leaveRoom as leaveRoomAction } from '../../features/game/room-actions.service'\nimport { loadArtifacts as loadArtifactsService } from '../../features/game/artifacts.service'\nimport { loadCollectionsFromArtifacts, getCurrentCollectionCount as getCollectionCountUtil, getCollectionProgress as getCollectionProgressUtil } from '../../features/game/collections.utils'\nimport { formatMessageTime as formatMessageTimeHelper, getAvatarFor as getAvatarForHelper, getNameFor as getNameForHelper } from '../../features/game/ui.helpers'\nimport { firstLoginDialogue as firstLoginDialogueConfig, getCurrentLanguage as getCurrentLanguageImported } from '../../config/dialogue-config'\nexport default {\n  name: 'GameIndex',\n  components: {\n    AuctionPanel\n  },\n  data() {\n    return {\n      selectedCard: null,\n      showHandPopup: false,\n      handPlayer: null,\n      artifactMap: {},\n      room: null,\n      profileMap: {},\n      refreshTimer: null,\n      collections: [],\n      showGameEndDialog: false,\n      finalScores: [],\n      winnerInfo: null,\n      auctionCountdown: 0,\n      auctionTimer: null,\n      currentAuction: null,\n      // 回合相关（前端实时显示，房主每轮开拍时广播以保持同步）\n      roundCount: 0,\n      totalRounds: 6,\n      chatMessages: [],\n      newMessage: '',\n      chatChannel: null,\n      countdownInProgress: false,\n      expandedCollections: {},\n      showNarration: false,\n      typingText: '',\n      typingTimer: null,\n      // 存储所有玩家的手牌数据，用于价值计算\n      allPlayersArtifacts: {}\n    }\n  },\n  computed: {\n    ...mapState(['gamePhase', 'gameLog', 'showCardDetail', 'user', 'roomId', 'roundCurrent', 'roundTotal']),\n    // 将当前玩家注入到渲染上下文，避免模板引用报错\n    currentPlayer() { return this.$store.state.currentPlayer },\n    isOwner() { return this.room && this.user && this.room.owner_id === this.user.id },\n    allReady() {\n      const players = (this.room && this.room.room_players) ? this.room.room_players : []\n      return players.length > 0 && players.every(p => !!p.is_ready)\n    },\n    currentUserReady() {\n      const user = this.user\n      const players = (this.room && this.room.room_players) ? this.room.room_players : []\n      if (!user) return false\n      const me = players.find(p => p.user_id === user.id)\n      return !!(me && me.is_ready)\n    },\n    playerCount() {\n      return (this.room && this.room.room_players) ? this.room.room_players.length : 0\n    },\n    ownerName() {\n      if (!this.room) return '-'\n      return this.getNameFor(this.room.owner_id)\n    },\n    seatCount() { return (this.room && Number(this.room.max_players)) ? Number(this.room.max_players) : 0 },\n    seats() {\n      const players = (this.room && this.room.room_players) ? this.room.room_players : []\n      const max = this.seatCount\n      const seats = Array.from({ length: max }, () => ({ player: null }))\n      // 放置已设置座位的玩家\n      players.forEach(p => {\n        const idx = typeof p.seat_index === 'number' ? p.seat_index : -1\n        if (idx >= 0 && idx < max && !seats[idx].player) seats[idx].player = p\n      })\n      // 将未设置座位的玩家依次放到空位\n      players.filter(p => typeof p.seat_index !== 'number' || p.seat_index < 0).forEach(p => {\n        const emptyIdx = seats.findIndex(s => !s.player)\n        if (emptyIdx >= 0) seats[emptyIdx].player = p\n      })\n      return seats\n    },\n    gamePhaseText() {\n      const phaseMap = {\n        'preparation': '准备阶段',\n        'countdown': '预倒计时',\n        'intermission': '间歇阶段',\n        'auction': '拍卖阶段',\n        'item': '道具阶段',\n        'settlement': '结算阶段'\n      }\n      return phaseMap[this.gamePhase] || '未知阶段'\n    },\n   \n\n    // 根据当前用户手牌计算收藏集显示数据，带缓存字段，便于模板直接引用\n    collectionsComputed() {\n      const list = Array.isArray(this.collections) ? this.collections : []\n      // 仅展示用户手牌中至少包含1件该收藏集的情况\n      return list\n        .map(col => {\n          const current = this.getCurrentCollectionCount(col)\n          const progress = Math.min((current / (col.requiredCount || 1)) * 100, 100)\n          return { ...col, _current: current, _progress: progress }\n        })\n        .filter(col => col._current > 0)\n    },\n\n    // 合并聊天与系统日志为同一信息流，按时间排序\n    chatFeed() {\n      const logs = (this.gameLog || []).map((l, idx) => ({\n        id: `log-${l.timestamp || idx}`,\n        type: 'log',\n        userId: null,\n        username: '系统',\n        content: l.message,\n        timestamp: l.timestamp || 0\n      }))\n      const chats = (this.chatMessages || []).map(m => ({ ...m, type: 'chat' }))\n      const merged = [...logs, ...chats]\n      return merged.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0))\n    },\n    // 暴露对话配置供模板使用\n    firstLoginConfig() { return firstLoginDialogueConfig },\n    // 当前讲述角色配置与名称\n    narrationCharacterName() { return (this.getCurrentLanguage() === 'zh-CN') ? '大木博士' : 'Dr. Alina' },\n    narrationCharacter() {\n      const key = this.narrationCharacterName\n      const chars = firstLoginDialogueConfig && firstLoginDialogueConfig.characters\n      return (chars && chars[key]) ? chars[key] : { image: '/images/guide.png', position: 'right', color: '#3b82f6' }\n    }\n  },\n  async mounted() {\n    const roomId = this.$route.query.roomId\n    if (roomId) this.$store.commit('SET_ROOM_ID', roomId)\n    await this.initializeGame()\n    await this.loadRoomState()\n    // loadRoomState 中已经调用了 loadAllPlayersArtifacts，这里确保数据加载\n    await this.subscribeRoomRealtime()\n  },\n  beforeDestroy() {\n    this.unsubscribeRoomRealtime()\n    if (this.refreshTimer) { clearInterval(this.refreshTimer); this.refreshTimer = null }\n    if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null }\n    if (this.typingTimer) { clearInterval(this.typingTimer); this.typingTimer = null }\n    this.$set(this, 'auctionCountdown', 0)\n  },\n  watch: {\n    gameLog() {\n      this.$nextTick(() => {\n        const chatContainer = this.$refs.chatContainer\n        if (chatContainer) { chatContainer.scrollTop = chatContainer.scrollHeight }\n      })\n    }\n  },\n  methods: {\n    // 去掉模拟初始化玩家，改为使用房间的实际玩家列表\n    async initializeGame() {\n      const artifacts = await this.loadArtifacts()\n      this.artifactMap = artifacts.reduce((acc, a) => { acc[a.id] = a; return acc }, {})\n      await this.loadCollections()\n    },\n    async subscribeRoomRealtime() {\n      const rid = this.$store.state.roomId\n      if (!rid) return\n      const supabase = getSupabase()\n      const { roomChannel, broadcastChannel } = subscribeRoomRealtimeService(\n        { roomId: rid, supabase, onLoadRoomState: this.loadRoomState },\n        {\n          onGameStarted: async (_payload) => {\n            // 防止重复启动多个倒计时\n            if (this.countdownInProgress) return\n            this.countdownInProgress = true\n            \n            // 新局开始：重置聊天消息和价值数据\n            this.chatMessages = []\n            this.allPlayersArtifacts = {}\n            // 重置回合数\n            this.$store.commit('RESET_ROUND')\n            this.$store.commit('SET_ROUND_TOTAL', 6)\n            \n            this.$store.commit('SET_GAME_PHASE', 'countdown')\n            this.$set(this, 'auctionCountdown', 5)\n            const me = (this.room && this.room.room_players ? this.room.room_players : []).find(p => p.user_id === this.$store.state.user.id)\n            if (me) {\n              this.$store.commit('SET_CURRENT_PLAYER', { id: me.user_id, name: this.getNameFor(me.user_id), energy: 50, artifacts: [], items: [] })\n            }\n            if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null }\n            this.$nextTick(() => {\n              startCountdown({\n                seconds: 5,\n                onTick: (s) => { this.$set(this, 'auctionCountdown', s) },\n                onDone: async () => { this.countdownInProgress = false; if (this.isOwner) { await this.autoStartAuction() } },\n                getRef: () => this.auctionTimer,\n                setRef: (id) => { this.auctionTimer = id },\n              })\n            })\n          },\n          onAuctionStarted: async (duration, payload) => { \n            // 确保所有玩家都能看到拍卖数据\n            await this.loadRoomState()\n            \n            // 同步回合数（如果广播中包含了回合信息）\n            if (payload && typeof payload.roundCurrent === 'number') {\n              this.$store.commit('SET_ROUND_CURRENT', payload.roundCurrent)\n            }\n            if (payload && typeof payload.roundTotal === 'number') {\n              this.$store.commit('SET_ROUND_TOTAL', payload.roundTotal)\n            }\n            \n            this.startAuctionTimer(duration) \n          },\n          onBidUpdate: ({ auctionId, highestBid, highestBidder }) => {\n            if (!auctionId) return\n            const list = this.$store.state.currentAuctions || []\n            const idx = list.findIndex(a => a.id === auctionId)\n            if (idx >= 0) {\n              const next = { ...list[idx], highestBid, highestBidder }\n              this.$store.commit('ADD_OR_UPDATE_AUCTION', next)\n            }\n          },\n          // 旧回合广播已移除，统一本地推进，不再接收该事件\n          onRoundUpdated: (_data) => {},\n          onGameEnded: () => {\n            this.$store.commit('SET_GAME_PHASE', 'settlement')\n        this.computeFinalScores().finally(() => { this.showGameEndDialog = true })\n            if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null }\n          },\n          onAuctionEnded: async () => { await this.loadRoomState() },\n          onChatMessage: (message) => {\n            // 避免重复添加消息\n            if (!message || !message.id) return\n            const existing = this.chatMessages.find(m => m.id === message.id || (m.userId === message.userId && m.timestamp === message.timestamp && m.content === message.content))\n            if (existing) return\n            \n            this.chatMessages.push(message)\n            this.$nextTick(() => {\n              const chatContainer = this.$refs.chatContainer\n              if (chatContainer) { chatContainer.scrollTop = chatContainer.scrollHeight }\n            })\n          },\n        },\n        () => { if (!this.refreshTimer) { this.refreshTimer = setInterval(this.loadRoomState, 1000) } }\n      )\n      this.roomChannel = roomChannel\n      this.broadcastChannel = broadcastChannel\n    },\n    unsubscribeRoomRealtime() {\n      unsubscribeRoomRealtimeService(this.roomChannel, this.broadcastChannel)\n      this.roomChannel = null\n      this.broadcastChannel = null\n    },\n    async loadRoomState() {\n      const rid = this.$store.state.roomId\n      const supabase = getSupabase()\n      await loadRoomStateService({\n        roomId: rid,\n        roomService,\n        supabase,\n        artifactMap: this.artifactMap,\n        store: this.$store,\n        setRoom: (room) => { this.room = room },\n        setProfileMap: (map) => { this.profileMap = map },\n        setGamePhase: (phase) => { this.$store.commit('SET_GAME_PHASE', phase) },\n        clearAuctionTimer: () => { if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null } },\n        setAuctionCountdown: (n) => { this.$set(this, 'auctionCountdown', n) },\n        onShowGameEnd: () => { this.showGameEndDialog = true; setTimeout(() => { this.handleGameEnd() }, 3000) },\n      })\n      // 加载所有玩家的手牌数据，用于价值计算\n      await this.loadAllPlayersArtifacts()\n      // 如果刷新后发现仍有活跃拍卖，但本地无倒计时，则用当前剩余时间启动统一倒计时\n      const auctions = this.$store.state.currentAuctions || []\n      if (this.$store.state.gamePhase === 'auction' && auctions.length > 0) {\n        const remaining = Number(this.auctionCountdown || 0)\n        if (!this.auctionTimer && remaining > 0) {\n          startCountdown({\n            seconds: remaining,\n            onTick: (s) => { this.$set(this, 'auctionCountdown', s); },\n            onDone: async () => { await this.onAuctionTimeUp() },\n            getRef: () => this.auctionTimer,\n            setRef: (id) => { this.auctionTimer = id },\n          })\n        }\n      }\n    },\n    \n    // 加载所有玩家的手牌数据\n    async loadAllPlayersArtifacts() {\n      try {\n        const rid = this.$store.state.roomId\n        if (!rid) {\n          this.allPlayersArtifacts = {}\n          return\n        }\n        \n        const supabase = getSupabase()\n        // 获取房间内所有玩家的手牌数据\n        const { data: allArtifacts } = await supabase\n          .from('room_artifacts')\n          .select('owner_user_id, artifact_id')\n          .eq('room_id', rid)\n        \n        // 按玩家ID分组\n        const playerArtifactsMap = {}\n        if (allArtifacts && allArtifacts.length > 0) {\n          allArtifacts.forEach(row => {\n            const userId = row.owner_user_id\n            if (!playerArtifactsMap[userId]) {\n              playerArtifactsMap[userId] = []\n            }\n            playerArtifactsMap[userId].push(row.artifact_id)\n          })\n        }\n        \n        // 使用 Vue.set 确保响应式更新\n        this.$set(this, 'allPlayersArtifacts', playerArtifactsMap)\n      } catch (e) {\n        console.warn('[game] loadAllPlayersArtifacts failed', e)\n        this.allPlayersArtifacts = {}\n      }\n    },\n    async toggleReady() {\n      try {\n        const rid = this.$store.state.roomId\n        const uid = this.$store.state.user && this.$store.state.user.id\n        if (!rid || !uid) return\n        await toggleReadyAction({ roomId: rid, userId: uid, room: this.room, roomService, reload: this.loadRoomState })\n      } catch (e) { console.warn('[game] toggleReady failed', e) }\n    },\n    async moveToSeat(idx) {\n      try {\n        const rid = this.$store.state.roomId\n        const uid = this.$store.state.user && this.$store.state.user.id\n        if (!rid || !uid) return\n        const targetSeat = { index: idx, player: this.seats[idx] && this.seats[idx].player }\n        await moveToSeatAction({ roomId: rid, userId: uid, room: this.room, seats: targetSeat, roomService, reload: this.loadRoomState })\n      } catch (e) { console.warn('[game] moveToSeat failed', e) }\n    },\n    async leaveRoom() {\n      try {\n        const rid = this.$store.state.roomId\n        const uid = this.$store.state.user && this.$store.state.user.id\n        if (!rid || !uid) return\n        await leaveRoomAction({\n          roomId: rid,\n          userId: uid,\n          clearAuctionTimer: () => { if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null } },\n          setCountdown: (n) => { this.$set(this, 'auctionCountdown', n) },\n          store: this.$store,\n          auctionService,\n          roomService,\n          unsubscribe: () => this.unsubscribeRoomRealtime(),\n          setRoomId: (v) => this.$store.commit('SET_ROOM_ID', v),\n          setLocalRoom: (v) => { this.room = v },\n          navigateToRooms: () => this.$router.push('/rooms'),\n        })\n      } catch (e) { console.warn('[game] leaveRoom failed', e) }\n    },\n    \n    // 游戏结束处理\n    async handleGameEnd() {\n      try {\n        const rid = this.$store.state.roomId\n        if (rid) {\n          // 将房间状态重置为 waiting，便于继续房间内准备/新一局\n          const supabase = getSupabase()\n          await supabase.from('rooms').update({ status: 'waiting' }).eq('id', rid)\n          // 跳转回房间页面（游戏页携带 roomId 即是房间界面）\n          this.$router.push({ path: '/game', query: { roomId: rid, gameEnded: 'true' } })\n        } else {\n          this.$router.push('/rooms')\n        }\n      } catch (e) {\n        console.warn('[game] handleGameEnd failed', e)\n        // 兜底跳回房间列表\n        this.$router.push('/rooms')\n      }\n    },\n    async startGame() {\n      try {\n        const rid = this.$store.state.roomId\n        const uid = this.$store.state.user && this.$store.state.user.id\n        if (!rid || !uid || !this.isOwner || !this.allReady) return\n        // 新局开始前重置系统日志、聊天消息和价值数据\n        try { this.$store.commit('CLEAR_GAME_LOG') } catch (_) {}\n        this.chatMessages = []\n        this.allPlayersArtifacts = {}\n        await roomService.startGame(rid, uid)\n        const supabase = getSupabase()\n        this.roundCount = 0\n        await startGameFlow({\n          roomId: rid,\n          userId: uid,\n          isOwner: this.isOwner,\n          allReady: this.allReady,\n          store: this.$store,\n          supabase,\n          setCountdown: (n) => this.$set(this, 'auctionCountdown', n),\n          setCurrentPlayerFromRoom: () => {\n            const me = (this.room && this.room.room_players ? this.room.room_players : []).find(p => p.user_id === uid)\n            if (me) { this.$store.commit('SET_CURRENT_PLAYER', { id: me.user_id, name: this.getNameFor(me.user_id), energy: 50, artifacts: [], items: [] }) }\n          },\n          onCountdownDone: async () => {\n            if (this.isOwner) { await this.autoStartAuction() }\n          },\n        })\n        // 房主本地也启动预倒计时，防止广播不回传导致不触发 onGameStarted\n        if (!this.countdownInProgress) {\n          this.countdownInProgress = true\n          // 确保本地也重置数据\n          this.chatMessages = []\n          this.allPlayersArtifacts = {}\n          this.$store.commit('SET_GAME_PHASE', 'countdown')\n          this.$set(this, 'auctionCountdown', 5)\n          const me = (this.room && this.room.room_players ? this.room.room_players : []).find(p => p.user_id === uid)\n          if (me) {\n            this.$store.commit('SET_CURRENT_PLAYER', { id: me.user_id, name: this.getNameFor(me.user_id), energy: 50, artifacts: [], items: [] })\n          }\n          if (this.auctionTimer) { clearInterval(this.auctionTimer); this.auctionTimer = null }\n          this.$nextTick(() => {\n            startCountdown({\n              seconds: 5,\n              onTick: (s) => { this.$set(this, 'auctionCountdown', s) },\n              onDone: async () => { this.countdownInProgress = false; if (this.isOwner) { await this.autoStartAuction() } },\n              getRef: () => this.auctionTimer,\n              setRef: (id) => { this.auctionTimer = id },\n            })\n          })\n        }\n      } catch (e) { console.warn('[game] startGame failed', e) }\n    },\n    \n    async startAuction() {\n      // 同时抽取多件进行拍卖（示例为2件）\n      const artifacts = await this.loadArtifacts()\n      if (artifacts.length > 0) {\n        const picks = []\n        while (picks.length < Math.min(2, artifacts.length)) {\n          const candidate = artifacts[Math.floor(Math.random() * artifacts.length)]\n          if (!picks.find(p => p.id === candidate.id)) picks.push(candidate)\n        }\n        for (const art of picks) {\n          await this.$store.dispatch('startAuction', art)\n        }\n      }\n    },\n    \n    async loadArtifacts() {\n      try {\n        const supabase = getSupabase()\n        return await loadArtifactsService({ supabase })\n      } catch (error) { console.error('加载卡牌数据失败:', error); return [] }\n    },\n    \n    showArtifactDetail(artifactId) {\n      // 若已加载artifactMap，则优先展示真实数据\n      const artifact = this.artifactMap[artifactId]\n      if (artifact) {\n        this.selectedCard = artifact\n      } else {\n        // 回退：维持原示例\n        this.selectedCard = {\n          id: artifactId,\n          name: '示例奇物',\n          era: '古代',\n          location: '未知',\n          story: '这是一个神秘的奇物...',\n          collectionTags: ['艺术瑰宝'],\n          baseValue: 8,\n          image: 'https://via.placeholder.com/300x200?text=示例奇物'\n        }\n      }\n      this.$store.commit('SET_SHOW_CARD_DETAIL', true)\n    },\n    \n    hideCardDetail() {\n      this.$store.commit('SET_SHOW_CARD_DETAIL', false)\n      this.selectedCard = null\n    },\n    showArtifactDetailFromAuction(artifact) {\n      this.selectedCard = artifact\n      this.$store.commit('SET_SHOW_CARD_DETAIL', false)\n      this.openNarration()\n    },\n    // 计算玩家总价值（支持所有玩家）\n    getPlayerTotalValue(userId) {\n      if (!userId) return 0\n      \n      // 优先从 allPlayersArtifacts 获取所有玩家的手牌数据\n      let owned = []\n      if (this.allPlayersArtifacts && this.allPlayersArtifacts[userId]) {\n        owned = Array.isArray(this.allPlayersArtifacts[userId]) ? this.allPlayersArtifacts[userId] : []\n      } else {\n        // 回退：如果 allPlayersArtifacts 中没有，尝试从当前玩家数据获取\n        const current = this.$store.state.currentPlayer\n        if (current && current.id === userId) {\n          owned = Array.isArray(this.$store.state.playerArtifacts) ? this.$store.state.playerArtifacts : []\n        }\n      }\n      \n      if (!owned || owned.length === 0) return 0\n      \n      // 确保 artifactMap 已加载\n      if (!this.artifactMap || Object.keys(this.artifactMap).length === 0) return 0\n      \n      let total = 0\n      owned.forEach(aid => {\n        const a = this.artifactMap[aid]\n        if (a && typeof a.baseValue === 'number') {\n          total += a.baseValue\n        }\n      })\n      return total\n    },\n\n    showPlayerHand(player) {\n      // 构造玩家对象，包含手牌信息\n      const playerData = {\n        id: player.user_id,\n        name: this.getNameFor(player.user_id),\n        artifacts: this.currentPlayer && this.currentPlayer.id === player.user_id ? \n          (this.currentPlayer.artifacts || []) : []\n      }\n      this.handPlayer = playerData\n      this.showHandPopup = true\n    },\n\n    hideHand() {\n      this.handPlayer = null\n      this.showHandPopup = false\n    },\n    \n    \n    getAvatarFor(userId) { return getAvatarForHelper({ profileMap: this.profileMap, userId }) },\n    getNameFor(userId) { return getNameForHelper({ profileMap: this.profileMap, room: this.room, userId }) },\n    getCurrentLanguage() { return getCurrentLanguageImported() },\n    \n    // 加载收藏集数据：基于数据库 artifacts 的 collection_tags 动态生成\n    async loadCollections() {\n      try { this.collections = loadCollectionsFromArtifacts(this.artifactMap) }\n      catch (error) { console.error('加载收藏集数据失败:', error); this.collections = [] }\n    },\n    \n   \n    \n    // 获取当前收藏集数量（基于当前用户手牌，且受最大要求数上限限制）\n    getCurrentCollectionCount(collection) {\n      const owned = (this.currentPlayer && this.currentPlayer.artifacts) ? this.currentPlayer.artifacts : []\n      return getCollectionCountUtil({ artifactMap: this.artifactMap, ownedArtifactIds: owned, collection })\n    },\n\n\n    // 展开/收起收藏集\n    toggleCollection(collection) {\n      const id = collection && collection.id\n      if (!id) return\n      this.$set(this.expandedCollections, id, !this.expandedCollections[id])\n    },\n    \n    // 关闭游戏结束对话框\n    closeGameEndDialog() {\n      this.showGameEndDialog = false\n    },\n    \n    // 留在房间\n    stayInRoom() {\n      this.showGameEndDialog = false\n      try { this.$store.commit('CLEAR_GAME_LOG') } catch (_) {}\n      // 返回当前房间准备界面\n      const rid = this.$store.state.roomId\n      if (rid) {\n        this.$store.commit('SET_GAME_PHASE', 'preparation')\n        this.$router.push({ path: '/game', query: { roomId: rid } })\n      }\n    },\n    \n    // 返回房间列表\n    goToRooms() {\n      this.showGameEndDialog = false\n      this.unsubscribeRoomRealtime()\n      try { this.$store.commit('CLEAR_GAME_LOG') } catch (_) {}\n      // 返回当前房间准备界面（更符合期望）\n      const rid = this.$store.state.roomId\n      if (rid) {\n        this.$store.commit('SET_GAME_PHASE', 'preparation')\n        this.$router.push({ path: '/game', query: { roomId: rid } })\n      } else {\n        this.$router.push('/rooms')\n      }\n    },\n    \n    // 时间到：结束当前所有拍卖并结算到对应玩家手牌，然后进入10s间歇或结束游戏\n    async onAuctionTimeUp() {\n      try {\n        const auctions = this.$store.state.currentAuctions || []\n        // 统一倒计时结束：结束所有当前拍卖\n        for (const a of auctions) {\n          await this.$store.dispatch('endAuction', a.id)\n        }\n        // 判断是否达到总回合数\n        const cur = Number(this.$store.state.roundCurrent || 0)\n        const tot = Number(this.$store.state.roundTotal || 6)\n        if (cur >= tot) {\n          // 触发结束\n          this.$store.commit('SET_GAME_PHASE', 'settlement')\n          await this.computeFinalScores()\n          this.showGameEndDialog = true\n          return\n        }\n        // 否则进入10s间歇阶段\n        this.startIntermissionTimer(10)\n      } catch (e) { console.warn('[game] onAuctionTimeUp failed', e) }\n    },\n\n    // 开始拍卖倒计时：统一每轮拍卖只有一个倒计时\n    startAuctionTimer(duration = 30) {\n      this.$store.commit('SET_GAME_PHASE', 'auction')\n      startCountdown({\n        seconds: duration,\n        onTick: (s) => { this.$set(this, 'auctionCountdown', s); },\n        onDone: async () => { await this.onAuctionTimeUp() },\n        getRef: () => this.auctionTimer,\n        setRef: (id) => { this.auctionTimer = id },\n      })\n    },\n\n\n    \n    // 每轮之间的间歇计时器，结束后自动开始下一轮拍卖\n    startIntermissionTimer(duration = 10) {\n      this.$store.commit('SET_GAME_PHASE', 'intermission')\n      startCountdown({\n        seconds: duration,\n        onTick: (s) => { this.$set(this, 'auctionCountdown', s); },\n        onDone: async () => {\n          if (this.isOwner) {\n            await this.autoStartAuction()\n          }\n        },\n        getRef: () => this.auctionTimer,\n        setRef: (id) => { this.auctionTimer = id },\n      })\n    },\n    \n    // 自动开始拍卖\n    async autoStartAuction() {\n      try {\n        const rid = this.$store.state.roomId\n        const supabase = getSupabase()\n        await autoStartAuctionFlow({\n          roomId: rid,\n          store: this.$store,\n          supabase,\n          loadArtifacts: () => this.loadArtifacts(),\n          dispatchStartAuction: (art) => this.$store.dispatch('startAuction', art),\n          startAuctionTimer: (sec) => this.startAuctionTimer(sec),\n          roundCount: this.roundCount,\n          totalRounds: this.totalRounds,\n          setRoundCount: (n) => { this.roundCount = n },\n        })\n      } catch (e) { console.warn('[game] autoStartAuction failed', e) }\n    },\n    \n    // 发送聊天消息\n    async sendMessage() {\n      if (!this.newMessage.trim() || !this.user) return\n      const message = { \n        id: Date.now(), \n        userId: this.user.id, \n        username: this.getNameFor(this.user.id), \n        content: this.newMessage.trim(), \n        timestamp: Date.now() \n      }\n      // 本地立即显示，提供即时反馈\n      this.chatMessages.push(message)\n      this.newMessage = ''\n      \n      // 滚动到底部\n      this.$nextTick(() => {\n        const chatContainer = this.$refs.chatContainer\n        if (chatContainer) { chatContainer.scrollTop = chatContainer.scrollHeight }\n      })\n      \n      // 发送到服务器，广播给所有玩家\n      const rid = this.$store.state.roomId\n      if (rid) { \n        try { \n          const supabase = getSupabase()\n          await sendChatMessage({ supabase, roomId: rid, message }) \n        } catch (e) { \n          console.warn('[game] sendMessage failed', e)\n          // 发送失败时，可以选择移除本地消息或保留（保留提供更好的用户体验）\n        } \n      }\n    },\n    \n    // 格式化消息时间\n    formatMessageTime(timestamp) { return formatMessageTimeHelper(timestamp) }\n    ,\n\n    // 计算最终得分并确定赢家\n    async computeFinalScores() {\n      try {\n        const rid = this.$store.state.roomId\n        if (!rid) return\n        const supabase = getSupabase()\n        const { data: rows } = await supabase\n          .from('room_artifacts')\n          .select('owner_user_id, artifact_id')\n          .eq('room_id', rid)\n        const userToArtifacts = {}\n        ;(rows || []).forEach(r => {\n          if (!userToArtifacts[r.owner_user_id]) userToArtifacts[r.owner_user_id] = []\n          userToArtifacts[r.owner_user_id].push(r.artifact_id)\n        })\n\n        const collections = Array.isArray(this.collections) ? this.collections : []\n        const scores = Object.keys(userToArtifacts).map(uid => {\n          const owned = userToArtifacts[uid]\n          // 收藏集分数\n          let collectionScore = 0\n          collections.forEach(col => {\n            const current = getCollectionCountUtil({ artifactMap: this.artifactMap, ownedArtifactIds: owned, collection: col })\n            if (current >= (col.requiredCount || 1)) collectionScore += (col.rewardPoints || 0)\n          })\n          // 零散奇物分数（基础价值一半，向下取整）\n          let artifactScore = 0\n          owned.forEach(aid => {\n            const a = this.artifactMap[aid]\n            if (a && typeof a.baseValue === 'number') artifactScore += Math.floor(a.baseValue / 2)\n          })\n        \n          const total = collectionScore + artifactScore\n          return {\n            userId: uid,\n            name: this.getNameFor(uid),\n            avatar: this.getAvatarFor(uid),\n            collectionScore,\n            artifactScore,\n            total\n          }\n        })\n\n        const sorted = scores.sort((a, b) => b.total - a.total)\n        this.finalScores = sorted\n        this.winnerInfo = sorted[0] || null\n\n        if (this.winnerInfo) {\n          this.$store.commit('ADD_GAME_LOG', { timestamp: Date.now(), message: `本局结束，胜者：${this.winnerInfo.name}（总分 ${this.winnerInfo.total}）` })\n        }\n      } catch (e) { console.warn('[game] computeFinalScores failed', e) }\n    },\n\n    // 开启/关闭文物讲述\n    openNarration() {\n      // 构造讲述文本，包含基本介绍 + 故事\n      const base = `${this.selectedCard.name}，来自 ${this.selectedCard.era}${this.selectedCard.location ? ' · ' + this.selectedCard.location : ''}。\\n`\n      const story = (this.selectedCard.story || '').trim()\n      const full = `${base}${story}`.trim()\n      // 打字机效果\n      this.typingText = ''\n      this.showNarration = true\n      const speed = (firstLoginDialogueConfig && firstLoginDialogueConfig.animations && firstLoginDialogueConfig.animations.textTypingSpeed) || 30\n      if (this.typingTimer) { clearInterval(this.typingTimer); this.typingTimer = null }\n      let i = 0\n      this.typingTimer = setInterval(() => {\n        if (i >= full.length) {\n          clearInterval(this.typingTimer)\n          this.typingTimer = null\n        } else {\n          this.typingText += full[i]\n          i += 1\n        }\n      }, speed)\n    },\n    closeNarration() {\n      if (this.typingTimer) { clearInterval(this.typingTimer); this.typingTimer = null }\n      this.showNarration = false\n      this.typingText = ''\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped src=\"./index.scss\"></style>"],"mappings":"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","ignoreList":[]}]}