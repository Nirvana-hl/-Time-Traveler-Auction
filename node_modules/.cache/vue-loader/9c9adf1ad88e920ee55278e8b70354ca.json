{"remainingRequest":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\pages\\profile\\profile.vue?vue&type=style&index=0&id=c010c622&scoped=true&lang=css","dependencies":[{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\-Time-Traveler-Auction\\src\\pages\\profile\\profile.vue","mtime":1762087622752},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\css-loader\\dist\\cjs.js","mtime":1762215255441},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1762215257236},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\postcss-loader\\src\\index.js","mtime":1762215256107},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1762215254891},{"path":"D:\\大学生活\\大三\\全栈ai\\项目\\node_modules\\vue-loader\\lib\\index.js","mtime":1762215256637}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoucHJvZmlsZS1jb250YWluZXIgew0KICBtaW4taGVpZ2h0OiAxMDB2aDsNCiAgZGlzcGxheTogZmxleDsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogIHBhZGRpbmc6IDI0cHg7DQogIGJhY2tncm91bmQ6DQogICAgcmFkaWFsLWdyYWRpZW50KDE0MDBweCBjaXJjbGUgYXQgMTUlIDAlLCAjMGIxMjIwLCAjMGYxNzJhKSwNCiAgICByYWRpYWwtZ3JhZGllbnQoOTAwcHggY2lyY2xlIGF0IDg1JSAyNSUsIHJnYmEoOTksMTAyLDI0MSwwLjEyKSwgcmdiYSg5OSwxMDIsMjQxLDApKTsNCn0NCg0KLnByb2ZpbGUtY2FyZCB7DQogIHdpZHRoOiA3MjBweDsNCiAgYmFja2dyb3VuZDogIzBmMTcyYTsNCiAgYm9yZGVyOiAxcHggc29saWQgIzFmMjkzNzsNCiAgYm9yZGVyLXJhZGl1czogMTZweDsNCiAgYm94LXNoYWRvdzogMCAyMHB4IDQwcHggcmdiYSgyLDYsMjMsMC41KTsNCiAgcGFkZGluZzogMjRweDsNCiAgY29sb3I6ICNlMmU4ZjA7DQp9DQoNCi50aXRsZSB7DQogIG1hcmdpbjogMCAwIDIwcHg7DQogIGZvbnQtc2l6ZTogMjRweDsNCiAgZm9udC13ZWlnaHQ6IDYwMDsNCn0NCg0KLmF2YXRhci1zZWN0aW9uIHsNCiAgZGlzcGxheTogZmxleDsNCiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogIG1hcmdpbi1ib3R0b206IDI0cHg7DQp9DQoNCi5hdmF0YXItY29udGFpbmVyIHsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQouYXZhdGFyLXdyYXBwZXIgew0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouYXZhdGFyIHsNCiAgd2lkdGg6IDEyMHB4Ow0KICBoZWlnaHQ6IDEyMHB4Ow0KICBib3JkZXItcmFkaXVzOiA1MCU7DQogIGJvcmRlcjogM3B4IHNvbGlkICMxZjI5Mzc7DQogIHRyYW5zaXRpb246IGJvcmRlci1jb2xvciAwLjNzIGVhc2U7DQogIG9iamVjdC1maXQ6IGNvdmVyOw0KfQ0KDQouYXZhdGFyOmhvdmVyIHsNCiAgYm9yZGVyLWNvbG9yOiAjM2I4MmY2Ow0KfQ0KDQoudXBsb2FkLW92ZXJsYXkgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogMDsNCiAgbGVmdDogMDsNCiAgcmlnaHQ6IDA7DQogIGJvdHRvbTogMDsNCiAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjcpOw0KICBib3JkZXItcmFkaXVzOiA1MCU7DQogIGRpc3BsYXk6IGZsZXg7DQogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICBjb2xvcjogd2hpdGU7DQogIGZvbnQtc2l6ZTogMTJweDsNCn0NCg0KLnVwbG9hZC1zcGlubmVyIHsNCiAgd2lkdGg6IDIwcHg7DQogIGhlaWdodDogMjBweDsNCiAgYm9yZGVyOiAycHggc29saWQgI2ZmZmZmZjsNCiAgYm9yZGVyLXRvcDogMnB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KICBib3JkZXItcmFkaXVzOiA1MCU7DQogIGFuaW1hdGlvbjogc3BpbiAxcyBsaW5lYXIgaW5maW5pdGU7DQogIG1hcmdpbi1ib3R0b206IDRweDsNCn0NCg0KQGtleWZyYW1lcyBzcGluIHsNCiAgMCUgeyB0cmFuc2Zvcm06IHJvdGF0ZSgwZGVnKTsgfQ0KICAxMDAlIHsgdHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTsgfQ0KfQ0KDQouYXZhdGFyLWVkaXQtYnRuIHsNCiAgZGlzcGxheTogYmxvY2s7DQogIG1hcmdpbjogOHB4IGF1dG8gMDsNCiAgcGFkZGluZzogNnB4IDEycHg7DQogIGJhY2tncm91bmQ6ICMxZjI5Mzc7DQogIGNvbG9yOiAjZTJlOGYwOw0KICBib3JkZXI6IG5vbmU7DQogIGJvcmRlci1yYWRpdXM6IDZweDsNCiAgZm9udC1zaXplOiAxMnB4Ow0KICBjdXJzb3I6IHBvaW50ZXI7DQogIHRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgMC4zcyBlYXNlOw0KfQ0KDQouYXZhdGFyLWVkaXQtYnRuOmhvdmVyIHsNCiAgYmFja2dyb3VuZDogIzM3NDE1MTsNCn0NCg0KLmluZm8tc2VjdGlvbiB7DQogIG1hcmdpbi1ib3R0b206IDI0cHg7DQp9DQoNCi5mb3JtLWZpZWxkIHsNCiAgbWFyZ2luLWJvdHRvbTogMTZweDsNCn0NCg0KLmZvcm0tZmllbGQgbGFiZWwgew0KICBkaXNwbGF5OiBibG9jazsNCiAgZm9udC1zaXplOiAxNHB4Ow0KICBjb2xvcjogIzk0YTNiODsNCiAgbWFyZ2luLWJvdHRvbTogNnB4Ow0KfQ0KDQouZm9ybS1maWVsZCBpbnB1dCB7DQogIHdpZHRoOiAxMDAlOw0KICBwYWRkaW5nOiAxMnB4Ow0KICBib3JkZXItcmFkaXVzOiA4cHg7DQogIGJhY2tncm91bmQ6ICMwYjEyMjA7DQogIGNvbG9yOiAjZTJlOGYwOw0KICBib3JkZXI6IDFweCBzb2xpZCAjMWYyOTM3Ow0KICBvdXRsaW5lOiBub25lOw0KICBmb250LXNpemU6IDE0cHg7DQp9DQoNCi5mb3JtLWZpZWxkIGlucHV0OmZvY3VzIHsNCiAgYm94LXNoYWRvdzogMCAwIDAgMnB4IHJnYmEoNTksMTMwLDI0NiwwLjM1KTsNCiAgYm9yZGVyLWNvbG9yOiAjM2I4MmY2Ow0KfQ0KDQouZm9ybS1maWVsZCBpbnB1dC5kaXNhYmxlZC1pbnB1dCB7DQogIGJhY2tncm91bmQ6ICMxZjI5Mzc7DQogIGNvbG9yOiAjOTRhM2I4Ow0KICBjdXJzb3I6IG5vdC1hbGxvd2VkOw0KfQ0KDQouYWN0aW9ucyB7DQogIGRpc3BsYXk6IGZsZXg7DQogIGdhcDogMTJweDsNCiAgbWFyZ2luLWJvdHRvbTogMjRweDsNCn0NCg0KLmJ0biB7DQogIHBhZGRpbmc6IDEycHggMjBweDsNCiAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICBiYWNrZ3JvdW5kOiAjMWYyOTM3Ow0KICBjb2xvcjogI2UyZThmMDsNCiAgYm9yZGVyOiBub25lOw0KICBjdXJzb3I6IHBvaW50ZXI7DQogIGZvbnQtc2l6ZTogMTRweDsNCiAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZTsNCn0NCg0KLmJ0bjpob3ZlciB7DQogIGJhY2tncm91bmQ6ICMzNzQxNTE7DQogIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsNCn0NCg0KLmJ0bi5wcmltYXJ5IHsNCiAgYmFja2dyb3VuZDogIzNiODJmNjsNCiAgY29sb3I6ICNmZmY7DQp9DQoNCi5idG4ucHJpbWFyeTpob3ZlciB7DQogIGJhY2tncm91bmQ6ICMyNTYzZWI7DQp9DQoNCi5idG4uZGFuZ2VyIHsNCiAgYmFja2dyb3VuZDogI2VmNDQ0NDsNCiAgY29sb3I6ICNmZmY7DQp9DQoNCi5idG4uZGFuZ2VyOmhvdmVyIHsNCiAgYmFja2dyb3VuZDogI2RjMjYyNjsNCn0NCg0KLmRpdmlkZXIgew0KICBoZWlnaHQ6IDFweDsNCiAgYmFja2dyb3VuZDogIzFmMjkzNzsNCiAgbWFyZ2luOiAyNHB4IDA7DQp9DQoNCi5zdGF0cy1zZWN0aW9uIGgzIHsNCiAgbWFyZ2luOiAwIDAgMTZweDsNCiAgZm9udC1zaXplOiAxOHB4Ow0KICBmb250LXdlaWdodDogNjAwOw0KfQ0KDQouc3RhdHMtZ3JpZCB7DQogIGRpc3BsYXk6IGdyaWQ7DQogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDQsIDFmcik7DQogIGdhcDogMTZweDsNCn0NCg0KLnN0YXQtaXRlbSB7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgcGFkZGluZzogMTZweDsNCiAgYmFja2dyb3VuZDogIzBiMTIyMDsNCiAgYm9yZGVyOiAxcHggc29saWQgIzFmMjkzNzsNCiAgYm9yZGVyLXJhZGl1czogOHB4Ow0KfQ0KDQouc3RhdC12YWx1ZSB7DQogIGZvbnQtc2l6ZTogMjRweDsNCiAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgY29sb3I6ICMzYjgyZjY7DQogIG1hcmdpbi1ib3R0b206IDRweDsNCn0NCg0KLnN0YXQtbGFiZWwgew0KICBmb250LXNpemU6IDEycHg7DQogIGNvbG9yOiAjOTRhM2I4Ow0KfQ0KDQoucHJvZmlsZS1hY3Rpb25zIHsNCiAgZGlzcGxheTogZmxleDsNCiAgZ2FwOiAxMnB4Ow0KICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCn0NCg0KLmVycm9yIHsNCiAgY29sb3I6ICNlZjQ0NDQ7DQogIG1hcmdpbi10b3A6IDEycHg7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg0KLnN1Y2Nlc3Mgew0KICBjb2xvcjogIzEwYjk4MTsNCiAgbWFyZ2luLXRvcDogMTJweDsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQpAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHsNCiAgLnByb2ZpbGUtY2FyZCB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgbWFyZ2luOiAwIDE2cHg7DQogIH0NCiAgDQogIC5zdGF0cy1ncmlkIHsNCiAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgyLCAxZnIpOw0KICB9DQp9DQo="},{"version":3,"sources":["profile.vue"],"names":[],"mappings":";AA8XA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"profile.vue","sourceRoot":"src/pages/profile","sourcesContent":["<template>\r\n  <div class=\"profile-container\">\r\n    <div class=\"profile-card\">\r\n      <h2 class=\"title\">个人中心</h2>\r\n      \r\n      <div class=\"user-info\" v-if=\"user\">\r\n        <div class=\"avatar-section\">\r\n          <div class=\"avatar-container\">\r\n            <div class=\"avatar-wrapper\" @click=\"changeAvatar\">\r\n              <img \r\n                class=\"avatar\" \r\n                :src=\"userProfile.avatar || defaultAvatar\" \r\n                alt=\"用户头像\"\r\n                @error=\"handleAvatarError\"\r\n              />\r\n              <div v-if=\"isUploading\" class=\"upload-overlay\">\r\n                <div class=\"upload-spinner\"></div>\r\n                <span>上传中...</span>\r\n              </div>\r\n            </div>\r\n            <button class=\"avatar-edit-btn\" @click=\"changeAvatar\" :disabled=\"isUploading\">\r\n              {{ isUploading ? '上传中...' : '更换头像' }}\r\n            </button>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"info-section\">\r\n          <div class=\"form-field\">\r\n            <label>用户名</label>\r\n            <input \r\n              v-model=\"userProfile.username\" \r\n              type=\"text\" \r\n              placeholder=\"请输入用户名\"\r\n              :disabled=\"!isEditing\"\r\n            />\r\n          </div>\r\n          \r\n          <div class=\"form-field\">\r\n            <label>邮箱</label>\r\n            <input \r\n              v-model=\"user.email\" \r\n              type=\"email\" \r\n              disabled\r\n              class=\"disabled-input\"\r\n            />\r\n          </div>\r\n          \r\n          <div class=\"form-field\">\r\n            <label>注册时间</label>\r\n            <input \r\n              :value=\"formatDate(user.created_at)\" \r\n              type=\"text\" \r\n              disabled\r\n              class=\"disabled-input\"\r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"actions\">\r\n          <button \r\n            class=\"btn\" \r\n            @click=\"toggleEdit\"\r\n            v-if=\"!isEditing\"\r\n          >\r\n            编辑资料\r\n          </button>\r\n          <template v-else>\r\n            <button class=\"btn primary\" @click=\"saveProfile\">保存</button>\r\n            <button class=\"btn\" @click=\"cancelEdit\">取消</button>\r\n          </template>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"divider\"></div>\r\n      \r\n      <!-- 游戏统计 -->\r\n      <div class=\"stats-section\">\r\n        <h3>游戏统计</h3>\r\n        <div class=\"stats-grid\">\r\n          <div class=\"stat-item\">\r\n            <div class=\"stat-value\">{{ gameStats.totalGames || 0 }}</div>\r\n            <div class=\"stat-label\">总游戏数</div>\r\n          </div>\r\n          <div class=\"stat-item\">\r\n            <div class=\"stat-value\">{{ gameStats.wins || 0 }}</div>\r\n            <div class=\"stat-label\">胜利次数</div>\r\n          </div>\r\n          <div class=\"stat-item\">\r\n            <div class=\"stat-value\">{{ gameStats.totalArtifacts || 0 }}</div>\r\n            <div class=\"stat-label\">获得奇物</div>\r\n          </div>\r\n          <div class=\"stat-item\">\r\n            <div class=\"stat-value\">{{ gameStats.totalEnergy || 0 }}</div>\r\n            <div class=\"stat-label\">总能量</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"divider\"></div>\r\n      \r\n      <!-- 操作按钮 -->\r\n      <div class=\"profile-actions\">\r\n        <button class=\"btn\" @click=\"$router.push('/menu')\">返回菜单</button>\r\n        <button class=\"btn danger\" @click=\"logout\">退出登录</button>\r\n      </div>\r\n      \r\n      <p v-if=\"errorMessage\" class=\"error\">{{ errorMessage }}</p>\r\n      <p v-if=\"successMessage\" class=\"success\">{{ successMessage }}</p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport authService from '../../services/auth-service'\r\nimport { getSupabase } from '../../services/supabase-client'\r\n\r\nexport default {\r\n  name: 'ProfilePage',\r\n  data() {\r\n    return {\r\n      user: null,\r\n      userProfile: {\r\n        username: '',\r\n        avatar: ''\r\n      },\r\n      gameStats: {\r\n        totalGames: 0,\r\n        wins: 0,\r\n        totalArtifacts: 0,\r\n        totalEnergy: 0\r\n      },\r\n      isEditing: false,\r\n      isUploading: false,\r\n      originalProfile: {},\r\n      errorMessage: '',\r\n      successMessage: ''\r\n    }\r\n  },\r\n  computed: {\r\n    defaultAvatar() {\r\n      if (!this.user) return ''\r\n      const code = (this.user.id || 'U').slice(0, 2).toUpperCase()\r\n      const bg = '334155'\r\n      const fg = 'e2e8f0'\r\n      const svg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120'><rect width='100%' height='100%' fill='#${bg}'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-size='48' fill='#${fg}' font-family='Arial, sans-serif'>${code}</text></svg>`)\r\n      return `data:image/svg+xml;charset=utf-8,${svg}`\r\n    }\r\n  },\r\n  async mounted() {\r\n    await this.loadUserData()\r\n    await this.loadUserProfile()\r\n    await this.loadGameStats()\r\n  },\r\n  methods: {\r\n    async loadUserData() {\r\n      const user = await authService.getUser()\r\n      if (user) {\r\n        this.user = user\r\n        this.$store.commit('SET_USER', user)\r\n      } else {\r\n        this.$router.push('/login')\r\n      }\r\n    },\r\n    \r\n    async loadUserProfile() {\r\n      if (!this.user) return\r\n      \r\n      try {\r\n        const supabase = getSupabase()\r\n        const { data, error } = await supabase\r\n          .from('profiles')\r\n          .select('*')\r\n          .eq('id', this.user.id)\r\n          .single()\r\n        \r\n        if (error && error.code !== 'PGRST116') {\r\n          throw error\r\n        }\r\n        \r\n        if (data) {\r\n          this.userProfile = {\r\n            username: data.username || '',\r\n            avatar: data.avatar || ''\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('加载用户资料失败:', error)\r\n        this.errorMessage = '加载用户资料失败'\r\n      }\r\n    },\r\n    \r\n    async loadGameStats() {\r\n      if (!this.user) return\r\n      \r\n      try {\r\n        const supabase = getSupabase()\r\n        \r\n        // 获取游戏统计（这里需要根据实际的游戏数据表结构来查询）\r\n        // 暂时使用模拟数据\r\n        this.gameStats = {\r\n          totalGames: 0,\r\n          wins: 0,\r\n          totalArtifacts: 0,\r\n          totalEnergy: 0\r\n        }\r\n      } catch (error) {\r\n        console.error('加载游戏统计失败:', error)\r\n      }\r\n    },\r\n    \r\n    toggleEdit() {\r\n      this.isEditing = true\r\n      this.originalProfile = { ...this.userProfile }\r\n    },\r\n    \r\n    cancelEdit() {\r\n      this.isEditing = false\r\n      this.userProfile = { ...this.originalProfile }\r\n      this.errorMessage = ''\r\n      this.successMessage = ''\r\n    },\r\n    \r\n    async saveProfile() {\r\n      if (!this.user) return\r\n      \r\n      try {\r\n        const supabase = getSupabase()\r\n        \r\n        // 构建更新数据，只包含有值的字段\r\n        const updateData = {\r\n          id: this.user.id,\r\n          username: this.userProfile.username || null\r\n        }\r\n        \r\n        // 只有当avatar不为空时才包含avatar字段\r\n        if (this.userProfile.avatar) {\r\n          updateData.avatar = this.userProfile.avatar\r\n        }\r\n        \r\n        // 更新或插入用户资料\r\n        const { error } = await supabase\r\n          .from('profiles')\r\n          .upsert(updateData)\r\n        \r\n        if (error) throw error\r\n        \r\n        // 同步更新到全局store，确保菜单/房间界面立即显示最新用户名与头像\r\n        const newUser = {\r\n          ...this.$store.state.user,\r\n          username: this.userProfile.username || (this.$store.state.user && this.$store.state.user.username),\r\n          avatar: this.userProfile.avatar || (this.$store.state.user && this.$store.state.user.avatar)\r\n        }\r\n        this.$store.commit('SET_USER', newUser)\r\n        \r\n        this.isEditing = false\r\n        this.successMessage = '资料保存成功'\r\n        setTimeout(() => {\r\n          this.successMessage = ''\r\n        }, 3000)\r\n        \r\n      } catch (error) {\r\n        console.error('保存用户资料失败:', error)\r\n        this.errorMessage = '保存用户资料失败: ' + (error.message || '未知错误')\r\n      }\r\n    },\r\n    \r\n    changeAvatar() {\r\n      // 创建文件输入元素\r\n      const input = document.createElement('input')\r\n      input.type = 'file'\r\n      input.accept = 'image/*'\r\n      input.style.display = 'none'\r\n      \r\n      input.onchange = async (event) => {\r\n        const file = event.target.files[0]\r\n        if (!file) return\r\n        \r\n        // 检查文件大小（限制为2MB）\r\n        if (file.size > 2 * 1024 * 1024) {\r\n          this.errorMessage = '图片大小不能超过2MB'\r\n          return\r\n        }\r\n        \r\n        // 检查文件类型\r\n        if (!file.type.startsWith('image/')) {\r\n          this.errorMessage = '请选择图片文件'\r\n          return\r\n        }\r\n        \r\n        try {\r\n          await this.uploadAvatar(file)\r\n        } catch (error) {\r\n          console.error('头像上传失败:', error)\r\n          this.errorMessage = '头像上传失败'\r\n        }\r\n      }\r\n      \r\n      // 触发文件选择\r\n      document.body.appendChild(input)\r\n      input.click()\r\n      document.body.removeChild(input)\r\n    },\r\n    \r\n    async uploadAvatar(file) {\r\n      this.isUploading = true\r\n      this.errorMessage = ''\r\n      \r\n      try {\r\n        const supabase = getSupabase()\r\n        \r\n        // 生成唯一的文件名\r\n        const fileExt = file.name.split('.').pop()\r\n        const fileName = `${this.user.id}_${Date.now()}.${fileExt}`\r\n        const filePath = `${this.user.id}/${fileName}`\r\n        \r\n        // 上传文件到Supabase Storage\r\n        const { error: uploadError } = await supabase.storage\r\n          .from('avatars')\r\n          .upload(filePath, file, {\r\n            cacheControl: '3600',\r\n            upsert: false\r\n          })\r\n        \r\n        if (uploadError) throw uploadError\r\n        \r\n        // 获取公开URL\r\n        const { data } = supabase.storage\r\n          .from('avatars')\r\n          .getPublicUrl(filePath)\r\n        \r\n        // 更新用户资料中的头像URL\r\n        this.userProfile.avatar = data.publicUrl\r\n        \r\n        // 自动保存\r\n        await this.saveProfile()\r\n        \r\n        this.successMessage = '头像上传成功'\r\n        setTimeout(() => {\r\n          this.successMessage = ''\r\n        }, 3000)\r\n        \r\n      } catch (error) {\r\n        console.error('头像上传失败:', error)\r\n        this.errorMessage = '头像上传失败: ' + (error.message || '未知错误')\r\n      } finally {\r\n        this.isUploading = false\r\n      }\r\n    },\r\n    \r\n    handleAvatarError(event) {\r\n      // 头像加载失败时使用默认头像\r\n      event.target.src = this.defaultAvatar\r\n    },\r\n    \r\n    formatDate(dateString) {\r\n      if (!dateString) return '-'\r\n      const date = new Date(dateString)\r\n      return date.toLocaleDateString('zh-CN', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      })\r\n    },\r\n    \r\n    async logout() {\r\n      try {\r\n        await authService.signOut()\r\n        this.$store.commit('SET_USER', null)\r\n        this.$store.commit('SET_ROOM_ID', null)\r\n        this.$router.push('/login')\r\n      } catch (error) {\r\n        console.error('退出登录失败:', error)\r\n        this.errorMessage = '退出登录失败'\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.profile-container {\r\n  min-height: 100vh;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 24px;\r\n  background:\r\n    radial-gradient(1400px circle at 15% 0%, #0b1220, #0f172a),\r\n    radial-gradient(900px circle at 85% 25%, rgba(99,102,241,0.12), rgba(99,102,241,0));\r\n}\r\n\r\n.profile-card {\r\n  width: 720px;\r\n  background: #0f172a;\r\n  border: 1px solid #1f2937;\r\n  border-radius: 16px;\r\n  box-shadow: 0 20px 40px rgba(2,6,23,0.5);\r\n  padding: 24px;\r\n  color: #e2e8f0;\r\n}\r\n\r\n.title {\r\n  margin: 0 0 20px;\r\n  font-size: 24px;\r\n  font-weight: 600;\r\n}\r\n\r\n.avatar-section {\r\n  display: flex;\r\n  justify-content: center;\r\n  margin-bottom: 24px;\r\n}\r\n\r\n.avatar-container {\r\n  text-align: center;\r\n}\r\n\r\n.avatar-wrapper {\r\n  position: relative;\r\n  display: inline-block;\r\n  cursor: pointer;\r\n}\r\n\r\n.avatar {\r\n  width: 120px;\r\n  height: 120px;\r\n  border-radius: 50%;\r\n  border: 3px solid #1f2937;\r\n  transition: border-color 0.3s ease;\r\n  object-fit: cover;\r\n}\r\n\r\n.avatar:hover {\r\n  border-color: #3b82f6;\r\n}\r\n\r\n.upload-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.7);\r\n  border-radius: 50%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: white;\r\n  font-size: 12px;\r\n}\r\n\r\n.upload-spinner {\r\n  width: 20px;\r\n  height: 20px;\r\n  border: 2px solid #ffffff;\r\n  border-top: 2px solid transparent;\r\n  border-radius: 50%;\r\n  animation: spin 1s linear infinite;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n\r\n.avatar-edit-btn {\r\n  display: block;\r\n  margin: 8px auto 0;\r\n  padding: 6px 12px;\r\n  background: #1f2937;\r\n  color: #e2e8f0;\r\n  border: none;\r\n  border-radius: 6px;\r\n  font-size: 12px;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s ease;\r\n}\r\n\r\n.avatar-edit-btn:hover {\r\n  background: #374151;\r\n}\r\n\r\n.info-section {\r\n  margin-bottom: 24px;\r\n}\r\n\r\n.form-field {\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.form-field label {\r\n  display: block;\r\n  font-size: 14px;\r\n  color: #94a3b8;\r\n  margin-bottom: 6px;\r\n}\r\n\r\n.form-field input {\r\n  width: 100%;\r\n  padding: 12px;\r\n  border-radius: 8px;\r\n  background: #0b1220;\r\n  color: #e2e8f0;\r\n  border: 1px solid #1f2937;\r\n  outline: none;\r\n  font-size: 14px;\r\n}\r\n\r\n.form-field input:focus {\r\n  box-shadow: 0 0 0 2px rgba(59,130,246,0.35);\r\n  border-color: #3b82f6;\r\n}\r\n\r\n.form-field input.disabled-input {\r\n  background: #1f2937;\r\n  color: #94a3b8;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.actions {\r\n  display: flex;\r\n  gap: 12px;\r\n  margin-bottom: 24px;\r\n}\r\n\r\n.btn {\r\n  padding: 12px 20px;\r\n  border-radius: 8px;\r\n  background: #1f2937;\r\n  color: #e2e8f0;\r\n  border: none;\r\n  cursor: pointer;\r\n  font-size: 14px;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.btn:hover {\r\n  background: #374151;\r\n  transform: translateY(-1px);\r\n}\r\n\r\n.btn.primary {\r\n  background: #3b82f6;\r\n  color: #fff;\r\n}\r\n\r\n.btn.primary:hover {\r\n  background: #2563eb;\r\n}\r\n\r\n.btn.danger {\r\n  background: #ef4444;\r\n  color: #fff;\r\n}\r\n\r\n.btn.danger:hover {\r\n  background: #dc2626;\r\n}\r\n\r\n.divider {\r\n  height: 1px;\r\n  background: #1f2937;\r\n  margin: 24px 0;\r\n}\r\n\r\n.stats-section h3 {\r\n  margin: 0 0 16px;\r\n  font-size: 18px;\r\n  font-weight: 600;\r\n}\r\n\r\n.stats-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(4, 1fr);\r\n  gap: 16px;\r\n}\r\n\r\n.stat-item {\r\n  text-align: center;\r\n  padding: 16px;\r\n  background: #0b1220;\r\n  border: 1px solid #1f2937;\r\n  border-radius: 8px;\r\n}\r\n\r\n.stat-value {\r\n  font-size: 24px;\r\n  font-weight: 600;\r\n  color: #3b82f6;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n.stat-label {\r\n  font-size: 12px;\r\n  color: #94a3b8;\r\n}\r\n\r\n.profile-actions {\r\n  display: flex;\r\n  gap: 12px;\r\n  justify-content: center;\r\n}\r\n\r\n.error {\r\n  color: #ef4444;\r\n  margin-top: 12px;\r\n  text-align: center;\r\n}\r\n\r\n.success {\r\n  color: #10b981;\r\n  margin-top: 12px;\r\n  text-align: center;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .profile-card {\r\n    width: 100%;\r\n    margin: 0 16px;\r\n  }\r\n  \r\n  .stats-grid {\r\n    grid-template-columns: repeat(2, 1fr);\r\n  }\r\n}\r\n</style>\r\n"]}]}